(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"8Hfl":function(t,e,a){"use strict";a.r(e),a.d(e,"DatalinkEditModule",(function(){return Fr}));var n=a("ofXK"),i=a("tyNb"),r=a("itXk"),o=a("soiQ"),s=a("fXoL"),l=a("4Y1E"),c=a("rgmq"),u=a("Z+eP"),m=a("2Vo4"),b=a("ElCs"),h=a("cvPx");let d=(()=>{class t{constructor(t,e,a){this.hubService=t,this.authService=e,this.hubFormsService=a,this.showAllErrors=!1,this.logger=new c.a("datalink-edit.service"),this.savingDatalink=new m.a(!1)}ngOnInit(){}init(t){this._hubCache=t}ngOnDestroy(){this.hubFormsService.ngOnDestroy()}savingDataLinkObservable(){return this.savingDatalink.asObservable()}getValidationTransform(){return this.logger.LogC(()=>"getValidationTransform",c.b.Trace),this.hubFormsService.currentForm.controls.dexihDatalinkTransforms.controls.find(t=>t.value.transformType===o.lc.Validation)}getDatalinkTransform(t){return this.logger.LogC(()=>"getDatalinkTransform",c.b.Trace),this.hubFormsService.currentForm.controls.dexihDatalinkTransforms.controls.find(e=>e.value.key===t)}getDatalinkTransformItem(t,e){this.logger.LogC(()=>`getDatalinkTransformItem, key:${e}.`,c.b.Trace);let a=t.controls.dexihDatalinkTransformItems.controls.find(t=>t.value.key===e);return this.logger.LogC(()=>"getDatalinkTransformItem finished.",c.b.Trace),a}fixMappings(t){let e=new u.b;t.controls.dexihDatalinkTransforms.controls.forEach(t=>{let a=t.controls.runTime.value.inputColumns,n=null;t.value.joinDatalinkTable&&(n=t.value.joinDatalinkTable.dexihDatalinkColumns);let i=this.getNodeColumns(a);this.fixMapping(i,t.controls.nodeDatalinkColumn),this.fixMapping(n,t.controls.joinSortDatalinkColumn),t.controls.nodeDatalinkColumn.value&&(a=e.getAvailableColumns(a,t.controls.nodeDatalinkColumn.value.key,0)),t.controls.dexihDatalinkTransformItems.controls.forEach(t=>{this.fixMapping(a,t.controls.sourceDatalinkColumn),this.fixMapping(n,t.controls.joinDatalinkColumn),this.fixMapping(a,t.controls.filterDatalinkColumn),t.controls.dexihFunctionParameters.controls.forEach(t=>{switch(t.controls.direction.value){case o.Vb.Input:this.fixMapping(a,t.controls.datalinkColumn);break;case o.Vb.Join:this.fixMapping(n,t.controls.datalinkColumn)}t.controls.arrayParameters.controls.forEach(t=>{switch(t.controls.direction.value){case o.Vb.Input:this.fixMapping(a,t.controls.datalinkColumn);break;case o.Vb.Join:this.fixMapping(n,t.controls.datalinkColumn)}})})})})}getNodeColumns(t){let e=[];return t&&t.filter(t=>t.dataType===o.pc.Node&&t.isValid).forEach(t=>{e.push(t),t.childColumns&&t.childColumns.length>0&&(e=e.concat(this.getNodeColumns(t.childColumns)))}),e}fixMapping(t,e){let a=e.value;if(t&&a&&t.findIndex(t=>t.key===a.key)<0){let n=t.find(t=>t.name===a.name&&t.columnGroup===a.columnGroup);n||(n=t.find(t=>t.name===a.name)),n&&e.setValue(n)}}getFunctionType(t){let e;switch(t.transformType){case o.lc.Filter:e=o.Cb.Condition;break;case o.lc.Mapping:e=o.Cb.Map;break;case o.lc.Join:e=o.Cb.JoinCondition;break;case o.lc.Group:case o.lc.Aggregate:e=o.Cb.Aggregate;break;case o.lc.Series:e=o.Cb.Series;break;case o.lc.Sort:e=o.Cb.Sort;break;case o.lc.Validation:e=o.Cb.Validate;break;case o.lc.Rows:e=o.Cb.Rows;break;case o.lc.Lookup:e=o.Cb.JoinCondition}return e}getVariables(){return this.hubFormsService.currentForm.controls.parameters.value.map(t=>"{"+t.name+"}").concat(this._hubCache.hub.dexihHubVariables.map(t=>"{"+t.name+"}"))}getColumnGroups(t){let e=null,a=[],n=null;return t.filter(t=>t.isValid).sort((t,e)=>t.position-e.position).forEach(t=>{let i=t.columnGroup?t.columnGroup:"(un-grouped)";i!==e&&(n&&a.push({group:e,columns:n}),e=i,n=[]),n.push(t)}),n&&n.length>0&&a.push({group:e,columns:n}),a}insertDatalinkTransformItem(t,e){this.logger.LogC(()=>"insertDatalinkTransformItem",c.b.Trace);let a=e.value,n=t.controls.dexihDatalinkTransformItems;if(a.key){let e=n.controls.findIndex(t=>t.value.key===a.key);n.removeAt(e);let i=this.hubFormsService.datalinkDatalinkTransformItemFormGroup(t,a);n.push(i)}else{a.key=this._hubCache.getNextSequence(),a.position=0===n.controls.length?1:Math.max.apply(Math,n.controls.map(t=>t.value.position))+1;let e=this.hubFormsService.datalinkDatalinkTransformItemFormGroup(t,a);n.push(e)}return this.fixMappings(this.hubFormsService.currentForm),this.logger.LogC(()=>"insertDatalinkTransformItem finished",c.b.Trace),a}deleteDatalinkTransformItem(t,e){this.logger.LogC(()=>"deleteDatalinkTransformItem",c.b.Trace);let a=t.controls.dexihDatalinkTransformItems,n=a.controls.indexOf(e);a.removeAt(n),this.fixMappings(this.hubFormsService.currentForm)}deleteDatalinkTarget(t,e){this.logger.LogC(()=>"deleteDatalinkTarget",c.b.Trace);let a=t.controls.dexihDatalinkTargets,n=a.controls.findIndex(t=>t.value.key===e);n>=0&&a.removeAt(n)}insertDatalinkTransform(t,e){this.logger.LogC(()=>"insertDatalinkTransform",c.b.Trace);let a=this.hubFormsService.currentForm.controls.dexihDatalinkTransforms,n=new o.w,i=-1;switch(a.controls.forEach(t=>{t.value.key<=i&&(i=t.value.key-1)}),this.logger.LogC(()=>"insertDatalinkTransform key:"+i,c.b.Trace),n.key=i,n.transformType=e.transformType,n.transformAssemblyName=e.transformAssemblyName,n.transformClassName=e.transformClassName,n.dexihDatalinkTransformItems=new Array,n.isValid=!0,e.transformType){case o.lc.Group:case o.lc.Rows:case o.lc.Mapping:n.passThroughColumns=!1;break;default:n.passThroughColumns=!0}if(e.transformType!==o.lc.Join&&e.transformType!==o.lc.Lookup&&e.transformType!==o.lc.Concatenate||(n.joinDatalinkTable=new o.r,n.joinDatalinkTable.key=this._hubCache.getNextSequence()),e.transformType===o.lc.Series){let t=new o.x;t.transformItemType=o.kc.Series,t.position=0,t.isValid=!0,n.dexihDatalinkTransformItems.push(t)}n.position=t;let r=this.hubFormsService.datalinkTransformFormGroup(n);return a.push(r),this.resetDatalinkTransformPositions(),this.logger.LogC(()=>"insertDatalinkTransform finished.",c.b.Trace),r}deleteDatalinkTransform(t){return new Promise(e=>{this.authService.confirmDialog("Delete Transform",`Are you sure you would like to remove the transform ${t.name}?`).then(a=>{if(a){let e=this.hubFormsService.currentForm.controls.dexihDatalinkTransforms,a=e.controls.findIndex(e=>e.value.key===t.key);e.removeAt(a),this.resetDatalinkTransformPositions()}e(a)}).catch(()=>{e(!1)})})}resetDatalinkTransformPositions(){return t=this,void 0,a=function*(){const t=this.hubFormsService.currentForm.controls.dexihDatalinkTransforms;let e=yield this.hubService.GetUserConfigTransformReference(),a=10;t.controls.sort((t,e)=>t.value.position-e.value.position).forEach(t=>{const n=t;e.find(e=>e.transformClassName===t.value.transformClassName)?(n.controls.position.setValue(a),a+=10):n.controls.position.setValue(1e6)})},new((e=void 0)||(e=Promise))((function(n,i){function r(t){try{s(a.next(t))}catch(e){i(e)}}function o(t){try{s(a.throw(t))}catch(e){i(e)}}function s(t){var a;t.done?n(t.value):(a=t.value,a instanceof e?a:new e((function(t){t(a)}))).then(r,o)}s((a=a.apply(t,[])).next())}));var t,e,a}importFunctionMappings(t,e,a){let n=this.hubFormsService.getDatalinkValue();return this.hubService.hubPostRemote("/api/Hub/ImportFunctionMappings",{hubKey:this._hubCache.hub.hubKey,remoteAgentId:this.hubService.getCurrentRemoteAgentId(),datalink:n,datalinkTransformKey:t,datalinkTransformItem:e},"Importing function mappings...",a)}reBuildDatalinkTable(t,e=!1){e?this.authService.confirmDialog("Rebuild Columns?","This action will load the selected table columns, and replace or delete any existing columns.  This may require fixing some mappings.  Do you want to proceed?").then(e=>{e&&this.doRebuildDatalinkTable(t)}).catch():this.doRebuildDatalinkTable(t)}doRebuildDatalinkTable(t){switch(t.dexihDatalinkColumns.forEach(t=>t.isValid=!1),t.sourceType){case o.gc.Table:let e=this._hubCache.getTable(t.sourceTableKey);e&&(t.name=e.name,t.dexihDatalinkColumns=this.mergeDatalinkColumns(t.name,t.key,e.dexihTableColumns,t.dexihDatalinkColumns));break;case o.gc.Datalink:let a=this._hubCache.hub.dexihDatalinks.find(e=>e.key===t.sourceDatalinkKey);if(a){let e;if(t.name=a.name,(new u.b).buildInputOutput(this._hubCache,a),0===a.dexihDatalinkTransforms.length)e=a.sourceDatalinkTable.dexihDatalinkColumns;else{let t=a.dexihDatalinkTransforms.sort((t,e)=>t.position-e.position);e=t[t.length-1].runTime.outputColumns}t.dexihDatalinkColumns=this.mergeDatalinkColumns(t.name,t.key,e,t.dexihDatalinkColumns)}break;case o.gc.Rows:t.name="Static Row Set";let n=t.dexihDatalinkColumns.find(t=>"RowNumber"===t.name);n||(n=new o.m,n.key=this._hubCache.getNextSequence(),n.datalinkTableKey=t.key,t.dexihDatalinkColumns.push(n)),n.name="RowNumber",n.logicalName=n.name,n.dataType=o.pc.Int32,n.isMandatory=!0,n.isValid=!0,n.description="The generated row number of the static row set"}}mergeDatalinkColumns(t,e,a,n){return a.forEach(a=>{let i=n.find(e=>e.name===a.name&&e.columnGroup===t);i||(i=n.find(t=>t.name===a.name)),i||(i=new o.m,i.key=this._hubCache.getNextSequence(),i.datalinkTableKey=e,n.push(i)),Object.keys(i).forEach(n=>{"childColumns"===n?i[n]=a[n]&&a[n].length>0?this.mergeDatalinkColumns(t,e,a[n],i[n]):[]:"key"!==n&&a[n]?i[n]=a[n]:"columnGroup"===n&&t&&(i[n]=i[n]&&i[n]!==t?t+"."+i[n]:t)})}),n}}return t.\u0275fac=function(e){return new(e||t)(s.Sb(l.a),s.Sb(b.a),s.Sb(h.a))},t.\u0275prov=s.Gb({token:t,factory:t.\u0275fac}),t})();var p=a("Wumg"),f=a("YcGA"),g=a("3Pt+");function k(t,e){if(1&t&&(s.Ob(0,"form",4),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-select",5),s.Nb(),s.Ob(4,"section"),s.Lb(5,"form-input",6),s.Nb(),s.Ob(6,"section"),s.Lb(7,"form-textarea",7),s.Nb(),s.Ob(8,"section"),s.Lb(9,"form-select",8),s.Nb(),s.Ob(10,"section"),s.Lb(11,"form-checkbox",9),s.Nb(),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.hc("formGroup",t.datalinkForm),s.yb(3),s.hc("items",t.eDatalinkTypeItems)("enableFilter",!1),s.yb(2),s.hc("autocapitalize",!0)("errors",t.editDatalinkService.hubFormsService.formErrors.name),s.yb(2),s.hc("showMarkdown",!0)("errors",t.editDatalinkService.hubFormsService.formErrors.description),s.yb(2),s.hc("items",t.eAlertLevelItems)("errors",t.editDatalinkService.hubFormsService.formErrors.alertLevel)("enableFilter",!1)}}let v=(()=>{class t{constructor(t,e,a){this.hubService=t,this.editDatalinkService=e,this.route=a,this.eConnectionPurpose=o.jb,this.eDatalinkTypeItems=o.ob.filter(t=>t.key>0),this.eAlertLevelItems=o.bb,this.eAlertLevel=o.ab}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle,this.datalinkForm=t[3]})}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Properties")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-properties-form"]],decls:4,vars:6,consts:[["title","Properties",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["title","Input Parameters",3,"showExpandButton"],[3,"showEdit","parameters","formsService"],[3,"formGroup"],["label","Datalink Type","formControlName","datalinkType","itemKey","key","itemName","description","iconClass","fa fa-database","note","Categorize the type of function this datalink is performing.",3,"items","enableFilter"],["label","Datalink Name","formControlName","name","placeholder","Enter the datalink name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["label","Alerting Level","formControlName","alertLevel","itemKey","key","itemName","description","iconClass","fa fa-bell","note","When alerts should be sent.",3,"items","errors","enableFilter"],["label","Datalink is shared in the catalog to users with read access.","formControlName","isShared"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,k,12,10,"form",1),s.Nb(),s.Ob(2,"dexih-widget-section",2),s.Lb(3,"input-parameters",3),s.Nb()),2&t&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",e.datalinkForm),s.yb(1),s.hc("showExpandButton",!0),s.yb(1),s.hc("showEdit",!0)("parameters",e.datalinkForm.controls.parameters)("formsService",e.editDatalinkService.hubFormsService))},directives:[p.T,n.t,f.a,g.I,g.t,g.l,p.E,g.s,g.j,p.D,p.H,p.A],encapsulation:2}),t})();var y=a("2v7R"),T=a("Npcx"),C=a("3WyZ"),F=a("iFLP"),D=a("64E1"),w=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function o(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}l((n=n.apply(t,e||[])).next())}))};function S(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-splitdropdown",4),s.Vb("buttonClick",(function(){return s.vc(t),s.Zb().saveDatalink(!1)})),s.Ob(1,"li"),s.Ob(2,"a",5),s.Vb("click",(function(){return s.vc(t),s.Zb().saveDatalink(!1)})),s.Lb(3,"i",6),s.Fc(4," Save"),s.Nb(),s.Nb(),s.Ob(5,"li"),s.Ob(6,"a",7),s.Vb("click",(function(){return s.vc(t),s.Zb().editDatalinkService.hubFormsService.saveLocal()})),s.Lb(7,"i",8),s.Fc(8," Save as file"),s.Nb(),s.Nb(),s.Ob(9,"li"),s.Ob(10,"a",9),s.Vb("click",(function(){return s.vc(t),s.Zb().saveDatalink(!0)})),s.Lb(11,"i",10),s.Fc(12," Save As..."),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("disabled",!t.editDatalinkService.hubFormsService.hasChanged)}}function N(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-dropdown",11),s.Ob(1,"a",12),s.Vb("click",(function(){return s.vc(t),s.Zb().fixMappings()})),s.Fc(2,"Fix Mappings"),s.Nb(),s.Ob(3,"a",13),s.Vb("click",(function(){return s.vc(t),s.Zb().runDatalink(!1,!1)})),s.Fc(4,"Run"),s.Nb(),s.Ob(5,"a",13),s.Vb("click",(function(){return s.vc(t),s.Zb().runDatalink(!0,!0)})),s.Fc(6,"Run (with truncate)"),s.Nb(),s.Ob(7,"a",14),s.Vb("click",(function(){return s.vc(t),s.Zb().runDatalink(!1,!0)})),s.Fc(8,"Run (reset incremental)"),s.Nb(),s.Ob(9,"a",15),s.Vb("click",(function(){return s.vc(t),s.Zb().preview()})),s.Fc(10,"Preview Datalink"),s.Nb(),s.Ob(11,"a",16),s.Vb("click",(function(){return s.vc(t),s.Zb().download()})),s.Fc(12,"Download Datalink Data"),s.Nb(),s.Nb()}2&t&&s.hc("pullRight",!0)}let O=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.editDatalinkService=e,this.authService=a,this.router=n,this.route=i,this.cancelToken=new C.a,this.eUpdateStrategy=o.qc}ngOnInit(){try{this._subscription=Object(r.a)(this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getHubCacheObservable()).subscribe(t=>{this.datalinkForm=t[0],this.hubCache=t[1]})}catch(t){this.hubService.addHubClientErrorMessage(t,"datalink save button")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}saveDatalink(t=!1){return w(this,void 0,void 0,(function*(){if(this.editDatalinkService.savingDatalink.next(!0),this.datalinkForm.controls.dexihDatalinkTargets.dirty){let e=this.datalinkForm.controls.dexihDatalinkTargets,a=e.controls.map(t=>{let e=t.controls.table;if(e)return e}).filter(t=>t.value.key>0&&t.dirty).map(t=>t.value.name).join(", "),n=()=>w(this,void 0,void 0,(function*(){for(let t of e.controls)if(t.dirty){let e=t,a=yield this.hubService.saveTables([e.controls.table.value]);e.setControl("table",this.editDatalinkService.hubFormsService.tableForm(a[0])),e.controls.tableKey.setValue(a[0].key)}this.editDatalinkService.hubFormsService.save(!1,t),this.editDatalinkService.savingDatalink.next(!1)}));0===a.length?yield n():this.authService.confirmDialog("Save Target Tables?",`The existing target table(s)\n                ${a} have changed.\n                This is a shared object, and may impact other dependencies if changed.\n                Note, this will only save the metadata, use the 'Create Table' function to overwrite the physical table.`).then(t=>w(this,void 0,void 0,(function*(){t&&(yield n())}))).catch(()=>this.editDatalinkService.savingDatalink.next(!1))}else this.editDatalinkService.hubFormsService.save(!1,t),this.editDatalinkService.savingDatalink.next(!1)}))}preview(){let t=this.datalinkForm.controls.dexihDatalinkTransforms.controls.sort((t,e)=>e.value.position-t.value.position);t.length>0&&this.router.navigate(["transforms/transform",t[0].value.key,"preview-transform-data"],{relativeTo:this.route})}download(){this.datalinkForm.dirty?this.authService.confirmDialog("Save Datalink","The datalink must be saved before a data download task can be started.  Do you want to save the datalink?").then(t=>{t&&(this.saveDatalink(),this.doDownload())}):this.doDownload()}doDownload(){let t=new Array,e=new o.M;e.objectKey=this.datalinkForm.controls.key.value,e.objectType=o.lb.Datalink,t.push(e),this.hubService.downloadData(t,!0,o.rb.Csv,this.cancelToken)}cancel(){this.editDatalinkService.hubFormsService.cancel()}runDatalink(t,e){this.editDatalinkService.hubFormsService.hasChanged?this.authService.confirmDialog("Save Datalink","The datalink must be saved before running.  Would you like to save now?").then(a=>{a&&(this.saveDatalink(),this.editDatalinkService.savingDatalink.toPromise().then(a=>{a&&this.hubService.runDatalinks([this.datalinkForm.controls.key.value],t,e,null,null,null,this.cancelToken)}))}):this.hubService.runDatalinks([this.datalinkForm.controls.key.value],t,e,null,null,null,this.cancelToken)}fixMappings(){this.editDatalinkService.fixMappings(this.datalinkForm)}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d),s.Kb(b.a),s.Kb(i.e),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["datalink-save-button"]],decls:4,vars:4,consts:[[1,"mr-1",3,"control"],["buttonClass","btn-primary","iconClass","fa fa-save","text","Save","class","mr-1",3,"disabled","buttonClick",4,"ngIf"],["class","mr-1","text","Actions","iconClass","fa fa-bolt","buttonClass","btn-primary",3,"pullRight",4,"ngIf"],[3,"formsService"],["buttonClass","btn-primary","iconClass","fa fa-save","text","Save",1,"mr-1",3,"disabled","buttonClick"],["title","Save in the hub",1,"dropdown-item",3,"click"],[1,"fa","fa-cloud"],["title","Export as a local file",1,"dropdown-item",3,"click"],[1,"fa","fa-floppy-o"],["title","Save another version",1,"dropdown-item",3,"click"],[1,"fa","fa-plus-circle"],["text","Actions","iconClass","fa fa-bolt","buttonClass","btn-primary",1,"mr-1",3,"pullRight"],["title","Attempt to fix mappings broken when removing/inserting transforms.",1,"dropdown-item",3,"click"],["title","Run datalink, truncating the target table for each.",1,"dropdown-item",3,"click"],["title","Run datalink, resetting the incremental (i.e. reload all source data rows) ",1,"dropdown-item",3,"click"],["title","Preview the output of this datalink",1,"dropdown-item",3,"click"],["title","Download the output from this datalink",1,"dropdown-item",3,"click"]],template:function(t,e){1&t&&(s.Lb(0,"dexih-invalid-form-details",0),s.Dc(1,S,13,1,"dexih-button-splitdropdown",1),s.Dc(2,N,13,1,"dexih-button-dropdown",2),s.Lb(3,"cancel-button",3)),2&t&&(s.hc("control",e.datalinkForm),s.yb(1),s.hc("ngIf",e.hubCache.canWrite),s.yb(1),s.hc("ngIf",e.hubCache.canWrite&&(null==e.datalinkForm?null:e.datalinkForm.controls.dexihDatalinkTargets.value.length)>0),s.yb(1),s.hc("formsService",e.editDatalinkService.hubFormsService))},directives:[F.a,n.t,D.a,p.w,p.i],encapsulation:2}),t})();var I=a("ZKkd"),x=a("/pur");function P(t,e){1&t&&(s.Ob(0,"li",19),s.Ob(1,"a",28),s.Lb(2,"i",29),s.Fc(3," Validation"),s.Nb(),s.Nb())}function V(t,e){1&t&&(s.Ob(0,"li",19),s.Ob(1,"a",30),s.Lb(2,"i",31),s.Fc(3," Profiling"),s.Nb(),s.Nb())}function E(t,e){if(1&t&&(s.Ob(0,"li",19),s.Ob(1,"a",22),s.Lb(2,"i",23),s.Fc(3," Transforms "),s.Lb(4,"dexih-invalid-form-icon",24),s.Nb(),s.Nb(),s.Dc(5,P,4,0,"li",25),s.Dc(6,V,4,0,"li",25),s.Ob(7,"li",19),s.Ob(8,"a",26),s.Lb(9,"i",27),s.Fc(10," Target"),s.Nb(),s.Nb()),2&t){const t=s.Zb(3);s.yb(4),s.hc("control",t.datalinkForm.controls.dexihDatalinkTransforms),s.yb(1),s.hc("ngIf",!t.datalinkForm.controls.isQuery.value),s.yb(1),s.hc("ngIf",!t.datalinkForm.controls.isQuery.value)}}function K(t,e){if(1&t&&(s.Ob(0,"div",17),s.Ob(1,"ul",18),s.Ob(2,"li",19),s.Ob(3,"a",20),s.Lb(4,"i",10),s.Fc(5,"Properties"),s.Nb(),s.Nb(),s.Ob(6,"li",19),s.Ob(7,"a",21),s.Lb(8,"i",12),s.Fc(9," Source"),s.Nb(),s.Nb(),s.Dc(10,E,11,3,"ng-template",13),s.Nb(),s.Nb()),2&t){const t=s.Zb(2);s.yb(10),s.hc("ngIf",null==t.datalinkForm?null:t.datalinkForm.controls.sourceDatalinkTable.value)}}function L(t,e){1&t&&(s.Ob(0,"a",36),s.Lb(1,"i",29),s.Fc(2,"Validation"),s.Nb())}function M(t,e){1&t&&(s.Ob(0,"a",37),s.Lb(1,"i",31),s.Fc(2,"Profiling"),s.Nb())}function Z(t,e){if(1&t&&(s.Ob(0,"a",32),s.Lb(1,"i",23),s.Fc(2,"Transforms"),s.Nb(),s.Dc(3,L,3,0,"a",33),s.Dc(4,M,3,0,"a",34),s.Ob(5,"a",35),s.Lb(6,"i",27),s.Fc(7,"Target"),s.Nb()),2&t){const t=s.Zb(2);s.yb(3),s.hc("ngIf",!t.datalinkForm.controls.isQuery.value),s.yb(1),s.hc("ngIf",!t.datalinkForm.controls.isQuery.value)}}function A(t,e){if(1&t&&s.Lb(0,"dexih-help",38),2&t){const t=s.Zb(2);s.jc("path","/assets/help/reference/",t.help,"")}}function _(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",1),s.Ob(1,"dexih-widget",2),s.Vb("close",(function(){return s.vc(t),s.Zb().cancel()})),s.Dc(2,K,11,1,"ng-template",null,3,s.Ec),s.Ob(4,"ul",4),s.Ob(5,"li",5),s.Ob(6,"div",6),s.Ob(7,"div",7),s.Ob(8,"dexih-button-dropdown",8),s.Ob(9,"a",9),s.Lb(10,"i",10),s.Fc(11,"Properties"),s.Nb(),s.Ob(12,"a",11),s.Lb(13,"i",12),s.Fc(14,"Source"),s.Nb(),s.Dc(15,Z,8,2,"ng-template",13),s.Nb(),s.Nb(),s.Lb(16,"datalink-status",14),s.Ob(17,"div",15),s.Lb(18,"datalink-save-button"),s.Nb(),s.Nb(),s.Nb(),s.Lb(19,"router-outlet"),s.Nb(),s.Nb(),s.Dc(20,A,1,1,"dexih-help",16),s.Nb()}if(2&t){const t=s.Zb();s.yb(1),s.hc("showCloseButton",!0)("padding",!1),s.yb(14),s.hc("ngIf",t.datalinkForm.controls.sourceDatalinkTable.value),s.yb(1),s.hc("datalinkKey",null==t.datalinkForm?null:t.datalinkForm.controls.key.value),s.yb(4),s.hc("ngIf",t.help)}}let G=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.savingDatalink=!1,this.logger=new c.a("datalink-edit.component"),this.logCount=0,this.eTransformWriterMethod=o.nc,this.isLoaded=!1,this.showPage=!1,this.showPageMessage="Loading datalink..."}getHelp(){let t=this.router.routerState.root.snapshot;for(;t.firstChild;)t=t.firstChild;this.help=t.data.help}ngOnInit(){this.logger.LogC(()=>"OnInit",c.b.Trace);try{this.router.events.subscribe(t=>{t instanceof i.b&&this.getHelp()}),this.getHelp(),this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(t=>{this.action=t[0].action,this.pageTitle=t[0].pageTitle,this.params=t[1],this.hubCache=t[2],this.hubCache&&this.hubCache.status===y.j.Loaded&&(this.editDatalinkService.init(this.hubCache),this.isLoaded&&"new"===this.action||(this.isLoaded&&this.editDatalinkService.hubFormsService.hasChanged?this.authService.confirmDialog("Datalink synchronization warning","The hub was disconnected, meaning the datalink could have been changed by another session.  Would you like to discard the current changes, and reload the latest version of the datalink?").then(t=>{t&&this.load()}).catch(t=>{}):this.load()))}),this.editDatalinkService.ngOnInit()}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe(),this.editDatalinkService.ngOnDestroy()}load(){if(this.logger.LogC(()=>"Subscription count: "+this.logCount++,c.b.Trace),"edit"===this.action){let t=+this.params.datalinkKey;if(t){let e=this.hubCache.hub.dexihDatalinks.find(e=>e.key===t);e?(this.editDatalinkService.hubFormsService.datalink(e),this.route.snapshot.data.pageTitle="Datalink ("+e.name+")"):(this.logger.LogC(()=>"no datalink found. key: "+t,c.b.Warning),this.hubService.addHubErrorMessage("A datalink with the key "+t+" could not be found in the repository."),this.showPageMessage="Edit failed...")}else this.logger.LogC(()=>"no datalink found.",c.b.Warning),this.hubService.addHubErrorMessage("There was no datalink specified to edit."),this.showPageMessage="Edit failed...",this.editDatalinkService.hubFormsService.datalink(null)}else if(this.isLoaded||"new"!==this.action)if(this.isLoaded||"copy"!==this.action){if("sourceTable"===this.action){let t=new o.l;t.datalinkType=o.nb.Query,t.sourceDatalinkTable=new o.r,t.sourceDatalinkTable.sourceType=o.gc.Table,t.sourceDatalinkTable.sourceTableKey=+this.params.sourceTableKey,this.editDatalinkService.reBuildDatalinkTable(t.sourceDatalinkTable),t.name="Datalink query for "+t.sourceDatalinkTable.name,this.editDatalinkService.hubFormsService.datalink(t),this.editDatalinkService.hubFormsService.currentForm.markAsDirty(),this.editDatalinkService.hubFormsService.hasChanged=!0,this.logger.LogC(()=>"new source table datalink set.",c.b.Warning)}}else{let t=+this.params.datalinkKey;if(t){let e=this.hubCache.hub.dexihDatalinks.find(e=>e.key===t);if(e){let t=this.hubCache.CopyDatalink(e);this.editDatalinkService.hubFormsService.datalink(t),this.editDatalinkService.hubFormsService.hasChanged=!0,this.route.snapshot.data.pageTitle="Datalink ("+t.name+")"}else this.logger.LogC(()=>"no datalink found. key: "+t,c.b.Warning),this.hubService.addHubErrorMessage("A datalink with the key "+t+" could not be found in the repository."),this.showPageMessage="Copy failed..."}else this.logger.LogC(()=>"no datalink found.",c.b.Warning),this.hubService.addHubErrorMessage("There was no datalink specified to copy."),this.showPageMessage="Copy failed...",this.editDatalinkService.hubFormsService.datalink(null)}else{let t=new o.l;t.sourceDatalinkTable=new o.r,this.editDatalinkService.hubFormsService.datalink(t),this.logger.LogC(()=>"new datalink set.",c.b.Warning)}this.isLoaded=!0,this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe(),this._datalinkFormSubscription=this.editDatalinkService.hubFormsService.getCurrentFormObservable().subscribe(t=>{if(!t)return;this.datalinkForm=t;let e=t.controls.key.value;if(e&&history.pushState){let t=window.location.pathname.replace("/new","/edit/"+e);this.router.navigateByUrl(t)}}),this.showPage=!0,this.showPageMessage=""}canDeactivate(){return new Promise(t=>{this.editDatalinkService.hubFormsService.hasChanged?this.authService.confirmDialog("Datalink changes have not been saved","The datalink changes have not been saved.  Do you want to discard the changes and exit?").then(e=>{t(e)}).catch(e=>{t(!1)}):t(!0)})}unloadNotification(t){this.editDatalinkService.hubFormsService.hasChanged&&(t.returnValue="The datalink changes have not been saved.  Do you want to discard the changes and exit?")}saveDatalink(){this.editDatalinkService.hubFormsService.save()}cancel(){this.editDatalinkService.hubFormsService.cancel()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-form"]],hostBindings:function(t,e){1&t&&s.Vb("beforeunload",(function(t){return e.unloadNotification(t)}),!1,s.uc)},decls:1,vars:1,consts:[["class","container-fluid",4,"ngIf"],[1,"container-fluid"],["title","Edit Datalink","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","padding","close"],["header",""],[1,"list-group"],[1,"list-group-item","rounded-0"],[1,"d-flex"],[1,"d-xl-none"],["buttonClass","btn btn-success","text","Navigate"],["routerLinkActive","active","routerLink","properties",1,"dropdown-item"],[1,"fa","fa-cog"],["routerLinkActive","active","routerLink","source-table",1,"dropdown-item"],[1,"fa","fa-arrow-circle-o-right"],[3,"ngIf"],[1,"d-none","d-xl-inline",3,"datalinkKey"],[1,"ml-auto"],["class","m-3","title","Datalinks",3,"path",4,"ngIf"],[1,"d-none","d-xl-inline"],[1,"nav","nav-tabs","card-header-tabs"],[1,"nav-item"],["routerLink","properties","routerLinkActive","active",1,"nav-link"],["routerLink","source-table","routerLinkActive","active",1,"nav-link"],["routerLink","transforms","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-share-alt"],[3,"control"],["class","nav-item",4,"ngIf"],["routerLink","target","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-arrow-circle-right"],["routerLink","validation","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-check-square-o"],["routerLink","profile-rules","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-bug"],["routerLinkActive","active","routerLink","transforms",1,"dropdown-item"],["class","dropdown-item","routerLink","validation","routerLinkActive","active",4,"ngIf"],["class","dropdown-item","routerLink","profile-rules","routerLinkActive","active",4,"ngIf"],["routerLink","target","routerLinkActive","active",1,"dropdown-item"],["routerLink","validation","routerLinkActive","active",1,"dropdown-item"],["routerLink","profile-rules","routerLinkActive","active",1,"dropdown-item"],["title","Datalinks",1,"m-3",3,"path"]],template:function(t,e){1&t&&s.Dc(0,_,21,5,"div",0),2&t&&s.hc("ngIf",e.datalinkForm&&!e.datalinkForm.pending)},directives:[n.t,p.P,p.i,i.h,i.g,T.a,O,i.j,I.a,x.a],encapsulation:2}),t})();var R=a("H3K+"),j=a("VRyK"),H=a("+F4M"),J=a("hJJo");function B(t,e){if(1&t&&(s.Ob(0,"section"),s.Ob(1,"form-select",8),s.Lb(2,"table-edit-button",9),s.Nb(),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("errors",null==t.errors?null:t.errors.sourceTableKey)("items",t.connectionTables),s.yb(1),s.hc("key",t.datalinkTableForm.controls.sourceTableKey.value)}}function $(t,e){if(1&t&&(s.Ob(0,"section"),s.Ob(1,"form-select",10),s.Lb(2,"datalink-edit-button",9),s.Nb(),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("errors",null==t.errors?null:t.errors.sourceDatalinkKey)("items",t.datalinks),s.yb(1),s.hc("key",t.datalinkTableForm.controls.sourceDatalinkKey.value)}}function U(t,e){1&t&&(s.Ob(0,"section"),s.Lb(1,"form-input",11),s.Lb(2,"form-input",12),s.Lb(3,"form-input",13),s.Nb())}function q(t,e){1&t&&s.Lb(0,"form-checkbox",14)}function z(t,e){if(1&t){const t=s.Pb();s.Ob(0,"form",1),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-select",2),s.Nb(),s.Dc(4,B,3,3,"section",3),s.Dc(5,$,3,3,"section",3),s.Dc(6,U,4,0,"section",3),s.Ob(7,"section"),s.Lb(8,"form-checkbox",4),s.Dc(9,q,1,0,"form-checkbox",5),s.Lb(10,"form-input",6),s.Nb(),s.Ob(11,"dexih-button-refresh",7),s.Vb("click",(function(){return s.vc(t),s.Zb().refreshColumns()})),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("formGroup",t.datalinkTableForm),s.yb(3),s.hc("items",t.sourceTypes)("enableFilter",!1),s.yb(1),s.hc("ngIf",t.datalinkTableForm.value.sourceType==t.eSourceType.Table),s.yb(1),s.hc("ngIf",t.datalinkTableForm.value.sourceType==t.eSourceType.Datalink),s.yb(1),s.hc("ngIf",t.datalinkTableForm.value.sourceType==t.eSourceType.Rows),s.yb(3),s.hc("ngIf",t.isVersioned)}}let W=(()=>{class t{constructor(t,e){this.hubService=t,this.datalinkEditService=e,this.eSourceType=o.gc,this.sourceTypes=y.w,this.connectionTables=[],this.datalinks=[],this.isVersioned=!1}ngOnInit(){this.errors=this.datalinkEditService.hubFormsService.getFormErrorMessages(this.datalinkTableForm,!0);try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(t=>{this.hubCache=t[0],this.subscribeDatalinkChanges(),this.hubCache&&this.hubCache.isLoaded()&&this.datalinkTableForm&&(this.connectionTables=this.hubCache.getConnectionTables(),this.datalinks=this.hubCache.hub.dexihDatalinks,this.updateIsVersioned())})}catch(t){this.hubService.addHubClientErrorMessage(t,"Selected datalink table")}}updateIsVersioned(){if(this.datalinkTableForm.controls.sourceType.value===o.gc.Table){var t=this.hubCache.getTable(this.datalinkTableForm.controls.sourceTableKey.value);t&&(this.isVersioned=t.isVersioned)}}subscribeDatalinkChanges(){this._datalinkTableSubscription&&this._datalinkTableSubscription.unsubscribe(),this._datalinkTableSubscription=Object(j.a)(this.datalinkTableForm.controls.sourceType.valueChanges,this.datalinkTableForm.controls.sourceTableKey.valueChanges,this.datalinkTableForm.controls.sourceDatalinkKey.valueChanges).subscribe(()=>{this.errors=this.datalinkEditService.hubFormsService.getFormErrorMessages(this.datalinkTableForm,!0),this.refreshColumns()})}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._datalinkTableSubscription&&this._datalinkTableSubscription.unsubscribe()}refreshColumns(){try{this._datalinkTableSubscription&&this._datalinkTableSubscription.unsubscribe();let t=this.datalinkTableForm.value;t.sourceType=this.datalinkTableForm.controls.sourceType.value,t.sourceTableKey=this.datalinkTableForm.controls.sourceTableKey.value,t.sourceDatalinkKey=this.datalinkTableForm.controls.sourceDatalinkKey.value,this.datalinkEditService.reBuildDatalinkTable(t),this.datalinkEditService.fixMappings(this.datalinkEditService.hubFormsService.currentForm),this.datalinkTableForm.controls.name.setValue(t.name),this.datalinkTableForm.controls.rowsEndAt.setValue(t.rowsEndAt),this.datalinkTableForm.controls.rowsStartAt.setValue(t.rowsStartAt),this.datalinkTableForm.controls.rowsIncrement.setValue(t.rowsIncrement),this.datalinkTableForm.controls.sourceType.setValue(t.sourceType),this.updateIsVersioned();let e=this.datalinkTableForm.controls.dexihDatalinkColumns;for(;e.length>0;)e.removeAt(0);t.dexihDatalinkColumns.sort((t,e)=>t.position-e.position).filter(t=>t.isValid).forEach(t=>{e.push(this.datalinkEditService.hubFormsService.datalinkTableColumn(e.value,t))}),this.subscribeDatalinkChanges()}catch(t){this.hubService.addHubClientErrorMessage(t,"Refresh datalink columns")}}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d))},t.\u0275cmp=s.Eb({type:t,selectors:[["datalink-table"]],inputs:{datalinkTableForm:"datalinkTableForm"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Data Source Type","formControlName","sourceType","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the source type for this table",3,"items","enableFilter"],[4,"ngIf"],["label","Disable query logic being pushed down to the database","formControlName","disablePushDown"],["label","Disable source table versions","formControlName","disableVersioning",4,"ngIf"],["label","Table Alias","formControlName","name","note","An alias that can be used to describe the table instance (this is generally used to differentiate self-joined tables)."],["tooltip","Refresh the columns from the source table.",3,"click"],["label","Source Table","formControlName","sourceTableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the source table",3,"errors","items"],[3,"key"],["label","Source Datalink","formControlName","sourceDatalinkKey","itemKey","key","itemName","name","note","Select the source datalink",3,"errors","items"],["label","Start At","type","number","formControlName","rowsStartAt","placeholder","Enter start row number","iconClass","fa fa-list"],["label","End At","type","number","formControlName","rowsEndAt","placeholder","Enter end row number","iconClass","fa fa-list"],["label","Increment By","type","number","formControlName","rowsIncrement","placeholder","Enter increment value","iconClass","fa fa-list"],["label","Disable source table versions","formControlName","disableVersioning"]],template:function(t,e){1&t&&s.Dc(0,z,12,7,"form",0),2&t&&s.hc("ngIf",e.datalinkTableForm)},directives:[n.t,g.I,g.t,g.l,p.E,g.s,g.j,p.A,p.D,p.s,H.a,J.a],encapsulation:2}),t})();const Q=function(t){return["table-edit",t]};function Y(t,e){if(1&t&&(s.Ob(0,"dexih-button-edit",13),s.Fc(1," Table "),s.Nb()),2&t){const t=s.Zb(2);s.hc("routerLink",s.mc(1,Q,t.datalinkForm.controls.sourceDatalinkTable.value.sourceTableKey))}}const X=function(t){return["../../edit",t]};function tt(t,e){if(1&t&&(s.Ob(0,"dexih-button-edit",13),s.Fc(1," Datalink "),s.Nb()),2&t){const t=s.Zb(2);s.hc("routerLink",s.mc(1,X,t.datalinkForm.controls.sourceDatalinkTable.value.sourceDatalinkKey))}}function et(t,e){if(1&t){const t=s.Pb();s.Dc(0,Y,2,3,"dexih-button-edit",11),s.Dc(1,tt,2,3,"dexih-button-edit",11),s.Ob(2,"dexih-button-preview",12),s.Vb("click",(function(){return s.vc(t),s.Zb().previewData()})),s.Nb()}if(2&t){const t=s.Zb();s.hc("ngIf",t.datalinkForm.controls.sourceDatalinkTable.value.sourceType==t.eSourceType.Table&&t.datalinkForm.controls.sourceDatalinkTable.value.sourceTableKey),s.yb(1),s.hc("ngIf",t.datalinkForm.controls.sourceDatalinkTable.value.sourceType==t.eSourceType.Datalink&&t.datalinkForm.controls.sourceDatalinkTable.value.sourceDatalinkKey)}}function at(t,e){if(1&t&&s.Lb(0,"datalink-table",14),2&t){const t=s.Zb();s.hc("datalinkTableForm",t.datalinkForm.controls.sourceDatalinkTable)}}function nt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-delete",15),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb().deleteSelected(a)})),s.Nb()}}function it(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-new",16),s.Vb("click",(function(){return s.vc(t),s.Zb().newColumn()})),s.Nb()}}function rt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-edit",17),s.Vb("click",(function(){s.vc(t);const a=e.item;return s.Zb().editColumn(a)})),s.Nb()}}let ot=(()=>{class t{constructor(t,e,a,n,i){this.authService=t,this.hubService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.eMappingStatus=y.k,this.eSourceType=o.gc,this.sourceTypes=y.w,this.columns=[{name:"position",title:"#",format:""},{name:"columnStatus",title:"Impact",format:"Html"},{name:"columnGroup",title:"Group",format:""},{name:"name",title:"Name",format:""},{name:"logicalName",title:"Logical",format:""},{name:"dataType",title:"Data Type",format:""},{name:"deltaType",title:"Delta Type",format:"Enum",enum:o.qb},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"isIncrementalUpdate",title:"Incremental?",format:"Boolean"},{name:"securityFlag",title:"Security Flag",format:"Enum",enum:o.Zb},{name:"isInput",title:"Input?",format:"Boolean"}],this._tableData=new m.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle,this.hubCache=t[2],this.datalinkForm=t[3],this.datalinkForm&&(this.updateData(),this._sourceSubscription&&this._sourceSubscription.unsubscribe(),this._sourceSubscription=this.datalinkForm.controls.sourceDatalinkTable.valueChanges.subscribe(()=>{this.updateData()}))})}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit Source Table")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._sourceSubscription&&this._sourceSubscription.unsubscribe()}previewData(){let t=this.datalinkForm.controls.sourceDatalinkTable.value;switch(t.sourceType){case o.gc.Table:this.router.navigate(["preview-table-data","table",t.sourceTableKey],{relativeTo:this.route});break;case o.gc.Datalink:this.router.navigate(["preview-table-data","datalink",t.sourceDatalinkKey],{relativeTo:this.route});break;default:this.authService.informationDialog("Cannot Preview","Previews are only available for tables and datalinks.")}}columnStatus(t){const e=new u.a(u.c.SourceTable,u.d.Source,this.datalinkForm.value,t,null,null,null,y.k.PassThroughMap,this.hubCache).createDatalinkImpact(!0),a=y.n.find(t=>t.key===e);if(a)return`${a.name}<i class="float-right ${a.statusClass}"></i>`}updateData(){let t=[];this.datalinkForm.controls.sourceDatalinkTable.controls.dexihDatalinkColumns.controls.filter(t=>t.value.isValid).sort((t,e)=>t.value.position-e.value.position).forEach(e=>{let a=e.value,n={key:a.key,position:a.position,columnStatus:this.columnStatus(a),columnGroup:a.columnGroup,name:a.name,dataType:this.hubCache.dataTypeToString(a),deltaType:a.deltaType,allowDbNull:a.allowDbNull,logicalName:a.logicalName,isIncrementalUpdate:a.isIncrementalUpdate,securityFlag:a.securityFlag,isInput:a.isInput};t.push(n)}),this._tableData.next(t)}deleteSelected(t){let e=this.datalinkForm.controls.sourceDatalinkTable.controls.dexihDatalinkColumns;t.forEach(t=>{let a=e.controls.findIndex(e=>e.value.key===t.key);e.removeAt(a)}),this.updateData()}newColumn(){this.router.navigate(["newcolumn"],{relativeTo:this.route.parent})}editColumn(t){this.router.navigate(["column",t.key],{relativeTo:this.route.parent})}columnSortChange(t){let e=this.datalinkForm.controls.sourceDatalinkTable.controls.dexihDatalinkColumns,a=1;t.forEach(t=>{let n=e.controls.find(e=>e.value.key===t.key);n&&n.controls.position.setValue(a++)}),this.updateData()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(b.a),s.Kb(l.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-source-table-form"]],decls:12,vars:8,consts:[["title","Source Type",3,"showExpandButton"],["header",""],[3,"datalinkTableForm",4,"ngIf"],["title","Columns",3,"showExpandButton","padding"],[3,"enableMultiSelect","enableManualSort","columns","dataObservable","onSortChanged","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","actionsTemplate"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["class","mr-1",3,"routerLink",4,"ngIf"],[3,"click"],[1,"mr-1",3,"routerLink"],[3,"datalinkTableForm"],["title","Delete selected columns",3,"click"],["title","Create a new column",3,"click"],["title","Edit selected column",3,"click"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,et,3,2,"ng-template",null,1,s.Ec),s.Dc(3,at,1,1,"datalink-table",2),s.Nb(),s.Ob(4,"dexih-widget-section",3),s.Ob(5,"dexih-table",4),s.Vb("onSortChanged",(function(t){return e.columnSortChange(t)}))("rowClick",(function(t){return e.editColumn(t)})),s.Dc(6,nt,1,0,"ng-template",5,6,s.Ec),s.Dc(8,it,1,0,"ng-template",7,8,s.Ec),s.Dc(10,rt,1,0,"ng-template",9,10,s.Ec),s.Nb(),s.Nb()),2&t&&(s.hc("showExpandButton",!0),s.yb(3),s.hc("ngIf",e.datalinkForm),s.yb(1),s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("columns",e.columns)("dataObservable",e.tableData))},directives:[p.T,n.t,R.a,p.q,p.j,i.f,W,p.g,p.o],encapsulation:2}),t})();var st=a("qMYE");function lt(t,e){if(1&t&&(s.Ob(0,"span"),s.Ob(1,"section"),s.Lb(2,"form-select",6),s.Nb(),s.Ob(3,"section"),s.Lb(4,"form-select",7),s.Nb(),s.Ob(5,"section"),s.Ob(6,"form-select",8),s.Lb(7,"connection-edit-button",9),s.Nb(),s.Nb(),s.Ob(8,"div",10),s.Ob(9,"section",11),s.Lb(10,"form-input",12),s.Nb(),s.Ob(11,"section",11),s.Lb(12,"form-input",13),s.Nb(),s.Nb(),s.Ob(13,"div",14),s.Lb(14,"form-checkbox",15),s.Nb(),s.Nb()),2&t){const t=s.Zb(2);s.yb(2),s.hc("items",t.loadStrategies)("errors",t.editDatalinkService.hubFormsService.formErrors.loadStrategy),s.yb(2),s.hc("items",t.updateStrategies)("errors",t.editDatalinkService.hubFormsService.formErrors.updateStrategy),s.yb(2),s.hc("items",t.managedConnections)("errors",t.editDatalinkService.hubFormsService.formErrors.auditConnectionKey),s.yb(1),s.hc("key",t.datalinkForm.controls.auditConnectionKey.value),s.yb(3),s.hc("errors",t.editDatalinkService.hubFormsService.formErrors.rowsPerCommit),s.yb(2),s.hc("errors",t.editDatalinkService.hubFormsService.formErrors.rowsPerProgress),s.yb(2),s.hc("errors",t.editDatalinkService.hubFormsService.formErrors.addDefaultRow)}}function ct(t,e){if(1&t&&(s.Ob(0,"form",3),s.Ob(1,"fieldset"),s.Lb(2,"form-checkbox",4),s.Dc(3,lt,15,10,"span",5),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.hc("formGroup",t.datalinkForm),s.yb(2),s.hc("errors",t.editDatalinkService.hubFormsService.formErrors.isQuery),s.yb(1),s.hc("ngIf",!(null!=t.datalinkForm&&t.datalinkForm.controls.isQuery.value))}}function ut(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-new",23),s.Vb("click",(function(){return s.vc(t),s.Zb(2).addTable()})),s.Nb()}}function mt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-edit",23),s.Vb("click",(function(){s.vc(t);const a=e.item;return s.Zb(2).editTable(a)})),s.Nb()}}function bt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-delete",23),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb(2).deleteTables(a)})),s.Nb()}}function ht(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-widget-section",16),s.Ob(1,"dexih-table",17),s.Vb("onSortChanged",(function(e){return s.vc(t),s.Zb().targetSortChange(e)}))("rowClick",(function(e){return s.vc(t),s.Zb().editTable(e)})),s.Dc(2,ut,1,0,"ng-template",null,18,s.Ec),s.Dc(4,mt,1,0,"ng-template",19,20,s.Ec),s.Dc(6,bt,1,0,"ng-template",21,22,s.Ec),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("enableSort",!1)("enableFilter",!1)("columns",t.targetTableColumns)("data",t.targets)}}let dt=(()=>{class t{constructor(t,e,a,n,i,r){this.hubService=t,this.editDatalinkService=a,this.route=n,this.router=i,this.eMappingStatus=y.k,this.eDeltaType=o.qb,this.eUpdateStrategy=o.qc,this.updateStrategies=y.y,this.eTransformWriterMethod=o.nc,this.loadStrategies=y.q,this.showTableProperties=!1,this.targets=[],this.logger=new c.a("datalink-edit-target-table"),this.targetTableColumns=[{name:"table.name",title:"Name",format:""},{name:"table.logicalName",title:"Logical",format:""},{name:"nodeDatalinkColumn.logicalName",title:"Node",format:""}],this.tableFormService=new h.a(r,t,e)}ngOnInit(){this.logger.LogC(()=>"ngOnInit",c.b.Trace);try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(t=>{let e=t[0];this.hubCache=t[2],this.datalinkForm=t[3],this.action=e.action,this.pageTitle=e.pageTitle,this.hubCache.isLoaded()&&this.datalinkForm&&(this.connectionTables=this.hubCache.getConnectionTables(),this.managedConnections=this.hubCache.getManagedConnections(),this.logger.LogC(()=>"ngOnInit - completed",c.b.Trace)),this.updateTargets()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Target Table")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._loadStrategySubscription&&this._loadStrategySubscription.unsubscribe()}updateTargets(){this.targets=this.datalinkForm.controls.dexihDatalinkTargets.value.sort((t,e)=>t.position-e.position)}editTable(t){this.router.navigate(["table-edit",t.key],{relativeTo:this.route})}addTable(){this.router.navigate(["table-new"],{relativeTo:this.route})}deleteTables(t){t.forEach(t=>{this.editDatalinkService.deleteDatalinkTarget(this.datalinkForm,t.key),this.updateTargets()})}targetSortChange(t){let e=1;t.forEach(t=>{t.position=e++}),this.updateTargets()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e),s.Kb(g.g))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-target-form"]],decls:4,vars:3,consts:[["title","Target Load Rules",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["title","Tables",3,"showExpandButton","padding",4,"ngIf"],[3,"formGroup"],["label","Datalink is a query and does not populate target tables.","formControlName","isQuery",3,"errors"],[4,"ngIf"],["label","Load Strategy","formControlName","loadStrategy","itemKey","key","itemName","description","iconClass","fa fa-database","note","Specify processing method for target table(s).",3,"items","errors"],["label","Update Strategy","formControlName","updateStrategy","itemKey","key","itemName","description","iconClass","fa fa-database","note","Specify how records should be inserted/updated in the target table.",3,"items","errors"],["label","Audit Connection","formControlName","auditConnectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the connection where audit data (such as job results) should be written to.",3,"items","errors"],[3,"key"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Maximum Rows Per Commit","type","number","formControlName","rowsPerCommit","placeholder","Enter maximum rows per commit","iconClass","fa fa-list",3,"errors"],["label","Maximum Rows Per Progress Update","type","number","formControlName","rowsPerProgress","placeholder","Enter maximum rows per progress update","iconClass","fa fa-list",3,"errors"],[1,"form-row","mb-2"],["label","Add a default row to the target table.  Edit the 'Default Value' of the target columns determine the value to populate.","formControlName","addDefaultRow",3,"errors"],["title","Tables",3,"showExpandButton","padding"],[3,"enableMultiSelect","enableManualSort","enableSort","enableFilter","columns","data","onSortChanged","rowClick"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],[1,"mr-1",3,"click"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,ct,4,3,"form",1),s.Nb(),s.Dc(2,ht,8,8,"dexih-widget-section",2),s.Lb(3,"router-outlet")),2&t&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",e.datalinkForm),s.yb(1),s.hc("ngIf",!(null!=e.datalinkForm&&e.datalinkForm.controls.isQuery.value)))},directives:[p.T,n.t,i.j,g.I,g.t,g.l,p.A,g.s,g.j,p.E,st.a,p.D,R.a,p.o,p.j,p.g],encapsulation:2}),t})();var pt=a("5+WD"),ft=a("Th2U");function gt(t,e){if(1&t&&s.Lb(0,"input-column",8),2&t){const t=e.$implicit,a=s.Zb(2);s.hc("column",t)("datalinkTransformForm",a.datalinkTransformForm)}}function kt(t,e){if(1&t&&(s.Ob(0,"div",6),s.Dc(1,gt,1,2,"input-column",7),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("ngForOf",t.childColumns)}}let vt=(()=>{class t{constructor(t,e){this.hubService=t,this.editDatalinkService=e,this.column=null,this.eMappingStatus=y.k,this.eTypeCode=o.pc}ngOnInit(){try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.hubCache=t[0],this.datalinkForm=t[1];let e=this.datalinkTransformForm.value,a=new u.a(u.c.Transform,u.d.Target,this.datalinkForm.value,this.column,null,e,null,y.k.NotMapped,this.hubCache),n=a.createDatalinkImpact(!1);this.mappingStatusInfoImpact=y.n.find(t=>t.key===n);let i=a.createDatalinkLineage(!0);this.mappingStatusInfoLineage=y.p.find(t=>t.key===i),(new u.b).findColumn(this.column,e.nodeDatalinkColumn?e.nodeDatalinkColumn.key:null)&&(this.childColumns=this.column.childColumns)})}catch(t){this.hubService.addHubClientErrorMessage(t,"Input Column")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d))},t.\u0275cmp=s.Eb({type:t,selectors:[["input-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm"},decls:7,vars:8,consts:[["dragZone","","zone","input-column","zone","input-column",1,"list-group-item","p-0","rounded-0",3,"data"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0",2,"overflow","hidden","text-overflow","ellipsis",3,"title"],[1,"input-group-text","rounded-0","border-0","border-l1",3,"ngClass","title"],["class","p-2",4,"ngIf"],[1,"p-2"],[3,"column","datalinkTransformForm",4,"ngFor","ngForOf"],[3,"column","datalinkTransformForm"]],template:function(t,e){1&t&&(s.Ob(0,"div",0),s.Ob(1,"div",1),s.Lb(2,"i",2),s.Ob(3,"a",3),s.Fc(4),s.Nb(),s.Lb(5,"i",4),s.Nb(),s.Nb(),s.Dc(6,kt,2,1,"div",5)),2&t&&(s.hc("data",e.column),s.yb(2),s.hc("ngClass",e.mappingStatusInfoLineage.statusClass)("title",e.mappingStatusInfoLineage.name),s.yb(1),s.hc("title",e.column.logicalName+" "+e.eTypeCode[e.column.dataType]),s.yb(1),s.Hc(" ",e.column.logicalName," "),s.yb(1),s.hc("ngClass",e.mappingStatusInfoImpact.statusClass)("title",e.mappingStatusInfoImpact.name),s.yb(1),s.hc("ngIf",(null==e.childColumns?null:e.childColumns.length)>0))},directives:[ft.a,n.q,n.t,n.s,t],encapsulation:2}),t})();var yt=a("Vjuc"),Tt=a("1mVc");function Ct(t,e){if(1&t&&s.Lb(0,"input-column",9),2&t){const t=e.$implicit,a=s.Zb(4);s.hc("datalinkTransformForm",a.datalinkTransformForm)("column",t)}}function Ft(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",6),s.Ob(1,"div",7),s.Dc(2,Ct,1,2,"input-column",8),s.ac(3,"isValidFilter"),s.ac(4,"fieldSort"),s.Nb(),s.Nb()),2&t){const t=s.Zb().$implicit;s.hc("title",t.name)("padding",!1)("showExpandButton",!0),s.yb(2),s.hc("ngForOf",s.bc(3,4,s.cc(4,6,t.dexihDatalinkColumns,"position")))}}function Dt(t,e){if(1&t&&(s.Ob(0,"span"),s.Dc(1,Ft,5,9,"dexih-widget-section",5),s.Nb()),2&t){const t=e.$implicit;s.yb(1),s.hc("ngIf",t.dexihDatalinkColumns.length>0)}}function wt(t,e){if(1&t&&(s.Ob(0,"div"),s.Lb(1,"input-column",9),s.Nb()),2&t){const t=e.$implicit,a=s.Zb(3);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("column",t)}}function St(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",6),s.Dc(1,wt,2,2,"div",3),s.ac(2,"isValidFilter"),s.ac(3,"fieldSort"),s.Nb()),2&t){const t=e.$implicit;s.hc("title",t.group)("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(2,4,s.cc(3,6,t.columns,"position")))}}function Nt(t,e){if(1&t&&(s.Ob(0,"div",1,2),s.Dc(2,Dt,2,1,"span",3),s.Dc(3,St,4,9,"dexih-widget-section",4),s.Nb()),2&t){const t=s.Zb();s.yb(2),s.hc("ngForOf",t.inputTables),s.yb(1),s.hc("ngForOf",t.columnGroups)}}let Ot=(()=>{class t{constructor(t){this.editDatalinkService=t,this.columns=[],this.columnGroups=[]}ngOnInit(){}ngOnChanges(){this._inputColumnsSubscribe&&this._inputColumnsSubscribe.unsubscribe(),this.columnGroups=this.editDatalinkService.getColumnGroups(this.datalinkTransformForm.controls.runTime.value.inputColumns),this._inputColumnsSubscribe=this.datalinkTransformForm.controls.runTime.valueChanges.subscribe(()=>{this.columnGroups=this.editDatalinkService.getColumnGroups(this.datalinkTransformForm.controls.runTime.value.inputColumns)})}ngOnDestroy(){this._inputColumnsSubscribe&&this._inputColumnsSubscribe.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(d))},t.\u0275cmp=s.Eb({type:t,selectors:[["input-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm"},features:[s.wb],decls:1,vars:1,consts:[["cdkDropList","",4,"ngIf"],["cdkDropList",""],["cdkDropList","cdkDropList"],[4,"ngFor","ngForOf"],[3,"title","padding","showExpandButton",4,"ngFor","ngForOf"],[3,"title","padding","showExpandButton",4,"ngIf"],[3,"title","padding","showExpandButton"],[1,"list-group"],[3,"datalinkTransformForm","column",4,"ngFor","ngForOf"],[3,"datalinkTransformForm","column"]],template:function(t,e){1&t&&s.Dc(0,Nt,4,2,"div",0),2&t&&s.hc("ngIf",e.datalinkTransformForm)},directives:[n.t,pt.e,n.s,p.T,vt],pipes:[yt.a,Tt.a],encapsulation:2}),t})();var It=a("obiC");function xt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(t),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Lb(5,"i",3),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("title",t.column.logicalName+" "+t.column.dataType),s.yb(2),s.hc("ngClass",t.mappingStatusInfoLineage.statusClass)("title",t.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",t.column.logicalName," "),s.yb(1),s.hc("ngClass",t.mappingStatusInfoImpact.statusClass)("title",t.mappingStatusInfoImpact.name)}}function Pt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(t),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Lb(5,"i",3),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("title",t.column.logicalName+" "+t.eTypeCode[t.column.dataType]),s.yb(2),s.hc("ngClass",t.mappingStatusInfoLineage.statusClass)("title",t.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",t.column.logicalName," "),s.yb(1),s.hc("ngClass",t.mappingStatusInfoImpact.statusClass)("title",t.mappingStatusInfoImpact.name)}}let Vt=(()=>{class t{constructor(t,e,a,n,i){this.authService=t,this.hubService=e,this.editDatalinkService=a,this.router=n,this.route=i,this.column=null,this.inputTables=null,this.inputOutputDrop=new s.n,this.eMappingStatus=y.k,this.logger=new c.a("output-column.component"),this.logCount=0,this.eTypeCode=o.pc}ngOnInit(){try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.hubCache=t[0],this.datalinkForm=t[1],this.logger.LogC(()=>"Subscription count: "+this.logCount++,c.b.Trace),this.childColumns=this.column.childColumns,this.refreshStatus()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Output Column")}}ngOnChanges(){this.refreshStatus()}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}refreshStatus(){if(this.datalinkForm){let t=new u.a(u.c.Transform,u.d.Target,this.datalinkForm.value,this.column,null,this.datalinkTransformForm.value,null,y.k.NotMapped,this.hubCache);this.mappingStatusLineage=t.createDatalinkLineage(!1),this.mappingStatusInfoLineage=y.p.find(t=>t.key===this.mappingStatusLineage);let e=t.createDatalinkImpact(!0);this.mappingStatusLineage===y.k.NotMapped&&e!==y.k.AutoGenerate&&(e=y.k.NotMapped),this.mappingStatusInfoImpact=y.n.find(t=>t.key===e)}}editColumn(){!this.column.key||this.mappingStatusLineage!==y.k.Mapped&&this.mappingStatusLineage!==y.k.MappedToNothing?this.authService.informationDialog("Can not edit column","This column is not created by the current transform (i.e. a pass-through or target column).  To edit a column first create a mapping."):this.router.navigate(["column",this.column.key],{relativeTo:this.route.parent})}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(b.a),s.Kb(l.a),s.Kb(d),s.Kb(i.e),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["output-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm",inputTables:"inputTables"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:2,vars:2,consts:[["class","list-group-item p-0 rounded-0",3,"title","click",4,"ngIf"],[1,"list-group-item","p-0","rounded-0",3,"title","click"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0"]],template:function(t,e){1&t&&(s.Dc(0,xt,6,6,"div",0),s.Dc(1,Pt,6,6,"div",0)),2&t&&(s.hc("ngIf",e.mappingStatusInfoLineage.key!=e.eMappingStatus.Mapped),s.yb(1),s.hc("ngIf",e.mappingStatusInfoLineage.key==e.eMappingStatus.Mapped))},directives:[n.t,n.q],encapsulation:2}),t})();function Et(t,e){if(1&t){const t=s.Pb();s.Ob(0,"li",5),s.Vb("dropData",(function(e){return s.vc(t),s.Zb(2).newOutputDrop(e)})),s.Fc(1," \xa0(Drop\xa0Column) "),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("zone",t.allowMappingOutputs?"input-column":"")}}function Kt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",8),s.Vb("dropData",(function(a){s.vc(t);const n=e.$implicit;return s.Zb(3).newInputOutputDrop(a,n)})),s.Lb(1,"output-column",9),s.Nb()}if(2&t){const t=e.$implicit,a=s.Zb(3);s.hc("zone",a.allowMappingOutputs?"input-column":""),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("column",t)}}function Lt(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",6),s.Dc(1,Kt,2,3,"div",7),s.ac(2,"isValidFilter"),s.ac(3,"fieldSort"),s.Nb()),2&t){const t=e.$implicit;s.hc("title",t.group)("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(2,4,s.cc(3,6,t.columns,"position")))}}function Mt(t,e){if(1&t&&(s.Ob(0,"div",1,2),s.Dc(2,Et,2,1,"li",3),s.Dc(3,Lt,4,9,"dexih-widget-section",4),s.Nb()),2&t){const t=s.Zb();s.yb(2),s.hc("ngIf",t.allowMappingOutputs),s.yb(1),s.hc("ngForOf",t.columnGroups)}}let Zt=(()=>{class t{constructor(){this.allowMappingOutputs=!0,this.inputOutputDrop=new s.n,this.columns=[],this.columnGroups=[]}ngOnInit(){}ngOnChanges(){this._outputColumnsSubscribe&&this._outputColumnsSubscribe.unsubscribe(),this.refreshColumns(this.datalinkTransformForm.controls.runTime.value.transformColumns),this._outputColumnsSubscribe=this.datalinkTransformForm.controls.runTime.valueChanges.subscribe(()=>{this.refreshColumns(this.datalinkTransformForm.controls.runTime.value.transformColumns)})}ngOnDestroy(){this._outputColumnsSubscribe&&this._outputColumnsSubscribe.unsubscribe()}refreshColumns(t){let e=null,a=[],n=null;t.filter(t=>t.isValid).sort((t,e)=>t.position-e.position).forEach(t=>{let i=t.columnGroup?t.columnGroup:"(un-grouped)";i!==e&&(n&&a.push({group:e,columns:n}),e=i,n=[]),n.push(t)}),n&&n.length>0&&a.push({group:e,columns:n}),this.columnGroups=a}newOutputDrop(t){let e=this.columns.find(e=>e.name===t.name);this.inputOutputDrop.emit({inputColumn:t,outputColumn:e})}newInputOutputDrop(t,e){this.inputOutputDrop.emit({inputColumn:t,outputColumn:e})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Eb({type:t,selectors:[["output-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm",allowMappingOutputs:"allowMappingOutputs"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:1,vars:1,consts:[["cdkDropList","",4,"ngIf"],["cdkDropList",""],["cdkDropList","cdkDropList"],["class","list-group-item p-1 dexih-overflow b-0","style","height: 40px;","title","drop to create new mapping...","dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData",4,"ngIf"],[3,"title","padding","showExpandButton",4,"ngFor","ngForOf"],["title","drop to create new mapping...","dropZone","","dropAllowedClass","drop-zone-green",1,"list-group-item","p-1","dexih-overflow","b-0",2,"height","40px",3,"zone","dropData"],[3,"title","padding","showExpandButton"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData",4,"ngFor","ngForOf"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData"],[3,"datalinkTransformForm","column"]],template:function(t,e){1&t&&s.Dc(0,Mt,4,2,"div",0),2&t&&s.hc("ngIf",e.datalinkTransformForm)},directives:[n.t,pt.e,n.s,It.a,p.T,Vt],pipes:[yt.a,Tt.a],encapsulation:2}),t})();function At(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(t),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("title",t.column.logicalName+" "+t.eTypeCode[t.column.dataType]),s.yb(2),s.hc("ngClass",t.mappingStatusInfoLineage.statusClass)("title",t.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",t.column.logicalName," ")}}function _t(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(t),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("title",t.column.logicalName+" "+t.eTypeCode[t.column.dataType]),s.yb(2),s.hc("ngClass",t.mappingStatusInfoLineage.statusClass)("title",t.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",t.column.logicalName," ")}}let Gt=(()=>{class t{constructor(t,e,a,n,i){this.authService=t,this.hubService=e,this.editDatalinkService=a,this.router=n,this.route=i,this.column=null,this.inputTables=null,this.inputOutputDrop=new s.n,this.eMappingStatus=y.k,this.eTypeCode=o.pc,this.logger=new c.a("output-column.component"),this.logCount=0}ngOnInit(){try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.hubCache=t[0],this.datalinkForm=t[1],this.logger.LogC(()=>"Subscription count: "+this.logCount++,c.b.Trace),this.childColumns=this.column.childColumns,this.refreshStatus()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Output Column")}}ngOnChanges(){this.refreshStatus()}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}refreshStatus(){if(this.datalinkForm){let t=new u.a(u.c.TargetTable,u.d.Target,this.datalinkForm.value,null,this.column,null,null,y.k.NotMapped,this.hubCache);this.mappingStatusLineage=t.createDatalinkLineage(!0),this.mappingStatusInfoLineage=y.p.find(t=>t.key===this.mappingStatusLineage)}}editColumn(){!this.column.key||this.mappingStatusLineage!==y.k.Mapped&&this.mappingStatusLineage!==y.k.MappedToNothing?this.authService.informationDialog("Can not edit column","This column is not created by the current transform (i.e. a pass-through or target column).  To edit a column first create a mapping."):this.router.navigate(["column",this.column.key],{relativeTo:this.route.parent})}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(b.a),s.Kb(l.a),s.Kb(d),s.Kb(i.e),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["target-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm",inputTables:"inputTables"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:2,vars:2,consts:[["class","list-group-item p-0 rounded-0",3,"title","click",4,"ngIf"],[1,"list-group-item","p-0","rounded-0",3,"title","click"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0"]],template:function(t,e){1&t&&(s.Dc(0,At,5,4,"div",0),s.Dc(1,_t,5,4,"div",0)),2&t&&(s.hc("ngIf",e.mappingStatusInfoLineage.key!=e.eMappingStatus.Mapped),s.yb(1),s.hc("ngIf",e.mappingStatusInfoLineage.key==e.eMappingStatus.Mapped))},directives:[n.t,n.q],encapsulation:2}),t})();function Rt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",6),s.Vb("dropData",(function(a){s.vc(t);const n=e.$implicit;return s.Zb(3).newInputOutputDrop(a,n)})),s.Lb(1,"target-column",7),s.Nb()}if(2&t){const t=e.$implicit,a=s.Zb(3);s.hc("zone",a.allowMappingOutputs?"input-column":""),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("column",t)}}function jt(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",4),s.Dc(1,Rt,2,3,"div",5),s.ac(2,"isValidFilter"),s.ac(3,"fieldSort"),s.Nb()),2&t){const t=e.$implicit;s.hc("title","Target ("+t.table.name+")")("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(2,4,s.cc(3,6,t.table.dexihTableColumns,"position")))}}function Ht(t,e){if(1&t&&(s.Ob(0,"div",1,2),s.Dc(2,jt,4,9,"dexih-widget-section",3),s.Nb()),2&t){const t=s.Zb();s.yb(2),s.hc("ngForOf",t.targets)}}let Jt=(()=>{class t{constructor(){this.allowMappingOutputs=!0,this.inputOutputDrop=new s.n}ngOnInit(){}ngOnChanges(){}ngOnDestroy(){}newInputOutputDrop(t,e){this.inputOutputDrop.emit({inputColumn:t,outputColumn:e})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Eb({type:t,selectors:[["target-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm",targets:"targets",allowMappingOutputs:"allowMappingOutputs"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:1,vars:1,consts:[["cdkDropList","",4,"ngIf"],["cdkDropList",""],["cdkDropList","cdkDropList"],[3,"title","padding","showExpandButton",4,"ngFor","ngForOf"],[3,"title","padding","showExpandButton"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData",4,"ngFor","ngForOf"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData"],[3,"datalinkTransformForm","column"]],template:function(t,e){1&t&&s.Dc(0,Ht,3,1,"div",0),2&t&&s.hc("ngIf",e.targets)},directives:[n.t,pt.e,n.s,p.T,It.a,Gt],pipes:[yt.a,Tt.a],encapsulation:2}),t})();function Bt(t,e){if(1&t&&(s.Ob(0,"a",5),s.Fc(1),s.Nb()),2&t){const t=s.Zb();s.hc("title",t.column.logicalName+" "+t.eTypeCode[t.column.dataType]),s.yb(1),s.Hc(" ",t.column.logicalName," ")}}function $t(t,e){if(1&t&&(s.Ob(0,"a",5),s.Fc(1),s.Nb()),2&t){const t=s.Zb();s.hc("title",t.column.logicalName+" "+t.eTypeCode[t.column.dataType]),s.yb(1),s.Hc(" ",t.column.logicalName," ")}}let Ut=(()=>{class t{constructor(t){this.hubService=t,this.column=null,this.inputTables=null,this.inputJoinDrop=new s.n,this.eMappingStatus=y.k,this.eTypeCode=o.pc}ngOnInit(){this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(t=>{if(t.isLoaded()){this.hubCache=t;let e=new u.a(u.c.Transform,u.d.Target,this.datalinkForm.value,this.column,null,this.datalinkTransformForm.value,null,y.k.NotMapped,this.hubCache),a=e.createDatalinkLineage(!1);this.mappingStatusInfoLineage=y.p.find(t=>t.key===a);let n=e.createDatalinkImpact(!1);this.mappingStatusInfoImpact=y.n.find(t=>t.key===n)}})}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["join-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm",datalinkForm:"datalinkForm",inputTables:"inputTables"},outputs:{inputJoinDrop:"inputJoinDrop"},decls:6,vars:6,consts:[[1,"list-group-item","p-0","rounded-0"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],["class","flex-fill input-group-text ellipsis-overflow rounded-0 border-0","style","overflow:hidden; text-overflow :ellipsis;",3,"title",4,"ngIf"],[1,"input-group-text","rounded-0","border-0","border-l1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0",2,"overflow","hidden","text-overflow","ellipsis",3,"title"]],template:function(t,e){1&t&&(s.Ob(0,"div",0),s.Ob(1,"div",1),s.Lb(2,"i",2),s.Dc(3,Bt,2,2,"a",3),s.Dc(4,$t,2,2,"a",3),s.Lb(5,"i",4),s.Nb(),s.Nb()),2&t&&(s.yb(2),s.hc("ngClass",e.mappingStatusInfoLineage.statusClass)("title",e.mappingStatusInfoLineage.name),s.yb(1),s.hc("ngIf",e.mappingStatusInfoLineage.key!=e.eMappingStatus.Joined),s.yb(1),s.hc("ngIf",e.mappingStatusInfoLineage.key==e.eMappingStatus.Joined),s.yb(1),s.hc("ngClass",e.mappingStatusInfoImpact.statusClass)("title",e.mappingStatusInfoImpact.name))},directives:[n.q,n.t],encapsulation:2}),t})();function qt(t,e){if(1&t){const t=s.Pb();s.Ob(0,"join-column",3),s.Vb("dropData",(function(a){s.vc(t);const n=e.$implicit;return s.Zb(2).newInputJoinDrop(a,n)})),s.Nb()}if(2&t){const t=e.$implicit,a=s.Zb(2);s.hc("datalinkForm",a.datalinkForm)("datalinkTransformForm",a.datalinkTransformForm)("column",t)}}function zt(t,e){if(1&t&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,qt,1,3,"join-column",2),s.ac(3,"isValidFilter"),s.ac(4,"fieldSort"),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("title",(null==t.joinTable?null:t.joinTable.name)+"("+t.eTransformType[t.datalinkTransformForm.value.transformType]+")")("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(3,4,s.cc(4,6,t.joinColumns,"position")))}}let Wt=(()=>{class t{constructor(t,e){this.hubService=t,this.editDatalinkService=e,this.inputJoinDrop=new s.n,this.eTransformType=o.lc}ngOnInit(){try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.datalinkForm=t[1],this.datalinkForm&&this.updateTableData()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function")}}ngOnChanges(){this.updateTableData(),this._changesSubscription&&this._changesSubscription.unsubscribe(),this._changesSubscription=this.datalinkTransformForm.controls.joinDatalinkTable.valueChanges.subscribe(()=>{this.updateTableData()})}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._changesSubscription&&this._changesSubscription.unsubscribe()}updateTableData(){this.datalinkTransformForm&&this.datalinkTransformForm.controls.joinDatalinkTable.value?(this.joinTable=this.datalinkTransformForm.controls.joinDatalinkTable.value,this.joinTable?(this.joinColumns=new Array,this.joinTable.dexihDatalinkColumns.forEach(t=>{this.joinColumns.push(t)})):this.joinColumns=null):this.joinColumns=null}newInputJoinDrop(t,e){this.inputJoinDrop.emit({inputColumn:t,joinColumn:e})}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d))},t.\u0275cmp=s.Eb({type:t,selectors:[["join-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm"},outputs:{inputJoinDrop:"inputJoinDrop"},features:[s.wb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"title","padding","showExpandButton"],["dropZone","","zone","input-column","dropAllowedClass","drop-zone-green",3,"datalinkForm","datalinkTransformForm","column","dropData",4,"ngFor","ngForOf"],["dropZone","","zone","input-column","dropAllowedClass","drop-zone-green",3,"datalinkForm","datalinkTransformForm","column","dropData"]],template:function(t,e){1&t&&s.Dc(0,zt,5,9,"div",0),2&t&&s.hc("ngIf",e.joinColumns)},directives:[n.t,p.T,n.s,Ut,It.a],pipes:[yt.a,Tt.a],encapsulation:2}),t})();var Qt=a("F2jK"),Yt=a("Xjf6");function Xt(t,e){if(1&t&&(s.Ob(0,"div",7),s.Lb(1,"i",8),s.Fc(2),s.Nb()),2&t){const t=s.Zb(2);s.yb(2),s.Hc(" ",t.error," ")}}function te(t,e){if(1&t&&s.Lb(0,"i",10),2&t){const t=s.Zb(3);s.hc("title",t.source.error)}}function ee(t,e){if(1&t&&(s.Ob(0,"div",4),s.Dc(1,te,1,1,"i",9),s.Fc(2),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("ngIf",!t.source.valid),s.yb(1),s.Gc(t.source.text)}}function ae(t,e){1&t&&s.Lb(0,"i",13)}function ne(t,e){if(1&t&&s.Lb(0,"i",10),2&t){const t=s.Zb(3);s.hc("title",t.target.error)}}function ie(t,e){if(1&t&&(s.Ob(0,"span",14),s.Fc(1),s.Nb()),2&t){const t=s.Zb(3);s.yb(1),s.Gc(t.compare)}}function re(t,e){if(1&t&&(s.Ob(0,"div",4),s.Dc(1,ae,1,0,"i",11),s.Dc(2,ne,1,1,"i",9),s.Dc(3,ie,2,1,"span",12),s.Fc(4),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("ngIf",t.source&&!t.compare),s.yb(1),s.hc("ngIf",!t.target.valid),s.yb(1),s.hc("ngIf",t.compare),s.yb(1),s.Hc(" ",t.target.text," ")}}function oe(t,e){if(1&t&&(s.Ob(0,"div",3),s.Ob(1,"div",4),s.Ob(2,"h5"),s.Fc(3),s.Nb(),s.Dc(4,Xt,3,1,"div",5),s.Nb(),s.Dc(5,ee,3,2,"div",6),s.Dc(6,re,5,4,"div",6),s.Nb()),2&t){const t=s.Zb();s.yb(3),s.Gc(t.label),s.yb(1),s.hc("ngIf",t.error),s.yb(1),s.hc("ngIf",t.source),s.yb(1),s.hc("ngIf",t.target)}}function se(t,e){if(1&t&&s.Lb(0,"i",10),2&t){const t=s.Zb(3);s.hc("title",t.source.error)}}function le(t,e){if(1&t&&(s.Ob(0,"div"),s.Dc(1,se,1,1,"i",9),s.Fc(2),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("ngIf",!t.source.valid),s.yb(1),s.Hc("Source = ",t.source.text," ")}}function ce(t,e){if(1&t&&(s.Ob(0,"div"),s.Fc(1),s.Nb()),2&t){const t=s.Zb(2).$implicit;s.yb(1),s.Gc(t.name)}}function ue(t,e){1&t&&s.Lb(0,"i",8)}function me(t,e){if(1&t&&(s.Ob(0,"div",15),s.Ob(1,"div",22),s.Dc(2,ce,2,1,"div",17),s.Nb(),s.Ob(3,"div",23),s.Dc(4,ue,1,0,"i",24),s.Fc(5),s.Nb(),s.Nb()),2&t){const t=e.$implicit,a=e.index,n=s.Zb().$implicit;s.yb(2),s.hc("ngIf",0==a),s.yb(1),s.hc("title",t.error),s.yb(1),s.hc("ngIf",!t.valid),s.yb(1),s.Hc(" ",(n.values.length>1?"["+a+"] ":"")+t.text," ")}}function be(t,e){1&t&&s.Dc(0,me,6,4,"div",21),2&t&&s.hc("ngForOf",e.$implicit.values)}function he(t,e){if(1&t&&(s.Ob(0,"div",18),s.Ob(1,"div",16),s.Ob(2,"h5"),s.Fc(3,"Inputs"),s.Nb(),s.Nb(),s.Nb(),s.Ob(4,"div",15),s.Ob(5,"div",19),s.Fc(6,"Parameter"),s.Nb(),s.Ob(7,"div",19),s.Fc(8,"Column / Value"),s.Nb(),s.Nb(),s.Dc(9,be,1,1,"ng-template",20)),2&t){const t=s.Zb(2);s.yb(9),s.hc("ngForOf",t.inputParameters)}}function de(t,e){if(1&t&&(s.Ob(0,"div",19),s.Fc(1),s.Nb()),2&t){const t=e.$implicit;s.yb(1),s.Gc(t.name)}}function pe(t,e){1&t&&s.Lb(0,"i",8)}function fe(t,e){if(1&t&&(s.Ob(0,"div",29),s.Dc(1,pe,1,0,"i",24),s.Fc(2),s.Nb()),2&t){const t=e.$implicit,a=s.Zb().index;s.hc("title",t.values[a].error),s.yb(1),s.hc("ngIf",!t.values[a].valid),s.yb(1),s.Hc(" ",t.values[a].text," ")}}function ge(t,e){if(1&t&&(s.Ob(0,"div",15),s.Dc(1,fe,3,3,"div",28),s.Nb()),2&t){const t=s.Zb().$implicit;s.yb(1),s.hc("ngForOf",t.parameters)}}function ke(t,e){if(1&t&&(s.Ob(0,"div"),s.Ob(1,"div",18),s.Ob(2,"div",26),s.Ob(3,"h5"),s.Fc(4),s.Nb(),s.Nb(),s.Nb(),s.Ob(5,"div",15),s.Dc(6,de,2,1,"div",27),s.Nb(),s.Dc(7,ge,2,1,"div",21),s.Nb()),2&t){const t=e.$implicit;s.yb(4),s.Gc(t.name),s.yb(2),s.hc("ngForOf",t.parameters),s.yb(1),s.hc("ngForOf",t.parameters[0].values)}}function ve(t,e){if(1&t&&s.Dc(0,ke,8,3,"div",25),2&t){const t=s.Zb(2);s.hc("ngForOf",t.mapParameters)}}function ye(t,e){if(1&t&&(s.Ob(0,"div"),s.Fc(1),s.Nb()),2&t){const t=s.Zb(2).$implicit;s.yb(1),s.Gc(t.name)}}function Te(t,e){1&t&&s.Lb(0,"i",8)}function Ce(t,e){if(1&t&&(s.Ob(0,"div",15),s.Ob(1,"div",22),s.Dc(2,ye,2,1,"div",17),s.Nb(),s.Ob(3,"div",30),s.Dc(4,Te,1,0,"i",24),s.Fc(5),s.Nb(),s.Nb()),2&t){const t=e.$implicit,a=e.index,n=s.Zb().$implicit;s.yb(2),s.hc("ngIf",0==a),s.yb(1),s.hc("title",t.error),s.yb(1),s.hc("ngIf",!t.valid),s.yb(1),s.Hc(" ",(n.values.length>1?"["+a+"] ":"")+t.text," ")}}function Fe(t,e){1&t&&s.Dc(0,Ce,6,4,"div",21),2&t&&s.hc("ngForOf",e.$implicit.values)}function De(t,e){if(1&t&&(s.Ob(0,"div",18),s.Ob(1,"div",16),s.Ob(2,"h5"),s.Fc(3,"Outputs"),s.Nb(),s.Nb(),s.Nb(),s.Ob(4,"div",15),s.Ob(5,"div",19),s.Fc(6,"Parameter"),s.Nb(),s.Ob(7,"div",19),s.Fc(8,"Column / Value"),s.Nb(),s.Nb(),s.Dc(9,Fe,1,1,"ng-template",20)),2&t){const t=s.Zb(2);s.yb(9),s.hc("ngForOf",t.outputParameters)}}function we(t,e){if(1&t&&(s.Ob(0,"div",15),s.Ob(1,"div",16),s.Ob(2,"h5"),s.Fc(3),s.Nb(),s.Nb(),s.Nb(),s.Dc(4,le,3,2,"div",17),s.Dc(5,he,10,1,"ng-template",2),s.Dc(6,ve,1,1,"ng-template",2),s.Dc(7,De,10,1,"ng-template",2)),2&t){const t=s.Zb();s.yb(3),s.Gc(t.label),s.yb(1),s.hc("ngIf",t.source),s.yb(1),s.hc("ngIf",(null==t.inputParameters?null:t.inputParameters.length)>0),s.yb(1),s.hc("ngIf",t.mapParameters),s.yb(1),s.hc("ngIf",(null==t.outputParameters?null:t.outputParameters.length)>0)}}let Se=(()=>{class t{constructor(t){this.hubService=t}ngOnInit(){try{this._subscription&&this._subscription.unsubscribe(),this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(t=>{this.hubCache=t[0],this.updateMapping()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Mappings")}}updateMapping(){return t=this,void 0,a=function*(){let t=this.transformItem,e=y.x.find(e=>e.key===t.transformItemType);switch(t.transformItemType){case o.kc.BuiltInFunction:if(t.functionClassName){let e=yield this.hubService.GetFunctionReference(t);e?(this.label=e.name,this.addBuiltInFunctionParameters(e)):this.error=`Error, function ${t.functionClassName}.${t.functionMethodName} not found.`}else if(t.customFunctionKey){let e=this.hubCache.hub.dexihCustomFunctions.find(e=>e.key===t.customFunctionKey);e?(this.label=e.name,this.addCustomFunctionParameters()):this.error="Error, function not found."}else this.error="Error, function not found";break;case o.kc.CustomFunction:this.addCustomFunctionParameters();break;case o.kc.AggregatePair:this.label=o.Y[t.aggregate];break;case o.kc.Sort:this.label=o.fc[t.sortDirection];break;case o.kc.UnGroup:this.label="UnGroup",this.addUnGroupParameters();break;default:this.label=e.name}if(e.useSource&&(this.source=this.columnOrValue(null,t.sourceDatalinkColumn,t.sourceValue)),e.useTarget&&(this.target=this.describeDatalinkColumn(null,t.targetDatalinkColumn)),e.useJoin&&(this.target=this.describeDatalinkColumn(null,t.joinDatalinkColumn)),e.useFilter&&(this.target=this.columnOrValue(null,t.filterDatalinkColumn,t.filterValue)),e.useFilter||e.useJoin){let e=t.filterCompare;null===e&&(e=o.hb.IsEqual),this.compare=Qt.a.find(t=>t.key===e).name}else this.compare=null},new((e=void 0)||(e=Promise))((function(n,i){function r(t){try{s(a.next(t))}catch(e){i(e)}}function o(t){try{s(a.throw(t))}catch(e){i(e)}}function s(t){var a;t.done?n(t.value):(a=t.value,a instanceof e?a:new e((function(t){t(a)}))).then(r,o)}s((a=a.apply(t,[])).next())}));var t,e,a}columnOrValue(t,e,a){return e?this.describeDatalinkColumn(t,e):{text:this.describeStaticValue(a),valid:!0,error:""}}concat(...t){let e=[];return t.forEach(t=>{t&&(e=e.concat(t))}),e}addBuiltInFunctionParameters(t){let e=this.concat(t.inputParameters,t.resultInputParameters),a=this.concat(t.outputParameters,t.returnParameters,t.resultOutputParameters,t.resultReturnParameters),n=this.transformItem.dexihFunctionParameters.filter(t=>t.direction===o.Vb.Input||t.direction===o.Vb.ResultInput||t.direction===o.Vb.Join);this.inputParameters=e.filter(t=>t&&!t.linkedName).map(t=>{let e=n.find(e=>e.name===t.parameterName);if(e){if(0===e.rank){let t=this.columnOrValue(e.dataType,e.datalinkColumn,e.value);return{name:this.describeParameterName(e),values:[t]}}{let t=e.arrayParameters.sort((t,e)=>t.position-e.position).map(t=>this.columnOrValue(t.dataType,t.datalinkColumn,t.value));return{name:this.describeParameterName(e),values:t}}}return{name:this.describeParameterName(e),values:[{valid:!1,error:"Not Mapped",text:""}]}});let i=this.transformItem.dexihFunctionParameters.filter(t=>y.e.parameterIsOutput(t));this.outputParameters=a.filter(t=>t&&!t.linkedName).map(t=>{let e=i.find(e=>e.name===t.parameterName);if(e){if(this.allowCondition&&(e.direction===o.Vb.ReturnValue||e.direction===o.Vb.ResultReturnValue))return null;if(0===e.rank||null!==e.datalinkColumn){let t=this.describeDatalinkColumn(e.dataType,e.datalinkColumn);return{name:this.describeParameterName(e),values:[t]}}{let t=e.arrayParameters.sort((t,e)=>t.position-e.position).map(t=>this.describeDatalinkColumn(t.dataType,t.datalinkColumn));return{name:this.describeParameterName(e),values:t}}}return null}).filter(t=>null!==t);let r=Array.from(new Set(this.concat(e,a).map(t=>t&&t.linkedName).filter(t=>t)));this.mapParameters=r.map(t=>{let r=e.filter(e=>e.linkedName===t).map(t=>{let e=n.find(e=>e.name===t.parameterName).arrayParameters.sort((t,e)=>t.position-e.position).map(t=>this.columnOrValue(t.dataType,t.datalinkColumn,t.value));return{name:this.describeParameterName(t),values:e}}),o=a.filter(e=>e.linkedName===t).map(t=>{let e=i.find(e=>e.name===t.parameterName).arrayParameters.sort((t,e)=>t.position-e.position).map(t=>this.describeDatalinkColumn(t.dataType,t.datalinkColumn));return{name:this.describeParameterName(t),values:e}});return{name:t,parameters:this.concat(r,o)}})}addCustomFunctionParameters(){let t=this.transformItem.dexihFunctionParameters.filter(t=>t.direction===o.Vb.Input||t.direction===o.Vb.ResultInput||t.direction===o.Vb.Join);this.inputParameters=t.map(t=>{if(0===t.rank){let e=this.columnOrValue(t.dataType,t.datalinkColumn,t.value);return{name:this.describeParameterName(t),values:[e]}}{let e=t.arrayParameters.sort((t,e)=>t.position-e.position).map(t=>this.columnOrValue(t.dataType,t.datalinkColumn,t.value));return{name:this.describeParameterName(t),values:e}}});let e=this.transformItem.dexihFunctionParameters.filter(t=>y.e.parameterIsOutput(t));this.outputParameters=e.map(t=>{if(0===t.rank){let e=this.describeDatalinkColumn(t.dataType,t.datalinkColumn);return{name:this.describeParameterName(t),values:[e]}}{let e=t.arrayParameters.sort((t,e)=>t.position-e.position).map(t=>this.describeDatalinkColumn(t.dataType,t.datalinkColumn));return{name:this.describeParameterName(t),values:e}}})}addUnGroupParameters(){let t=this.transformItem.dexihFunctionParameters,e=this.transform.runTime.inputColumns.find(t=>t.key===this.transformItem.sourceDatalinkColumn.key);e&&(this.outputParameters=t.map(t=>t.datalinkColumn?e.childColumns.find(e=>e.key===t.datalinkColumn.key)?{name:this.describeParameterName(t),values:[{valid:!0,error:"",text:t.datalinkColumn.name}]}:{name:this.describeParameterName(t),values:[{valid:!1,error:"(Invalid column) ",text:t.datalinkColumn.name}]}:{name:this.describeParameterName(t),values:[{valid:!1,error:"(No column)",text:""}]}))}describeParameterName(t){return t.name+" ("+o.pc[t.dataType]+")"}describeDatalinkColumn(t,e){if(!e)return{error:"(not mapped)",text:"",valid:!1};let a=this.transform.runTime,n=a.inputColumns,i=this.transform.nodeDatalinkColumn?this.transform.nodeDatalinkColumn:null,r=i?i.key:null,s=null;if((new u.b).findValidColumn(e,r,n)&&(s=(e.columnGroup?"("+e.columnGroup+")":"")+e.logicalName),s||a.transformColumns.forEach(t=>{s||t.key!==e.key||(s=e.logicalName)}),!s&&this.transform.joinDatalinkTable){let t=this.transform.joinDatalinkTable;t.dexihDatalinkColumns.forEach(a=>{s||a.key!==e.key||(s="("+t.name+") "+e.logicalName)})}return s?null==t||e.dataType===t?{text:s,valid:!0,error:""}:{text:s,error:"(inconsistent datatype "+o.pc[e.dataType]+")",valid:!1}:{text:e.logicalName,error:"(Invalid column) ",valid:!1}}describeStaticValue(t){return" "===t?"<space>":t?'"'+t+'"':"<null>"}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(Yt.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["mapping-item"]],inputs:{transform:"transform",transformItem:"transformItem",allowCondition:"allowCondition"},decls:3,vars:2,consts:[[1,"container"],["class","row justify-content-start",4,"ngIf"],[3,"ngIf"],[1,"row","justify-content-start"],[1,"col-auto"],["class","text-danger",4,"ngIf"],["class","col-auto",4,"ngIf"],[1,"text-danger"],[1,"fa","fa-exclamation-circle","text-danger"],["class","fa fa-exclamation-circle text-danger",3,"title",4,"ngIf"],[1,"fa","fa-exclamation-circle","text-danger",3,"title"],["class","fa fa-arrow-right mr-2",4,"ngIf"],["class","mr-2",4,"ngIf"],[1,"fa","fa-arrow-right","mr-2"],[1,"mr-2"],[1,"row"],[1,"col"],[4,"ngIf"],[1,"row","pt-2"],[1,"col","border","bg-primary","text-white","font-weight-bold","text-truncate"],["ngFor","",3,"ngForOf"],["class","row",4,"ngFor","ngForOf"],[1,"col","border","bg-secondary","text-white","text-truncate"],[1,"col","border","border","text-white","bg-secondary","text-truncate",3,"title"],["class","fa fa-exclamation-circle text-danger",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col","text-truncate"],["class","col border bg-primary text-white font-weight-bold text-truncate",4,"ngFor","ngForOf"],["class","col border bg-secondary text-white text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"col","border","bg-secondary","text-white","text-truncate",3,"title"],[1,"col","border","border","bg-secondary","text-white","text-truncate",3,"title"]],template:function(t,e){1&t&&(s.Ob(0,"div",0),s.Dc(1,oe,7,4,"div",1),s.Dc(2,we,8,5,"ng-template",2),s.Nb()),2&t&&(s.yb(1),s.hc("ngIf",!e.outputParameters),s.yb(1),s.hc("ngIf",e.outputParameters))},directives:[n.t,n.s],encapsulation:2}),t})();const Ne=["mappingTable"];function Oe(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-edit",9),s.Vb("click",(function(){s.vc(t);const a=e.item;return s.Zb().editMapping(a)})),s.Nb()}}function Ie(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-delete",10),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb().deleteSelected(a)})),s.Nb()}}function xe(t,e){if(1&t){const t=s.Pb();s.Ob(0,"mapping-item",11),s.Vb("click",(function(){s.vc(t);const a=e.item;return s.Zb().editMapping(a)})),s.Nb()}if(2&t){const t=e.item,a=s.Zb();s.hc("transform",a.datalinkTransformForm.value)("transformItem",t.datalinkTransformItem)("allowCondition",a.allowCondition)}}function Pe(t,e){if(1&t){const t=s.Pb();s.Ob(0,"li"),s.Ob(1,"a",16),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb(3).addGroup(a)})),s.Fc(2),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit;s.yb(1),s.hc("title","Add all "+t.group),s.yb(1),s.Hc("Add all ",t.group,"")}}function Ve(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-splitdropdown",13),s.Vb("buttonClick",(function(){s.vc(t);const e=s.Zb(2);return e.newMapping(e.eTransformItemType.ColumnPair)})),s.Ob(1,"li"),s.Ob(2,"a",14),s.Vb("click",(function(){return s.vc(t),s.Zb(2).addAll()})),s.Fc(3,"Add all input columns"),s.Nb(),s.Nb(),s.Dc(4,Pe,3,2,"li",15),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(4),s.hc("ngForOf",t.columnGroups)}}function Ee(t,e){if(1&t&&(s.Ob(0,"dexih-button",17),s.Fc(1,"Filter "),s.Nb()),2&t){const t=s.Zb(2);s.jc("routerLink","mapping-edit/",t.eTransformItemType.FilterPair,"")}}function Ke(t,e){if(1&t&&(s.Ob(0,"dexih-button",18),s.Fc(1," Aggregate"),s.Nb()),2&t){const t=s.Zb(2);s.jc("routerLink","mapping-edit/",t.eTransformItemType.AggregatePair,"")}}const Le=function(t){return["standard-function-edit",t]},Me=function(t){return["custom-function-edit",t]};function Ze(t,e){if(1&t&&(s.Ob(0,"dexih-button",19),s.Fc(1," Standard"),s.Nb(),s.Ob(2,"dexih-button",20),s.Fc(3,"Custom"),s.Nb()),2&t){const t=s.Zb(2);s.hc("routerLink",s.mc(2,Le,t.functionType)),s.yb(2),s.hc("routerLink",s.mc(4,Me,t.functionType))}}function Ae(t,e){1&t&&(s.Ob(0,"dexih-button",21),s.Fc(1,"Un-Group"),s.Nb())}function _e(t,e){if(1&t){const t=s.Pb();s.Ob(0,"li"),s.Ob(1,"a",16),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb(3).addValidFromTo(a)})),s.Fc(2),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit;s.yb(1),s.hc("title",t.name),s.yb(1),s.Gc(t.name)}}function Ge(t,e){if(1&t&&(s.Ob(0,"dexih-button",22),s.Fc(1,"Join "),s.Nb(),s.Ob(2,"dexih-button",23),s.Fc(3," Filter"),s.Nb(),s.Ob(4,"dexih-button",24),s.Fc(5,"Custom Filter"),s.Nb(),s.Ob(6,"dexih-button-dropdown",25),s.Dc(7,_e,3,2,"li",15),s.Nb()),2&t){const t=s.Zb(2);s.jc("routerLink","mapping-edit/",t.eTransformItemType.JoinPair,""),s.yb(2),s.hc("routerLink",s.mc(4,Le,t.functionType)),s.yb(2),s.hc("routerLink",s.mc(6,Me,t.functionType)),s.yb(3),s.hc("ngForOf",t.inputDateColumns)}}function Re(t,e){if(1&t&&(s.Ob(0,"dexih-button",26),s.Fc(1,"Sort"),s.Nb()),2&t){const t=s.Zb(2);s.jc("routerLink","mapping-edit/",t.eTransformItemType.Sort,"")}}function je(t,e){if(1&t&&(s.Ob(0,"dexih-button",27),s.Fc(1,"Group"),s.Nb()),2&t){const t=s.Zb(2);s.jc("routerLink","mapping-edit/",t.eTransformItemType.Column,"")}}function He(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button",28),s.Vb("click",(function(){return s.vc(t),s.Zb(2).createJoinNode()})),s.Fc(1,"Node"),s.Nb()}}function Je(t,e){if(1&t&&(s.Dc(0,Ve,5,1,"ng-template",12),s.Dc(1,Ee,2,1,"ng-template",12),s.Dc(2,Ke,2,1,"ng-template",12),s.Dc(3,Ze,4,6,"ng-template",12),s.Dc(4,Ae,2,0,"ng-template",12),s.Dc(5,Ge,8,8,"ng-template",12),s.Dc(6,Re,2,1,"ng-template",12),s.Dc(7,je,2,1,"ng-template",12),s.Dc(8,He,2,0,"ng-template",12)),2&t){const t=s.Zb();s.hc("ngIf",t.allowMapping),s.yb(1),s.hc("ngIf",t.allowCondition&&!t.allowValidation),s.yb(1),s.hc("ngIf",t.allowAggregate),s.yb(1),s.hc("ngIf",t.allowStandard||t.allowAggregate||t.allowCondition||t.allowRow||t.allowValidation),s.yb(1),s.hc("ngIf",t.allowRow),s.yb(1),s.hc("ngIf",t.allowJoin),s.yb(1),s.hc("ngIf",t.allowSort),s.yb(1),s.hc("ngIf",t.allowGroup),s.yb(1),s.hc("ngIf",t.allowJoinNode)}}let Be=(()=>{class t{constructor(t,e,a,n,i){this.authService=t,this.hubService=e,this.editDatalinkService=a,this.router=n,this.route=i,this.allowStandard=!1,this.allowMapping=!1,this.allowAggregate=!1,this.allowRow=!1,this.allowCondition=!1,this.allowValidation=!1,this.allowOutput=!1,this.allowGroup=!1,this.allowJoin=!1,this.allowSort=!1,this.allowSeries=!1,this.allowJoinNode=!1,this.addMapping=new s.n,this.removeMapping=new s.n,this.updateMapping=new s.n,this.hasChanged=new s.n,this.onColumnDrop=new s.n,this._tableData=new m.a(null),this.tableData=this._tableData.asObservable(),this.eTransformType=o.lc,this.eTransformItemType=o.kc,this.columnGroups=[]}ngOnInit(){}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._changesSubscription&&this._changesSubscription.unsubscribe()}ngOnChanges(){try{this.columns=[],this._subscription&&this._subscription.unsubscribe(),this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(()=>{this.functionType=this.editDatalinkService.getFunctionType(this.datalinkTransformForm.value),this.transformType=this.datalinkTransformForm.value.transformType,this.updateTableData(),this._changesSubscription&&this._changesSubscription.unsubscribe(),this._changesSubscription=this.datalinkTransformForm.valueChanges.subscribe(()=>this.updateTableData())})}catch(t){this.hubService.addHubClientErrorMessage(t,"Mappings")}}updateTableData(){try{if(this.datalinkTransformForm){let t=this.datalinkTransformForm.controls.runTime.value.inputColumns;this.inputDateColumns=t.filter(t=>t.dataType===o.pc.DateTime||t.dataType===o.pc.Date),this.columnGroups=this.editDatalinkService.getColumnGroups(t);let e=[],a=this.datalinkTransformForm.controls.dexihDatalinkTransformItems,n=[];this.allowJoinNode&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.JoinNode))),this.allowGroup&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.Column))),(this.allowStandard||this.allowJoin)&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.BuiltInFunction||t.value.transformItemType===o.kc.CustomFunction))),this.allowAggregate&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.AggregatePair))),this.allowMapping&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.ColumnPair))),this.allowCondition&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.FilterPair))),this.allowJoin&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.JoinPair))),this.allowRow&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.UnGroup))),this.allowSort&&(n=n.concat(a.controls.filter(t=>t.value.transformItemType===o.kc.Sort))),n.sort((t,e)=>t.value.position-e.value.position).forEach(t=>{const a=t.value;e.push({datalinkTransformItem:a,key:a.key})}),this._tableData.next(e)}}catch(t){this.hubService.addHubClientErrorMessage(t,"Mappings, update data")}}getItemFormGroup(t){return this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find(e=>e.value.key===t)}editMapping(t){let e=t.key,a=this.getItemFormGroup(e).value.transformItemType;switch(a){case o.kc.BuiltInFunction:this.router.navigate(["standard-function-edit",this.functionType,e],{relativeTo:this.route.parent});break;case o.kc.CustomFunction:this.router.navigate(["custom-function-edit",this.functionType,e],{relativeTo:this.route.parent});break;case o.kc.Column:case o.kc.JoinNode:case o.kc.GroupNode:case o.kc.ColumnPair:case o.kc.Sort:case o.kc.JoinPair:case o.kc.FilterPair:case o.kc.AggregatePair:case o.kc.Series:this.router.navigate(["mapping-edit",a,e],{relativeTo:this.route.parent});break;case o.kc.UnGroup:this.router.navigate(["unGroup-edit",e],{relativeTo:this.route.parent})}}deleteMapping(t){this.deleteSelected([t])}deleteSelected(t){t.forEach(t=>{let e=this.getItemFormGroup(t.key);this.editDatalinkService.deleteDatalinkTransformItem(this.datalinkTransformForm,e)})}datalinkItemSortChange(t){t.forEach((t,e)=>{let a=this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find(e=>e.value.key===t.key);a&&a.controls.position.setValue(e)})}newOutputDrop(t){this.onColumnDrop.emit({inputColumn:t,outputColumn:null})}createJoinNode(){if(this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find(t=>t.value.transformItemType===o.kc.JoinNode))return void this.authService.informationDialog("Can not add node","Only one join node can be added.");let t=this.datalinkTransformForm.value.joinDatalinkTable,e=new o.x,a=new o.m;a.position=0,a.key=this.hubService.getHubCache().getNextSequence(),a.name=t.name,a.logicalName=t.name;let n=new u.b,i=t.dexihDatalinkColumns.map((t,e)=>{let a=n.copyDatalinkColumn(t,e,"Join Node");return a.key=this.hubService.getHubCache().getNextSequence(),a.datalinkTableKey=null,a});a.childColumns=i,a.dataType=o.pc.Node,e.position=-1,e.datalinkTransformKey=this.datalinkTransformForm.value.key,e.targetDatalinkColumn=a,e.isValid=!0,e.transformItemType=o.kc.JoinNode;let r=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,e);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,r)}createGroupNode(){if(this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find(t=>t.value.transformItemType===o.kc.GroupNode))return void this.authService.informationDialog("Can not add node","Only one group node can be added.");let t=new o.x,e=new o.m;e.position=0,e.key=this.hubService.getHubCache().getNextSequence(),e.name="Group",e.logicalName="Group",e.dataType=o.pc.Node,t.position=-1,t.datalinkTransformKey=this.datalinkTransformForm.value.key,t.targetDatalinkColumn=e,t.isValid=!0,t.transformItemType=o.kc.GroupNode;let a=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,t);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,a)}newMapping(t){this.router.navigate(["mapping-edit",t],{relativeTo:this.route})}addAll(){this.datalinkTransformForm.controls.runTime.value.inputColumns.forEach(t=>{this.createMapping(t)})}addGroup(t){t.columns.forEach(t=>{this.createMapping(t)})}createMapping(t){if(this.datalinkTransformForm.controls.runTime.value.outputColumns.findIndex(e=>e.name===t.name)>=0)return;let e=new o.x,a=(new u.b).copyDatalinkColumn(t,0,"mapping");a.key=this.hubService.getHubCache().getNextSequence(),a.childColumns&&a.childColumns.forEach(t=>{t.key=this.hubService.getHubCache().getNextSequence()}),a.datalinkTableKey=null,e.datalinkTransformKey=this.datalinkTransformForm.value.key,e.sourceDatalinkColumn=t,e.targetDatalinkColumn=a,e.transformItemType=o.kc.ColumnPair,e.isValid=!0;let n=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,e);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,n)}addValidFromTo(t){let e=this.datalinkTransformForm.value.joinDatalinkTable,a=e.dexihDatalinkColumns.find(t=>t.deltaType===o.qb.ValidFromDate),n=e.dexihDatalinkColumns.find(t=>t.deltaType===o.qb.ValidToDate);if(!a||!n)return void this.authService.informationDialog("No valid from","The join table does not contain a columns with a valid from/to delta type.");let i=new o.x;i.sourceDatalinkColumn=t,i.joinDatalinkColumn=a,i.transformItemType=o.kc.JoinPair,i.filterCompare=o.hb.GreaterThanEqual;let r=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,i);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,r),i=new o.x,i.sourceDatalinkColumn=t,i.joinDatalinkColumn=n,i.transformItemType=o.kc.JoinPair,i.filterCompare=o.hb.LessThan,r=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,i),this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,r)}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(b.a),s.Kb(l.a),s.Kb(d),s.Kb(i.e),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["mapping"]],viewQuery:function(t,e){var a;1&t&&s.Bc(Ne,!0),2&t&&s.rc(a=s.Wb())&&(e.mappingTable=a.first)},inputs:{datalinkTransformForm:"datalinkTransformForm",allowStandard:"allowStandard",allowMapping:"allowMapping",allowAggregate:"allowAggregate",allowRow:"allowRow",allowCondition:"allowCondition",allowValidation:"allowValidation",allowOutput:"allowOutput",allowGroup:"allowGroup",allowJoin:"allowJoin",allowSort:"allowSort",allowSeries:"allowSeries",allowJoinNode:"allowJoinNode",title:"title"},outputs:{addMapping:"addMapping",removeMapping:"removeMapping",updateMapping:"updateMapping",hasChanged:"hasChanged",onColumnDrop:"onColumnDrop"},features:[s.wb],decls:11,vars:9,consts:[[3,"title","scrollable","showExpandButton"],["tableClass","table table-striped table-hover m-0","dropZone","","zone","input-column","dropAllowedClass","drop-zone-green","actionHeading","Mappings",3,"enableMultiSelect","enableManualSort","columns","dataObservable","enableStickyToolbar","toolbarZIndex","rowClick","onSortChanged","dropData"],["mappingTable",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["rowAction",""],["actions",""],["title","Edit this mapping",1,"mr-1",3,"click"],["title","Delete selected mapping functions",1,"mr-1",3,"click"],[3,"transform","transformItem","allowCondition","click"],[3,"ngIf"],["buttonClass","btn-primary","iconClass","fa fa-map","title","Create a new mapping, or drop a column to create new mapping.","text","Mapping",1,"mr-1",3,"buttonClick"],["title","Add all",1,"dropdown-item",3,"click"],[4,"ngFor","ngForOf"],[1,"dropdown-item",3,"title","click"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-filter","title","Create a simple filter",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-cubes","title","Create a simple aggregate",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-dollar","title","Create a new standard function",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-code","title","Create a new custom function",3,"routerLink"],["routerLink","unGroup-edit","buttonClass","btn-primary mr-1 ","iconClass","fa fa-map","title","Un-Group a Node"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-link","title","Create a new join",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-dollar","title","Create a new standard filter",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-code","title","Create a new custom filter",3,"routerLink"],["buttonClass","btn-primary","iconClass","fa fa-calendar","title","Add a joins between the column and the valid from/to","text","Valid From/To",1,"mr-1"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-sort-alpha-asc","title","New Sort",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-list","title","New Group",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-list","title","Join Node",3,"click"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget",0),s.Ob(1,"dexih-table",1,2),s.Vb("rowClick",(function(t){return e.editMapping(t)}))("onSortChanged",(function(t){return e.datalinkItemSortChange(t)}))("dropData",(function(t){return e.newOutputDrop(t)})),s.Dc(3,Oe,1,0,"ng-template",3,4,s.Ec),s.Dc(5,Ie,1,0,"ng-template",5,6,s.Ec),s.Dc(7,xe,1,3,"ng-template",null,7,s.Ec),s.Dc(9,Je,9,9,"ng-template",null,8,s.Ec),s.Nb(),s.Nb()),2&t&&(s.hc("title",e.title)("scrollable",!0)("showExpandButton",!0),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("columns",e.columns)("dataObservable",e.tableData)("enableStickyToolbar",!0)("toolbarZIndex",100))},directives:[p.P,R.a,It.a,p.j,p.g,Se,n.t,p.w,n.s,p.f,i.f,p.i],encapsulation:2}),t})();function $e(t,e){1&t&&(s.Ob(0,"div"),s.Ob(1,"section"),s.Lb(2,"form-checkbox",16),s.Nb(),s.Nb())}function Ue(t,e){if(1&t&&(s.Ob(0,"section"),s.Lb(1,"form-select",17),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.nodes)("enableKeySelect",!1)("allowNullSelect",!0)}}function qe(t,e){if(1&t&&(s.Ob(0,"form",8),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-input",9),s.Nb(),s.Ob(4,"section"),s.Lb(5,"form-textarea",10),s.Nb(),s.Dc(6,$e,3,0,"div",11),s.Dc(7,Ue,2,3,"section",11),s.Ob(8,"div",12),s.Ob(9,"section",13),s.Lb(10,"form-input",14),s.Nb(),s.Ob(11,"section",13),s.Lb(12,"form-input",15),s.Nb(),s.Nb(),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.hc("formGroup",t.datalinkTransformForm),s.yb(3),s.hc("autocapitalize",!0)("errors",t.formErrors.name),s.yb(2),s.hc("errors",t.formErrors.description),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Aggregate||t.datalinkTransformForm.value.transformType==t.eTransformType.Series||t.datalinkTransformForm.value.transformType==t.eTransformType.Rows||t.datalinkTransformForm.value.transformType==t.eTransformType.Mapping),s.yb(1),s.hc("ngIf",(null==t.nodes?null:t.nodes.length)>0)}}function ze(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",18),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Lb(3,"datalink-table",19),s.Ob(4,"div",12),s.Ob(5,"section",13),s.Lb(6,"form-select",20),s.Nb(),s.Ob(7,"section",13),s.Lb(8,"form-select",21),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.hc("showExpandButton",!0),s.yb(1),s.hc("formGroup",t.datalinkTransformForm),s.yb(2),s.hc("datalinkTableForm",t.datalinkTransformForm.controls.joinDatalinkTable),s.yb(3),s.hc("label","Strategy when "+t.eTransformType[t.datalinkTransformForm.value.transformType]+" produces duplicate matches")("items",t.eDuplicateStrategyItems),s.yb(2),s.hc("label","Strategy when "+t.eTransformType[t.datalinkTransformForm.value.transformType]+" produces no match ")("items",t.eJoinNotFoundStrategyItems)}}function We(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",22),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Lb(3,"datalink-table",19),s.Nb(),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.hc("showExpandButton",!0),s.yb(1),s.hc("formGroup",t.datalinkTransformForm),s.yb(2),s.hc("datalinkTableForm",t.datalinkTransformForm.controls.joinDatalinkTable)}}function Qe(t,e){1&t&&(s.Ob(0,"div",12),s.Ob(1,"section",13),s.Lb(2,"form-input",28),s.Nb(),s.Ob(3,"section",13),s.Lb(4,"form-input",29),s.Nb(),s.Nb())}function Ye(t,e){1&t&&(s.Ob(0,"div",12),s.Ob(1,"section",13),s.Lb(2,"form-input",30),s.Nb(),s.Ob(3,"section",13),s.Lb(4,"form-input",31),s.Nb(),s.Nb())}function Xe(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-widget-section",23),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Ob(3,"div",12),s.Ob(4,"section",13),s.Lb(5,"form-select",24),s.Nb(),s.Ob(6,"section",13),s.Ob(7,"form-select",25),s.Vb("textValueChange",(function(e){return s.vc(t),s.Zb().sourceValue=e})),s.Nb(),s.Nb(),s.Nb(),s.Lb(8,"form-checkbox",26),s.Dc(9,Qe,5,0,"div",27),s.Dc(10,Ye,5,0,"div",27),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("showExpandButton",!0),s.yb(1),s.hc("formGroup",t.seriesForm),s.yb(4),s.hc("items",t.seriesGrains),s.yb(2),s.hc("items",t.inputColumns)("textValue",t.sourceValue)("enableKeySelect",!1)("errors",t.sourceErrors),s.yb(2),s.hc("ngIf",t.seriesForm.controls.seriesFill.value&&t.seriesForm.controls.seriesGrain.value!==t.eSeriesGrain.Number),s.yb(1),s.hc("ngIf",t.seriesForm.controls.seriesFill.value&&t.seriesForm.controls.seriesGrain.value===t.eSeriesGrain.Number)}}const ta=function(){return{standalone:!0}};function ea(t,e){if(1&t){const t=s.Pb();s.Ob(0,"section",13),s.Ob(1,"form-input",35),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb(2).nodeName=e}))("ngModelChange",(function(e){return s.vc(t),s.Zb(2).updateNode(e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("ngModelOptions",s.lc(2,ta))("ngModel",t.nodeName)}}function aa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-widget-section",32),s.Ob(1,"form"),s.Ob(2,"fieldset"),s.Ob(3,"form-checkbox",33),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb().allowNode=e}))("ngModelChange",(function(e){return s.vc(t),s.Zb().toggleNode(e)})),s.Nb(),s.Dc(4,ea,2,3,"section",34),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.hc("showExpandButton",!0),s.yb(3),s.hc("ngModelOptions",s.lc(4,ta))("ngModel",t.allowNode),s.yb(1),s.hc("ngIf",t.allowNode)}}function na(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",44),s.Ob(1,"join-columns",45),s.Vb("inputJoinDrop",(function(e){return s.vc(t),s.Zb(2).newDragDropJoin(e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)}}function ia(t,e){if(1&t&&(s.Ob(0,"div"),s.Lb(1,"mapping",46),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.jc("title","",t.eTransformType[t.datalinkTransformForm.value.transformType]," Table"),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowJoin",!0)}}function ra(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",47),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowStandard",!0)("allowMapping",!0)("allowOutput",!0)}}function oa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",48),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.Sort,e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowSort",!0)}}function sa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",49),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.Column,e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowGroup",!0)("allowSeries",t.datalinkTransformForm.value.transformType==t.eTransformType.Series)}}function la(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",50),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.AggregatePair,e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowStandard",!0)("allowAggregate",!0)("allowOutput",!0)}}function ca(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",51),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.AggregatePair,e)})),s.Nb(),s.Ob(2,"mapping",52),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowStandard",!0)("allowAggregate",!0)("allowSeries",!0)("allowOutput",!0),s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowMapping",!0)("allowOutput",!0)}}function ua(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",50),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.AggregatePair,e)})),s.Nb(),s.Ob(2,"mapping",52),s.Vb("onColumnDrop",(function(e){s.vc(t);const a=s.Zb(2);return a.newDragDropMapping(a.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowStandard",!0)("allowAggregate",!0)("allowOutput",!0),s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowMapping",!0)("allowOutput",!0)}}function ma(t,e){if(1&t&&(s.Ob(0,"div"),s.Lb(1,"mapping",53),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowStandard",!0)("allowCondition",!0)("allowOutput",!1)}}function ba(t,e){if(1&t&&(s.Ob(0,"div"),s.Lb(1,"mapping",54),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowRow",!0)("allowStandard",!0)("allowJoinNode",!1)("allowOutput",!0)("allowCondition",!0)}}function ha(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",36),s.Ob(1,"dexih-widget",37),s.Lb(2,"input-columns",38),s.Dc(3,na,2,1,"div",39),s.Nb(),s.Ob(4,"div",40),s.Dc(5,ia,2,3,"div",11),s.Dc(6,ra,2,4,"div",11),s.Dc(7,oa,2,2,"div",11),s.Dc(8,sa,2,3,"div",11),s.Dc(9,la,2,4,"div",11),s.Dc(10,ca,3,8,"div",11),s.Dc(11,ua,3,7,"div",11),s.Dc(12,ma,2,4,"div",11),s.Dc(13,ba,2,6,"div",11),s.Nb(),s.Ob(14,"dexih-widget",41),s.Ob(15,"output-columns",42),s.Vb("inputOutputDrop",(function(e){s.vc(t);const a=s.Zb();return a.newDragDropMapping(a.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Ob(16,"target-columns",43),s.Vb("inputOutputDrop",(function(e){s.vc(t);const a=s.Zb();return a.newDragDropMapping(a.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.yb(1),s.hc("scrollable",!0),s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.controls.joinDatalinkTable.value),s.yb(2),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Join||t.datalinkTransformForm.value.transformType==t.eTransformType.Lookup),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Mapping),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Sort),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Group||t.datalinkTransformForm.value.transformType==t.eTransformType.Aggregate||t.datalinkTransformForm.value.transformType==t.eTransformType.Series||t.datalinkTransformForm.value.transformType==t.eTransformType.Rows),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Group),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Series),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Aggregate),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Filter),s.yb(1),s.hc("ngIf",t.datalinkTransformForm.value.transformType==t.eTransformType.Rows),s.yb(1),s.hc("title","Outputs"+(null!=t.datalinkTransformForm.controls.nodeDatalinkColumn&&t.datalinkTransformForm.controls.nodeDatalinkColumn.value?"(@"+t.datalinkTransformForm.controls.nodeDatalinkColumn.value.name+")":""))("scrollable",!0),s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowMappingOutputs",t.allowMappingOutputs),s.yb(1),s.hc("datalinkTransformForm",t.datalinkTransformForm)("targets",t.datalinkForm.controls.dexihDatalinkTargets.value)("allowMappingOutputs",t.allowMappingOutputs)}}let da=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.pageTitle="Transform",this.showName=!1,this.showDescription=!1,this.eTransformType=o.lc,this.eTransformItemType=o.kc,this.eDuplicateStrategyItems=o.ub,this.eJoinNotFoundStrategyItems=o.Pb,this.eSeriesGrain=o.ac,this.seriesGrains=y.t,this.allowNode=!1,this.nodeName="",this.logger=new c.a("datalink-edit-transform"),this.nodes=[],this.formErrors={}}ngOnInit(){this.logger.LogC(()=>"OnInit",c.b.Trace);try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{if(this.action=t[0].action,this.pageTitle=t[0].pageTitle,this.datalinkTransformKey=+t[1].datalinkTransformKey,this.datalinkForm=t[2],this.datalinkForm){let t=this.datalinkForm.controls.dexihDatalinkTransforms;if(this._transformsArraySubscription&&this._transformsArraySubscription.unsubscribe(),this._transformsArraySubscription=t.valueChanges.subscribe(t=>{t.find(t=>t.datalinkTransformKey===this.datalinkTransformKey)||this.router.navigate(["transforms"],{relativeTo:this.route.parent.parent.parent})}),this.datalinkTransformForm=t.controls.find(t=>t.value.key===this.datalinkTransformKey),!this.datalinkTransformForm)return void this.authService.navigateUp();let e=this.datalinkTransformForm.value,a=this.datalinkTransformForm.controls.dexihDatalinkTransformItems;if(e.transformType===o.lc.Series&&(this.seriesForm=a.controls.filter(t=>t.value.transformItemType===o.kc.Series)[0]),e.transformType===o.lc.Aggregate&&(this.nodeType=o.kc.GroupNode),e.transformType!==o.lc.Lookup&&e.transformType!==o.lc.Join||(this.nodeType=o.kc.JoinNode),this.nodeType){let t=e.dexihDatalinkTransformItems.find(t=>t.transformItemType===this.nodeType);t?(this.allowNode=!0,this.nodeName=t.targetDatalinkColumn.name):this.allowNode=!1}this.inputColumns=e.runTime.inputColumns,this.nodes=[],this.addNodeColumns(this.inputColumns,"");let n=e.transformType;this.allowMappingOutputs=n===o.lc.Series||n===o.lc.Rows||n===o.lc.Mapping||n===o.lc.Validation,this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe(),this._datalinkFormSubscription=this.datalinkForm.valueChanges.subscribe(t=>{this.formErrors=this.editDatalinkService.hubFormsService.getFormErrorMessages(this.datalinkForm,!0)}),this.datalinkTransformForm||this.router.navigate(["properties"],{relativeTo:this.route.parent.parent.parent}),this.logger.LogC(()=>"datalink form is loaded",c.b.Trace)}})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Transform")}}addNodeColumns(t,e){t&&t.filter(t=>t.dataType===o.pc.Node&&t.isValid).forEach(t=>{let a=e?e+"."+t.logicalName:t.logicalName;this.nodes.push({key:t.key,name:a}),t.childColumns&&t.childColumns.length>0&&this.addNodeColumns(t.childColumns,a)})}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._transformsArraySubscription&&this._transformsArraySubscription.unsubscribe(),this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe()}deleteTransform(){this.logger.LogC(()=>"deleteTransform",c.b.Trace),this.editDatalinkService.deleteDatalinkTransform(this.datalinkTransformForm.value),this.router.navigate(["properties"],{relativeTo:this.route.parent.parent})}previewData(){this.router.navigate(["preview-transform-data"],{relativeTo:this.route.parent})}toggleNode(t){let e=this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find(t=>t.value.transformItemType===this.nodeType);if(t){if(this.nodeName||(this.nodeName=o.kc[this.nodeType]),e)return void this.authService.informationDialog("Can not add node","Only one node can be added per transform.");let t=new o.x,a=new o.m;a.position=0,a.key=this.hubService.getHubCache().getNextSequence(),a.name=this.nodeName,a.logicalName=this.nodeName,a.dataType=o.pc.Node,t.position=-1,t.datalinkTransformKey=this.datalinkTransformForm.value.key,t.targetDatalinkColumn=a,t.isValid=!0,t.transformItemType=this.nodeType;let n=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,t);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,n)}else this.editDatalinkService.deleteDatalinkTransformItem(this.datalinkTransformForm,e)}updateNode(t){let e=this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find(t=>t.value.transformItemType===this.nodeType);if(e){let a=e.controls.targetDatalinkColumn.value;a&&(a.name=t,a.logicalName=t,e.controls.targetDatalinkColumn.setValue(a))}}newDragDropMapping(t,e){let a=new o.x,n=e.outputColumn,i=e.inputColumn,r=new u.b;switch(t){case o.kc.ColumnPair:n||(n=r.copyDatalinkColumn(i,0,"mapping")),n.key=this.hubService.getHubCache().getNextSequence(),n.childColumns&&n.childColumns.forEach(t=>{t.key=this.hubService.getHubCache().getNextSequence()}),n.datalinkTableKey=null;break;case o.kc.Sort:a.sortDirection=o.fc.Ascending;break;case o.kc.AggregatePair:n||(n=r.copyDatalinkColumn(i,0,"mapping")),n.key=this.hubService.getHubCache().getNextSequence(),n.childColumns&&n.childColumns.forEach(t=>{t.key=this.hubService.getHubCache().getNextSequence()}),n.datalinkTableKey=null,a.aggregate=o.Y.Sum}if(t){a.datalinkTransformKey=this.datalinkTransformForm.value.key,a.sourceDatalinkColumn=i,a.targetDatalinkColumn=n,a.isValid=!0,a.transformItemType=t;let e=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,a);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,e)}}newDragDropJoin(t){let e=this.datalinkTransformForm.value.transformType;if(e===o.lc.Join||e===o.lc.Lookup){let e=t.joinColumn,a=t.inputColumn,n=new o.x;n.transformItemType=o.kc.JoinPair,n.datalinkTransformKey=this.datalinkTransformForm.value.key,n.sourceDatalinkColumn=a,n.joinDatalinkColumn=e,n.isValid=!0;let i=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,n);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,i)}}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-transform-form"]],decls:8,vars:8,consts:[["title","Properties",3,"showExpandButton","isExpanded"],[3,"formGroup",4,"ngIf"],["title","Join Settings",3,"showExpandButton",4,"ngIf"],["title","Concatenate Settings",3,"showExpandButton",4,"ngIf"],["title","Series Settings",3,"showExpandButton",4,"ngIf"],["title","Group Node",3,"showExpandButton",4,"ngIf"],[1,"list-group-item","p-1"],["class","d-flex","cdkDropListGroup","",4,"ngIf"],[3,"formGroup"],["label","Transform Name","formControlName","name","placeholder","Enter a name for the transform","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"errors"],[4,"ngIf"],[1,"form-row"],[1,"form-group","col-md-6"],["type","number","formControlName","maxInputRows","label","Maximum number of rows to input into the transform (0 = unlimited)"],["type","number","formControlName","maxOutputRows","label","Maximum number of rows to output into the transform (0 = unlimited)"],["label","Allow unmapped input columns to pass through to the next transform.","formControlName","passThroughColumns"],["label","Node level","formControlName","nodeDatalinkColumn","itemKey","key","itemName","name","node","Specify the node where the transform should be applied to.","selectNullMessage","Use top level",3,"items","enableKeySelect","allowNullSelect"],["title","Join Settings",3,"showExpandButton"],[3,"datalinkTableForm"],["formControlName","joinDuplicateStrategy","itemKey","key","itemName","name",3,"label","items"],["formControlName","joinNotFoundStrategy","itemKey","key","itemName","description",3,"label","items"],["title","Concatenate Settings",3,"showExpandButton"],["title","Series Settings",3,"showExpandButton"],["label","Series Grain","formControlName","seriesGrain","itemKey","key","itemName","name",3,"items"],["label","Input Column","formControlName","sourceDatalinkColumn","itemKey","key","itemName","name",3,"items","textValue","enableKeySelect","errors","textValueChange"],["label","Fill empty series values","formControlName","seriesFill"],["class","form-row",4,"ngIf"],["type","date","formControlName","seriesStart","label","Series Start Date (empty to use first value)"],["type","date","formControlName","seriesFinish","label","Series Finish Date (empty to use last value)"],["formControlName","seriesStart","label","Series Start Number (empty to use first value)"],["formControlName","seriesFinish","label","Series Finish Number (empty to use last value)"],["title","Group Node",3,"showExpandButton"],["label","Group rows under a node",3,"ngModelOptions","ngModel","ngModelChange"],["class","form-group col-md-6",4,"ngIf"],["label","Name of the node",3,"ngModelOptions","ngModel","ngModelChange"],["cdkDropListGroup","",1,"d-flex"],["title","Inputs","height","80vh",1,"d-none","d-lg-inline",2,"width","300px",3,"scrollable"],[3,"datalinkTransformForm"],["class","mt-1",4,"ngIf"],[1,"w-100","mr-1","ml-1"],["height","80vh",1,"d-none","d-lg-inline",2,"width","300px",3,"title","scrollable"],[3,"datalinkTransformForm","allowMappingOutputs","inputOutputDrop"],[3,"datalinkTransformForm","targets","allowMappingOutputs","inputOutputDrop"],[1,"mt-1"],[3,"datalinkTransformForm","inputJoinDrop"],[3,"datalinkTransformForm","allowJoin","title"],["title","Mapping Functions",3,"datalinkTransformForm","allowStandard","allowMapping","allowOutput","onColumnDrop"],["title","Sort Columns",3,"datalinkTransformForm","allowSort","onColumnDrop"],["title","Group Columns",3,"datalinkTransformForm","allowGroup","allowSeries","onColumnDrop"],["title","Aggregate Functions",3,"datalinkTransformForm","allowStandard","allowAggregate","allowOutput","onColumnDrop"],["title","Series/Aggregate Functions",3,"datalinkTransformForm","allowStandard","allowAggregate","allowSeries","allowOutput","onColumnDrop"],["title","Mappings",3,"datalinkTransformForm","allowMapping","allowOutput","onColumnDrop"],["title","Filters",3,"datalinkTransformForm","allowStandard","allowCondition","allowOutput"],["title","Row Functions",3,"datalinkTransformForm","allowRow","allowStandard","allowJoinNode","allowOutput","allowCondition"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,qe,13,6,"form",1),s.Nb(),s.Dc(2,ze,9,7,"dexih-widget-section",2),s.Dc(3,We,4,3,"dexih-widget-section",3),s.Dc(4,Xe,11,9,"dexih-widget-section",4),s.Dc(5,aa,5,5,"dexih-widget-section",5),s.Ob(6,"div",6),s.Dc(7,ha,17,19,"div",7),s.Nb()),2&t&&(s.hc("showExpandButton",!0)("isExpanded",!1),s.yb(1),s.hc("ngIf",e.datalinkTransformForm),s.yb(1),s.hc("ngIf",e.datalinkTransformForm&&(e.datalinkTransformForm.value.transformType==e.eTransformType.Join||e.datalinkTransformForm.value.transformType==e.eTransformType.Lookup)),s.yb(1),s.hc("ngIf",e.datalinkTransformForm&&e.datalinkTransformForm.value.transformType==e.eTransformType.Concatenate),s.yb(1),s.hc("ngIf",e.datalinkTransformForm&&e.datalinkTransformForm.value.transformType==e.eTransformType.Series),s.yb(1),s.hc("ngIf",e.datalinkTransformForm&&e.nodeType),s.yb(2),s.hc("ngIf",e.datalinkTransformForm))},directives:[p.T,n.t,g.I,g.t,g.l,p.D,g.s,g.j,p.H,p.A,p.E,W,g.u,g.v,pt.f,p.P,Ot,Zt,Jt,Wt,Be],encapsulation:2}),t})();function pa(t,e){if(1&t&&(s.Ob(0,"form",5),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-input",6),s.Nb(),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.hc("formGroup",t.datalinkForm),s.yb(3),s.hc("autocapitalize",!0)}}function fa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"form-checkbox",7),s.Vb("ngModelChange",(function(a){return s.vc(t),e.item.detailedResults=a}))("change",(function(){s.vc(t);const a=e.item;return s.Zb().updateProfileRule(a)})),s.Nb()}2&t&&s.hc("ngModel",e.item.detailedResults)}let ga=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.selectedProfileRules=new Array,this.columns=[{name:"name",title:"Profile Name",format:""},{name:"description",title:"Description",format:""}],this._tableData=new m.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{return e=this,void 0,n=function*(){if(this.hubCache=t[0],this.datalinkForm=t[1],this.datalinkForm&&this.hubCache.isLoaded()){this.selectedProfileRules=this.datalinkForm.value.dexihDatalinkProfiles;let t=(yield this.hubService.GetFunctionsByType(o.Cb.Profile)).map(t=>{let e=this.selectedProfileRules.find(e=>e.functionAssemblyName===t.functionAssemblyName&&e.functionClassName===t.functionClassName&&e.functionMethodName===t.functionMethodName);return{functionAssemblyName:t.functionAssemblyName,functionClassName:t.functionClassName,functionMethodName:t.functionMethodName,detailedResults:!!e&&e.detailedResults}});this._tableData.next(t)}},new((a=void 0)||(a=Promise))((function(t,i){function r(t){try{s(n.next(t))}catch(e){i(e)}}function o(t){try{s(n.throw(t))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(r,o)}s((n=n.apply(e,[])).next())}));var e,a,n})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function")}}updateProfileRules(){if(this.datalinkForm){let t=this.datalinkForm.controls.dexihDatalinkProfiles;t.controls.forEach(t=>{t.controls.isValid.setValue(!1)}),this.selectedProfileRules.forEach(e=>{let a=t.controls.find(t=>t.value.functionAssemblyName===e.functionAssemblyName&&t.value.functionClassName===e.functionClassName&&t.value.functionMethodName===e.functionMethodName);if(a)a.controls.isValid.setValue(!0);else{let n=new o.o;n.key=this.hubCache.getNextSequence(),n.datalinkKey=this.datalinkForm.value.key,n.functionAssemblyName=e.functionAssemblyName,n.functionClassName=e.functionClassName,n.functionMethodName=e.functionMethodName,n.detailedResults=e.detailedResults,n.isValid=!0,a=this.editDatalinkService.hubFormsService.datalinkProfileFormGroup(n),t.push(a)}});for(let e=t.controls.length-1;e>=0;e--)t.controls[e].value.isValid||t.removeAt(e)}}updateProfileRule(t){this.datalinkForm.controls.dexihDatalinkProfiles.controls.find(e=>e.value.functionAssemblyName===t.functionAssemblyName&&e.value.functionClassName===t.functionClassName&&e.value.functionMethodName===t.functionMethodName).controls.detailedResults.setValue(t.detailedResults),this.editDatalinkService.hubFormsService.hasChanged=!0}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this.updateProfileRules()}hasChanged(t){t&&(this.selectedProfileRules=t),this.updateProfileRules(),this.editDatalinkService.hubFormsService.hasChanged=!0}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["profile-rules"]],decls:5,vars:8,consts:[["title","Profile Rules",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["keyColumn","functionMethodName",3,"enableMultiSelect","enableManualSort","enableFilter","columns","dataObservable","selectedItems","selectedItemsChange","onSelectedChange"],["select","rowAction"],["rowAction",""],[3,"formGroup"],["label","Profile Table Name","formControlName","profileTableName","placeholder","Enter the profile table name.","iconClass","fa fa-list","note","Specify the table name in the 'Audit Connection' to send the profile results to.  If this table does not exist, it will be created on first run.",3,"autocapitalize"],["label","Capture Detailed Distribution","name","detailedResults",3,"ngModel","ngModelChange","change"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,pa,4,2,"form",1),s.Ob(2,"dexih-table",2),s.Vb("selectedItemsChange",(function(t){return e.selectedProfileRules=t}))("onSelectedChange",(function(t){return e.hasChanged(t)})),s.Dc(3,fa,1,1,"ng-template",3,4,s.Ec),s.Nb(),s.Nb()),2&t&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",e.datalinkForm),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!1)("enableFilter",!1)("columns",e.columns)("dataObservable",e.tableData)("selectedItems",e.selectedProfileRules))},directives:[p.T,n.t,R.a,g.I,g.t,g.l,p.D,g.s,g.j,p.A,g.v],encapsulation:2}),t})();function ka(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button",5),s.Vb("click",(function(){return s.vc(t),s.Zb(2).enableValidation()})),s.Fc(1,"Enable Validation"),s.Nb()}2&t&&s.hc("autoCompact",!1)}function va(t,e){if(1&t&&(s.Ob(0,"div"),s.Ob(1,"h4"),s.Fc(2,"Target column validation is not currently enabled. "),s.Nb(),s.Dc(3,ka,2,1,"dexih-button",4),s.Nb()),2&t){const t=s.Zb();s.yb(3),s.hc("ngIf",!t.datalinkTransformForm)}}function ya(t,e){if(1&t){const t=s.Pb();s.Ob(0,"form",7),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Ob(3,"dexih-button",5),s.Vb("click",(function(){return s.vc(t),s.Zb(2).disableValidation()})),s.Fc(4,"Disable Validation"),s.Nb(),s.Nb(),s.Ob(5,"section"),s.Lb(6,"form-textarea",8),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("formGroup",t.datalinkTransformForm),s.yb(3),s.hc("autoCompact",!1)}}function Ta(t,e){if(1&t&&(s.Ob(0,"div"),s.Dc(1,ya,7,2,"form",6),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("ngIf",t.datalinkTransformForm)}}function Ca(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",9),s.Ob(1,"div",10),s.Ob(2,"div"),s.Ob(3,"div",11),s.Ob(4,"h4"),s.Fc(5,"Inputs"),s.Nb(),s.Nb(),s.Ob(6,"div"),s.Lb(7,"input-columns",12),s.Nb(),s.Nb(),s.Nb(),s.Ob(8,"div",13),s.Lb(9,"mapping",14),s.Nb(),s.Ob(10,"div",15),s.Ob(11,"div",11),s.Ob(12,"h4"),s.Fc(13,"Outputs "),s.Lb(14,"div",16),s.Nb(),s.Nb(),s.Ob(15,"output-columns",17),s.Vb("inputOutputDrop",(function(e){s.vc(t);const a=s.Zb();return a.newDragDropMapping(a.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.yb(7),s.hc("datalinkTransformForm",t.datalinkTransformForm),s.yb(2),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowCondition",!0)("allowOutput",!0)("allowStandard",!0)("allowValidation",!0),s.yb(6),s.hc("datalinkTransformForm",t.datalinkTransformForm)("allowMappingOutputs",t.allowMappingOutputs)}}let Fa=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.pageTitle="Validation",this.showName=!1,this.showDescription=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle,this.hubCache=t[1],this.datalinkForm=t[2],this.remoteLibraries=t[3],this.hubCache.isLoaded()&&this.datalinkForm&&(this.datalinkTransformForm=this.editDatalinkService.getValidationTransform())})}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit Validation")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}enableValidation(){let t=this.remoteLibraries.transforms.find(t=>t.transformType===o.lc.Validation);this.datalinkTransformForm=this.editDatalinkService.insertDatalinkTransform(1,t)}disableValidation(){this.editDatalinkService.deleteDatalinkTransform(this.datalinkTransformForm.value),this.datalinkTransformForm=null}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-validation-form"]],decls:5,vars:4,consts:[["title","Validation",3,"showExpandButton"],[4,"ngIf"],[1,"list-group-item","p-1"],["class","d-flex",4,"ngIf"],["buttonClass","btn btn-success","iconClass","fa fa-check","title","Enable the validation on the target table.",3,"autoCompact","click",4,"ngIf"],["buttonClass","btn btn-success","iconClass","fa fa-check","title","Enable the validation on the target table.",3,"autoCompact","click"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Description","formControlName","description","placeholder","Enter the description."],[1,"d-flex"],[1,"mr-1","d-none","d-md-inline"],[1,"alert","alert-primary","mb-1"],[3,"datalinkTransformForm"],[1,"w-100"],["title","Validation",3,"datalinkTransformForm","allowCondition","allowOutput","allowStandard","allowValidation"],[1,"ml-1","d-none","d-md-inline"],[1,"float-right"],[3,"datalinkTransformForm","allowMappingOutputs","inputOutputDrop"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,va,4,1,"div",1),s.Dc(2,Ta,2,1,"div",1),s.Nb(),s.Ob(3,"div",2),s.Dc(4,Ca,16,8,"div",3),s.Nb()),2&t&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",!e.datalinkTransformForm),s.yb(1),s.hc("ngIf",e.datalinkTransformForm),s.yb(2),s.hc("ngIf",e.datalinkTransformForm))},directives:[p.T,n.t,p.f,g.I,g.t,g.l,p.H,g.s,g.j,Ot,Be,Zt],encapsulation:2}),t})(),Da=(()=>{class t{constructor(t,e,a){this.hubService=t,this.editDatalinkService=e,this.route=a,this.allowSave=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle,this.datalinkForm=t[3]})}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Run Plan")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-run-plan"]],decls:9,vars:0,consts:[[1,"no-padding"],[1,"widget-body"],["section","",1,"widget-body-toolbar"],[1,"form-row"],[1,"col-sm-6"],[1,"col-sm-6","text-right"]],template:function(t,e){1&t&&(s.Ob(0,"div",0),s.Ob(1,"div",1),s.Ob(2,"div",2),s.Ob(3,"div",3),s.Ob(4,"div",4),s.Ob(5,"h4"),s.Fc(6,"Run Plan"),s.Nb(),s.Nb(),s.Lb(7,"div",5),s.Nb(),s.Nb(),s.Fc(8," NOT COMPLETED "),s.Nb(),s.Nb())},encapsulation:2}),t})();var wa=a("1qMd"),Sa=a("zXKq"),Na=a("l2bN");function Oa(t,e){if(1&t&&(s.Ob(0,"div",11),s.Ob(1,"div",12),s.Fc(2),s.Nb(),s.Nb()),2&t){const t=s.Zb().$implicit,e=s.Zb();s.yb(2),s.Ic(" ",(null==t.value.runTime||null==t.value.runTime.functionParameter?null:t.value.runTime.functionParameter.name)+"("+e.eTypeCode[e.type.dataType]+")"," ",e.rank>0?"[]":""," ")}}function Ia(t,e){1&t&&(s.Ob(0,"div",13),s.Lb(1,"form-input",14),s.Nb()),2&t&&(s.yb(1),s.hc("border",!1))}function xa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",13),s.Ob(1,"form-select",15),s.Vb("textValueChange",(function(e){s.vc(t);const a=s.Zb().index;return s.Zb().inputs[a].staticValue=e}))("textValueChange",(function(e){s.vc(t);const a=s.Zb().index;return s.Zb().updateStatic(e,a)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb().index,e=s.Zb();s.yb(1),s.hc("border",!1)("items",e.inputColumnGroups)("textValue",e.inputs[t].staticValue)("enableKeySelect",!1)("enableTextEntry",0===e.rank)("enableTextEntryMatch",!1)("setTextEntryToValue",!1)("textEntryNote",e.rank>0?"Select an array type source (otherwise select add to build an array)":"Select a column or enter a static value.")("textEntryItems",e.inputs[t].textItems)("errors",e.errors[t].datalinkColumn)}}const Pa=function(){return{standalone:!0}};function Va(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",13),s.Ob(1,"form-input",16),s.Vb("ngModelChange",(function(e){s.vc(t);const a=s.Zb().index;return s.Zb().inputs[a].staticValue=e})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb().index,e=s.Zb();s.yb(1),s.hc("border",!1)("ngModel",e.inputs[t].staticValue)("ngModelOptions",s.lc(3,Pa))}}function Ea(t,e){if(1&t&&(s.Ob(0,"div",12),s.Fc(1),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.Hc(" ","("+t.eTypeCode[t.type.dataType]+")"," ")}}function Ka(t,e){if(1&t&&(s.Ob(0,"div",13),s.Lb(1,"form-select",17),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("border",!1)("items",t.typeCodes)}}function La(t,e){1&t&&(s.Ob(0,"div",18),s.Lb(1,"form-checkbox",19),s.Nb()),2&t&&(s.yb(1),s.hc("border",!1))}function Ma(t,e){if(1&t&&(s.Ob(0,"form",5),s.Ob(1,"div",6),s.Dc(2,Oa,3,2,"div",7),s.Dc(3,Ia,2,1,"div",8),s.Dc(4,xa,2,10,"div",8),s.Dc(5,Va,2,4,"div",8),s.Dc(6,Ea,2,1,"div",9),s.Dc(7,Ka,2,2,"div",8),s.Dc(8,La,2,1,"div",10),s.Nb(),s.Nb()),2&t){const t=e.$implicit,a=s.Zb();s.hc("formGroup",t),s.yb(2),s.hc("ngIf",!a.allowNameSelect),s.yb(1),s.hc("ngIf",1==a.allowNameSelect),s.yb(1),s.hc("ngIf",!(null!=t.value.runTime&&null!=t.value.runTime.functionParameter&&t.value.runTime.functionParameter.isLabel)),s.yb(1),s.hc("ngIf",null==t.value.runTime||null==t.value.runTime.functionParameter?null:t.value.runTime.functionParameter.isLabel),s.yb(1),s.hc("ngIf",0==a.allowDataTypeSelect&&1==a.allowNameSelect),s.yb(1),s.hc("ngIf",1==a.allowDataTypeSelect),s.yb(1),s.hc("ngIf",1==a.allowDataTypeSelect)}}function Za(t,e){if(1&t){const t=s.Pb();s.Ob(0,"form",20),s.Ob(1,"form-select",21),s.Vb("textValueChange",(function(a){s.vc(t);const n=e.index;return s.Zb().updateNewColumn(a,n)})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=s.Zb();s.hc("formGroup",t),s.yb(1),s.hc("border",!1)("items",a.outputTables)("enableKeySelect",!1)("enableTextEntry",!0)("setTextEntryToValue",!1)}}function Aa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"button",25),s.Vb("click",(function(){return s.vc(t),s.Zb(2).add()})),s.Lb(1,"i",26),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("disabled",!t.allowAdd)}}function _a(t,e){if(1&t){const t=s.Pb();s.Ob(0,"button",27),s.Vb("click",(function(){return s.vc(t),s.Zb(2).remove()})),s.Lb(1,"i",28),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("disabled",!t.allowRemove)}}function Ga(t,e){if(1&t&&(s.Ob(0,"div",22),s.Dc(1,Aa,2,1,"button",23),s.Dc(2,_a,2,1,"button",24),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("ngIf",t.allowAdd),s.yb(1),s.hc("ngIf",t.allowRemove)}}function Ra(t,e){if(1&t&&(s.Ob(0,"small",29),s.Lb(1,"markdown",30),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("data",t.inputParameterForms[0].value.runTime.functionParameter.description)}}class ja{}let Ha=(()=>{class t{constructor(t,e){this.hubService=t,this.editDatalinkService=e,this.allowDataTypeSelect=!1,this.allowNameSelect=!1,this.allowAdd=!1,this.allowRemove=!1,this.inputParameterForms=[],this.inputColumns=null,this.updateParameterName=!1,this.rank=0,this.nodeDatalinkColumnKey=null,this.outputParameterForms=null,this.outputColumns=null,this.datalinkTargets=null,this.variables=[],this.addParameter=new s.n,this.removeParameter=new s.n,this.eBasicType=wa.c,this.typeCodes=wa.a,this.eTypeCode=o.pc,this.inputColumnGroups=[],this.inputs=[],this.ignoreChanges=!1}ngOnInit(){this.inputs=this.inputParameterForms.map(t=>new ja),this.errors=this.inputParameterForms.map(t=>this.editDatalinkService.hubFormsService.getFormErrorMessages(t,!0));let t=new u.b;this.nodeDatalinkColumnKey&&(this.inputColumns=t.getAvailableColumns(this.inputColumns,this.nodeDatalinkColumnKey,0)),this.rank>0&&this.inputColumns&&(this.inputColumns=this.inputColumns.filter(t=>t.rank>0)),this.inputColumnGroups=this.inputColumns?this.editDatalinkService.getColumnGroups(this.inputColumns):[];for(let e=0;e<this.inputParameterForms.length;e++){let t=this.inputParameterForms[e].value;this.inputs[e].staticValue=t.datalinkColumn||null==t.value?"":t.value,this.inputs[e].textItems=[],t.dataType===o.pc.Boolean&&(this.inputs[e].textItems=this.inputs[e].textItems.concat(["true","false"]),this.inputs[e].staticValue=this.inputs[e].staticValue.toString()),t.runTime&&t.runTime.functionParameter.listOfValues&&(this.inputs[e].textItems=this.inputs[e].textItems.concat(t.runTime.functionParameter.listOfValues)),this.inputs[e].textItems=this.inputs[e].textItems.concat(this.variables)}this.updateItems();for(let e=0;e<this.inputParameterForms.length;e++){let t=this.inputParameterForms[e].value.runTime;t&&t.functionParameter&&t.functionParameter.listOfValues||(this.inputs[e].inputParameterSubscription=this.inputParameterForms[e].valueChanges.subscribe(()=>{this.ignoreChanges||(this.updateItems(),this.ignoreChanges=!0,this.inputParameterForms[e].controls.value.setValue(this.inputParameterForms[e].controls.datalinkColumn.value?null:this.inputs[e].staticValue),this.ignoreChanges=!1),this.errors[e]=this.editDatalinkService.hubFormsService.getFormErrorMessages(this.inputParameterForms[e],!0)})),this.updateParameterName&&(this.inputs[e].datalinkColumnSubscription=this.inputParameterForms[e].controls.datalinkColumn.valueChanges.subscribe(t=>{t?(this.inputParameterForms[e].controls.dataType.setValue(t.dataType),this.inputParameterForms[e].controls.name.setValue(t.name)):(this.inputParameterForms[e].controls.dataType.setValue(o.pc.String),this.inputParameterForms[e].controls.name.setValue("")),this.errors[e]=this.editDatalinkService.hubFormsService.getFormErrorMessages(this.inputParameterForms[e],!0)}))}}updateStatic(t,e){this.inputParameterForms[e].controls.value.setValue(t)}ngOnDestroy(){this.inputs&&this.inputs.forEach(t=>{t.datalinkColumnSubscription&&t.datalinkColumnSubscription.unsubscribe(),t.inputParameterSubscription&&t.inputParameterSubscription.unsubscribe()})}ngOnChanges(){let t=new o.H;t.name="Output Columns",t.dexihTableColumns=this.outputColumns,this.outputTables=[t],this.datalinkTargets&&this.datalinkTargets.forEach(t=>{this.outputTables.push(t.table)})}updateItems(){for(let t=0;t<this.inputParameterForms.length;t++){let e=this.inputParameterForms[t].value;this.type=new wa.b(e.dataType,null,null,null),this.inputs[t].name=this.allowDataTypeSelect||this.allowNameSelect?e.name:e.name+"("+this.type.dataType+")"+(this.rank>0?"[]":"")}}add(){this.addParameter.emit(this.inputParameterForms[0])}remove(){this.removeParameter.emit(this.inputParameterForms[0])}updateNewColumn(t,e){let a=this.outputParameterForms[e].controls.targetDatalinkColumn.value;!t||a&&t===a.name||(this.newColumn||(this.newColumn=new o.m,this.newColumn.position=1e3-this.newColumn.key,this.newColumn.key=this.hubService.getHubCache().getNextSequence()),this.newColumn.dataType=this.outputParameterForms[e].controls.dataType.value,this.newColumn.name=t,this.newColumn.logicalName=t,this.outputParameterForms[e].controls.datalinkColumn.setValue(this.newColumn),this.updateItems())}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d))},t.\u0275cmp=s.Eb({type:t,selectors:[["input-parameter"]],inputs:{allowDataTypeSelect:"allowDataTypeSelect",allowNameSelect:"allowNameSelect",allowAdd:"allowAdd",allowRemove:"allowRemove",inputParameterForms:"inputParameterForms",inputColumns:"inputColumns",updateParameterName:"updateParameterName",rank:"rank",nodeDatalinkColumnKey:"nodeDatalinkColumnKey",outputParameterForms:"outputParameterForms",outputColumns:"outputColumns",datalinkTargets:"datalinkTargets",variables:"variables"},outputs:{addParameter:"addParameter",removeParameter:"removeParameter"},features:[s.wb],decls:6,vars:4,consts:[[1,"input-group","d-flex"],["class","flex-fill",3,"formGroup",4,"ngFor","ngForOf"],["class","ml-1  flex-fill",3,"formGroup",4,"ngFor","ngForOf"],["class","input-group-append flex-shrink-1 ml-1 ",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],[1,"flex-fill",3,"formGroup"],[1,"input-group"],["class","input-group-prepend",4,"ngIf"],["class","form-control p-0",4,"ngIf"],["class","input-group-text",4,"ngIf"],["class","form-control",4,"ngIf"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0"],["formControlName","name","type","text","placeholder","Enter a name for the parameter",3,"border"],["formControlName","datalinkColumn","parentName","group","childItems","columns","itemKey","key","itemName","logicalName","textEntryItemsTitle","Variables",3,"border","items","textValue","enableKeySelect","enableTextEntry","enableTextEntryMatch","setTextEntryToValue","textEntryNote","textEntryItems","errors","textValueChange"],["type","text","placeholder","Enter a static value.",3,"border","ngModel","ngModelOptions","ngModelChange"],["formControlName","dataType","itemKey","key","itemName","name",3,"border","items"],[1,"form-control"],["label","Allow Null","formControlName","allowNull",3,"border"],[1,"ml-1","flex-fill",3,"formGroup"],["formControlName","datalinkColumn","parentName","name","childItems","dexihTableColumns","itemKey","key","itemName","logicalName","textEntryNote","Enter new column name, or select existing",1,"form-control","p-0",3,"border","items","enableKeySelect","enableTextEntry","setTextEntryToValue","textValueChange"],[1,"input-group-append","flex-shrink-1","ml-1"],["class","btn btn-light","type","button","value","Add",3,"disabled","click",4,"ngIf"],["class","btn btn-light","type","button","value","Remove",3,"disabled","click",4,"ngIf"],["type","button","value","Add",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-minus-square-o"],[1,"form-text","text-muted"],[3,"data"]],template:function(t,e){1&t&&(s.Ob(0,"section"),s.Ob(1,"div",0),s.Dc(2,Ma,9,8,"form",1),s.Dc(3,Za,2,6,"form",2),s.Dc(4,Ga,3,2,"div",3),s.Nb(),s.Dc(5,Ra,2,1,"small",4),s.Nb()),2&t&&(s.yb(2),s.hc("ngForOf",e.inputParameterForms),s.yb(1),s.hc("ngForOf",e.outputParameterForms),s.yb(1),s.hc("ngIf",e.allowAdd&&e.allowRemove),s.yb(1),s.hc("ngIf",!e.allowAdd&&(null==e.inputParameterForms[0].value.runTime||null==e.inputParameterForms[0].value.runTime.functionParameter?null:e.inputParameterForms[0].value.runTime.functionParameter.description)))},directives:[n.s,n.t,g.I,g.t,g.l,p.D,g.s,g.j,p.E,g.v,p.A,Na.a],encapsulation:2}),t})();function Ja(t,e){if(1&t&&(s.Ob(0,"div",15),s.Ob(1,"div",16),s.Fc(2),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.yb(2),s.Ic(" ",(null==t.outputParameterForm.value.runTime||null==t.outputParameterForm.value.runTime.functionParameter?null:t.outputParameterForm.value.runTime.functionParameter.name)+"("+t.eTypeCode[t.type.dataType]+")"," ",t.rank>0?"[]":""," ")}}function Ba(t,e){if(1&t&&(s.Ob(0,"div",15),s.Ob(1,"div",16),s.Fc(2),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.yb(2),s.Hc(" ",null==t.outputParameterForm.value.runTime||null==t.outputParameterForm.value.runTime.functionParameter?null:t.outputParameterForm.value.runTime.functionParameter.name," ")}}function $a(t,e){1&t&&(s.Ob(0,"div",5),s.Lb(1,"form-input",17),s.Lb(2,"span",18),s.Nb()),2&t&&(s.yb(1),s.hc("border",!1))}function Ua(t,e){if(1&t&&(s.Ob(0,"div",16),s.Fc(1),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.Hc(" ","("+t.eTypeCode[t.type.dataType]+")"," ")}}function qa(t,e){if(1&t&&(s.Ob(0,"div",5),s.Lb(1,"form-select",19),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("border",!1)("items",t.typeCodes)}}function za(t,e){1&t&&(s.Ob(0,"div",20),s.Lb(1,"form-checkbox",21),s.Nb()),2&t&&(s.yb(1),s.hc("border",!1))}function Wa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"button",22),s.Vb("click",(function(){return s.vc(t),s.Zb().fixDataType()})),s.Lb(1,"i",23),s.Nb()}}function Qa(t,e){if(1&t&&(s.Ob(0,"small",24),s.Lb(1,"markdown",25),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("data",t.outputParameterForm.value.runTime.functionParameter.description)}}let Ya=(()=>{class t{constructor(t,e){this.hubService=t,this.editDatalinkService=e,this.allowDataTypeSelect=!1,this.allowNameSelect=!1,this.allowAdd=!1,this.allowRemove=!1,this.outputParameterForm=null,this.outputColumns=null,this.datalinkTargets=null,this.updateParameterName=!1,this.rank=0,this.addParameter=new s.n,this.removeParameter=new s.n,this.hasChanged=new s.n,this.eBasicType=wa.c,this.eTypeCode=o.pc,this.typeCodes=wa.a,this.ignoreChanges=!1}ngOnInit(){this.updateItems(),this.errors=this.editDatalinkService.hubFormsService.getFormErrorMessages(this.outputParameterForm,!0),this.updateParameterName&&(this._datalinkColumnSubscription=this.outputParameterForm.controls.datalinkColumn.valueChanges.subscribe(t=>{this.outputParameterForm.controls.dataType.setValue(t.dataType),this.outputParameterForm.controls.name.setValue(t.name)})),this._parameterSubscription=this.outputParameterForm.valueChanges.subscribe(t=>{this.errors=this.editDatalinkService.hubFormsService.getFormErrorMessages(this.outputParameterForm,!0),this.updateItems()}),this._dataTypeSubscription=this.outputParameterForm.controls.dataType.valueChanges.subscribe(t=>{this.newColumn&&(this.newColumn.dataType=t)})}ngOnChanges(){let t=new o.H;t.name="Output Columns",t.dexihTableColumns=this.outputColumns,this.outputTables=[t],this.datalinkTargets&&this.datalinkTargets.forEach(t=>{this.outputTables.push(t.table)})}ngOnDestroy(){this._datalinkColumnSubscription&&this._datalinkColumnSubscription.unsubscribe(),this._parameterSubscription&&this._parameterSubscription.unsubscribe(),this._dataTypeSubscription&&this._dataTypeSubscription.unsubscribe()}updateItems(){this.type=new wa.b(this.outputParameterForm.value.dataType,null,null,null)}add(){this.addParameter.emit(this.outputParameterForm)}remove(){this.removeParameter.emit(this.outputParameterForm)}fixDataType(){this.outputParameterForm.controls.datalinkColumn.value.dataType=this.outputParameterForm.controls.dataType.value}updateNewColumn(t){let e=this.outputParameterForm.controls.datalinkColumn.value;!t||e&&e.name===t||(this.newColumn||(this.newColumn=new o.m,this.newColumn.key=this.hubService.getHubCache().getNextSequence(),this.newColumn.position=1e3-this.newColumn.key),this.newColumn.dataType=this.outputParameterForm.controls.dataType.value,this.newColumn.allowDbNull=!0,this.newColumn.name=t,this.newColumn.logicalName=t,this.newColumn.rank=this.rank,this.newColumn.columnGroup="mapping",this.outputParameterForm.controls.datalinkColumn.setValue(this.newColumn),this.updateItems())}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d))},t.\u0275cmp=s.Eb({type:t,selectors:[["output-parameter"]],inputs:{allowDataTypeSelect:"allowDataTypeSelect",allowNameSelect:"allowNameSelect",allowAdd:"allowAdd",allowRemove:"allowRemove",outputParameterForm:"outputParameterForm",outputColumns:"outputColumns",datalinkTargets:"datalinkTargets",updateParameterName:"updateParameterName",rank:"rank"},outputs:{addParameter:"addParameter",removeParameter:"removeParameter",hasChanged:"hasChanged"},features:[s.wb],decls:18,vars:17,consts:[[1,"mb-1",3,"formGroup"],[1,"input-group"],["class","input-group-prepend",4,"ngIf"],["class","form-control p-0",4,"ngIf"],["class","input-group-text",4,"ngIf"],[1,"form-control","p-0"],["formControlName","datalinkColumn","parentName","name","childItems","dexihTableColumns","itemKey","key","itemName","logicalName","textEntryNote","Enter new column name, or select existing",3,"border","items","enableKeySelect","enableTextEntry","setTextEntryToValue","errors","textValueChange"],["class","form-control",4,"ngIf"],[1,"input-group-append"],["class","btn btn-danger","type","button","title","fix target column datatype",3,"click",4,"ngIf"],["type","button","value","Add",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-minus-square-o"],["class","form-text text-muted",4,"ngIf"],[1,"input-group-prepend"],[1,"input-group-text"],["formControlName","name","type","text","name","name","placeholder","Enter a name for the parameter",3,"border"],[1,"input-group-btn",2,"width","0px"],["formControlName","dataType","itemKey","key","itemName","name",3,"border","items"],[1,"form-control"],["label","Allow Null","formControlName","allowNull",3,"border"],["type","button","title","fix target column datatype",1,"btn","btn-danger",3,"click"],[1,"fa","fa-medkit"],[1,"form-text","text-muted"],[3,"data"]],template:function(t,e){1&t&&(s.Ob(0,"form",0),s.Ob(1,"section"),s.Ob(2,"div",1),s.Dc(3,Ja,3,2,"div",2),s.Dc(4,Ba,3,1,"div",2),s.Dc(5,$a,3,1,"div",3),s.Dc(6,Ua,2,1,"div",4),s.Ob(7,"div",5),s.Ob(8,"form-select",6),s.Vb("textValueChange",(function(t){return e.updateNewColumn(t)})),s.Nb(),s.Nb(),s.Dc(9,qa,2,2,"div",3),s.Dc(10,za,2,1,"div",7),s.Ob(11,"div",8),s.Dc(12,Wa,2,0,"button",9),s.Ob(13,"button",10),s.Vb("click",(function(){return e.add()})),s.Lb(14,"i",11),s.Nb(),s.Ob(15,"button",12),s.Vb("click",(function(){return e.remove()})),s.Lb(16,"i",13),s.Nb(),s.Nb(),s.Nb(),s.Dc(17,Qa,2,1,"small",14),s.Nb(),s.Nb()),2&t&&(s.hc("formGroup",e.outputParameterForm),s.yb(3),s.hc("ngIf",0==e.allowDataTypeSelect&&0==e.allowNameSelect),s.yb(1),s.hc("ngIf",1==e.allowDataTypeSelect&&0==e.allowNameSelect),s.yb(1),s.hc("ngIf",e.allowNameSelect),s.yb(1),s.hc("ngIf",0==e.allowDataTypeSelect&&1==e.allowNameSelect),s.yb(2),s.hc("border",!1)("items",e.outputTables)("enableKeySelect",!1)("enableTextEntry",!0)("setTextEntryToValue",!1)("errors",e.errors.datalinkColumn),s.yb(1),s.hc("ngIf",1==e.allowDataTypeSelect),s.yb(1),s.hc("ngIf",1==e.allowDataTypeSelect),s.yb(2),s.hc("ngIf",(null==e.outputParameterForm.controls.datalinkColumn?null:e.outputParameterForm.controls.datalinkColumn.value)&&e.outputParameterForm.controls.dataType.value!==(null==e.outputParameterForm.controls.datalinkColumn||null==e.outputParameterForm.controls.datalinkColumn.value?null:e.outputParameterForm.controls.datalinkColumn.value.dataType)),s.yb(1),s.hc("disabled",!e.allowAdd),s.yb(2),s.hc("disabled",!e.allowRemove),s.yb(2),s.hc("ngIf",null==e.outputParameterForm.value.runTime||null==e.outputParameterForm.value.runTime.functionParameter?null:e.outputParameterForm.value.runTime.functionParameter.description))},directives:[g.I,g.t,g.l,n.t,p.E,g.s,g.j,p.D,p.A,Na.a],encapsulation:2}),t})();function Xa(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-apply",4),s.Vb("click",(function(){s.vc(t);const e=s.Zb(2);return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(1,"dexih-button-cancel",5),s.Vb("click",(function(){return s.vc(t),s.Zb(2).cancel()})),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("disabled",t.newDatalinkTransformItemForm.pristine)}}const tn=function(){return{standalone:!0}};function en(t,e){if(1&t){const t=s.Pb();s.Ob(0,"section"),s.Ob(1,"form-checkbox",11),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb(3).useCustomFunction=e})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(3);s.yb(1),s.hc("ngModel",t.useCustomFunction)("ngModelOptions",s.lc(2,tn))}}const an=function(){return{"z-index":499,position:"relative"}};function nn(t,e){if(1&t&&(s.Ob(0,"section",12),s.Ob(1,"form-select",13),s.Lb(2,"customFunction-edit-button",14),s.Nb(),s.Nb()),2&t){const t=s.Zb(3);s.hc("ngStyle",s.lc(3,an)),s.yb(1),s.hc("items",t.customFunctions),s.yb(1),s.hc("key",t.newDatalinkTransformItemForm.controls.customFunctionKey.value)}}const rn=function(){return{"z-index":500,position:"relative"}};function on(t,e){if(1&t){const t=s.Pb();s.Ob(0,"section",12),s.Ob(1,"form-select",15),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb(3).functionCategory=e}))("ngModelChange",(function(e){return s.vc(t),s.Zb(3).updateCategory(e)})),s.Nb(),s.Nb(),s.Ob(2,"section",12),s.Ob(3,"form-select",16),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb(3).selectFunction(e,!0)}))("ngModelChange",(function(e){return s.vc(t),s.Zb(3).selectedFunction=e})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(3);s.hc("ngStyle",s.lc(13,rn)),s.yb(1),s.hc("items",t.functionCategories)("allowNullSelect",!0)("ngModelOptions",s.lc(14,tn))("ngModel",t.functionCategory)("sortItems",!0),s.yb(1),s.hc("ngStyle",s.lc(15,an)),s.yb(1),s.hc("ngModel",t.selectedFunction)("ngModelOptions",s.lc(16,tn))("items",t.filteredFunctions)("enableKeySelect",!1)("note",null==t.selectedFunction?null:t.selectedFunction.description)("sortItems",!0)}}const sn=function(){return{"z-index":405,position:"relative"}};function ln(t,e){if(1&t&&(s.Ob(0,"section",19),s.Lb(1,"form-select",25),s.Nb()),2&t){const t=s.Zb(4);s.hc("ngStyle",s.lc(3,sn)),s.yb(1),s.hc("items",t.eErrorActionItems)("enableFilter",!1)}}const cn=function(){return{"z-index":402,position:"relative"}};function un(t,e){if(1&t&&(s.Ob(0,"div",19),s.Lb(1,"form-select",26),s.Nb()),2&t){const t=s.Zb(4);s.hc("ngStyle",s.lc(3,cn)),s.yb(1),s.hc("items",t.eInvalidActionItems)("enableFilter",!1)}}function mn(t,e){1&t&&(s.Ob(0,"section",27),s.Lb(1,"form-checkbox",28),s.Nb())}function bn(t,e){if(1&t&&(s.Ob(0,"section",23),s.Lb(1,"form-select",29),s.Nb()),2&t){const t=s.Zb(4);s.yb(1),s.hc("items",t.typeCodes)}}const hn=function(){return{"z-index":404,position:"relative"}};function dn(t,e){if(1&t&&(s.Ob(0,"div",17),s.Dc(1,ln,2,4,"section",18),s.Ob(2,"section",19),s.Lb(3,"form-select",20),s.Nb(),s.Dc(4,un,2,4,"div",18),s.Dc(5,mn,2,0,"section",21),s.Dc(6,bn,2,1,"section",22),s.Ob(7,"section",23),s.Lb(8,"form-select",24),s.Nb(),s.Nb()),2&t){const t=s.Zb(3);s.yb(1),s.hc("ngIf",t.transformFunctionType!=t.eFunctionType.Validate&&t.transformFunctionType!=t.eFunctionType.condition),s.yb(1),s.hc("ngStyle",s.lc(8,hn)),s.yb(1),s.hc("items",t.eErrorActionItems)("enableFilter",!1),s.yb(1),s.hc("ngIf",t.transformFunctionType==t.eFunctionType.Validate),s.yb(1),s.hc("ngIf","Boolean"==(null==t.selectedFunction?null:t.selectedFunction.returnType)||t.selectedCustomFunction&&"Boolean"==(null==t.selectedCustomFunction?null:t.selectedCustomFunction.returnType)),s.yb(1),s.hc("ngIf",(null==t.selectedFunction?null:t.selectedFunction.genericType)!==t.eGenericType.None),s.yb(2),s.hc("items",t.functionCache)}}function pn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button",43),s.Vb("click",(function(){s.vc(t);const e=s.Zb(2).$implicit;return s.Zb(4).importMappings(e)})),s.Nb()}}const fn=function(t){return[t]};function gn(t,e){if(1&t&&s.Lb(0,"input-parameter",44),2&t){const t=s.Zb(2).$implicit,e=s.Zb(4);s.hc("inputParameterForms",s.mc(8,fn,t))("nodeDatalinkColumnKey",null==e.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:e.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("inputColumns",e.inputColumns)("allowAdd",!1)("allowRemove",!1)("updateParameterName",!1)("rank",t.value.rank)("variables",e.variables)}}function kn(t,e){if(1&t&&(s.Ob(0,"small",48),s.Lb(1,"markdown",49),s.Nb()),2&t){const t=s.Zb().$implicit;s.yb(1),s.hc("data",t.value.runTime.functionParameter.description)}}const vn=function(t){return{"z-index":t,position:"relative"}};function yn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",45),s.Ob(1,"input-parameter",46),s.Vb("addParameter",(function(){s.vc(t);const a=e.index,n=s.Zb(2).$implicit,i=s.Zb(4);return i.addParameter(n,i.eParameterDirection.Input,a)}))("removeParameter",(function(){s.vc(t);const a=e.index,n=s.Zb(2).$implicit;return s.Zb(4).removeParameter(n,a)})),s.Nb(),s.Dc(2,kn,2,1,"small",47),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=e.last,i=s.Zb(6);s.hc("ngStyle",s.mc(9,vn,300-a)),s.yb(1),s.hc("inputParameterForms",s.mc(11,fn,t))("inputColumns",i.inputColumns)("allowAdd",!0)("nodeDatalinkColumnKey",null==i.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:i.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("allowRemove",!0)("updateParameterName",!1)("variables",i.variables),s.yb(1),s.hc("ngIf",n&&(null==t.value.runTime||null==t.value.runTime.functionParameter?null:t.value.runTime.functionParameter.description))}}function Tn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",31),s.Ob(2,"div",35),s.Fc(3),s.Nb(),s.Ob(4,"div",36),s.Dc(5,pn,1,0,"dexih-button",37),s.Ob(6,"dexih-button",38),s.Vb("click",(function(){s.vc(t);const e=s.Zb().$implicit,a=s.Zb(4);return a.addParameter(e,a.eParameterDirection.Input)})),s.Nb(),s.Ob(7,"dexih-button",39),s.Vb("click",(function(){s.vc(t);const e=s.Zb().$implicit;return s.Zb(4).addAllColumns(e)})),s.Nb(),s.Ob(8,"dexih-button",40),s.Vb("click",(function(){s.vc(t);const e=s.Zb().$implicit;return s.Zb(4).clearArray(e)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(9,gn,1,10,"input-parameter",41),s.Dc(10,yn,3,13,"div",42),s.Nb()}if(2&t){const t=s.Zb().$implicit,e=s.Zb(4);s.yb(3),s.Hc(" Array - ",t.value.name," "),s.yb(2),s.hc("ngIf",e.selectedFunction.importMethodName),s.yb(4),s.hc("ngIf",0===t.controls.arrayParameters.controls.length),s.yb(1),s.hc("ngForOf",t.controls.arrayParameters.controls)}}function Cn(t,e){if(1&t&&s.Lb(0,"input-parameter",50),2&t){const t=s.Zb().$implicit,e=s.Zb(4);s.hc("inputParameterForms",s.mc(7,fn,t))("inputColumns",e.inputColumns)("nodeDatalinkColumnKey",null==e.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:e.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("allowAdd",!1)("allowRemove",!1)("updateParameterName",!1)("variables",e.variables)}}function Fn(t,e){if(1&t&&(s.Ob(0,"div",33),s.Dc(1,Tn,11,4,"div",0),s.Dc(2,Cn,1,9,"input-parameter",34),s.Nb()),2&t){const t=e.$implicit;s.hc("ngStyle",s.mc(3,vn,300-e.index)),s.yb(1),s.hc("ngIf",t.value.rank>0&&!t.value.runTime.functionParameter.linkedName),s.yb(1),s.hc("ngIf",0==t.value.rank&&!t.value.runTime.functionParameter.linkedName)}}function Dn(t,e){if(1&t&&(s.Ob(0,"div",30),s.Ob(1,"div",31),s.Fc(2," Input Parameters "),s.Nb(),s.Dc(3,Fn,3,5,"div",32),s.Nb()),2&t){const t=s.Zb(3);s.yb(3),s.hc("ngForOf",t.inputParameterControls)}}function wn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button",43),s.Vb("click",(function(){s.vc(t);const e=s.Zb().$implicit;return s.Zb(3).importInputOutputMappings(e)})),s.Nb()}}function Sn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",53),s.Ob(1,"input-parameter",54),s.Vb("addParameter",(function(){s.vc(t);const a=e.index,n=s.Zb().$implicit;return s.Zb(3).addInputOutputParameter(n,a)}))("removeParameter",(function(){s.vc(t);const a=e.index,n=s.Zb().$implicit;return s.Zb(3).removeInputOutputParameter(n,a)})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=s.Zb(4);s.hc("ngStyle",s.mc(11,vn,200-a)),s.yb(1),s.hc("inputParameterForms",t.inputItems)("outputParameterForms",t.outputItems)("nodeDatalinkColumnKey",null==n.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:n.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("inputColumns",n.inputColumns)("outputColumns",n.outputColumns)("datalinkTargets",n.datalinkTargets)("allowAdd",!0)("allowRemove",!0)("updateParameterName",!1)("variables",n.variables)}}function Nn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",30),s.Ob(1,"div",31),s.Fc(2),s.Ob(3,"div",36),s.Dc(4,wn,1,0,"dexih-button",37),s.Ob(5,"dexih-button",51),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb(3).addInputOutputParameter(a)})),s.Nb(),s.Ob(6,"dexih-button",39),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb(3).addAllInputOutputColumns(a)})),s.Nb(),s.Ob(7,"dexih-button",40),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb(3).clearInputOutputArray(a)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(8,Sn,2,13,"div",52),s.Nb()}if(2&t){const t=e.$implicit,a=s.Zb(3);s.yb(2),s.Hc(" ",t.name," "),s.yb(2),s.hc("ngIf",a.selectedFunction.importMethodName),s.yb(4),s.hc("ngForOf",t.parameterItems)}}function On(t,e){if(1&t&&s.Lb(0,"output-parameter",60),2&t){const t=s.Zb(2).$implicit,e=s.Zb(4);s.hc("outputParameterForm",t)("outputColumns",e.outputColumns)("datalinkTargets",e.datalinkTargets)("allowAdd",!1)("allowRemove",!1)("rank",t.value.rank)}}function In(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",53),s.Ob(1,"output-parameter",61),s.Vb("addParameter",(function(){s.vc(t);const a=e.index,n=s.Zb(2).$implicit,i=s.Zb(4);return i.addParameter(n,i.eParameterDirection.Output,a)}))("removeParameter",(function(){s.vc(t);const a=e.index,n=s.Zb(2).$implicit;return s.Zb(4).removeParameter(n,a)})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=s.Zb(6);s.hc("ngStyle",s.mc(6,vn,200-a)),s.yb(1),s.hc("outputParameterForm",t)("outputColumns",n.outputColumns)("datalinkTargets",n.datalinkTargets)("allowAdd",!0)("allowRemove",!0)}}function xn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",31),s.Ob(2,"div",35),s.Fc(3),s.Nb(),s.Ob(4,"div",36),s.Ob(5,"dexih-button",38),s.Vb("click",(function(){s.vc(t);const e=s.Zb().$implicit,a=s.Zb(4);return a.addParameter(e,a.eParameterDirection.Output)})),s.Nb(),s.Ob(6,"dexih-button",40),s.Vb("click",(function(){s.vc(t);const e=s.Zb().$implicit;return s.Zb(4).clearArray(e)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(7,On,1,6,"output-parameter",59),s.Dc(8,In,2,8,"div",52),s.Nb()}if(2&t){const t=s.Zb().$implicit;s.yb(3),s.Hc(" Array - ",t.value.name," "),s.yb(4),s.hc("ngIf",0===t.controls.arrayParameters.controls.length),s.yb(1),s.hc("ngForOf",t.controls.arrayParameters.controls)}}function Pn(t,e){if(1&t&&s.Lb(0,"output-parameter",62),2&t){const t=s.Zb().$implicit,e=s.Zb(4);s.hc("outputParameterForm",t)("outputColumns",e.outputColumns)("datalinkTargets",e.datalinkTargets)("allowAdd",!1)("allowRemove",!1)}}function Vn(t,e){if(1&t&&(s.Ob(0,"div",12),s.Dc(1,xn,9,3,"div",0),s.Dc(2,Pn,1,5,"output-parameter",58),s.Nb()),2&t){const t=e.$implicit;s.hc("ngStyle",s.mc(3,vn,100-e.index)),s.yb(1),s.hc("ngIf",t.value.rank>0&&!t.value.runTime.functionParameter.linkedName),s.yb(1),s.hc("ngIf",0==t.value.rank)}}function En(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",30),s.Ob(1,"label",55),s.Ob(2,"div"),s.Fc(3," Output Parameters "),s.Nb(),s.Ob(4,"div",36),s.Ob(5,"dexih-button",56),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.autoMap(e.outputParameter)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(6,Vn,3,5,"div",57),s.Nb()}if(2&t){const t=s.Zb(3);s.yb(6),s.hc("ngForOf",t.outputParameterControls)}}function Kn(t,e){if(1&t&&(s.Ob(0,"form",6),s.Ob(1,"fieldset"),s.Dc(2,en,2,3,"section",0),s.Dc(3,nn,3,4,"ng-template",7),s.Dc(4,on,4,17,"ng-template",7),s.Dc(5,dn,9,9,"div",8),s.Dc(6,Dn,4,1,"div",9),s.Dc(7,Nn,9,3,"div",10),s.Dc(8,En,7,1,"div",9),s.Nb(),s.Nb()),2&t){const t=s.Zb(2);s.hc("formGroup",t.newDatalinkTransformItemForm),s.yb(2),s.hc("ngIf",(null==t.hubCache?null:t.hubCache.hub.dexihCustomFunctions.length)>0),s.yb(1),s.hc("ngIf",t.useCustomFunction),s.yb(1),s.hc("ngIf",!t.useCustomFunction),s.yb(1),s.hc("ngIf",t.selectedFunction||t.selectedCustomFunction),s.yb(1),s.hc("ngIf",(t.selectedFunction||t.selectedCustomFunction)&&t.inputParameterControls.length>0),s.yb(1),s.hc("ngForOf",t.arrayParameters),s.yb(1),s.hc("ngIf",(t.selectedFunction||t.selectedCustomFunction)&&t.allowOutput)}}function Ln(t,e){if(1&t&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,Xa,2,1,"ng-template",null,2,s.Ec),s.Dc(4,Kn,9,8,"form",3),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("showExpandButton",!1),s.yb(3),s.hc("ngIf",t.datalinkTransformForm)}}class Mn{constructor(){this.inputParameterForms=[],this.outputParameterForms=[],this.parameterItems=[]}resetItems(){let t=this.inputParameterForms[0].controls.arrayParameters;for(let e=0;e<t.controls.length;e++){let t=new Zn;this.inputParameterForms.forEach(a=>{t.inputItems.push(a.controls.arrayParameters.controls[e])}),this.outputParameterForms.forEach(a=>{t.outputItems.push(a.controls.arrayParameters.controls[e])}),this.parameterItems.push(t)}}}class Zn{constructor(){this.inputItems=[],this.outputItems=[]}}let An=(()=>{class t{constructor(t,e,a,n){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.eFunctionType=o.Cb,this.eParameterDirection=o.Vb,this.typeCodes=wa.a,this.cancelToken=new C.a,this.invalidActions=y.g,this.functionCache=y.d,this.eGenericType=o.Db,this.variables=[],this.allowOutput=!1,this.allowReturn=!0,this.arrayParameters=[],this.eInvalidActionItems=o.Gb.filter(t=>t.key>0),this.eErrorActionItems=o.xb.filter(t=>t.key>0),this.logger=new c.a("standard-function-edit"),this.isJoin=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle;let e=t[1];if(this.hubCache=t[2],this.remoteLibraries=t[3],this.datalinkForm=t[4],this.logger.LogC(()=>"OnInit",c.b.Trace),this.hubCache&&this.hubCache.isLoaded()&&this.datalinkForm&&this.remoteLibraries&&this.remoteLibraries.functions.length>0){if(this.transformFunctionType=+e.functionType,this.transformFunctionType===o.Cb.Validate?(this.datalinkTransformForm=this.editDatalinkService.getValidationTransform(),this.datalinkTransformKey=this.datalinkTransformForm.value.key):(this.datalinkTransformKey=+e.datalinkTransformKey,this.datalinkTransformForm=this.editDatalinkService.getDatalinkTransform(this.datalinkTransformKey)),this.variables=this.editDatalinkService.getVariables(),this.useCustomFunction=!!this.datalinkTransformForm.controls.customFunctionKey,this.datalinkTransformItemKey=+e.datalinkTransformItemKey,this.isJoin=this.datalinkTransformForm.value.transformType===o.lc.Join||this.datalinkTransformForm.value.transformType===o.lc.Lookup,this.isJoin){const t=this.datalinkTransformForm.controls.joinDatalinkTable.value;if(!t)return this.hubService.addHubErrorMessage("The join table could not be found."),void this.authService.navigateUp();this.inputColumns=t.dexihDatalinkColumns}else{let t=this.datalinkTransformForm.controls.nodeDatalinkColumn.value,e=t?t.key:null,a=new u.b;this.inputColumns=e?a.getAvailableColumns(this.datalinkTransformForm.controls.runTime.value.inputColumns,e,0):this.datalinkTransformForm.controls.runTime.value.inputColumns}if(this.outputColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns,this.datalinkTargets=this.datalinkForm.controls.dexihDatalinkTargets.value,this.datalinkTransformItemKey){if(this.datalinkTransformItemForm=this.editDatalinkService.getDatalinkTransformItem(this.datalinkTransformForm,this.datalinkTransformItemKey),!this.datalinkTransformItemForm)return void this.authService.navigateUp();if(this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,this.datalinkTransformItemForm.value),this.datalinkTransformItemForm.controls.customFunctionKey.value)this.selectCustomFunction(this.datalinkTransformItemForm.value.customFunctionKey,!1);else{let t=this.remoteLibraries.functions.find(t=>t.functionClassName===this.datalinkTransformItemForm.value.functionClassName&&t.functionMethodName===this.datalinkTransformItemForm.value.functionMethodName&&t.functionAssemblyName===this.datalinkTransformItemForm.value.functionAssemblyName);this.selectFunction(t,!1)}}else{let t=new o.x;t.datalinkTransformKey=this.datalinkTransformKey,t.transformItemType=o.kc.BuiltInFunction,this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,t)}switch(this.transformFunctionType){case o.Cb.Condition:case o.Cb.JoinCondition:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Condition),this.allowOutput=!1;break;case o.Cb.Validate:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Condition||t.functionType===o.Cb.Validate),this.allowOutput=!0;break;case o.Cb.Map:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Condition||t.functionType===o.Cb.Validate||t.functionType===o.Cb.Map),this.allowOutput=!0;break;case o.Cb.Aggregate:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Aggregate),this.allowOutput=!0;break;case o.Cb.Series:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Series||t.functionType===o.Cb.Aggregate),this.allowOutput=!0;break;case o.Cb.Rows:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Rows),this.allowOutput=!0,this.allowReturn=!1;break;case o.Cb.Profile:this.functions=this.remoteLibraries.functions.filter(t=>t.functionType===o.Cb.Profile),this.allowOutput=!1;break;default:this.functions=null}this.functionCategories=Array.from(new Set(this.functions.map(t=>t.category))),this.filteredFunctions=this.functions,this.customFunctions=this.hubCache.hub.dexihCustomFunctions,this.datalinkTransformItemForm&&this.datalinkTransformItemForm.value.customFunctionKey&&(this.useCustomFunction=!0,this.selectedCustomFunction=this.hubCache.hub.dexihCustomFunctions.find(t=>t.key===this.datalinkTransformItemForm.value.customFunctionKey)),this._functionSubscription&&this._functionSubscription.unsubscribe(),this._functionSubscription=this.newDatalinkTransformItemForm.controls.customFunctionKey.valueChanges.subscribe(t=>{this.selectCustomFunction(t,!1)})}this._saveSubscription&&this._saveSubscription.unsubscribe(),this._saveSubscription=this.editDatalinkService.savingDatalink.subscribe(t=>{t&&this.apply()})})}catch(t){this.hubService.addHubClientErrorMessage(t,"Standard Function Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._returnParameterSubscription&&this._returnParameterSubscription.unsubscribe(),this._functionSubscription&&this._functionSubscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe(),this.cancelToken.cancel()}updateCategory(t){this.filteredFunctions=t?this.functions.filter(e=>e.category===t):this.functions}canDeactivate(){return new Promise(t=>{this.newDatalinkTransformItemForm&&!this.newDatalinkTransformItemForm.pristine?this.authService.confirmDialog("The function has changed","The function has changed.  Do you want to discard the changes and continue?").then(e=>{t(e)}).catch(()=>{t(!1)}):t(!0)})}parametersArray(){return this.newDatalinkTransformItemForm.controls.dexihFunctionParameters}refreshParameters(){var t,e,a,n,i;let r=this.parametersArray();this.inputParameterControls=r.controls.sort((t,e)=>t.value.position-e.value.position).filter(t=>t.value.direction===o.Vb.Input||t.value.direction===o.Vb.ResultInput||t.value.direction===o.Vb.Join),this.outputParameterControls=r.controls.sort((t,e)=>t.value.position-e.value.position).filter(t=>y.e.parameterIsOutput(t.value)),this.transformFunctionType===o.Cb.Validate&&(this.outputParameterControls=this.outputParameterControls.filter(t=>t.value.direction!==o.Vb.ReturnValue)),this.arrayParameters=[],this.selectedFunction&&(null===(t=this.selectedFunction.inputParameters)||void 0===t||t.filter(t=>t.linkedName).forEach(t=>{this.addArrayParameter(t,!0)}),null===(e=this.selectedFunction.outputParameters)||void 0===e||e.filter(t=>t.linkedName).forEach(t=>{this.addArrayParameter(t,!1)}),null===(a=this.selectedFunction.resultInputParameters)||void 0===a||a.filter(t=>t.linkedName).forEach(t=>{this.addArrayParameter(t,!0)}),null===(n=this.selectedFunction.resultOutputParameters)||void 0===n||n.filter(t=>t.linkedName).forEach(t=>{this.addArrayParameter(t,!1)}),null===(i=this.selectedFunction.resultReturnParameters)||void 0===i||i.filter(t=>t.linkedName).forEach(t=>{this.addArrayParameter(t,!1)})),this.arrayParameters.forEach(t=>t.resetItems())}addArrayParameter(t,e){let a=this.arrayParameters.find(e=>e.name===t.linkedName);if(a||(a=new Mn,a.name=t.linkedName,a.functionParameter=t,this.arrayParameters.push(a)),e){let e=this.inputParameterControls.find(e=>e.controls.name.value===t.name);a.inputParameterForms.push(e)}else{let e=this.outputParameterControls.find(e=>e.controls.name.value===t.name);a.outputParameterForms.push(e)}}selectFunction(t,e){if(this.selectedFunction=t,null!=t){switch(this.newDatalinkTransformItemForm.controls.functionAssemblyName.setValue(this.selectedFunction.functionAssemblyName),this.newDatalinkTransformItemForm.controls.functionClassName.setValue(this.selectedFunction.functionClassName),this.newDatalinkTransformItemForm.controls.functionMethodName.setValue(this.selectedFunction.functionMethodName),this.newDatalinkTransformItemForm.controls.targetDatalinkColumn.setValue(null),this.newDatalinkTransformItemForm.controls.genericTypeCode.value||this.newDatalinkTransformItemForm.controls.genericTypeCode.setValue(this.selectedFunction.genericTypeDefault?this.selectedFunction.genericTypeDefault:this.selectedFunction.genericType===o.Db.Numeric?o.pc.Decimal:o.pc.String),this.selectedFunction.genericType){case o.Db.All:this.typeCodes=wa.a;break;case o.Db.Numeric:this.typeCodes=wa.a.filter(t=>t.isNumeric);break;case o.Db.String:this.typeCodes=wa.a.filter(t=>t.isString);break;case o.Db.None:this.typeCodes=[]}if(this.selectedFunction){let t=this.parametersArray(),a=[];for(;t.length;)a.push(t.value[0]),t.removeAt(0);this.selectedFunction.inputParameters&&this.selectedFunction.inputParameters.forEach((e,n)=>{e&&t.push(this.newParameter(a,e,n,this.isJoin?o.Vb.Join:o.Vb.Input,this.selectedFunction.genericTypeDefault))}),this.selectedFunction.outputParameters&&this.selectedFunction.outputParameters.forEach((e,n)=>{e&&e&&t.push(this.newParameter(a,e,n+100,o.Vb.Output,this.selectedFunction.genericTypeDefault))}),this.selectedFunction.resultInputParameters&&this.selectedFunction.resultInputParameters.forEach((e,n)=>{e&&t.push(this.newParameter(a,e,n+200,o.Vb.ResultInput,this.selectedFunction.genericTypeDefault))}),this.selectedFunction.resultOutputParameters&&this.selectedFunction.resultOutputParameters.forEach((e,n)=>{e&&e&&t.push(this.newParameter(a,e,n+300,o.Vb.ResultOutput,this.selectedFunction.genericTypeDefault))}),this.selectedFunction.returnParameters&&this.allowReturn&&this.selectedFunction.returnParameters.length>0&&this.selectedFunction.returnParameters.forEach((e,n)=>{t.push(this.newParameter(a,e,n+400,o.Vb.ReturnValue,this.selectedFunction.genericTypeDefault))}),this.selectedFunction.resultReturnParameters&&this.allowReturn&&this.selectedFunction.resultReturnParameters.length>0&&this.selectedFunction.resultReturnParameters.forEach(e=>{t.push(this.newParameter(a,e,0,o.Vb.ResultReturnValue,this.selectedFunction.genericTypeDefault))}),this.refreshParameters(),e&&this.newDatalinkTransformItemForm.markAsDirty()}else this.selectedFunction=null}}newParameter(t,e,a,n,i){let r=t.find(t=>t.name===e.parameterName),s=new o.A;return s.name=e.parameterName,s.rank=e.rank,s.direction=n,s.isGeneric=e.isGeneric,s.position=a,s.key=this.hubCache.getNextSequence(),s.runTime={functionParameter:e},r?(s.key=r.key,s.datalinkColumn=r.datalinkColumn,s.value=r.value,s.dataType=e.isGeneric?r.dataType:e.dataType,r.arrayParameters.forEach(t=>{t.runTime={functionParameter:e}}),s.arrayParameters=r.arrayParameters):(s.value=e.defaultValue,s.dataType=e.isGeneric?i:e.dataType),s.isValid=!0,this.editDatalinkService.hubFormsService.datalinkFunctionParametersFormGroup(s)}selectCustomFunction(t,e){if(this.selectedCustomFunction=this.hubCache.hub.dexihCustomFunctions.find(e=>e.key===t),this.selectedCustomFunction){let t=this.parametersArray(),a=[];for(;t.length;)a.push(t.value[0]),t.removeAt(0);this.selectedCustomFunction.dexihCustomFunctionParameters.filter(t=>(t.direction===o.Vb.Input||t.direction===o.Vb.Join)&&t.isValid).forEach((e,n)=>{if(e){let i=this.newParameter(a,e,n,this.isJoin?o.Vb.Join:o.Vb.Input,this.selectedCustomFunction.genericTypeDefault);t.push(i)}}),this.selectedCustomFunction.dexihCustomFunctionParameters.filter(t=>t.direction===o.Vb.Output&&t.isValid).forEach((e,n)=>{if(e){let i=this.newParameter(a,e,n,o.Vb.Output,this.selectedCustomFunction.genericTypeDefault);t.push(i)}});let n=new o.A;n.dataType=this.selectedCustomFunction.returnType,n.name="Return",n.direction=o.Vb.Output,n.rank=0,n.position=-1,n.isValid=!0;let i=this.newParameter(a,n,0,o.Vb.ReturnValue,this.selectedCustomFunction.genericTypeDefault);t.push(i),this.refreshParameters(),e&&this.newDatalinkTransformItemForm.markAsDirty()}}createArrayParameter(t,e,a=null,n){let i=t.runTime.functionParameter,r=new o.z;return r.isGeneric=i.isGeneric,r.dataType=i.isGeneric?n:t.dataType,r.position=a?a+1:1e7,r.name=i.name,r.direction=e,r.rank=0,r.key=this.hubCache.getNextSequence(),r.datalinkColumn=null,r.isValid=!0,r.runTime={functionParameter:i},r}addParameter(t,e,a=null){e===o.Vb.Input&&this.isJoin&&(e=o.Vb.Join);let n=this.createArrayParameter(t.value,e,0,this.newDatalinkTransformItemForm.controls.genericTypeCode.value),i=this.editDatalinkService.hubFormsService.datalinkFunctionArrayParametersFormGroup(n),r=t.controls.arrayParameters;return null!==a?r.insert(a+1,i):r.push(i),r.controls.forEach((t,e)=>{t.controls.position.setValue(10*e)}),this.refreshParameters(),i}addInputOutputParameter(t,e=null){let a=new Zn;t.inputParameterForms.forEach(t=>{let n=this.addParameter(t,this.isJoin?o.Vb.Join:o.Vb.Input,e);a.inputItems.push(n)}),t.outputParameterForms.forEach(t=>{let n=this.addParameter(t,o.Vb.Output,e);a.outputItems.push(n)}),null!==e?t.parameterItems.splice(e,0,a):t.parameterItems.push(a)}removeParameter(t,e){e>-1&&(t.controls.arrayParameters.removeAt(e),this.newDatalinkTransformItemForm.markAsDirty(),this.refreshParameters())}removeInputOutputParameter(t,e=null){t.inputParameterForms.forEach(t=>{this.removeParameter(t,e)}),t.outputParameterForms.forEach(t=>{this.removeParameter(t,e)}),t.parameterItems.splice(null!==e?e:t.parameterItems.length-1,1)}addAllColumns(t){this.clearArray(t);let e=t.value.runTime.functionParameter.isLabel,a=t.value,n=t.controls.arrayParameters,i=1;this.inputColumns.forEach(t=>{let r=this.createArrayParameter(a,this.isJoin?o.Vb.Join:o.Vb.Input,i++,this.selectedFunction.genericTypeDefault);e?r.value=t.name:r.datalinkColumn=t;let s=this.editDatalinkService.hubFormsService.datalinkFunctionArrayParametersFormGroup(r);n.push(s)}),this.refreshParameters()}addAllInputOutputColumns(t){this.addAllColumns(t.inputParameterForms[0]);let e=t.inputParameterForms[0].controls.arrayParameters;if(t.inputParameterForms.length>1){this.clearArray(t.inputParameterForms[1]);for(let a=0;a<e.length;a++){let e=this.addParameter(t.inputParameterForms[1],this.isJoin?o.Vb.Join:o.Vb.Input);t.inputParameterForms[0].value.runTime.functionParameter.isLabel&&e.controls.datalinkColumn.setValue(this.inputColumns[a])}for(let a=2;a<t.inputParameterForms.length;a++){this.clearArray(t.inputParameterForms[a]);for(let n=0;n<e.length;n++)this.addParameter(t.inputParameterForms[a],this.isJoin?o.Vb.Join:o.Vb.Input).controls.value.setValue(t.inputParameterForms[a].value.runTime.functionParameter.defaultValue)}}if(t.outputParameterForms.length>0)for(let a=0;a<t.outputParameterForms.length;a++){this.clearArray(t.outputParameterForms[a]);for(let t=0;t<e.length;t++);}t.resetItems()}clearArray(t){let e=t.controls.arrayParameters;for(let a=e.controls.length-1;a>=0;a--)e.removeAt(a);this.refreshParameters()}clearInputOutputArray(t){t.inputParameterForms.forEach(t=>{this.clearArray(t)}),t.outputParameterForms.forEach(t=>{this.clearArray(t)})}importInputOutputMappings(t){return e=this,void 0,n=function*(){let e=yield this.editDatalinkService.importFunctionMappings(this.datalinkTransformKey,this.newDatalinkTransformItemForm.value,this.cancelToken);if(null===e)return;let a=t.inputParameterForms[0].controls.arrayParameters;this.clearArray(t.inputParameterForms[0]);for(let n=0;n<e.length;n++)this.addParameter(t.inputParameterForms[0],this.isJoin?o.Vb.Join:o.Vb.Input).controls.value.setValue(e[n]);for(let n=1;n<t.inputParameterForms.length;n++){this.clearArray(t.inputParameterForms[n]);for(let e=0;e<a.length;e++)this.addParameter(t.inputParameterForms[n],this.isJoin?o.Vb.Join:o.Vb.Input).controls.value.setValue(t.inputParameterForms[n].value.runTime.functionParameter.defaultValue)}if(t.outputParameterForms.length>0)for(let n=0;n<t.outputParameterForms.length;n++){this.clearArray(t.outputParameterForms[n]);for(let t=0;t<a.length;t++);}t.resetItems()},new((a=void 0)||(a=Promise))((function(t,i){function r(t){try{s(n.next(t))}catch(e){i(e)}}function o(t){try{s(n.throw(t))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(r,o)}s((n=n.apply(e,[])).next())}));var e,a,n}autoMap(){this.outputParameterControls.forEach(t=>{let e=new o.m;e.key=this.hubService.getHubCache().getNextSequence(),e.position=1e3-e.key;let a=t.value;e.dataType=a.dataType,e.allowDbNull=!0,e.name=a.runTime.functionParameter.name,e.logicalName=a.runTime.functionParameter.name,e.rank=a.rank,t.controls.datalinkColumn.setValue(e),this.newDatalinkTransformItemForm.markAsDirty()})}cancel(){this.authService.navigateUp()}apply(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm),this.newDatalinkTransformItemForm.markAsPristine()}applyExit(){this.apply(),this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-function-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],["title","Edit Function",3,"showExpandButton"],["header",""],[3,"formGroup",4,"ngIf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[3,"formGroup"],[3,"ngIf"],["class","form-row",4,"ngIf"],["class","mt-1",4,"ngIf"],["class","mt-1",4,"ngFor","ngForOf"],["label","Use a custom function",3,"ngModel","ngModelOptions","ngModelChange"],[3,"ngStyle"],["label","Select a hub function","formControlName","customFunctionKey","itemKey","key","itemName","name","itemTitle","description",3,"items"],[3,"key"],["label","Category","selectNullMessage","(All functions)",3,"items","allowNullSelect","ngModelOptions","ngModel","sortItems","ngModelChange"],["label","Select a standard function","itemKey","name","itemName","name","itemTitle","description",3,"ngModel","ngModelOptions","items","enableKeySelect","note","sortItems","ngModelChange"],[1,"form-row"],["class","col-xs-12 col-sm-6 col-md-3",3,"ngStyle",4,"ngIf"],[1,"col-xs-12","col-sm-6","col-md-3",3,"ngStyle"],["label","Action when error","formControlName","onError","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],["class","col-xs-12 col-sm-6 col-md-4",4,"ngIf"],["class","col-xs-12 col-sm-6 col-md-3",4,"ngIf"],[1,"col-xs-12","col-sm-6","col-md-3"],["label","Cache Options","formControlName","functionCaching","itemKey","key","itemName","name",3,"items"],["label","Action when null","formControlName","onNull","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],["label","Action when false","formControlName","invalidAction","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],[1,"col-xs-12","col-sm-6","col-md-4"],["label","Return 'NOT' result","formControlName","notCondition"],["label","Data Type","formControlName","genericTypeCode","itemKey","key","itemName","name",3,"items"],[1,"mt-1"],[1,"d-flex","flex-row","mb-1"],["class","mb-1",3,"ngStyle",4,"ngFor","ngForOf"],[1,"mb-1",3,"ngStyle"],[3,"inputParameterForms","inputColumns","nodeDatalinkColumnKey","allowAdd","allowRemove","updateParameterName","variables",4,"ngIf"],[1,"input-group-text"],[1,"ml-auto"],["iconClass","fa fa-download","text","Import Mappings","title","Attempt to import the mappings from the source data","class","mr-1",3,"click",4,"ngIf"],["iconClass","fa fa-plus","text","Add Parameter","title","Add a parameter to the array",1,"mr-1",3,"click"],["iconClass","fa fa-columns","text","Add All Inputs","title","Add all the input columns to the array",1,"mr-1",3,"click"],["iconClass","fa fa-eraser","text","Clear",3,"click"],[3,"inputParameterForms","nodeDatalinkColumnKey","inputColumns","allowAdd","allowRemove","updateParameterName","rank","variables",4,"ngIf"],["class","pl-2 mb-1",3,"ngStyle",4,"ngFor","ngForOf"],["iconClass","fa fa-download","text","Import Mappings","title","Attempt to import the mappings from the source data",1,"mr-1",3,"click"],[3,"inputParameterForms","nodeDatalinkColumnKey","inputColumns","allowAdd","allowRemove","updateParameterName","rank","variables"],[1,"pl-2","mb-1",3,"ngStyle"],[3,"inputParameterForms","inputColumns","allowAdd","nodeDatalinkColumnKey","allowRemove","updateParameterName","variables","addParameter","removeParameter"],["class","form-text text-muted",4,"ngIf"],[1,"form-text","text-muted"],[3,"data"],[3,"inputParameterForms","inputColumns","nodeDatalinkColumnKey","allowAdd","allowRemove","updateParameterName","variables"],["iconClass","fa fa-plus","text","Add Mapping","title","Add a parameter to the array",1,"mr-1",3,"click"],["class","pl-2",3,"ngStyle",4,"ngFor","ngForOf"],[1,"pl-2",3,"ngStyle"],[3,"inputParameterForms","outputParameterForms","nodeDatalinkColumnKey","inputColumns","outputColumns","datalinkTargets","allowAdd","allowRemove","updateParameterName","variables","addParameter","removeParameter"],[1,"d-flex","flex-row"],["text","Auto Map","buttonClass","btn-sm btn-outline-primary",3,"click"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove",4,"ngIf"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove","rank",4,"ngIf"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove","rank"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove","addParameter","removeParameter"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove"]],template:function(t,e){1&t&&s.Dc(0,Ln,5,2,"div",0),2&t&&s.hc("ngIf",e.newDatalinkTransformItemForm&&e.inputColumns&&e.outputColumns)},directives:[n.t,p.T,p.a,p.b,g.I,g.t,g.l,n.s,p.A,g.s,g.v,n.w,p.E,g.j,Sa.a,p.f,Ha,Na.a,Ya],encapsulation:2}),t})();function _n(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-validate",6),s.Vb("click",(function(){return s.vc(t),s.Zb(3).test()})),s.Nb(),s.Ob(1,"dexih-button-download",7),s.Vb("click",(function(){return s.vc(t),s.Zb(3).downloadCode()})),s.Nb(),s.Ob(2,"dexih-button-apply",8),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(3,"dexih-button-cancel",9),s.Vb("click",(function(){return s.vc(t),s.Zb(3).cancel()})),s.Nb()}if(2&t){const t=s.Zb(3);s.yb(2),s.hc("disabled",t.newDatalinkTransformItemForm.pristine)}}const Gn=function(){return{"z-index":305,position:"relative"}};function Rn(t,e){if(1&t&&(s.Ob(0,"section",13),s.Lb(1,"form-select",19),s.Nb()),2&t){const t=s.Zb(4);s.hc("ngStyle",s.lc(3,Gn)),s.yb(1),s.hc("items",t.eErrorActionItems)("enableFilter",!1)}}const jn=function(){return{"z-index":303,position:"relative"}};function Hn(t,e){1&t&&(s.Ob(0,"section",13),s.Lb(1,"form-checkbox",20),s.Nb()),2&t&&s.hc("ngStyle",s.lc(1,jn))}const Jn=function(){return{"z-index":302,position:"relative"}};function Bn(t,e){if(1&t&&(s.Ob(0,"div",13),s.Lb(1,"form-select",21),s.Nb()),2&t){const t=s.Zb(4);s.hc("ngStyle",s.lc(3,Jn)),s.yb(1),s.hc("items",t.eInvalidActionItems)("enableFilter",!1)}}function $n(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",22),s.Ob(1,"dexih-button",23),s.Vb("click",(function(){s.vc(t);const e=s.Zb(4);return e.addParameter(null,e.eParameterDirection.Input)})),s.Fc(2,"Add Parameter "),s.Nb(),s.Nb()}}const Un=function(t){return{"z-index":t,position:"relative"}},qn=function(t){return[t]};function zn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",24),s.Ob(1,"input-parameter",25),s.Vb("hasChanged",(function(e){return s.vc(t),s.Zb(4).parameterHasChanged(e)}))("addParameter",(function(e){s.vc(t);const a=s.Zb(4);return a.addParameter(e,a.eParameterDirection.Input)}))("removeParameter",(function(e){return s.vc(t),s.Zb(4).removeParameter(e)})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=s.Zb(4);s.hc("ngStyle",s.mc(9,Un,200-a)),s.yb(1),s.hc("allowNameSelect",!0)("allowDataTypeSelect",!0)("inputParameterForms",s.mc(11,qn,t))("inputColumns",n.inputColumns)("nodeDatalinkColumnKey",null==n.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:n.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("updateParameterName",!0)("allowAdd",!0)("allowRemove",!0)}}function Wn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"dexih-button",23),s.Vb("click",(function(){s.vc(t);const e=s.Zb(5);return e.addParameter(null,e.eParameterDirection.Output)})),s.Fc(2,"Add Parameter "),s.Nb(),s.Nb()}}function Qn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",27),s.Ob(1,"output-parameter",30),s.Vb("addParameter",(function(e){s.vc(t);const a=s.Zb(5);return a.addParameter(e,a.eParameterDirection.Output)}))("removeParameter",(function(e){return s.vc(t),s.Zb(5).removeParameter(e)})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=s.Zb(5);s.hc("ngStyle",s.mc(9,Un,100-a)),s.yb(1),s.hc("allowNameSelect",!0)("allowDataTypeSelect",!0)("outputParameterForm",t)("outputColumns",n.outputColumns)("datalinkTargets",n.datalinkTargets)("updateParameterName",!0)("allowAdd",!0)("allowRemove",!0)}}const Yn=function(){return{"z-index":101,position:"relative"}};function Xn(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",26),s.Fc(2," Output Parameters "),s.Nb(),s.Ob(3,"div",27),s.Ob(4,"output-parameter",28),s.Vb("addParameter",(function(e){s.vc(t);const a=s.Zb(4);return a.addParameter(e,a.eParameterDirection.Output)})),s.Nb(),s.Nb(),s.Dc(5,Wn,3,0,"div",0),s.Dc(6,Qn,2,11,"div",29),s.Nb()}if(2&t){const t=s.Zb(4);s.yb(3),s.hc("ngStyle",s.lc(8,Yn)),s.yb(1),s.hc("allowNameSelect",!1)("allowDataTypeSelect",!0)("outputParameterForm",t.returnParameterForm)("outputColumns",t.outputColumns)("datalinkTargets",t.datalinkTargets),s.yb(1),s.hc("ngIf",0===t.outputParameters.length),s.yb(1),s.hc("ngForOf",t.outputParameters)}}const ti=function(){return{"z-index":304,position:"relative"}};function ei(t,e){if(1&t&&(s.Ob(0,"form",10),s.Ob(1,"fieldset"),s.Ob(2,"div",11),s.Dc(3,Rn,2,4,"section",12),s.Ob(4,"section",13),s.Lb(5,"form-select",14),s.Nb(),s.Dc(6,Hn,2,2,"section",12),s.Dc(7,Bn,2,4,"div",12),s.Nb(),s.Ob(8,"div"),s.Ob(9,"div",15),s.Fc(10," Input Parameters "),s.Nb(),s.Dc(11,$n,3,0,"div",16),s.Dc(12,zn,2,13,"div",17),s.Nb(),s.Dc(13,Xn,7,9,"div",0),s.Fc(14," Function Code "),s.Lb(15,"textarea",18),s.Nb(),s.Nb()),2&t){const t=s.Zb(3);s.hc("formGroup",t.newDatalinkTransformItemForm),s.yb(3),s.hc("ngIf",t.functionType!=t.eFunctionType.Validate&&t.functionType!=t.eFunctionType.condition),s.yb(1),s.hc("ngStyle",s.lc(10,ti)),s.yb(1),s.hc("items",t.eErrorActionItems)("enableFilter",!1),s.yb(1),s.hc("ngIf",t.selectedFunction&&"Boolean"==(null==t.selectedFunction?null:t.selectedFunction.returnType)),s.yb(1),s.hc("ngIf",t.functionType==t.eFunctionType.Validate),s.yb(4),s.hc("ngIf",0===t.inputParameters.length),s.yb(1),s.hc("ngForOf",t.inputParameters),s.yb(1),s.hc("ngIf",t.functionType!=t.eFunctionType.Condition&&t.functionType!=t.eFunctionType.JoinCondition)}}function ai(t,e){if(1&t&&(s.Ob(0,"dexih-widget-section",3),s.Dc(1,_n,4,1,"ng-template",null,4,s.Ec),s.Dc(3,ei,16,11,"form",5),s.Nb()),2&t){const t=s.Zb(2);s.hc("showExpandButton",!0),s.yb(3),s.hc("ngIf",t.newDatalinkTransformItemForm)}}function ni(t,e){if(1&t){const t=s.Pb();s.Ob(0,"button",34),s.Vb("click",(function(){return s.vc(t),s.Zb(3).test()})),s.Fc(1,"Syntax Check"),s.Nb(),s.Ob(2,"button",34),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.test(e.inputParameterValues)})),s.Fc(3,"Run"),s.Nb(),s.Ob(4,"button",35),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.downloadCode(e.inputParameterValues)})),s.Fc(5,"Download Code"),s.Nb()}}function ii(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",27),s.Ob(1,"form-input",36),s.Vb("ngModelChange",(function(a){s.vc(t);const n=e.index;return s.Zb(3).inputParameterValues[n]=a})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=s.Zb(3);s.hc("ngStyle",s.mc(4,Un,200-a)),s.yb(1),s.hc("label",t.controls.name.value)("ngModel",n.inputParameterValues[a])("name","inputParameterValues"+a)}}function ri(t,e){1&t&&(s.Ob(0,"div",15),s.Fc(1," Outputs Parameters "),s.Nb())}function oi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",27),s.Ob(1,"form-input",37),s.Vb("ngModelChange",(function(a){s.vc(t);const n=e.index;return s.Zb(3).outputParameterValues[n]=a})),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.index,n=s.Zb(3);s.hc("ngStyle",s.mc(5,Un,200-a)),s.yb(1),s.hc("disabled",!0)("label",t.controls.name.value)("ngModel",n.outputParameterValues[a])("name","outputParameterValues"+a)}}function si(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-widget-section",31),s.Dc(1,ni,6,0,"ng-template",null,4,s.Ec),s.Ob(3,"form"),s.Ob(4,"div",15),s.Fc(5," Input Parameters "),s.Nb(),s.Dc(6,ii,2,6,"div",29),s.Ob(7,"form-input",32),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb(2).returnParameterValue=e})),s.Nb(),s.Dc(8,ri,2,0,"div",33),s.Dc(9,oi,2,7,"div",29),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("showExpandButton",!0),s.yb(6),s.hc("ngForOf",t.inputParameters),s.yb(1),s.hc("disabled",!0)("ngModel",t.returnParameterValue),s.yb(1),s.hc("ngIf",t.outputParameters.length>0),s.yb(1),s.hc("ngForOf",t.outputParameters)}}function li(t,e){if(1&t&&(s.Ob(0,"div"),s.Dc(1,ai,4,2,"dexih-widget-section",1),s.Dc(2,si,10,6,"dexih-widget-section",2),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("ngIf",t.datalinkTransformForm),s.yb(1),s.hc("ngIf",t.datalinkTransformForm&&t.newDatalinkTransformItemForm)}}let ci=(()=>{class t{constructor(t,e,a,n,i,r){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.location=r,this.cancelToken=new C.a,this.eFunctionType=o.Cb,this.eParameterDirection=o.Vb,this.eInvalidActionItems=o.Gb.filter(t=>t.key>0),this.eErrorActionItems=o.xb.filter(t=>t.key>0),this.inputParameters=[],this.outputParameters=[],this.inputParameterValues=[],this.outputParameterValues=[]}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(t=>{if(this.pageTitle=t[0].pageTitle,this.hubCache=t[2],this.datalinkForm=t[3],this.functionType=t[1].functionType,this.functionType===o.Cb.Validate?(this.datalinkTransformForm=this.editDatalinkService.getValidationTransform(),this.datalinkTransformKey=this.datalinkTransformForm.value.key):(this.datalinkTransformKey=+t[1].datalinkTransformKey,this.datalinkTransformForm=this.editDatalinkService.getDatalinkTransform(this.datalinkTransformKey)),this.datalinkTransformItemKey=+t[1].datalinkTransformItemKey,this.datalinkTransformForm){let t=this.datalinkTransformForm.controls.nodeDatalinkColumn.value,e=t?t.key:null,a=new u.b;if(this.inputColumns=e?a.getAvailableColumns(this.datalinkTransformForm.controls.runTime.value.inputColumns,e,0):this.datalinkTransformForm.controls.runTime.value.inputColumns,this.outputColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns,this.datalinkTargets=this.datalinkForm.controls.dexihDatalinkTargets.value,this.datalinkTransformItemKey){if(this.datalinkTransformItemForm=this.editDatalinkService.getDatalinkTransformItem(this.datalinkTransformForm,this.datalinkTransformItemKey),this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,this.datalinkTransformItemForm.value),!this.newDatalinkTransformItemForm)return void this.authService.navigateUp()}else{let t=new o.x;t.datalinkTransformKey=this.datalinkTransformKey,t.transformItemType=o.kc.CustomFunction;let e=new o.A;e.dataType=this.functionType===o.Cb.Condition||this.functionType===o.Cb.JoinCondition||this.functionType===o.Cb.Validate?o.pc.Boolean:o.pc.String,e.name="Return",e.direction=o.Vb.ReturnValue,e.rank=0,e.position=-1,e.datalinkColumn=null,e.isValid=!0;let a=new o.O;a.name="Return",e.runTime={functionParameter:a},t.dexihFunctionParameters=new Array,t.dexihFunctionParameters.push(e),this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,t)}this.parameters=this.newDatalinkTransformItemForm.controls.dexihFunctionParameters,this.setParameters(this.parameters.controls),this._parametersSubscription&&this._parametersSubscription.unsubscribe(),this._parametersSubscription=this.parameters.valueChanges.subscribe(t=>{this.setParameters(t)})}this._saveSubscription&&this._saveSubscription.unsubscribe(),this._saveSubscription=this.editDatalinkService.savingDatalink.subscribe(t=>{t&&this.apply()})})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._returnParameterSubscription&&this._returnParameterSubscription.unsubscribe(),this._parametersSubscription&&this._parametersSubscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe(),this.cancelToken.cancel()}canDeactivate(){return new Promise(t=>{this.newDatalinkTransformItemForm&&!this.newDatalinkTransformItemForm.pristine?this.authService.confirmDialog("Function has changed","The function has changed.  Would you like to discard the changes and return to the previous screen?").then(e=>{t(e)}).catch(e=>{t(!1)}):t(!0)})}setParameters(t){this.inputParameters=this.parameters.controls.sort((t,e)=>t.value.position-e.value.position).filter(t=>t.value.direction===o.Vb.Input),this.inputParameterValues=new Array(this.inputParameters.length),this.outputParameters=this.parameters.controls.sort((t,e)=>t.value.position-e.value.position).filter(t=>t.value.direction===o.Vb.Output),this.outputParameterValues=new Array(this.inputParameters.length),this.returnParameterForm=this.parameters.controls.find(t=>t.value.direction===o.Vb.ReturnValue)}parametersArray(){return this.newDatalinkTransformItemForm.controls.dexihFunctionParameters}addParameter(t,e){try{let a=new o.A;if(t){let e=t.value;a.dataType=e.dataType,a.name=e.name,a.position=e.position+1}a.name="",a.datalinkColumn=null,a.value=null,a.dataType=o.pc.String,a.direction=e,a.rank=0,a.isValid=!0;let n=this.parametersArray(),i=this.editDatalinkService.hubFormsService.datalinkFunctionParametersFormGroup(a);n.push(i),n.controls.sort((t,e)=>t.value.position-e.value.position).forEach((t,e)=>{t.controls.position.setValue(10*e)})}catch(a){this.hubService.addHubClientErrorMessage(a,"Edit Custom Function, add parameter")}}removeParameter(t){try{let e=this.parametersArray(),a=e.controls.indexOf(t);a>-1&&e.removeAt(a)}catch(e){this.hubService.addHubClientErrorMessage(e,"Edit Custom Function, remove parameter")}}newDefaultParameter(){try{let t=new o.A;return t.datalinkTransformItemKey=this.newDatalinkTransformItemForm.value.key,t.dataType=o.pc.String,t.rank=0,t.isValid=!0,t}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function, default parameter")}}cancel(){this.authService.navigateUp()}apply(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm),this.newDatalinkTransformItemForm.markAsPristine()}applyExit(){this.apply(),this.authService.navigateUp()}downloadCode(t=null){this.hubService.downloadCustomFunction(this.newDatalinkTransformItemForm.value,t).catch(t=>{})}test(t=null){this.hubService.testCustomFunction(this.newDatalinkTransformItemForm.value,t,this.cancelToken).then(t=>{this.hubService.addHubSuccessMessage("The function has successfully compiled."),t&&t.length>0?t.forEach((t,e)=>{0===e?this.returnParameterValue=t:this.outputParameterValues[e-1]=t}):(this.returnParameterValue=null,this.outputParameterValues.forEach(t=>null))}).catch(t=>{this.returnParameterValue=null,this.outputParameterValues.forEach(t=>null),this.hubService.addHubMessage(t)})}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e),s.Kb(n.n))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-custom-function-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],["title","Edit Custom Function",3,"showExpandButton",4,"ngIf"],["title","Test Function",3,"showExpandButton",4,"ngIf"],["title","Edit Custom Function",3,"showExpandButton"],["header",""],[3,"formGroup",4,"ngIf"],["text","Syntax Check",1,"mr-1",3,"click"],["text","Download Code",1,"mr-1",3,"click"],[1,"mr-1",3,"disabled","click"],[3,"click"],[3,"formGroup"],[1,"form-row"],["class","col col-xs-4",3,"ngStyle",4,"ngIf"],[1,"col","col-xs-4",3,"ngStyle"],["label","Action when error","formControlName","onError","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],[1,"label"],["class","mb-1",4,"ngIf"],["class","pl-2",3,"ngStyle",4,"ngFor","ngForOf"],["rows","20","width","100%","spellcheck","false","formControlName","functionCode",1,"form-control"],["label","Action when null","formControlName","onNull","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],["label","Return 'NOT' result","formControlName","notCondition"],["label","Action when false","formControlName","invalidAction","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],[1,"mb-1"],["iconClass","fa fa-plus-square-o","title","Click to add a parameter",3,"click"],[1,"pl-2",3,"ngStyle"],[3,"allowNameSelect","allowDataTypeSelect","inputParameterForms","inputColumns","nodeDatalinkColumnKey","updateParameterName","allowAdd","allowRemove","hasChanged","addParameter","removeParameter"],[1,"label","mb-1"],[3,"ngStyle"],[3,"allowNameSelect","allowDataTypeSelect","outputParameterForm","outputColumns","datalinkTargets","addParameter"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"allowNameSelect","allowDataTypeSelect","outputParameterForm","outputColumns","datalinkTargets","updateParameterName","allowAdd","allowRemove","addParameter","removeParameter"],["title","Test Function",3,"showExpandButton"],["label","Return Value","name","returnParameterValue","type","text",3,"disabled","ngModel","ngModelChange"],["class","label",4,"ngIf"],[1,"btn","btn-success","mr-1",3,"click"],[1,"btn","btn-success",3,"click"],["type","text","placeholder","Enter a test value for the parameter",3,"label","ngModel","name","ngModelChange"],["type","text",3,"disabled","label","ngModel","name","ngModelChange"]],template:function(t,e){1&t&&s.Dc(0,li,3,2,"div",0),2&t&&s.hc("ngIf",e.newDatalinkTransformItemForm&&e.inputColumns&&e.outputColumns)},directives:[n.t,p.T,p.x,p.h,p.a,p.b,g.I,g.t,g.l,n.w,p.E,g.s,g.j,n.s,g.c,p.A,p.f,Ha,Ya,g.u,p.D,g.v],encapsulation:2}),t})();function ui(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-apply",6),s.Vb("click",(function(){s.vc(t);const e=s.Zb(2);return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(1,"dexih-button-cancel",7),s.Vb("click",(function(){return s.vc(t),s.Zb(2).cancel()})),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("disabled",t.newDatalinkTransformItemForm.pristine)}}function mi(t,e){if(1&t&&(s.Ob(0,"section",8),s.Lb(1,"form-select",9),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.eAggregateItems)}}function bi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"section",8),s.Ob(1,"form-select",10),s.Vb("textValueChange",(function(e){return s.vc(t),s.Zb(2).sourceValue=e}))("textValueChange",(function(e){return s.vc(t),s.Zb(2).updateSourceValue(e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.inputColumns)("textValue",t.sourceValue)("enableKeySelect",!1)("enableTextEntry",!0)("enableTextEntryMatch",!1)("errors",t.sourceErrors)}}function hi(t,e){if(1&t&&(s.Ob(0,"section",8),s.Lb(1,"form-select",11),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.compare)}}function di(t,e){if(1&t){const t=s.Pb();s.Ob(0,"section",8),s.Ob(1,"form-select",12),s.Vb("textValueChange",(function(e){return s.vc(t),s.Zb(2).filterValue=e}))("textValueChange",(function(e){return s.vc(t),s.Zb(2).updateFilterValue(e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.inputColumns)("enableTextEntry",!0)("textValue",t.filterValue)("enableTextEntryMatch",!1)("enableKeySelect",!1)("errors",t.filterValueErrors)("textEntryItems",t.variables)("setTextEntryToValue",!1)}}function pi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"section",8),s.Ob(1,"form-select",13),s.Vb("textValueChange",(function(e){return s.vc(t),s.Zb(2).updateNewColumn(e)})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.outputTables)("enableKeySelect",!1)("enableTextEntry",!0)("setTextEntryToValue",!1)("errors",t.targetErrors)}}function fi(t,e){if(1&t&&(s.Ob(0,"section",8),s.Lb(1,"form-select",14),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.sortDirections)}}function gi(t,e){if(1&t&&(s.Ob(0,"section",8),s.Lb(1,"form-select",15),s.Nb()),2&t){const t=s.Zb(2);s.yb(1),s.hc("items",t.joinColumns)("enableKeySelect",!1)("errors",t.joinErrors)}}function ki(t,e){if(1&t&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,ui,2,1,"ng-template",null,2,s.Ec),s.Ob(4,"form",3),s.Ob(5,"fieldset"),s.Ob(6,"div",4),s.Dc(7,mi,2,1,"section",5),s.Dc(8,bi,2,6,"section",5),s.Dc(9,hi,2,1,"section",5),s.Dc(10,di,2,8,"section",5),s.Dc(11,pi,2,5,"section",5),s.Dc(12,fi,2,1,"section",5),s.Dc(13,gi,2,3,"section",5),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("title",t.pageTitle)("showExpandButton",!1),s.yb(3),s.hc("formGroup",t.newDatalinkTransformItemForm),s.yb(3),s.hc("ngIf",t.transformItemType==t.eTransformItemType.AggregatePair),s.yb(1),s.hc("ngIf",t.showInput),s.yb(1),s.hc("ngIf",t.transformItemType==t.eTransformItemType.FilterPair||t.transformItemType==t.eTransformItemType.JoinPair),s.yb(1),s.hc("ngIf",t.transformItemType==t.eTransformItemType.FilterPair&&t.newDatalinkTransformItemForm.controls.filterCompare.value!=t.eCompare.IsNotNull&&t.newDatalinkTransformItemForm.controls.filterCompare.value!=t.eCompare.IsNull),s.yb(1),s.hc("ngIf",t.showOutput),s.yb(1),s.hc("ngIf",t.transformItemType==t.eTransformItemType.Sort),s.yb(1),s.hc("ngIf",t.transformItemType==t.eTransformItemType.JoinPair)}}let vi=(()=>{class t{constructor(t,e,a,n){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.eTransformItemType=o.kc,this.inputColumns=[],this.showInput=!0,this.showOutput=!0,this.eAggregate=o.Y,this.eAggregateItems=o.Z.filter(t=>t.key>0),this.compare=Qt.a,this.eCompare=o.hb,this.sortDirections=y.v}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle;let e=t[1];this.hubCache=t[2];let a=t[3];if(this.hubCache.isLoaded()){if(this.datalinkForm=a,this.variables=this.editDatalinkService.getVariables(),this.datalinkTransformItemKey=+e.datalinkTransformItemKey,this.datalinkTransformKey=+e.datalinkTransformKey,this.transformItemType=+e.type,this.datalinkForm){switch(this.datalinkTransformForm=this.editDatalinkService.getDatalinkTransform(this.datalinkTransformKey),this.transformItemType){case o.kc.JoinPair:this.showInput=!0,this.showOutput=!1,this.pageTitle="Edit Join";break;case o.kc.Column:this.showInput=!0,this.showOutput=!1,this.pageTitle="Edit Group";break;case o.kc.JoinNode:this.showInput=!1,this.showOutput=!0,this.pageTitle="Edit Join Node";break;case o.kc.GroupNode:this.showInput=!1,this.showOutput=!0,this.pageTitle="Edit Group Node";break;case o.kc.Sort:this.showInput=!0,this.showOutput=!1,this.pageTitle="Edit Sort";break;case o.kc.FilterPair:this.showInput=!0,this.showOutput=!1,this.pageTitle="Edit Condition";break;case o.kc.AggregatePair:this.pageTitle="Edit Aggregate",this.showInput=!0,this.showOutput=!0;break;default:this.pageTitle="Edit Mapping",this.showInput=!0,this.showOutput=!0}let t=this.datalinkTransformForm.controls.nodeDatalinkColumn.value,e=t?t.key:null,a=new u.b;if(e){let t=a.getAvailableColumns(this.datalinkTransformForm.controls.runTime.value.inputColumns,e,0);this.inputColumns=this.editDatalinkService.getColumnGroups(t),this.outputColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns}else this.inputColumns=this.editDatalinkService.getColumnGroups(this.datalinkTransformForm.controls.runTime.value.inputColumns),this.outputColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns;this.datalinkTransformForm.value.joinDatalinkTable&&(this.joinColumns=this.datalinkTransformForm.value.joinDatalinkTable.dexihDatalinkColumns),this.datalinkTargets=this.datalinkForm.controls.dexihDatalinkTargets.value;let n=new o.H;if(n.name="Output Columns",n.dexihTableColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns,this.outputTables=[n],this.datalinkTargets&&this.datalinkTargets.forEach(t=>{this.outputTables.push(t.table)}),this.datalinkTransformItemKey)this.datalinkTransformItemForm=this.editDatalinkService.getDatalinkTransformItem(this.datalinkTransformForm,this.datalinkTransformItemKey),this.filterValue=this.datalinkTransformItemForm.controls.filterValue.value,this.sourceValue=this.datalinkTransformItemForm.controls.sourceValue.value,this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,this.datalinkTransformItemForm.value);else{let t=new o.x;t.datalinkTransformKey=this.datalinkTransformKey,t.transformItemType=this.transformItemType,this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,t)}this.getErrors(),this._formChangesObserve&&this._formChangesObserve.unsubscribe(),this._formChangesObserve=this.newDatalinkTransformItemForm.statusChanges.subscribe(()=>{this.getErrors()})}this._saveSubscription&&this._saveSubscription.unsubscribe(),this._saveSubscription=this.editDatalinkService.savingDatalink.subscribe(t=>{t&&this.apply()})}})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Mapping Function")}}ngOnDestroy(){this._formChangesObserve&&this._formChangesObserve.unsubscribe(),this._subscription&&this._subscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe()}cancel(){this.authService.navigateUp()}getErrors(){this.targetErrors=this.editDatalinkService.hubFormsService.getErrorMessage(this.newDatalinkTransformItemForm.controls.targetDatalinkColumn),this.sourceErrors=this.editDatalinkService.hubFormsService.getErrorMessage(this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn),this.joinErrors=this.editDatalinkService.hubFormsService.getErrorMessage(this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn)}apply(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm)}updateNewColumn(t){let e=this.newDatalinkTransformItemForm.controls.targetDatalinkColumn.value;if(t&&(!e||e.name!==t)){let e;e=this.newColumn?this.newColumn.key:this.hubService.getHubCache().getNextSequence();let a=this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn.value;if(a){let t=new u.b;this.newColumn=t.copyDatalinkColumn(a,1e3-e,"mapping")}else this.newColumn=new o.m,this.newColumn.position=1e3-e,this.transformItemType===o.kc.JoinNode?(this.newColumn.dataType=o.pc.Node,this.newColumn.childColumns=this.joinColumns):this.newColumn.dataType=o.pc.String;this.newColumn.name=t,this.newColumn.logicalName=t,this.newColumn.columnGroup="mapping",this.newColumn.key=e,this.newDatalinkTransformItemForm.controls.targetDatalinkColumn.setValue(this.newColumn)}}updateFilterValue(t){this.newDatalinkTransformItemForm.controls.filterValue.setValue(t)}updateSourceValue(t){this.newDatalinkTransformItemForm.controls.sourceValue.setValue(t)}applyExit(){this.apply(),this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["mapping-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],[3,"title","showExpandButton"],["header",""],[3,"formGroup"],[1,"form-row"],["class","form-group col-md-4",4,"ngIf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"form-group","col-md-4"],["label","Aggregate","formControlName","aggregate","itemKey","key","itemName","name",3,"items"],["label","Input Column","formControlName","sourceDatalinkColumn","parentName","group","childItems","columns","itemName","logicalName","itemKey","key",3,"items","textValue","enableKeySelect","enableTextEntry","enableTextEntryMatch","errors","textValueChange"],["label","Compare","formControlName","filterCompare","itemKey","key","itemName","name",3,"items"],["label","Compare Column/Value","formControlName","filterDatalinkColumn","parentName","group","childItems","columns","itemKey","key","itemName","logicalName","textEntryItemsTitle","Variables","note","Note: For static date values use format YYYY-MM-DD (e.g. 2018-01-30)",3,"items","enableTextEntry","textValue","enableTextEntryMatch","enableKeySelect","errors","textEntryItems","setTextEntryToValue","textValueChange"],["label","Output Column","formControlName","targetDatalinkColumn","parentName","name","childItems","dexihTableColumns","itemKey","key","itemName","logicalName","note","Enter new column, or select existing","textEntryNote","Enter new column name, or select existing",3,"items","enableKeySelect","enableTextEntry","setTextEntryToValue","errors","textValueChange"],["label","Direction","formControlName","sortDirection","itemKey","key","itemName","name",3,"items"],["label","Join Column","formControlName","joinDatalinkColumn","itemKey","key","itemName","logicalName","note","Select a join column","textEntryNote","Enter a value to add a new column",3,"items","enableKeySelect","errors"]],template:function(t,e){1&t&&s.Dc(0,ki,14,10,"div",0),2&t&&s.hc("ngIf",e.newDatalinkTransformItemForm&&e.inputColumns&&e.outputColumns)},directives:[n.t,p.T,g.I,g.t,g.l,p.a,p.b,p.E,g.s,g.j],encapsulation:2}),t})(),yi=(()=>{class t{canDeactivate(t){return!t||!t.canDeactivate||t.canDeactivate()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Gb({token:t,factory:t.\u0275fac}),t})();var Ti=a("NHAS");function Ci(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-close",3),s.Vb("click",(function(){return s.vc(t),s.Zb().close()})),s.Nb()}}let Fi=(()=>{class t{constructor(t,e,a,n){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.eDataObjectType=o.lb}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{let e=t[0],a=t[1];this.hubCache=t[2],this.datalinkForm=t[4],this.action=e.action,this.pageTitle=e.pageTitle,this.hubCache.isLoaded()&&(this.datalinkTransformKey=+a.datalinkTransformKey)})}catch(t){this.hubService.addHubClientErrorMessage(t,"Preview Transform Data")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["datalink-preview-data"]],decls:4,vars:5,consts:[["title","Preview Transform Data",3,"showExpandButton","padding"],["header",""],[3,"datalink","datalinkTransformKey","viewSource"],[3,"click"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,Ci,1,0,"ng-template",null,1,s.Ec),s.Lb(3,"preview-data",2),s.Nb()),2&t&&(s.hc("showExpandButton",!0)("padding",!1),s.yb(3),s.hc("datalink",null==e.datalinkForm?null:e.datalinkForm.value)("datalinkTransformKey",e.datalinkTransformKey)("viewSource",e.eDataObjectType.Datalink))},directives:[p.T,Ti.a,p.d],encapsulation:2}),t})();function Di(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-close",3),s.Vb("click",(function(){return s.vc(t),s.Zb().close()})),s.Nb()}}function wi(t,e){if(1&t&&s.Lb(0,"preview-data",4),2&t){const t=s.Zb();s.hc("key",t.tableKey)("viewSource",t.eDataObjectType.Table)}}function Si(t,e){if(1&t&&s.Lb(0,"preview-data",4),2&t){const t=s.Zb();s.hc("key",t.datalinkKey)("viewSource",t.eDataObjectType.Datalink)}}let Ni=(()=>{class t{constructor(t,e,a){this.hubService=t,this.authService=e,this.route=a,this.eDataObjectType=o.lb}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(t=>{let e=t[0],a=t[1];if(this.hubCache=t[2],this.action=e.action,this.pageTitle=e.pageTitle,this.hubCache.isLoaded())if(a.tableKey){this.tableKey=+a.tableKey;let t=this.hubCache.getTable(this.tableKey);t&&(this.name=t.name)}else{this.datalinkKey=+a.datalinkKey;let t=this.hubCache.hub.dexihDatalinks.find(t=>t.key==this.datalinkKey);t&&(this.name=t.name)}})}catch(t){this.hubService.addHubClientErrorMessage(t,"Preview Table Data")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["datalink-preview-table"]],decls:5,vars:5,consts:[[3,"title","showExpandButton","padding"],["header",""],[3,"key","viewSource",4,"ngIf"],[3,"click"],[3,"key","viewSource"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,Di,1,0,"ng-template",null,1,s.Ec),s.Dc(3,wi,1,2,"preview-data",2),s.Dc(4,Si,1,2,"preview-data",2),s.Nb()),2&t&&(s.hc("title","Preview "+e.name)("showExpandButton",!1)("padding",!1),s.yb(3),s.hc("ngIf",e.tableKey),s.yb(1),s.hc("ngIf",e.datalinkKey))},directives:[p.T,n.t,p.d,Ti.a],encapsulation:2}),t})();function Oi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-delete",12),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb().deleteSelected(a)})),s.Nb()}}function Ii(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-edit",13),s.Vb("click",(function(){s.vc(t);const a=e.item;return s.Zb().editColumn(a)})),s.Nb()}}function xi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-new",14),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb().deleteSelected(a)})),s.Nb()}}let Pi=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.canEdit=!1,this.typeCodes=wa.a,this.deltaTypes=y.i,this.securityFlags=y.s,this.eConnectionPurpose=o.jb,this.columns=[{name:"position",title:"#",format:""},{control:"name",title:"Column Name",format:"",tooltip:"description"},{name:"dataType",title:"Data Type",format:""},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"logicalName",title:"Logical Name",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._columnData=new m.a(null),this.columnData=this._columnData.asObservable()}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle;let e=t[1];this.hubCache=t[2],this.datalinkTransformKey=+e.datalinkTransformKey,this.datalinkTransformForm=this.editDatalinkService.getDatalinkTransform(this.datalinkTransformKey),this.transformTableForm=this.datalinkTransformForm.controls.transformTable,this.updateColumnData()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Transform Table Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}updateColumnData(){let t=[];this.transformTableForm.controls.dexihTableColumns.controls.filter(t=>t.value.isValid).sort((t,e)=>t.value.position-e.value.position).forEach(e=>{t.push({key:e.value.key,position:e.value.position,name:e.controls.name,description:e.value.description,dataType:e.value.dataType,allowDbNull:e.value.allowDbNull,logicalName:e.value.logicalName,updateDate:e.value.updateDate})}),this._columnData.next(t)}deleteColumn(t){this.deleteSelected([t])}deleteSelected(t){const e=this.transformTableForm.controls.dexihTableColumns;t.forEach(t=>{let a=e.controls.findIndex(e=>e.value.key===t.key);a>=0&&e.removeAt(a),this.updateColumnData()})}newColumn(){this.router.navigate(["column"],{relativeTo:this.route.parent})}editColumn(t){this.router.navigate(["column",t.key],{relativeTo:this.route.parent})}columnSortChange(t){let e=this.transformTableForm.controls.dexihTableColumns,a=1;t.forEach(t=>{e.controls.find(e=>e.value.key===t.key).controls.position.setValue(a++)}),this.updateColumnData()}close(){this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["transform-table-edit-form"]],decls:15,vars:4,consts:[[1,"widget-body-toolbar"],[1,"form-row"],[1,"col-sm-6"],[1,"col-sm-6","text-right"],[3,"click"],["sortColumn","position",3,"enableMultiSelect","enableManualSort","columns","dataObservable","onSortChanged"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["select","actionsTemplate"],["actions",""],["title","Delete selected columns",3,"click"],["title","Edit the column",3,"click"],["title","Create a new column",3,"click"]],template:function(t,e){1&t&&(s.Ob(0,"div"),s.Ob(1,"div",0),s.Ob(2,"div",1),s.Ob(3,"div",2),s.Ob(4,"h5"),s.Fc(5,"Transform Output Columns"),s.Nb(),s.Nb(),s.Ob(6,"div",3),s.Ob(7,"dexih-button-close",4),s.Vb("click",(function(){return e.close()})),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Ob(8,"dexih-table",5),s.Vb("onSortChanged",(function(t){return e.columnSortChange(t)})),s.Dc(9,Oi,1,0,"ng-template",6,7,s.Ec),s.Dc(11,Ii,1,0,"ng-template",8,9,s.Ec),s.Dc(13,xi,1,0,"ng-template",10,11,s.Ec),s.Nb(),s.Nb()),2&t&&(s.yb(8),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("columns",e.columns)("dataObservable",e.columnData))},directives:[p.d,R.a,p.g,p.j,p.o],encapsulation:2}),t})();const Vi=function(){return["new",1]};function Ei(t,e){1&t&&(s.Ob(0,"li",6),s.Ob(1,"a",7),s.Ob(2,"div",8),s.Fc(3," Add Transform "),s.Nb(),s.Lb(4,"i",9),s.Nb(),s.Nb()),2&t&&(s.yb(1),s.hc("routerLink",s.lc(1,Vi)))}function Ki(t,e){1&t&&s.Lb(0,"div",24)}const Li=function(t){return["new",t]},Mi=function(t){return["transform",t]},Zi=function(t){return["transform",t,"preview-transform-data"]};function Ai(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",10),s.Ob(1,"li",11),s.Ob(2,"a",12),s.Lb(3,"i",13),s.Nb(),s.Ob(4,"a",14),s.Lb(5,"i",13),s.Nb(),s.Ob(6,"a",15),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb(2).deleteTransform(a.transform.value)})),s.Lb(7,"i",16),s.Nb(),s.Ob(8,"a",17),s.Ob(9,"div",8),s.Fc(10),s.Ob(11,"div"),s.Lb(12,"span",18),s.Lb(13,"dexih-invalid-form-icon",19),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Ob(14,"div",20),s.Ob(15,"a",21),s.Lb(16,"i",22),s.Nb(),s.Dc(17,Ki,1,0,"div",23),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit,a=e.last;s.yb(2),s.hc("routerLink",s.mc(9,Li,t.transform.value.position-1)),s.yb(2),s.hc("routerLink",s.mc(11,Li,t.transform.value.position+1)),s.yb(4),s.hc("routerLink",s.mc(13,Mi,t.transform.value.key))("title","Select the "+t.transform.value.name+" transform."),s.yb(2),s.Hc(" ",t.name," "),s.yb(2),s.hc("ngClass",t.icon),s.yb(1),s.hc("control",t.transform),s.yb(2),s.hc("routerLink",s.mc(15,Zi,t.transform.value.key)),s.yb(2),s.hc("ngIf",!a)}}function _i(t,e){if(1&t&&(s.Ob(0,"div",2),s.Ob(1,"ul",3),s.Dc(2,Ei,5,2,"li",4),s.Dc(3,Ai,18,17,"div",5),s.Nb(),s.Nb()),2&t){const t=s.Zb();s.yb(2),s.hc("ngIf",0===t.datalinkTransforms.length),s.yb(1),s.hc("ngForOf",t.datalinkTransforms)}}let Gi=(()=>{class t{constructor(t,e,a,n){this.hubService=t,this.editDatalinkService=e,this.route=a,this.router=n,this.pageTitle="Transform",this.datalinkTransforms=null,this.logger=new c.a("datalink-edit-transforms")}ngOnInit(){this.logger.LogC(()=>"OnInit",c.b.Trace);try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.action=t[0].action,this.pageTitle=t[0].pageTitle;let e=t[1];if(this.hubCache=t[2],this.datalinkForm=t[3],this.hubCache.isLoaded()&&this.datalinkForm){let t=+e.datalinkTransformKey;this.logger.LogC(()=>"loading transform with key "+t,c.b.Trace),this.refreshTransforms(),this._transformsChange&&this._transformsChange.unsubscribe(),this._transformsChange=this.datalinkForm.controls.dexihDatalinkTransforms.valueChanges.subscribe(()=>this.refreshTransforms())}})}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit Transform")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._transformsChange&&this._transformsChange.unsubscribe()}refreshTransforms(){this.logger.LogC(()=>"refreshing transforms list",c.b.Trace);const t=this.datalinkForm.controls.dexihDatalinkTransforms.controls.filter(t=>t.value.transformType!==o.lc.Validation&&t.value.transformType!==o.lc.Profile).sort((t,e)=>t.value.position-e.value.position).map(t=>{const e=wa.e.find(e=>e.key===t.value.transformType);let a="";e&&(a=e.icon);const n=this.hubCache.getTransformName(t.value);return{transform:t,icon:a,name:n,invalid:t.invalid}});this.datalinkTransforms=t}deleteTransform(t){this.logger.LogC(()=>"deleteTransform",c.b.Trace),this.editDatalinkService.deleteDatalinkTransform(t).then(()=>{this.refreshTransforms()})}previewData(t){this.router.navigate(["transform",t.key,"preview-transform-data"],{relativeTo:this.route})}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-transforms-form"]],decls:3,vars:2,consts:[["title","Transforms",3,"padding"],["class","bg-light pt-1 pb-1 d-flex \u2248",4,"ngIf"],[1,"bg-light","pt-1","pb-1","d-flex","\u2248"],[1,"transform-container"],["class","d-flex align-items-stretch p-0 m-3",4,"ngIf"],["class","d-flex m-3 ",4,"ngFor","ngForOf"],[1,"d-flex","align-items-stretch","p-0","m-3"],["title","Insert a transform before this",1,"btn","btn-outline-success",3,"routerLink"],[1,"d-block"],[1,"fa","fa-4x","fa-plus"],[1,"d-flex","m-3"],[1,"d-flex","align-items-stretch","p-0"],["title","Insert a transform before this",1,"insert-before","btn","btn-sm","btn-primary",3,"routerLink"],[1,"fa","fa-plus"],["title","Insert a transform after this",1,"insert-after","btn","btn-sm","btn-primary",3,"routerLink"],["href","javascript:void(0)","title","Delete this transform",1,"delete","btn","btn-sm","btn-danger","mr-1",3,"click"],[1,"fa","fa-remove"],["routerLinkActive","btn-outline-success",1,"btn","btn-outline-primary",2,"width","100%",3,"routerLink","title"],[1,"fa-4x",3,"ngClass"],[3,"control"],[1,"arrow","bg-primary"],["title","Preview transform data",1,"preview","btn","btn-sm","btn-primary","mr-1",3,"routerLink"],[1,"fa","fa-search"],["class","arrow-head",4,"ngIf"],[1,"arrow-head"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,_i,4,2,"div",1),s.Nb(),s.Lb(2,"router-outlet")),2&t&&(s.hc("padding",!1),s.yb(1),s.hc("ngIf",e.datalinkTransforms))},directives:[p.T,n.t,i.j,n.s,i.h,i.g,n.q,I.a],styles:['.transform-container[_ngcontent-%COMP%]{overflow-x:auto;margin:auto;overflow-y:hidden}ul[_ngcontent-%COMP%]{display:flex;list-style:none;padding:0}li[_ngcontent-%COMP%]{margin:auto;position:relative;text-align:center;min-width:120px}a.active[_ngcontent-%COMP%]{color:#fff;background:#d3d3d3}.arrow[_ngcontent-%COMP%]{content:"";height:1px;min-width:120px;right:-13px;position:relative;top:50%}.arrow-head[_ngcontent-%COMP%]{width:0;height:0;border-color:transparent transparent transparent #3a5f8d;border-style:solid;border-width:7px 0 7px 20px;left:calc(100% - 15px)}.arrow-head[_ngcontent-%COMP%], .preview[_ngcontent-%COMP%]{content:"";position:absolute;top:50%;transform:translateY(-50%)}.preview[_ngcontent-%COMP%]{left:calc(50% - 19px)}.insert-before[_ngcontent-%COMP%]{left:-16px}.insert-after[_ngcontent-%COMP%], .insert-before[_ngcontent-%COMP%]{content:"";position:absolute;top:50%;transform:translateY(-50%)}.delete[_ngcontent-%COMP%], .insert-after[_ngcontent-%COMP%]{left:calc(100% - 16px)}.delete[_ngcontent-%COMP%]{content:"";position:absolute;top:-16px}']}),t})();function Ri(t,e){if(1&t){const t=s.Pb();s.Ob(0,"a",3),s.Vb("click",(function(){s.vc(t);const a=e.$implicit;return s.Zb().insert(a.transformReference)})),s.Ob(1,"div",4),s.Ob(2,"div",5),s.Ob(3,"div",6),s.Fc(4),s.Nb(),s.Lb(5,"i",7),s.Nb(),s.Ob(6,"div",8),s.Fc(7),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit;s.yb(4),s.Hc(" ",t.transformReference.name," "),s.yb(1),s.hc("ngClass",t.icon),s.yb(2),s.Hc(" ",t.transformReference.description," ")}}let ji=(()=>{class t{constructor(t,e,a,n,i){this.hubService=t,this.editDatalinkService=e,this.authService=a,this.route=n,this.router=i}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{return e=this,void 0,n=function*(){this.transforms=[],(yield this.hubService.GetUserConfigTransformReference()).forEach(t=>{let e=wa.e.find(e=>e.key===t.transformType),a="";e&&(a=e.icon),this.transforms.push({transformReference:t,icon:a})}),this.position=+t[1].position},new((a=void 0)||(a=Promise))((function(t,i){function r(t){try{s(n.next(t))}catch(e){i(e)}}function o(t){try{s(n.throw(t))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(r,o)}s((n=n.apply(e,[])).next())}));var e,a,n})}catch(t){this.hubService.addHubClientErrorMessage(t,"New Transform")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}insert(t){let e=this.editDatalinkService.insertDatalinkTransform(this.position,t);this.router.navigate(["transform",e.value.key],{relativeTo:this.route.parent})}close(){this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(d),s.Kb(b.a),s.Kb(i.a),s.Kb(i.e))},t.\u0275cmp=s.Eb({type:t,selectors:[["datalink-edit-new-transform"]],decls:3,vars:2,consts:[["title","Select a Transform",3,"padding"],[1,"d-flex","flex-wrap","justify-content-around"],["href","javascript:void(0)","class","btn btn-outline-primary p-0 m-3","style","width:400px",3,"click",4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"btn","btn-outline-primary","p-0","m-3",2,"width","400px",3,"click"],[1,"d-flex"],[1,"border-right","border-primary","p-3",2,"min-width","140px"],[1,"d-block"],[1,"fa","fa-4x",3,"ngClass"],[1,"p-3","text-left"]],template:function(t,e){1&t&&(s.Ob(0,"dexih-widget-section",0),s.Ob(1,"div",1),s.Dc(2,Ri,8,3,"a",2),s.Nb(),s.Nb()),2&t&&(s.hc("padding",!0),s.yb(2),s.hc("ngForOf",e.transforms))},directives:[p.T,n.s,n.q],encapsulation:2}),t})();var Hi=a("9nsk"),Ji=a("vDxl");function Bi(t,e){if(1&t&&s.Lb(0,"table-edit-columns",10),2&t){const t=s.Zb(2);s.hc("parentColumnForm",t.columnFormService.currentForm)}}function $i(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",1),s.Ob(2,"div",2),s.Ob(3,"h5"),s.Fc(4,"Edit Column "),s.Nb(),s.Ob(5,"div",3),s.Ob(6,"dexih-invalid-form-details",4),s.Vb("click",(function(){return s.vc(t),s.Zb().columnFormService.showErrors()})),s.Nb(),s.Ob(7,"dexih-button-apply",5),s.Vb("click",(function(){s.vc(t);const e=s.Zb();return!e.columnFormService.currentForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(8,"dexih-button-cancel",6),s.Vb("click",(function(){return s.vc(t),s.Zb().cancel()})),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Ob(9,"div",7),s.Lb(10,"column-edit-base",8),s.Nb(),s.Dc(11,Bi,1,1,"table-edit-columns",9),s.Nb()}if(2&t){const t=s.Zb();s.yb(6),s.hc("control",t.columnFormService.currentForm),s.yb(1),s.hc("disabled",t.columnFormService.currentForm.pristine),s.yb(3),s.hc("columnFormService",t.columnFormService)("detailedView",!0),s.yb(1),s.hc("ngIf",t.columnFormService.currentForm.controls.dataType.value===t.eTypeCode.Node)}}let Ui=(()=>{class t{constructor(t,e,a,n,i){this.authService=t,this.hubService=e,this.editDatalinkService=a,this.route=i,this.eTypeCode=o.pc,this.typeCodes=wa.a,this.deltaTypes=y.i,this.securityFlags=y.s,this.columnFormService=new h.a(n,e,t)}ngOnInit(){try{this._subscription=Object(r.a)(this.route.params,this.hubService.getHubCacheObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle,this.datalinkColumnKey=+t[0].datalinkColumnKey,this.hubCache=t[1],this.sourceDatalinkTableForm=this.editDatalinkService.hubFormsService.currentForm.controls.sourceDatalinkTable,this.initializeForm()}),this._saveSubscription&&this._saveSubscription.unsubscribe(),this._saveSubscription=this.editDatalinkService.savingDatalink.subscribe(t=>{t&&this.applyExit()})}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink column edit")}}ngOnChanges(){this.hubCache&&this.initializeForm()}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe()}findColumn(){let t=this.sourceDatalinkTableForm.controls.dexihDatalinkColumns,e=t.controls.find(t=>t.value.key===this.datalinkColumnKey);return e||(this.editDatalinkService.hubFormsService.currentForm.controls.dexihDatalinkTransforms.controls.forEach(a=>{a.controls.dexihDatalinkTransformItems.controls.forEach(a=>{if(!e){let n=a;if(n.controls.targetDatalinkColumn.value&&n.controls.targetDatalinkColumn.value.key===this.datalinkColumnKey&&(e=n.controls.targetDatalinkColumn),!e){t=n.controls.dexihFunctionParameters;let a=t.controls.find(t=>y.e.parameterIsOutput(t.value)&&t.value.datalinkColumn&&t.value.datalinkColumn.key===this.datalinkColumnKey);a&&(e=a.controls.datalinkColumn),e||t.controls.forEach(t=>{let n=t.controls.arrayParameters;n&&(a=n.controls.find(t=>y.e.parameterIsOutput(t.value)&&t.value.datalinkColumn&&t.value.datalinkColumn.key===this.datalinkColumnKey),a&&(e=a.controls.datalinkColumn))})}}})}),e)}initializeForm(){let t;if(this.datalinkColumnKey){if(this.originalColumnForm=this.findColumn(),!this.originalColumnForm)return void this.authService.informationDialog("Cannot Edit","The selected column could not be edited.").then(()=>{this.authService.navigateUp()});t=this.columnFormService.datalinkTableColumn(null,this.originalColumnForm.value)}else{let e=new o.m;e.key=this.hubCache.getNextSequence(),e.datalinkTableKey=this.sourceDatalinkTableForm.controls.key.value;let a=this.sourceDatalinkTableForm.controls.dexihDatalinkColumns.value,n=1;a.forEach(t=>{t.position>n&&(n=t.position)}),e.position=n+1,t=this.columnFormService.datalinkTableColumn(a,e)}this.columnFormService.startForm(t)}cancel(){this.authService.navigateUp()}applyExit(){const t=this.columnFormService.currentForm;this.originalColumnForm?this.originalColumnForm.setValue(t.value):this.sourceDatalinkTableForm.controls.dexihDatalinkColumns.push(t),this.sourceDatalinkTableForm.markAsDirty(),this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(b.a),s.Kb(l.a),s.Kb(d),s.Kb(g.g),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["datalink-column-edit"]],features:[s.wb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"list-group-item","list-group-item-info","rounded-0"],[1,"d-flex","flex-row"],[1,"ml-auto"],[1,"mr-1",3,"control","click"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"container","mt-3","mb-3"],[3,"columnFormService","detailedView"],[3,"parentColumnForm",4,"ngIf"],[3,"parentColumnForm"]],template:function(t,e){1&t&&s.Dc(0,$i,12,5,"div",0),2&t&&s.hc("ngIf",null==e.columnFormService?null:e.columnFormService.currentForm)},directives:[n.t,F.a,p.a,p.b,Hi.a,Ji.a],encapsulation:2}),t})();var qi=a("wTS4");function zi(t,e){if(1&t&&(s.Ob(0,"div",12),s.Ob(1,"div",15),s.Ob(2,"div"),s.Fc(3),s.Nb(),s.Nb(),s.Nb()),2&t){const t=e.$implicit;s.yb(3),s.Gc(t.controls.name.value)}}function Wi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",7),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Ob(3,"section",9),s.Ob(4,"form-select",10),s.Vb("textValueChange",(function(e){return s.vc(t),s.Zb(2).sourceValue=e})),s.Nb(),s.Nb(),s.Ob(5,"div",11),s.Ob(6,"div",12),s.Ob(7,"div",13),s.Fc(8,"UnGroup Column"),s.Nb(),s.Nb(),s.Dc(9,zi,4,1,"div",14),s.Nb(),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.yb(1),s.hc("formGroup",t.newDatalinkTransformItemForm),s.yb(3),s.hc("items",t.inputColumns)("textValue",t.sourceValue)("enableTextEntry",!0)("enableTextEntryMatch",!1)("enableKeySelect",!1)("errors",t.sourceErrors),s.yb(5),s.hc("ngForOf",t.newDatalinkTransformItemForm.controls.dexihFunctionParameters.controls)}}function Qi(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",1),s.Ob(2,"div",2),s.Ob(3,"h5"),s.Fc(4,"Un-Group Column Node"),s.Nb(),s.Ob(5,"div",3),s.Ob(6,"dexih-button-apply",4),s.Vb("click",(function(){s.vc(t);const e=s.Zb();return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(7,"dexih-button-cancel",5),s.Vb("click",(function(){return s.vc(t),s.Zb().cancel()})),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Dc(8,Wi,10,8,"div",6),s.Nb()}if(2&t){const t=s.Zb();s.yb(6),s.hc("disabled",t.newDatalinkTransformItemForm.pristine),s.yb(2),s.hc("ngIf",t.datalinkTransformForm)}}let Yi=(()=>{class t{constructor(t,e,a,n){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.eFunctionType=o.Cb,this.eParameterDirection=o.Vb,this.typeCodes=wa.a,this.variables=[],this.allowOutput=!1,this.allowReturn=!0,this.logger=new c.a("unGroup-edit")}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{this.pageTitle=t[0].pageTitle;let e=t[1];if(this.hubCache=t[2],this.datalinkForm=t[3],this.logger.LogC(()=>"OnInit",c.b.Trace),this.hubCache&&this.hubCache.isLoaded()&&this.datalinkForm){this.datalinkTransformKey=+e.datalinkTransformKey,this.datalinkTransformItemKey=+e.datalinkTransformItemKey,this.datalinkTransformForm=this.editDatalinkService.getDatalinkTransform(this.datalinkTransformKey),this.variables=this.editDatalinkService.getVariables();let t=this.datalinkTransformForm.controls.nodeDatalinkColumn.value,a=t?t.key:null,n=new u.b;if(a?(this.inputColumns=n.getAvailableColumns(this.datalinkTransformForm.controls.runTime.value.inputColumns,a,0),this.outputColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns):(this.inputColumns=this.datalinkTransformForm.controls.runTime.value.inputColumns,this.outputColumns=this.datalinkTransformForm.controls.runTime.value.transformColumns),this.inputColumns=this.inputColumns.filter(t=>t.dataType===o.pc.Node),this.datalinkTransformItemKey){if(this.datalinkTransformItemForm=this.editDatalinkService.getDatalinkTransformItem(this.datalinkTransformForm,this.datalinkTransformItemKey),!this.datalinkTransformItemForm)return void this.authService.navigateUp();this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,this.datalinkTransformItemForm.value),this.newDatalinkTransformItemForm.controls.dexihFunctionParameters.controls.forEach(t=>{let e={};e.functionParameter=new o.O,t.value.datalinkColumn&&(e.functionParameter.name=t.value.datalinkColumn.name),t.controls.runTime.setValue(e)})}else{let t=new o.x;t.datalinkTransformKey=this.datalinkTransformKey,t.transformItemType=o.kc.UnGroup,this.datalinkTransformItemKey=0,this.newDatalinkTransformItemForm=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,t)}this._nodeSubscription&&this._nodeSubscription.unsubscribe(),this._nodeSubscription=this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn.valueChanges.subscribe(t=>{let e=this.newDatalinkTransformItemForm.controls.dexihFunctionParameters;for(;e.length;)e.removeAt(0);t.childColumns&&t.childColumns.length>0&&t.childColumns.forEach((t,a)=>{let i=n.copyDatalinkColumn(t,0,"un-group"),r=new o.A;r.datalinkTransformItemKey=this.datalinkTransformItemKey,r.name=t.name,r.rank=t.rank,r.direction=o.Vb.Output,r.dataType=t.dataType,r.position=a,r.key=this.hubCache.getNextSequence(),r.datalinkColumn=i,r.isValid=!0,r.runTime={},r.runTime.functionParameter=new o.O,r.runTime.functionParameter.name=t.name;let s=this.editDatalinkService.hubFormsService.datalinkFunctionParametersFormGroup(r);e.push(s)})})}})}catch(t){this.hubService.addHubClientErrorMessage(t,"UnGroup Node Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._nodeSubscription&&this._nodeSubscription.unsubscribe()}canDeactivate(){return new Promise(t=>{this.newDatalinkTransformItemForm&&!this.newDatalinkTransformItemForm.pristine?this.authService.confirmDialog("The function has changed","The function has changed.  Do you want to discard the changes and continue?").then(e=>{t(e)}).catch(()=>{t(!1)}):t(!0)})}cancel(){this.authService.navigateUp()}apply(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm),this.newDatalinkTransformItemForm.markAsPristine()}applyExit(){this.apply(),this.authService.navigateUp()}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-unGroup-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"list-group-item","list-group-item-info","rounded-0"],[1,"d-flex","flex-row"],[1,"ml-auto"],[1,"mr-1",3,"disabled","click"],[3,"click"],["class","container  mt-3 mb-3",4,"ngIf"],[1,"container","mt-3","mb-3"],[3,"formGroup"],[1,"col","col-xs-12"],["label","Column Node","formControlName","sourceDatalinkColumn","itemKey","key","itemName","logicalName",3,"items","textValue","enableTextEntry","enableTextEntryMatch","enableKeySelect","errors","textValueChange"],[1,"mt-1"],[1,"row"],[1,"col","border","bg-primary","text-white","font-weight-bold","text-truncate"],["class","row",4,"ngFor","ngForOf"],[1,"col","border","bg-secondary","text-white","text-truncate"]],template:function(t,e){1&t&&s.Dc(0,Qi,9,2,"div",0),2&t&&s.hc("ngIf",e.newDatalinkTransformItemForm&&e.inputColumns&&e.outputColumns)},directives:[n.t,p.a,p.b,g.I,g.t,g.l,p.E,g.s,g.j,n.s],encapsulation:2}),t})();var Xi=a("Qrk8"),tr=a("zal2"),er=a("dn85");function ar(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-preview",6),s.Vb("click",(function(){return s.vc(t),s.Zb(2).previewData()})),s.Nb(),s.Ob(1,"dexih-button",7),s.Vb("click",(function(){return s.vc(t),s.Zb(2).importTable()})),s.Fc(2," Re-Import "),s.Nb(),s.Ob(3,"dexih-button",8),s.Vb("click",(function(){return s.vc(t),s.Zb(2).createTable()})),s.Fc(4," Drop & Create "),s.Nb(),s.Ob(5,"dexih-button-apply",9),s.Vb("click",(function(){return s.vc(t),s.Zb(2).apply()})),s.Nb(),s.Lb(6,"cancel-button",10)}if(2&t){const t=s.Zb(2);s.yb(5),s.hc("disabled",!(null!=t.targetTableForm&&t.targetTableForm.dirty)),s.yb(1),s.hc("formsService",t.tableFormService)}}function nr(t,e){if(1&t&&(s.Ob(0,"section"),s.Lb(1,"form-select",13),s.Nb()),2&t){const t=s.Zb(3);s.yb(1),s.hc("items",t.connectionTables)}}function ir(t,e){if(1&t&&(s.Ob(0,"section"),s.Lb(1,"form-select",14),s.Nb()),2&t){const t=s.Zb(3);s.yb(1),s.hc("items",t.nodes)("enableKeySelect",!1)("allowNullSelect",!0)}}const rr=function(){return{standalone:!0}};function or(t,e){if(1&t){const t=s.Pb();s.Ob(0,"form",11),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Ob(3,"form-checkbox",12),s.Vb("ngModelChange",(function(e){return s.vc(t),s.Zb(2).newTable=e}))("ngModelChange",(function(e){return s.vc(t),s.Zb(2).toggleNewTable(e)})),s.Nb(),s.Nb(),s.Dc(4,nr,2,1,"section",0),s.Dc(5,ir,2,3,"section",0),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("formGroup",t.targetTableForm),s.yb(3),s.hc("ngModelOptions",s.lc(5,rr))("ngModel",t.newTable),s.yb(1),s.hc("ngIf",!t.newTable),s.yb(1),s.hc("ngIf",(null==t.nodes?null:t.nodes.length)>0)}}function sr(t,e){if(1&t&&s.Lb(0,"dexih-table-edit-properties",15),2&t){const t=s.Zb(2);s.hc("formsService",t.tableFormService)("isExpanded",t.newTable)}}function lr(t,e){if(1&t){const t=s.Pb();s.Ob(0,"column-edit-bulk",32),s.Vb("updated",(function(){return s.vc(t),s.Zb(4).updateData()})),s.Nb()}if(2&t){const t=s.Zb().items,e=s.Zb(3);s.hc("columns",t)("columnsFormArray",e.targetTableForm.controls.table.controls.dexihTableColumns)}}function cr(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-splitdropdown",25),s.Vb("buttonClick",(function(){return s.vc(t),s.Zb(3).newColumn(null)})),s.Ob(1,"li"),s.Ob(2,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.AutoIncrement)})),s.Fc(3,"Add Auto Incrementing Key Column"),s.Nb(),s.Nb(),s.Ob(4,"li"),s.Ob(5,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.ValidFromDate)})),s.Fc(6,"Add Valid from Date"),s.Nb(),s.Nb(),s.Ob(7,"li"),s.Ob(8,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.ValidToDate)})),s.Fc(9,"Add Valid to Date"),s.Nb(),s.Nb(),s.Ob(10,"li"),s.Ob(11,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.IsCurrentField)})),s.Fc(12,"Add Is Current Column"),s.Nb(),s.Nb(),s.Ob(13,"li"),s.Ob(14,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.CreateAuditKey)})),s.Fc(15,"Add Create Audit Key"),s.Nb(),s.Nb(),s.Ob(16,"li"),s.Ob(17,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.UpdateAuditKey)})),s.Fc(18,"Add Update Audit Key"),s.Nb(),s.Nb(),s.Ob(19,"li"),s.Ob(20,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.CreateDate)})),s.Fc(21,"Add Create Date"),s.Nb(),s.Nb(),s.Ob(22,"li"),s.Ob(23,"a",26),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.newColumn(e.eDeltaType.UpdateDate)})),s.Fc(24,"Add Update Date"),s.Nb(),s.Nb(),s.Nb(),s.Dc(25,lr,1,2,"column-edit-bulk",27),s.Ob(26,"dexih-button",28),s.Vb("click",(function(){return s.vc(t),s.Zb(3).resetColumns()})),s.Fc(27,"Reset All Columns"),s.Nb(),s.Ob(28,"dexih-button-preview",29),s.Vb("click",(function(){return s.vc(t),s.Zb(3).previewData()})),s.Nb(),s.Ob(29,"dexih-button",30),s.Vb("click",(function(){return s.vc(t),s.Zb(3).importTable()})),s.Fc(30," Re-Import "),s.Nb(),s.Ob(31,"dexih-button",31),s.Vb("click",(function(){return s.vc(t),s.Zb(3).createTable()})),s.Fc(32," Drop & Create "),s.Nb()}if(2&t){const t=e.items,a=s.Zb(3);s.yb(25),s.hc("ngIf",a.showBulkEdit&&t.length>0)}}function ur(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-edit",29),s.Vb("click",(function(){s.vc(t);const a=e.item;return s.Zb(3).editColumn(a)})),s.Nb()}}function mr(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button-delete",29),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb(3).deleteColumns(a)})),s.Nb(),s.Ob(1,"dexih-button",33),s.Vb("click",(function(){s.vc(t);const e=s.Zb(3);return e.showBulkEdit=!e.showBulkEdit})),s.Fc(2),s.Nb()}if(2&t){const t=s.Zb(3);s.yb(2),s.Hc("",t.showBulkEdit?"Hide Bulk Edit":"Show Bulk Edit"," ")}}function br(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-button",34),s.Vb("click",(function(){s.vc(t);const a=e.items;return s.Zb(3).addMissing(a)})),s.Fc(1,"Add To Table"),s.Nb()}}function hr(t,e){if(1&t){const t=s.Pb();s.Ob(0,"dexih-widget-section",16),s.Ob(1,"dexih-table",17),s.Vb("onSortChanged",(function(e){return s.vc(t),s.Zb(2).columnSortChange(e)}))("rowClick",(function(e){return s.vc(t),s.Zb(2).editColumn(e)})),s.Dc(2,cr,33,1,"ng-template",null,18,s.Ec),s.Dc(4,ur,1,0,"ng-template",19,20,s.Ec),s.Dc(6,mr,3,1,"ng-template",21,22,s.Ec),s.Nb(),s.Nb(),s.Ob(8,"dexih-widget-section",23),s.Ob(9,"dexih-table",24),s.Dc(10,br,2,0,"ng-template",21,22,s.Ec),s.Nb(),s.Nb()}if(2&t){const t=s.Zb(2);s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("enableSort",!1)("enableFilter",!1)("columns",t.columns)("dataObservable",t.tableData)("enableStickyToolbar",!0)("toolbarZIndex",100),s.yb(7),s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableFilter",!1)("columns",t.columns)("dataObservable",t.missingColumnsData)("enableStickyToolbar",!0)("toolbarZIndex",100)}}function dr(t,e){if(1&t&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,ar,7,2,"ng-template",null,2,s.Ec),s.Dc(4,or,6,6,"form",3),s.Nb(),s.Dc(5,sr,1,2,"dexih-table-edit-properties",4),s.Dc(6,hr,12,18,"ng-template",5),s.Nb()),2&t){const t=s.Zb();s.yb(1),s.hc("showExpandButton",!0),s.yb(3),s.hc("ngIf",t.targetTableForm),s.yb(1),s.hc("ngIf",t.tableFormService.currentForm.value),s.yb(1),s.hc("ngIf",null==t.targetTableForm?null:t.targetTableForm.controls.table.value)}}function pr(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div"),s.Ob(1,"column-edit",35),s.Vb("isUpdated",(function(){return s.vc(t),s.Zb().columnUpdated()})),s.Nb(),s.Nb()}if(2&t){const t=s.Zb();s.yb(1),s.hc("columnKey",t.columnKey)("tableForm",t.targetTableForm.controls.table)("deltaType",t.deltaType)}}let fr=(()=>{class t{constructor(t,e,a,n,i,r){this.hubService=t,this.authService=e,this.editDatalinkService=a,this.route=n,this.router=i,this.fb=r,this.cancelToken=new C.a,this.eMappingStatus=y.k,this.eDeltaType=o.qb,this.eUpdateStrategy=o.qc,this.updateStrategies=y.y,this.eTransformWriterMethod=o.nc,this.loadStrategies=y.q,this.showTableProperties=!1,this.showColumn=!1,this.ignoreUpdateTable=!1,this.nodes=[],this.newTable=!1,this.showBulkEdit=!1,this.canExit=!1,this.logger=new c.a("datalink-edit-target-table"),this.columns=[{name:"position",title:"#",format:""},{name:"columnStatus",title:"Lineage",format:"Html"},{name:"name",title:"Name",format:""},{name:"logicalName",title:"Logical",format:""},{name:"dataType",title:"Data Type",format:""},{name:"deltaType",title:"Delta Type",format:""},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"defaultValue",title:"Default Value",format:""},{name:"securityFlag",title:"Security Flag",format:"Enum",enum:o.Zb},{name:"columnValidation",title:"Validation",format:"",class:"columnValidationClass",tooltip:"columnValidationTooltip"}],this._tableData=new m.a(null),this.tableData=this._tableData.asObservable(),this._missingColumnsData=new m.a(null),this.missingColumnsData=this._missingColumnsData.asObservable(),this.tableFormService=new h.a(r,t,e)}ngOnInit(){this.logger.LogC(()=>"ngOnInit",c.b.Trace);try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe(t=>{let e=t[0],a=t[1];this.hubCache=t[2],this.datalinkForm=t[3],this.action=e.action,this.pageTitle=e.pageTitle;const n=new u.b;if(this.inputColumns=n.getDatalinkOutputColumns(this.datalinkForm.value),"edit"===this.action){this.targetKey=+a.targetKey;let t=this.datalinkForm.controls.dexihDatalinkTargets.controls.find(t=>t.value.key===this.targetKey);if(t&&t.controls.key.value<=0&&(this.newTable=!0),void 0===t)return this.canExit=!0,void this.authService.navigateUp();this.targetTableForm=this.editDatalinkService.hubFormsService.datalinkTargetFormGroup(t.value,t.controls.table.value)}else if("new"===this.action){let t=new o.s;t.key=this.hubCache.getNextSequence(),this.targetTableForm=this.editDatalinkService.hubFormsService.datalinkTargetFormGroup(t)}else this.hubService.addHubErrorMessage("Invalid action "+this.action);this.hubCache.isLoaded()&&this.datalinkForm&&(this.connectionTables=this.hubCache.getConnectionTables(),this.managedConnections=this.hubCache.getManagedConnections(),this.updateData(),this.resetSubscription(),this.logger.LogC(()=>"ngOnInit - completed",c.b.Trace)),this._saveSubscription&&this._saveSubscription.unsubscribe(),this._saveSubscription=this.editDatalinkService.savingDatalink.subscribe(t=>{t&&this.apply()})})}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Target Table")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._loadStrategySubscription&&this._loadStrategySubscription.unsubscribe(),this._tableFormSubscription&&this._tableFormSubscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe()}canDeactivate(){return new Promise(t=>{var e;!this.canExit&&(null===(e=this.targetTableForm)||void 0===e?void 0:e.dirty)?this.authService.confirmDialog("Target Table Changed","The table has changed.  Would you like to discard the changes and return to the previous screen?  Otherwise, use the apply button to save the changes.").then(e=>{t(e)}).catch(e=>{t(!1)}):t(!0)})}resetSubscription(){this._tableFormSubscription&&this._tableFormSubscription.unsubscribe(),this._tableFormSubscription=this.targetTableForm.controls.tableKey.valueChanges.subscribe(()=>{this.updateData()})}previewData(){this.router.navigate(["preview-table-data",this.targetTableForm.controls.tableKey.value],{relativeTo:this.route})}columnStatus(t,e){const a=new u.a(u.c.TargetTable,u.d.Target,this.datalinkForm.value,null,e,null,null,y.k.NotMapped,this.hubCache).createDatalinkLineage(!0),n=y.p.find(t=>t.key===a);if(n)return`<i class="${n.statusClass}"></i>&nbsp;${n.name}`}datalinkColumnStatus(t,e){const a=new u.a(u.c.TargetTable,u.d.Target,this.datalinkForm.value,e,null,null,null,y.k.NotMapped,this.hubCache).createDatalinkLineage(!0),n=y.p.find(t=>t.key===a);if(n)return`<i class="${n.statusClass}"></i>&nbsp;${n.name}`}addNodeColumns(t,e){e||(this.nodes=[]),t&&t.filter(t=>t.dataType===o.pc.Node&&t.isValid).forEach(t=>{let a=e?e+"."+t.logicalName:t.logicalName;this.nodes.push({key:t.key,name:a}),t.childColumns&&t.childColumns.length>0&&this.addNodeColumns(t.childColumns,a)})}updateData(){if(this.ignoreUpdateTable)return;this.logger.LogC(()=>"updateData started",c.b.Trace),this.showBulkEdit=!1;let t=this.editDatalinkService.getValidationTransform();if(this.tableFormService.startForm(this.targetTableForm.controls.table),this.targetTableForm.controls.table)if(this.targetTableForm.controls.table.value){const e=this.targetTableForm.controls.table.value;this.logger.LogC(()=>"updateData targetTable "+e.name,c.b.Trace);let a=[];e.dexihTableColumns.filter(t=>t.isValid).sort((t,e)=>t.position-e.position).forEach(n=>{let i=y.i.find(t=>t.key===n.deltaType),r={key:n.key,position:n.position,columnStatus:this.columnStatus(e,n),name:n.name,dataType:this.hubCache.dataTypeToString(n),deltaType:i?i.name:"Not specified",allowDbNull:n.allowDbNull,logicalName:n.logicalName,isIncrementalUpdate:n.isIncrementalUpdate,securityFlag:n.securityFlag,defaultValue:n.defaultValue,columnValidation:this.hubCache.getColumnValidation(n.columnValidationKey).name,columnValidationClass:n.columnValidationKey&&!t?"dexih-error-icon":"",columnValidationTooltip:n.columnValidationKey&&!t?"Enabled the validation transform for this to function":""};a.push(r)}),this._tableData.next(a);let n=this.validColumns();if(n){this.addNodeColumns(n,"");let t=[],a=0;n.forEach(n=>{if(e.dexihTableColumns.findIndex(t=>t.name===n.name)<0&&t.findIndex(t=>t.name===n.name)<0){let i=y.i.find(t=>t.key===n.deltaType),r={key:n.key,position:n.position+a,columnStatus:this.datalinkColumnStatus(e,n),name:n.name,dataType:this.hubCache.dataTypeToString(n),deltaType:i?i.name:"Not specified",allowDbNull:n.allowDbNull,logicalName:n.logicalName,isIncrementalUpdate:n.isIncrementalUpdate,securityFlag:n.securityFlag,defaultValue:n.defaultValue,columnValidation:""};t.push(r)}a+=1e3}),this._missingColumnsData.next(t)}this.logger.LogC(()=>"updateData columns loaded",c.b.Trace)}else this.logger.LogC(()=>"updateData no targetTable specified.",c.b.Trace),this._tableData.next(null);else this._tableData.next(null)}validColumns(){let t=this.inputColumns;return this.targetTableForm.controls.nodeDatalinkColumn&&this.targetTableForm.controls.nodeDatalinkColumn.value&&(t=(new u.b).validColumns(this.targetTableForm.controls.nodeDatalinkColumn.value.key,this.inputColumns)),t}addMissing(t){this.logger.LogC(()=>"addMissing started",c.b.Trace);const e=this.targetTableForm.controls.table,a=this.validColumns();if(e&&a){const n=e.controls.dexihTableColumns;t.forEach(t=>{let i=null;if(a.forEach(e=>{i||t.key!==e.key||(i=e)}),i){const t=new o.I;Object.assign(t,i),this.resetColumnKeys(t);let a=n.controls.map(t=>t.value.position),r=0===a.length?0:Math.max(...a)+1;t.position=r;const s=this.editDatalinkService.hubFormsService.tableColumn(n.value,t);n.push(s),e.markAsDirty(),this.targetTableForm.markAsDirty()}}),this.updateData()}this.logger.LogC(()=>"addMissing completed",c.b.Trace)}resetColumnKeys(t){t.key=this.hubCache.getNextSequence(),t.childColumns&&t.childColumns.forEach(t=>this.resetColumnKeys(t))}toggleNewTable(){if(this.logger.LogC(()=>"newTable started",c.b.Trace),this.newTable){const t=new o.H;this.targetTableForm.setControl("table",this.editDatalinkService.hubFormsService.tableForm(t)),this.targetTableForm.controls.tableKey.setValue(0),this.resetSubscription(),this.addMissing(this._missingColumnsData.value),this.showTableProperties=!0}this.logger.LogC(()=>"newTable completed",c.b.Trace)}editColumn(t){this.columnKey=t.key,this.showColumn=!0}newColumn(t){if(null!==t){const e=this.targetTableForm.controls.table,a=e.controls.dexihTableColumns;let n=this.hubCache.newColumn(e.value,t);if(null===n)return void this.authService.informationDialog("Invalid column.",`The column ${t} could not be added as it already exists.`);const i=this.editDatalinkService.hubFormsService.tableColumn(a.value,n);a.push(i),e.markAsDirty(),this.targetTableForm.markAsDirty()}else this.columnKey=null,this.deltaType=t,this.showColumn=!0}resetColumns(){return t=this,void 0,a=function*(){if(yield this.authService.confirmDialog("Warning reset columns","This will remove and reload all the columns in this table using the last mapped outputs.  Continue?")){const t=this.targetTableForm.controls.table.controls.dexihTableColumns;for(;0!==t.length;)t.removeAt(0)}this.addMissing(this.validColumns())},new((e=void 0)||(e=Promise))((function(n,i){function r(t){try{s(a.next(t))}catch(e){i(e)}}function o(t){try{s(a.throw(t))}catch(e){i(e)}}function s(t){var a;t.done?n(t.value):(a=t.value,a instanceof e?a:new e((function(t){t(a)}))).then(r,o)}s((a=a.apply(t,[])).next())}));var t,e,a}deleteColumns(t){t.forEach(t=>{const e=this.targetTableForm.controls.table,a=e.controls.dexihTableColumns,n=a.controls.findIndex(e=>e.value.key===t.key);n>=0&&(a.removeAt(n),e.markAsDirty())}),this.updateData()}importTable(){const t=this.targetTableForm.controls.table.value;this.hubCache.getConnection(t.connectionKey),this.hubService.importTables([t],!1,this.cancelToken).then(t=>{if(!t||0===t.length)return;const e=t[0];e.useLogical=this.hubCache.defaultTableLogicalName(e.schema,e.name)!==e.logicalName;let a=this.editDatalinkService.hubFormsService.tableForm(e);this.targetTableForm.controls.tableKey.setValue(e.key),this.targetTableForm.setControl("table",a)}).catch(t=>{})}createTable(){const t=this.targetTableForm.controls.table.value;this.hubCache.getConnection(t.connectionKey),this.hubService.createTables([t],this.cancelToken).then(t=>{this.hubService.addHubSuccessMessage("The table was created successfully.")}).catch(t=>{})}columnSortChange(t){this.logger.LogC(()=>"columns sort change - started ",c.b.Trace),this.tableFormService.IgnoreFormChange=!0,this.editDatalinkService.hubFormsService.IgnoreFormChange=!0,this.ignoreUpdateTable=!0;const e=this.targetTableForm.controls.table;let a=e.controls.dexihTableColumns,n=1;t.forEach(t=>{a.controls.find(e=>e.value.key===t.key).controls.position.setValue(n++)}),e.markAsDirty(),this.editDatalinkService.hubFormsService.IgnoreFormChange=!1,this.tableFormService.IgnoreFormChange=!1,this.ignoreUpdateTable=!1,this.updateData(),this.logger.LogC(()=>"columns sort change - finished ",c.b.Trace)}columnUpdated(){this.showColumn=!1,this.updateData()}saveTable(){this.hubService.saveTables([this.targetTableForm.controls.table.value]).then(t=>{let e=t[0];this.targetTableForm.setControl("table",this.editDatalinkService.hubFormsService.tableForm(e)),this.targetTableForm.controls.tableKey.setValue(e.key),this.resetSubscription(),this.editDatalinkService.hubFormsService.save(!1)})}apply(){if(this.targetTableForm.dirty){let t=this.datalinkForm.controls.dexihDatalinkTargets,e=t.length;"edit"===this.action&&(e=t.controls.findIndex(t=>t.value.key===this.targetKey),t.removeAt(e)),t.insert(e,this.targetTableForm),t.markAsDirty(),this.canExit=!0,this.authService.navigateUp()}}}return t.\u0275fac=function(e){return new(e||t)(s.Kb(l.a),s.Kb(b.a),s.Kb(d),s.Kb(i.a),s.Kb(i.e),s.Kb(g.g))},t.\u0275cmp=s.Eb({type:t,selectors:[["dexih-datalink-edit-target-table"]],decls:2,vars:2,consts:[[4,"ngIf"],["title","Edit Target Table",3,"showExpandButton"],["header",""],[3,"formGroup",4,"ngIf"],[3,"formsService","isExpanded",4,"ngIf"],[3,"ngIf"],[1,"mr-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-refresh","title","Re-import table from connection.",1,"mr-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-bullseye","title","Drop & re-create the table on the connection.  Warning: This remove all data from the table!",1,"mr-1",3,"click"],[1,"mr-1",3,"disabled","click"],[3,"formsService"],[3,"formGroup"],["label","Create a new table",3,"ngModelOptions","ngModel","ngModelChange"],["label","Target Table","formControlName","tableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the target table",3,"items"],["label","Node level","formControlName","nodeDatalinkColumn","itemKey","key","itemName","name","node","Specify the node where the transform should be applied to.","selectNullMessage","Use top level",3,"items","enableKeySelect","allowNullSelect"],[3,"formsService","isExpanded"],["title","Columns",3,"showExpandButton","padding"],[3,"enableMultiSelect","enableManualSort","enableSort","enableFilter","columns","dataObservable","enableStickyToolbar","toolbarZIndex","onSortChanged","rowClick"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["title","Unused Columns",3,"showExpandButton","padding"],["sortColumn","position",3,"enableMultiSelect","enableFilter","columns","dataObservable","enableStickyToolbar","toolbarZIndex"],["text","Add Column","title","Create a new column","iconClass","fa fa-plus-square","buttonClass","btn-primary",3,"buttonClick"],[1,"dropdown-item",3,"click"],[3,"columns","columnsFormArray","updated",4,"ngIf"],["iconClass","fa fa-retweet",1,"ml-1",3,"click"],[1,"ml-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-refresh","title","Re-import table from connection.",1,"ml-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-bullseye","title","Drop & re-create the table on the connection.  Warning: This remove all data from the table!",1,"ml-1",3,"click"],[3,"columns","columnsFormArray","updated"],["iconClass","fa fa-th-list",1,"ml-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-plus-square","title","Add selected outputs to the target table",3,"click"],[3,"columnKey","tableForm","deltaType","isUpdated"]],template:function(t,e){1&t&&(s.Dc(0,dr,7,4,"div",0),s.Dc(1,pr,2,3,"div",0)),2&t&&(s.hc("ngIf",!e.showColumn),s.yb(1),s.hc("ngIf",e.showColumn))},directives:[n.t,p.T,p.q,p.f,p.a,D.a,g.I,g.t,g.l,p.A,g.s,g.v,p.E,g.j,Xi.a,R.a,p.w,tr.a,p.j,p.g,er.a],encapsulation:2}),t})();const gr=[{path:"",redirectTo:"properties"},{path:"properties",component:v,data:{pageTitle:"Properties",help:"datalink.md"}},{path:"source-table",data:{pageTitle:"Source Table"},children:[{path:"",pathMatch:"full",component:ot},{path:"preview-table-data/table/:tableKey",component:Ni,data:{pageTitle:"Preview Table",action:"preview"}},{path:"preview-table-data/datalink/:datalinkKey",component:Ni,data:{pageTitle:"Preview Datalink",action:"preview"}},{path:"column/:datalinkColumnKey",component:Ui,data:{pageTitle:"Edit Column",action:"edit"}},{path:"newcolumn",component:Ui,data:{pageTitle:"New Column",action:"new"}},{path:"table-edit/:tableKey",data:{pageTitle:"Edit Table",action:"edit"},loadChildren:()=>a.e(0).then(a.bind(null,"gQFH")).then(t=>t.TableEditModule)}]},{path:"target",data:{breadCrumb:!0,pageTitle:"Targets"},children:[{path:"",pathMatch:"full",component:dt},{path:"table-edit/:targetKey",data:{pageTitle:"Edit Target Table",action:"edit"},children:[{path:"",pathMatch:"full",canDeactivate:[yi],component:fr},{path:"preview-table-data/:tableKey",component:Ni,data:{pageTitle:"Preview Table",action:"preview"}}]},{path:"table-new",data:{pageTitle:"New Target Table",action:"new"},children:[{path:"",pathMatch:"full",canDeactivate:[yi],component:fr},{path:"preview-table-data/:tableKey",component:Ni,data:{pageTitle:"Preview Table",action:"preview"}}]}]},{path:"transforms",component:Gi,data:{pageTitle:"Transforms"},children:[{path:"new/:position",component:ji,data:{pageTitle:"New Transform"}},{path:"transform/:datalinkTransformKey",data:{pageTitle:"Transform"},children:[{path:"",pathMatch:"full",component:da},{path:"table-edit/:tableKey",data:{pageTitle:"Edit Table",action:"edit"},loadChildren:()=>a.e(0).then(a.bind(null,"gQFH")).then(t=>t.TableEditModule)},{path:"standard-function-edit",data:{pageTitle:"Standard Function"},canDeactivate:[yi],component:An},{path:"standard-function-edit/:functionType",data:{pageTitle:"Standard Function"},canDeactivate:[yi],component:An},{path:"standard-function-edit/:functionType/:datalinkTransformItemKey",data:{pageTitle:"Standard Function"},canDeactivate:[yi],component:An},{path:"custom-function-edit",data:{pageTitle:"Custom Function",help:"function.md"},canDeactivate:[yi],component:ci},{path:"custom-function-edit/:functionType",data:{pageTitle:"Custom Function",help:"function.md"},canDeactivate:[yi],component:ci},{path:"custom-function-edit/:functionType/:datalinkTransformItemKey",data:{pageTitle:"Custom Function",help:"function.md"},canDeactivate:[yi],component:ci},{path:"mapping-edit/:type",data:{pageTitle:"Mapping Edit"},component:vi},{path:"mapping-edit/:type/:datalinkTransformItemKey",data:{pageTitle:"Mapping Edit"},component:vi},{path:"unGroup-edit",data:{pageTitle:"Un-Group Edit"},component:Yi},{path:"unGroup-edit/:datalinkTransformItemKey",data:{pageTitle:"Un-Group Edit"},component:Yi},{path:"preview-transform-data",data:{pageTitle:"Preview Data"},component:Fi},{path:"transform-table-edit",data:{pageTitle:"Transform Table Edit"},component:Pi},{path:"column/:datalinkColumnKey",component:Ui,data:{pageTitle:"Edit Column",action:"edit"}}]}]},{path:"validation",data:{pageTitle:"Validation"},children:[{path:"",pathMatch:"full",component:Fa,data:{pageTitle:"Validation"}},{path:"standard-function-edit",data:{pageTitle:"Standard Function"},canDeactivate:[yi],component:An},{path:"standard-function-edit/:functionType",data:{pageTitle:"Standard Function"},canDeactivate:[yi],component:An},{path:"standard-function-edit/:functionType/:datalinkTransformItemKey",data:{pageTitle:"Standard Function"},canDeactivate:[yi],component:An},{path:"custom-function-edit",data:{pageTitle:"Custom Function"},canDeactivate:[yi],component:ci},{path:"custom-function-edit/:functionType",data:{pageTitle:"Custom Function"},canDeactivate:[yi],component:ci},{path:"column/:datalinkColumnKey",component:Ui,data:{pageTitle:"Edit Column",action:"edit"}}]},{path:"profile-rules",component:ga,data:{pageTitle:"Profile Rules"}},{path:"run-plan",component:Da,data:{pageTitle:"Run Plan"}},{path:"result-view/:auditConnectionKey/:auditKey",component:qi.b,data:{pageTitle:"Detailed Result"}}],kr=i.i.forChild([{path:"new",component:G,canDeactivate:[yi],data:{action:"new",navigateSkip:!0,pageTitle:"New Datalink"},children:gr},{path:"edit/:datalinkKey",component:G,canDeactivate:[yi],data:{action:"edit",navigateSkip:!0,pageTitle:"Edit Datalink"},children:gr},{path:"copy/:datalinkKey",component:G,canDeactivate:[yi],data:{action:"copy",navigateSkip:!0,pageTitle:"Copy Datalink"},children:gr},{path:"sourceTable/:sourceTableKey",component:G,canDeactivate:[yi],data:{action:"sourceTable",navigateSkip:!0,pageTitle:"Edit Datalink"},children:gr}]);var vr=a("PCNd"),yr=a("RRRx"),Tr=a("vSNy"),Cr=a("mCXf");let Fr=(()=>{class t{static forRoot(){return{ngModule:t,providers:[d,h.a]}}}return t.\u0275mod=s.Ib({type:t}),t.\u0275inj=s.Hb({factory:function(e){return new(e||t)},providers:[d,h.a,yi],imports:[[vr.a,n.c,g.n,g.C,kr,yr.a,Tr.a,Cr.a]]}),t})()}}]);
//# sourceMappingURL=14-es2015.79fc01d828f369459841.js.map