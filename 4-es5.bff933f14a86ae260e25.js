function _createForOfIteratorHelper(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{geWG:function(e,t,a){"use strict";a.r(t),a.d(t,"DatajobEditModule",(function(){return de}));var n=a("ofXK"),i=a("tyNb"),r=a("2v7R"),o=a("4Y1E"),s=a("ElCs"),c=a("itXk"),l=a("cvPx"),u=a("fXoL"),d=a("Wumg"),b=a("iFLP"),h=a("64E1"),f=a("oLr2");function m(e,t){if(1&e&&u.Lb(0,"save-button",5),2&e){var a=u.Zb(2);u.hc("formsService",a.formsService)}}function p(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-invalid-form-details",3),u.Vb("click",(function(){return u.vc(a),u.Zb().formsService.showErrors()})),u.Nb(),u.Dc(1,m,1,1,"save-button",4),u.Lb(2,"cancel-button",5)}if(2&e){var n=u.Zb();u.hc("control",n.formsService.currentForm),u.yb(1),u.hc("ngIf",null==n.hubCache?null:n.hubCache.canWrite),u.yb(1),u.hc("formsService",n.formsService)}}var v,g=((v=function(){function e(t,a,n,i,r){_classCallCheck(this,e),this.hubService=t,this.formsService=a,this.authService=n,this.route=i,this.router=r,this.isLoaded=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(c.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(!0)).subscribe((function(t){var a=t[0];e.params=t[1],e.hubCache=t[2],e.action=a.action,e.pageTitle=a.pageTitle,e.hubCache&&e.hubCache.status===r.j.Loaded&&(e.isLoaded&&"new"===e.action||(e.isLoaded&&e.formsService.hasChanged?e.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then((function(t){t&&e.load()})).catch((function(e){})):e.load()))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datajob Edit")}}},{key:"ngOnDestroy",value:function(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this.formsService.ngOnDestroy()}},{key:"load",value:function(){var e,t=this;if(this.isLoaded=!0,"edit"===this.action)if(this.datajobKey=+this.params.datajobKey,this.datajobKey)if(this.hubCache.hub&&this.hubCache.hub.dexihDatajobs){var a=this.hubCache.hub.dexihDatajobs.find((function(e){return e.key===t.datajobKey}));a?this.formsService.datajob(a):this.hubService.addHubErrorMessage("The specified datajob could not be found.")}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no datajob specified to edit.");"new"===this.action&&(this.hubService.newDatajob?(e=this.hubService.newDatajob,this.hubService.newDatajob=null):(e=this.hubService.createDefaultDatajob()).key=0,this.formsService.datajob(e),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe((function(e){var a=e.controls.key.value;if(a&&history.pushState){var n=window.location.pathname.replace("/datajob-new","/datajob-edit/"+a);t.router.navigateByUrl(n),t._formChangeSubscription.unsubscribe()}})))}},{key:"canDeactivate",value:function(){var e=this;return new Promise((function(t){e.formsService.hasChanged?e.authService.confirmDialog("The data job has not been saved","The datajob changes have not been saved.  Do you want to discard the changes and exit?").then((function(e){t(e)})).catch((function(){t(!1)})):t(!0)}))}},{key:"unloadNotification",value:function(e){this.formsService.hasChanged&&(e.returnValue="The datajob changes have not been saved.  Do you want to discard the changes and exit?")}}]),e}()).\u0275fac=function(e){return new(e||v)(u.Kb(o.a),u.Kb(l.a),u.Kb(s.a),u.Kb(i.a),u.Kb(i.e))},v.\u0275cmp=u.Eb({type:v,selectors:[["dexih-datajob-edit-form"]],hostBindings:function(e,t){1&e&&u.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,u.uc)},decls:6,vars:0,consts:[[1,"container"],["title","Edit Job","iconClass","fa fa-lg fa-fw fa-cog"],["header",""],[1,"mr-1",3,"control","click"],["class","mr-1",3,"formsService",4,"ngIf"],[1,"mr-1",3,"formsService"]],template:function(e,t){1&e&&(u.Ob(0,"div",0),u.Ob(1,"dexih-widget",1),u.Dc(2,p,3,3,"ng-template",null,2,u.Ec),u.Ob(4,"div"),u.Lb(5,"router-outlet"),u.Nb(),u.Nb(),u.Nb())},directives:[d.P,i.j,b.a,n.t,h.a,f.a],encapsulation:2}),v),y=a("2Vo4"),k=a("soiQ"),S=a("H3K+"),C=a("3Pt+"),D=a("qMYE"),O=a("YcGA");function x(e,t){if(1&e&&(u.Ob(0,"form",14),u.Ob(1,"fieldset"),u.Ob(2,"section"),u.Lb(3,"form-input",15),u.Nb(),u.Ob(4,"section"),u.Lb(5,"form-textarea",16),u.Nb(),u.Ob(6,"section"),u.Lb(7,"form-select",17),u.Nb(),u.Ob(8,"section"),u.Lb(9,"form-select",18),u.Nb(),u.Ob(10,"section"),u.Ob(11,"form-select",19),u.Lb(12,"connection-edit-button",20),u.Nb(),u.Nb(),u.Ob(13,"section",21),u.Lb(14,"form-checkbox",22),u.Nb(),u.Ob(15,"section",21),u.Lb(16,"form-checkbox",23),u.Nb(),u.Nb(),u.Nb()),2&e){var a=u.Zb();u.hc("formGroup",a.mainForm),u.yb(3),u.hc("autocapitalize",!0)("errors",a.formService.formErrors.name),u.yb(2),u.hc("showMarkdown",!0)("errors",a.formService.formErrors.description),u.yb(2),u.hc("items",a.failActions)("errors",a.formService.formErrors.failAction)("enableFilter",!1),u.yb(2),u.hc("items",a.eAlertLevelItems)("errors",a.formService.formErrors.alertLevel)("enableFilter",!1),u.yb(2),u.hc("items",a.managedConnections)("errors",a.formService.formErrors.auditConnectionKey)("errors",a.formService.formErrors.auditConnectionKey),u.yb(1),u.hc("key",a.mainForm.controls.auditConnectionKey.value)}}function T(e,t){if(1&e&&u.Lb(0,"input-parameters",24),2&e){var a=u.Zb();u.hc("showEdit",!0)("parameters",null==a.mainForm?null:a.mainForm.controls.parameters)("formsService",a.formService)}}function N(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-delete",25),u.Vb("click",(function(){u.vc(a);var e=t.items;return u.Zb().deleteTriggers(e)})),u.Nb()}}function w(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-edit",25),u.Vb("click",(function(){u.vc(a);var e=t.item;return u.Zb().editTrigger(e)})),u.Nb()}}function F(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-new",26),u.Vb("click",(function(){return u.vc(a),u.Zb().newTrigger()})),u.Nb()}}function E(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button",27),u.Vb("click",(function(){u.vc(a);var e=t.items;return u.Zb().updateDependencies(e)})),u.Nb(),u.Ob(1,"dexih-button",28),u.Vb("click",(function(){u.vc(a);var e=t.items;return u.Zb().clearDependencies(e)})),u.Nb(),u.Ob(2,"dexih-button-delete",29),u.Vb("click",(function(){u.vc(a);var e=t.items;return u.Zb().deleteDatalinkSteps(e)})),u.Nb()}}function K(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-edit",30),u.Vb("click",(function(){u.vc(a);var e=t.item;return u.Zb().editDatalinkStep(e)})),u.Nb()}}function W(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-new",31),u.Vb("click",(function(){return u.vc(a),u.Zb().newDatalinkStep()})),u.Nb(),u.Ob(1,"dexih-button",32),u.Vb("click",(function(){return u.vc(a),u.Zb().addDatalinkSteps()})),u.Fc(2,"Add"),u.Nb()}}var _,j=((_=function(){function e(t,a,n,i){_classCallCheck(this,e),this.hubService=t,this.formService=a,this.route=n,this.router=i,this.hasChanged=!1,this.showAllErrors=!1,this.failActions=[{key:k.yb.Continue,name:"Continue Execution"},{key:k.yb.ContinueNonDependent,name:"Continue execution (non dependent datalinks only)"},{key:k.yb.Abend,name:"Abend"}],this.datajobChanged=!1,this.triggerColumns=[{name:"details",title:"Details",format:"Html"},{name:"updateDate",title:"Last Modified",format:"Calendar"},{name:"errors",title:"Errors",format:""}],this._triggerTableData=new y.a(null),this.triggerTableData=this._triggerTableData.asObservable(),this.stepColumns=[{name:"name",title:"Name",format:""},{name:"datalink",title:"Datalink",format:"",tags:"tags"},{name:"dependencies",title:"Dependencies",format:"Html"},{name:"inputs",title:"Inputs",format:"Html"},{name:"updateDate",title:"Last Modified",format:"Calendar"},{name:"errors",title:"Errors",format:""}],this._stepTableData=new y.a(null),this.stepTableData=this._stepTableData.asObservable(),this.eAlertLevelItems=k.bb,this.eAlertLevel=k.ab}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this,t=!0;try{this._subscription=Object(c.a)(this.hubService.getHubCacheObservable(),this.formService.getCurrentFormObservable()).subscribe((function(a){e.hubCache=a[0],e.mainForm=a[1],e.hubCache.isLoaded()&&(e.managedConnections=e.hubCache.getManagedConnections(),e.updateTriggers(),e.updateSteps(),e.mainForm.controls.key.value<=0&&t)&&(t=!1,e.updateDependencies(e.mainForm.controls.dexihDatalinkSteps.value))}))}catch(a){this.hubService.addHubClientErrorMessage(a,"Data Job Edit Properties")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"updateTriggers",value:function(){var e=this,t=[];this.mainForm&&this.mainForm.controls.dexihTriggers.controls.forEach((function(a){var n=a.value;t.push({key:n.key,details:e.hubCache.getTriggerDetails(n),updateDate:n.updateDate,errors:a.valid?"No errors":"Errors"})})),this._triggerTableData.next(t)}},{key:"updateSteps",value:function(){var e=this,t=[];this.mainForm&&this.mainForm.controls.dexihDatalinkSteps.controls.sort((function(e,t){return e.controls.position.value-t.controls.position.value})).forEach((function(a){var n=a.value,i=e.hubCache.hub.dexihDatalinks.find((function(e){return e.key===n.datalinkKey}));t.push({key:n.key,name:n.name,datalinkKey:i.key,datalink:i?i.name:"Not specified",tags:e.hubCache.getObjectTags(k.dc.Datalink,i.key),dependencies:e.getDependencies(n.dexihDatalinkDependencies),inputs:e.getInputs(n.dexihDatalinkStepColumns),updateDate:n.updateDate,errors:a.valid?"No errors":"Errors"})})),this._stepTableData.next(t)}},{key:"stepSortChanged",value:function(e){var t=this.mainForm.controls.dexihDatalinkSteps;e.forEach((function(e,a){var n=t.controls.find((function(t){return t.value.key===e.key}));n&&n.controls.position.setValue(a)}))}},{key:"getDependencies",value:function(e){var t=this,a="";return e&&e.forEach((function(e){var n=t.mainForm.value.dexihDatalinkSteps.find((function(t){return t.key===e.dependentDatalinkStepKey}));n?a=a+n.name+"<br>":a+="Error: step not found.<br>"})),a}},{key:"getInputs",value:function(e){var t="";return e&&e.forEach((function(e){t=t+e.name+" = "+e.defaultValue+"<br>"})),t}},{key:"newTrigger",value:function(){this.router.navigate(["trigger"],{relativeTo:this.route.parent})}},{key:"addDatalinkSteps",value:function(){this.router.navigate(["add-steps"],{relativeTo:this.route.parent})}},{key:"editTrigger",value:function(e){this.router.navigate(["trigger",e.key],{relativeTo:this.route.parent})}},{key:"deleteTriggers",value:function(e){var t=this.mainForm.controls.dexihTriggers;e.forEach((function(e){var a=t.controls.findIndex((function(t){return t.value.key===e.key}));t.removeAt(a)})),this.updateTriggers()}},{key:"newDatalinkStep",value:function(){this.router.navigate(["step"],{relativeTo:this.route.parent})}},{key:"editDatalinkStep",value:function(e){this.router.navigate(["step",e.key],{relativeTo:this.route.parent})}},{key:"deleteDatalinkSteps",value:function(e){var t=this.mainForm.controls.dexihDatalinkSteps;e.forEach((function(e){var a=t.controls.findIndex((function(t){return t.value.key===e.key}));t.removeAt(a)})),this.updateSteps()}},{key:"clearDependencies",value:function(e){var t=this.mainForm.controls.dexihDatalinkSteps;e.forEach((function(e){t.controls.find((function(t){return t.value.key===e.key})).controls.dexihDatalinkDependencies.clear()})),this.updateSteps()}},{key:"updateDependencies",value:function(e){var t=this,a=this.mainForm.controls.dexihDatalinkSteps,n=[],i=-1;a.value.forEach((function(e){n.push({key:e.key,tables:t.getDatalinkTargetTables(e.datalinkKey)})})),e.forEach((function(e){var r=a.controls.find((function(t){return t.value.key===e.key})).controls.dexihDatalinkDependencies;r.clear();var o=t.getDatalinkSourceTables(e.datalinkKey);n.forEach((function(a){var n,s=_createForOfIteratorHelper(a.tables);try{for(s.s();!(n=s.n()).done;){var c=n.value;if(o.indexOf(c)>=0){var l=new k.n;l.key=i,l.datalinkStepKey=e.key,l.dependentDatalinkStepKey=a.key,r.push(t.formService.datalinkDependencyFormGroup(l)),i--;break}}}catch(u){s.e(u)}finally{s.f()}}))})),this.updateSteps()}},{key:"getDatalinkTargetTables",value:function(e){var t=this.hubCache.hub.dexihDatalinks.find((function(t){return t.key===e}));return t?t.dexihDatalinkTargets.map((function(e){return e.tableKey})):[]}},{key:"getDatalinkSourceTables",value:function(e){var t=this,a=this.hubCache.hub.dexihDatalinks.find((function(t){return t.key===e}));if(!a)return[];var n=this.getDatalinkTable(a.sourceDatalinkTable);return a.dexihDatalinkTransforms.forEach((function(e){e.joinDatalinkTable&&t.getDatalinkTable(e.joinDatalinkTable).forEach((function(e){n.indexOf(e)<0&&n.push(e)}))})),n}},{key:"getDatalinkTable",value:function(e){if(!e)return[];switch(e.sourceType){case k.gc.Table:return[e.sourceTableKey];case k.gc.Datalink:return this.getDatalinkSourceTables(e.sourceDatalinkKey)}return[]}}]),e}()).\u0275fac=function(e){return new(e||_)(u.Kb(o.a),u.Kb(l.a),u.Kb(i.a),u.Kb(i.e))},_.\u0275cmp=u.Eb({type:_,selectors:[["dexih-datajob-edit-form"]],decls:20,vars:23,consts:[["title","Properties",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["title","Parameters",3,"showExpandButton","padding"],[3,"showEdit","parameters","formsService",4,"ngIf"],["title","Triggers",3,"showExpandButton","padding"],["sortColumn","position",3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","enableManualSort","columns","dataObservable","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["select","actionsTemplate"],["actions",""],["title","Steps",3,"showExpandButton","padding"],["sortColumn","position",3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","enableManualSort","columns","tags","dataObservable","onSortChanged","rowClick"],[3,"formGroup"],["label","Data Job Name","formControlName","name","placeholder","Enter the job name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["label","Datalink Fail Action","formControlName","failAction","itemKey","key","itemName","name","iconClass","fa fa-database","note","Action to take when a datalink execution fails.",3,"items","errors","enableFilter"],["label","Alerting Level","formControlName","alertLevel","itemKey","key","itemName","description","iconClass","fa fa-bell","note","When alerts should be sent.",3,"items","errors","enableFilter"],["label","Audit Connection","formControlName","auditConnectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the connection where audit data (such as job results) should be written to.",3,"items","errors"],[3,"key"],[1,"col","col-12"],["label","Trigger datajob when new files arrive","formControlName","fileWatch"],["label","Auto Start","formControlName","autoStart","note","Re-activate the datajob when the remote agent is restarted."],[3,"showEdit","parameters","formsService"],[3,"click"],["title","New Trigger",3,"click"],["iconClass","fa fa-magic","text","AutoSet Dependencies",3,"click"],["iconClass","fa fa-eraser","text","Clear Dependencies",1,"ml-1",3,"click"],[1,"ml-1",3,"click"],[1,"mr-1",3,"click"],["title","Create a new step",1,"mr-1",3,"click"],["iconClass","fa fa-plus-square","buttonClass","btn-primary","title","Select multiple datalinks to add as steps",1,"mr-1",3,"click"]],template:function(e,t){1&e&&(u.Ob(0,"dexih-widget-section",0),u.Dc(1,x,17,15,"form",1),u.Nb(),u.Ob(2,"dexih-widget-section",2),u.Dc(3,T,1,3,"input-parameters",3),u.Nb(),u.Ob(4,"dexih-widget-section",4),u.Ob(5,"dexih-table",5),u.Vb("rowClick",(function(e){return t.editTrigger(e)})),u.Dc(6,N,1,0,"ng-template",6,7,u.Ec),u.Dc(8,w,1,0,"ng-template",8,9,u.Ec),u.Dc(10,F,1,0,"ng-template",10,11,u.Ec),u.Nb(),u.Nb(),u.Ob(12,"dexih-widget-section",12),u.Ob(13,"dexih-table",13),u.Vb("onSortChanged",(function(e){return t.stepSortChanged(e)}))("rowClick",(function(e){return t.editDatalinkStep(e)})),u.Dc(14,E,3,0,"ng-template",6,7,u.Ec),u.Dc(16,K,1,0,"ng-template",8,9,u.Ec),u.Dc(18,W,3,0,"ng-template",10,11,u.Ec),u.Nb(),u.Nb()),2&e&&(u.hc("showExpandButton",!0),u.yb(1),u.hc("ngIf",t.mainForm),u.yb(1),u.hc("showExpandButton",!0)("padding",!0)("padding",!0),u.yb(1),u.hc("ngIf",t.mainForm),u.yb(1),u.hc("showExpandButton",!0)("padding",!1),u.yb(1),u.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("enableManualSort",!0)("columns",t.triggerColumns)("dataObservable",t.triggerTableData),u.yb(7),u.hc("showExpandButton",!0)("padding",!1),u.yb(1),u.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("enableManualSort",!0)("columns",t.stepColumns)("tags",t.hubCache.hub.dexihTags)("dataObservable",t.stepTableData))},directives:[d.T,n.t,S.a,C.I,C.t,C.l,d.D,C.s,C.j,d.H,d.E,D.a,d.A,O.a,d.g,d.j,d.o,d.f],encapsulation:2}),_),I=a("l2bN");function M(e,t){if(1&e&&(u.Ob(0,"div",11),u.Fc(1),u.Nb()),2&e){var a=u.Zb();u.yb(1),u.Hc(" ",a.errors," ")}}function A(e,t){if(1&e){var a=u.Pb();u.Ob(0,"small",12),u.Ob(1,"markdown",13),u.Vb("click",(function(e){return u.vc(a),u.Zb().sharedFunctions.getRoute(e)})),u.Nb(),u.Nb()}if(2&e){var n=u.Zb();u.yb(1),u.hc("data",n.note)}}var L,V=["*"],Z=((L=function(){function e(t){_classCallCheck(this,e),this._changeDetectionRef=t,this.eDayOfWeek=k.pb,this.daysOfWeek=new Array(7),this.id="input_"+Math.random().toString(36).substr(2,9),this.onChange=function(){},this.onTouched=function(){}}return _createClass(e,[{key:"ngAfterViewInit",value:function(){var e=this;this.value&&this.value.forEach((function(t){switch(t){case k.pb.Sunday:e.daysOfWeek[0]=!0;break;case k.pb.Monday:e.daysOfWeek[1]=!0;break;case k.pb.Tuesday:e.daysOfWeek[2]=!0;break;case k.pb.Wednesday:e.daysOfWeek[3]=!0;break;case k.pb.Thursday:e.daysOfWeek[4]=!0;break;case k.pb.Friday:e.daysOfWeek[5]=!0;break;case k.pb.Saturday:e.daysOfWeek[6]=!0}})),this._changeDetectionRef.detectChanges()}},{key:"hasChanged",value:function(e){var t=new Array;this.daysOfWeek[0]&&t.push(k.pb.Sunday),this.daysOfWeek[1]&&t.push(k.pb.Monday),this.daysOfWeek[2]&&t.push(k.pb.Tuesday),this.daysOfWeek[3]&&t.push(k.pb.Wednesday),this.daysOfWeek[4]&&t.push(k.pb.Thursday),this.daysOfWeek[5]&&t.push(k.pb.Friday),this.daysOfWeek[6]&&t.push(k.pb.Saturday),this.value=t,this.onChange(this.value),this.onTouched()}},{key:"registerOnChange",value:function(e){this.onChange=e}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"writeValue",value:function(e){e&&(this.value=e)}},{key:"selectWeekend",value:function(){this.daysOfWeek[0]=!0,this.daysOfWeek[1]=!1,this.daysOfWeek[2]=!1,this.daysOfWeek[3]=!1,this.daysOfWeek[4]=!1,this.daysOfWeek[5]=!1,this.daysOfWeek[6]=!0,this.hasChanged(null)}},{key:"selectWeekDays",value:function(){this.daysOfWeek[0]=!1,this.daysOfWeek[1]=!0,this.daysOfWeek[2]=!0,this.daysOfWeek[3]=!0,this.daysOfWeek[4]=!0,this.daysOfWeek[5]=!0,this.daysOfWeek[6]=!1,this.hasChanged(null)}},{key:"selectAllDays",value:function(){this.daysOfWeek[0]=!0,this.daysOfWeek[1]=!0,this.daysOfWeek[2]=!0,this.daysOfWeek[3]=!0,this.daysOfWeek[4]=!0,this.daysOfWeek[5]=!0,this.daysOfWeek[6]=!0,this.hasChanged(null)}},{key:"selectNoDays",value:function(){this.daysOfWeek[0]=!1,this.daysOfWeek[1]=!1,this.daysOfWeek[2]=!1,this.daysOfWeek[3]=!1,this.daysOfWeek[4]=!1,this.daysOfWeek[5]=!1,this.daysOfWeek[6]=!1,this.hasChanged(null)}}]),e}()).\u0275fac=function(e){return new(e||L)(u.Kb(u.h))},L.\u0275cmp=u.Eb({type:L,selectors:[["daysofweek"]],inputs:{label:"label",labelLeft:"labelLeft",note:"note",errors:"errors",value:"value"},features:[u.xb([{provide:C.r,useExisting:Object(u.S)((function(){return L})),multi:!0}])],ngContentSelectors:V,decls:46,vars:25,consts:[[1,"form-group"],[1,"mt-1",3,"for"],[1,"input-group"],[1,"input-group-prepend"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"input-group-append"],[1,"form-check","form-check-inline"],["type","checkbox",1,"form-check-input",3,"id","ngModel","ngModelChange"],[1,"form-check-label",3,"for"],["class","invalid-feedback d-block",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],[1,"invalid-feedback","d-block"],[1,"form-text","text-muted"],[3,"data","click"]],template:function(e,t){1&e&&(u.gc(),u.Ob(0,"div",0),u.Ob(1,"label",1),u.Fc(2),u.Ob(3,"div",2),u.Ob(4,"div",3),u.Ob(5,"a",4),u.Vb("click",(function(){return t.selectAllDays()})),u.Fc(6,"All"),u.Nb(),u.Ob(7,"a",4),u.Vb("click",(function(){return t.selectNoDays()})),u.Fc(8,"None"),u.Nb(),u.Ob(9,"a",4),u.Vb("click",(function(){return t.selectWeekend()})),u.Fc(10,"Weekend"),u.Nb(),u.Nb(),u.Ob(11,"div",5),u.Ob(12,"a",4),u.Vb("click",(function(){return t.selectWeekDays()})),u.Fc(13,"Weekdays"),u.Nb(),u.Nb(),u.Nb(),u.fc(14),u.Nb(),u.Ob(15,"div",2),u.Ob(16,"div",6),u.Ob(17,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[0]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(18,"label",8),u.Fc(19,"Sunday"),u.Nb(),u.Nb(),u.Ob(20,"div",6),u.Ob(21,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[1]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(22,"label",8),u.Fc(23,"Monday"),u.Nb(),u.Nb(),u.Ob(24,"div",6),u.Ob(25,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[2]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(26,"label",8),u.Fc(27,"Tuesday"),u.Nb(),u.Nb(),u.Ob(28,"div",6),u.Ob(29,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[3]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(30,"label",8),u.Fc(31,"Wednesday"),u.Nb(),u.Nb(),u.Ob(32,"div",6),u.Ob(33,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[4]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(34,"label",8),u.Fc(35,"Thursday"),u.Nb(),u.Nb(),u.Ob(36,"div",6),u.Ob(37,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[5]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(38,"label",8),u.Fc(39,"Friday"),u.Nb(),u.Nb(),u.Ob(40,"div",6),u.Ob(41,"input",7),u.Vb("ngModelChange",(function(e){return t.daysOfWeek[6]=e}))("ngModelChange",(function(e){return t.hasChanged(e)})),u.Nb(),u.Ob(42,"label",8),u.Fc(43,"Saturday"),u.Nb(),u.Nb(),u.Nb(),u.Dc(44,M,2,1,"div",9),u.Dc(45,A,2,1,"small",10),u.Nb()),2&e&&(u.yb(1),u.hc("for",t.id),u.yb(1),u.Hc("",t.label," "),u.yb(15),u.hc("id",t.id+"1")("ngModel",t.daysOfWeek[0]),u.yb(1),u.hc("for",t.id+"1"),u.yb(3),u.hc("id",t.id+"2")("ngModel",t.daysOfWeek[1]),u.yb(1),u.hc("for",t.id+"2"),u.yb(3),u.hc("id",t.id+"3")("ngModel",t.daysOfWeek[2]),u.yb(1),u.hc("for",t.id+"3"),u.yb(3),u.hc("id",t.id+"4")("ngModel",t.daysOfWeek[3]),u.yb(1),u.hc("for",t.id+"4"),u.yb(3),u.hc("id",t.id+"5")("ngModel",t.daysOfWeek[4]),u.yb(1),u.hc("for",t.id+"5"),u.yb(3),u.hc("id",t.id+"6")("ngModel",t.daysOfWeek[5]),u.yb(1),u.hc("for",t.id+"6"),u.yb(3),u.hc("id",t.id+"7")("ngModel",t.daysOfWeek[6]),u.yb(1),u.hc("for",t.id+"7"),u.yb(2),u.hc("ngIf",t.errors),u.yb(1),u.hc("ngIf",t.note))},directives:[C.a,C.s,C.v,n.t,I.a],encapsulation:2}),L);function P(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-apply",13),u.Vb("click",(function(){return u.vc(a),u.Zb(2).applyExit()})),u.Nb(),u.Ob(1,"dexih-button-cancel",14),u.Vb("click",(function(){return u.vc(a),u.Zb(2).cancel()})),u.Nb()}if(2&e){var n=u.Zb(2);u.hc("disabled",!n.triggerFormService.hasChanged)}}function B(e,t){if(1&e&&(u.Ob(0,"dexih-widget-section",1),u.Dc(1,P,2,1,"ng-template",null,2,u.Ec),u.Ob(3,"form",3),u.Ob(4,"fieldset"),u.Ob(5,"div",4),u.Ob(6,"section",5),u.Lb(7,"form-date",6),u.Nb(),u.Nb(),u.Ob(8,"div",4),u.Ob(9,"section",7),u.Lb(10,"form-time",8),u.Nb(),u.Ob(11,"section",7),u.Lb(12,"form-input",9),u.Nb(),u.Ob(13,"section",7),u.Lb(14,"form-time",10),u.Nb(),u.Ob(15,"section",7),u.Lb(16,"form-time",11),u.Nb(),u.Nb(),u.Ob(17,"section"),u.Lb(18,"daysofweek",12),u.Nb(),u.Lb(19,"div",4),u.Nb(),u.Nb(),u.Nb()),2&e){var a=u.Zb();u.hc("showExpandButton",!1),u.yb(3),u.hc("formGroup",a.triggerFormService.currentForm),u.yb(4),u.hc("errors",a.triggerFormService.formErrors.startDate),u.yb(3),u.hc("errors",a.triggerFormService.formErrors.intervalTime),u.yb(2),u.hc("errors",a.triggerFormService.formErrors.maxRecurs),u.yb(2),u.hc("errors",a.triggerFormService.formErrors.startTime),u.yb(2),u.hc("errors",a.triggerFormService.formErrors.endTime)}}var H,G=((H=function(){function e(t,a,n,i,r,o,s){_classCallCheck(this,e),this.authService=t,this.hubService=a,this.formService=n,this.route=i,this.router=r,this.location=o,this.fb=s,this.triggerFormService=new l.a(s,a,t)}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(c.a)(this.route.data,this.route.params,this.formService.getCurrentFormObservable()).subscribe((function(t){var a,n=t[0],i=t[1];if(e.mainForm=t[2],e.mainForm){if(e.pageTitle=n.pageTitle,e.action=n.action,e.triggerKey=+i.triggerKey,e.triggerKey){if(e.originalTrigger=e.mainForm.value.dexihTriggers.find((function(t){return t.key===e.triggerKey})),!e.originalTrigger)return void e.authService.navigateUp();a=e.triggerFormService.triggerFormGroup(e.originalTrigger)}else{var r=new k.K,o=-1;e.mainForm.value.dexihTriggers.forEach((function(e){e.key<=o&&(o=e.key-1)})),r.key=o,a=e.triggerFormService.triggerFormGroup(r)}e.triggerFormService.startForm(a)}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datajob Edit Trigger")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"applyExit",value:function(){var e=this.triggerFormService.currentForm,t=this.mainForm.controls.dexihTriggers;this.originalTrigger?t.controls.find((function(t){return t.value.key===e.value.key})).setValue(e.value):t.push(e),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||H)(u.Kb(s.a),u.Kb(o.a),u.Kb(l.a),u.Kb(i.a),u.Kb(i.e),u.Kb(n.n),u.Kb(C.g))},H.\u0275cmp=u.Eb({type:H,selectors:[["datajob-edit-trigger"]],decls:1,vars:1,consts:[["title","Edit Trigger",3,"showExpandButton",4,"ngIf"],["title","Edit Trigger",3,"showExpandButton"],["header",""],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Start Date","formControlName","startDate","note","This is the date that the trigger will start.  Leave blank for immediate start.",3,"errors"],[1,"form-group","col-md-3"],["label","Interval","formControlName","intervalTime","note","The intra-day interval which the trigger restarts.  Leave blank for once a day jobs.",3,"errors"],["type","number","label","Max Recurrences","formControlName","maxRecurs","placeholder","Enter the max recurrences","iconClass","fa fa-refresh","note"," The maximum number of times job can recur in one day.",3,"errors"],["label","Start Time","formControlName","startTime","note","Time of the day the job will activate.",3,"errors"],["label","End Time","formControlName","endTime","note","Time of the day the triggers will deactivate.",3,"errors"],["label","Days of the week","formControlName","daysOfWeek","note"," The days of the week the trigger is valid."],[1,"mr-1",3,"disabled","click"],[3,"click"]],template:function(e,t){1&e&&u.Dc(0,B,20,7,"dexih-widget-section",0),2&e&&u.hc("ngIf",t.triggerFormService.currentForm)},directives:[n.t,d.T,C.I,C.t,C.l,d.B,C.s,C.j,d.I,d.D,Z,d.a,d.b],encapsulation:2}),H),R=a("hJJo");function U(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-apply",10),u.Vb("click",(function(){return u.vc(a),u.Zb(2).applyExit()})),u.Nb(),u.Ob(1,"dexih-button-cancel",11),u.Vb("click",(function(){return u.vc(a),u.Zb(2).cancel()})),u.Nb()}if(2&e){var n=u.Zb(2);u.hc("disabled",!n.stepFormService.hasChanged)}}function J(e,t){if(1&e&&(u.Ob(0,"span",14),u.Ob(1,"div",15),u.Ob(2,"div",16),u.Fc(3),u.Nb(),u.Nb(),u.Lb(4,"form-input",17),u.Nb()),2&e){var a=t.$implicit;u.yb(3),u.Hc(" ",a.value.logicalName," "),u.yb(1),u.hc("placeholder",a.value.logicalName)("autocapitalize",!0)("formControl",a.controls.defaultValue)}}function z(e,t){if(1&e&&(u.Ob(0,"div",12),u.Ob(1,"div"),u.Fc(2," Input Values "),u.Nb(),u.Dc(3,J,5,4,"span",13),u.Nb()),2&e){var a=u.Zb(2);u.yb(3),u.hc("ngForOf",a.stepFormService.currentForm.controls.dexihDatalinkStepColumns.controls)}}function q(e,t){if(1&e&&(u.Ob(0,"dexih-widget-section",3),u.Dc(1,U,2,1,"ng-template",null,4,u.Ec),u.Ob(3,"form",5),u.Ob(4,"fieldset"),u.Ob(5,"section"),u.Lb(6,"form-input",6),u.Nb(),u.Ob(7,"section"),u.Ob(8,"form-select",7),u.Lb(9,"datalink-edit-button",8),u.Nb(),u.Nb(),u.Nb(),u.Dc(10,z,4,1,"div",9),u.Nb(),u.Nb()),2&e){var a=u.Zb();u.hc("showExpandButton",!1),u.yb(3),u.hc("formGroup",a.stepFormService.currentForm),u.yb(3),u.hc("autocapitalize",!0)("errors",a.stepFormService.formErrors.name),u.yb(2),u.hc("items",a.hubCache.hub.dexihDatalinks)("errors",a.stepFormService.formErrors.datalinkKey),u.yb(1),u.hc("key",a.stepFormService.currentForm.controls.datalinkKey.value),u.yb(1),u.hc("ngIf",a.stepFormService.currentForm.controls.dexihDatalinkStepColumns.controls.length>0)}}function X(e,t){if(1&e&&(u.Ob(0,"dexih-widget-section",18),u.Lb(1,"input-parameters",19),u.Nb()),2&e){var a=u.Zb();u.hc("showExpandButton",!0)("padding",!1)("padding",!0),u.yb(1),u.hc("showEdit",!0)("parameters",a.stepFormService.currentForm.controls.parameters)("formsService",a.formService)("parentParameters",a.formService.currentForm.controls.parameters.value)}}function Y(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-table",22),u.Vb("selectedItemsChange",(function(e){return u.vc(a),u.Zb(2).stepFormService.currentForm.value.dexihDatalinkDependencies=e}))("onSelectedChange",(function(e){return u.vc(a),u.Zb(2).dependentStepsChange(e)})),u.Nb()}if(2&e){var n=u.Zb(2);u.hc("enableMultiSelect",!0)("columns",n.stepColumns)("dataObservable",n.stepTableData)("selectedItems",n.stepFormService.currentForm.value.dexihDatalinkDependencies)("tags",n.hubCache.hub.dexihTags)}}function Q(e,t){if(1&e&&(u.Ob(0,"dexih-widget-section",20),u.Dc(1,Y,1,5,"dexih-table",21),u.Nb()),2&e){var a=u.Zb();u.hc("showExpandButton",!1)("padding",!1),u.yb(1),u.hc("ngIf",a.stepFormService.currentForm)}}var $,ee=(($=function(){function e(t,a,n,i,r){_classCallCheck(this,e),this.hubService=t,this.authService=a,this.formService=n,this.route=i,this.showAllErrors=!1,this.stepColumns=[{name:"name",title:"Name",format:"",tags:"tags"},{name:"datalink",title:"Datalink",format:""},{name:"dependencies",title:"Dependencies",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._stepTableData=new y.a(null),this.stepTableData=this._stepTableData.asObservable(),this.stepFormService=new l.a(r,t,a)}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(c.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.formService.getCurrentFormObservable()).subscribe((function(t){var a=t[1];e.hubCache=t[2];var n=t[3];if(e.datalinkStepKey=+a.datalinkStepKey,n){var i;if(e.datajobForm=n,e.datalinkStepKey){if(!(i=n.value.dexihDatalinkSteps.find((function(t){return t.key===e.datalinkStepKey}))))return void e.authService.navigateUp()}else{i=new k.p;var r=-1;e.datajobForm.value.dexihDatalinkSteps.forEach((function(e){e.key<=r&&(r=e.key-1)})),i.key=r,e.datalinkStepKey=r}var o=e.stepFormService.datalinkStepFormGroup(n,i);e.stepFormService.startForm(o),e.updateSteps(),e._datalinkSubscription=o.controls.datalinkKey.valueChanges.subscribe((function(t){e.updateDatalinkStepColumns(t)}))}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datajob Edit Step")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._datalinkSubscription&&this._datalinkSubscription.unsubscribe()}},{key:"updateSteps",value:function(){var e=this,t=[];this.datajobForm.value.dexihDatalinkSteps&&this.datajobForm.value.dexihDatalinkSteps.forEach((function(a){if(a.key!==e.stepFormService.currentForm.value.key){var n=e.hubCache.hub.dexihDatalinks.find((function(e){return e.key===a.datalinkKey}));t.push({key:a.key,name:a.name,datalink:n?n.name:"Not specified",tags:e.hubCache.getObjectTags(k.dc.Datalink,n.key),dependencies:"",updateDate:a.updateDate})}})),this._stepTableData.next(t)}},{key:"updateDatalinkStepColumns",value:function(e){var t=this,a=this.hubCache.hub.dexihDatalinks.find((function(t){return t.key===e})),n=this.stepFormService.currentForm,i=n.controls.parameters,r=i.value;i.clear(),a.parameters.forEach((function(e){var a=r.find((function(t){return t.name===e.name})),n=new k.Q;a?(n.name=a.name,n.value=a.value):(n.name=e.name,n.value=e.value);var o=t.formService.parameter(n);i.push(o)}));for(var o=n.controls.dexihDatalinkStepColumns,s=o.value;0!==o.length;)o.removeAt(0);a.sourceDatalinkTable.dexihDatalinkColumns.filter((function(e){return e.isInput})).forEach((function(e){var a=s.find((function(t){return t.name===e.name}));a||((a=new k.q).defaultValue=e.defaultValue),a.dataType=e.dataType,a.name=e.name,a.logicalName=e.logicalName,a.columnGroup=e.columnGroup,a.rank=e.rank,a.maxLength=e.maxLength,a.deltaType=e.deltaType,a.allowDbNull=e.allowDbNull,a.isUnicode=e.isUnicode,a.isValid=!0;var n=t.formService.datalinkStepColumnFormGroup(a);o.push(n)})),n.controls.name.value||n.controls.name.setValue(a.name)}},{key:"dependentStepsChange",value:function(e){var t=this,a=this.stepFormService.currentForm.controls.dexihDatalinkDependencies,n=-1;for(a&&a.controls.forEach((function(e){e.valid.key<=n&&(n=e.key-1)}));a.length>0;)a.removeAt(0);e.forEach((function(e){var i=a?a.controls.find((function(t){return t.value.datalinkStepKey===e.datalinkStepKey})):null;if(i)a.push(i);else{var r=new k.n;r.key=n,r.datalinkStepKey=t.datalinkStepKey,r.dependentDatalinkStepKey=e.key,a.push(t.stepFormService.datalinkDependencyFormGroup(r)),n--}})),this.stepFormService.hasChanged=!0}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"applyExit",value:function(){var e=this.stepFormService.currentForm,t=this.datajobForm.controls.dexihDatalinkSteps,a=t.controls.findIndex((function(t){return t.value.key===e.value.key&&t.value.isValid}));a<0?t.push(e):(t.removeAt(a),t.insert(a,e)),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||$)(u.Kb(o.a),u.Kb(s.a),u.Kb(l.a),u.Kb(i.a),u.Kb(C.g))},$.\u0275cmp=u.Eb({type:$,selectors:[["datajob-edit-step"]],decls:3,vars:3,consts:[["title","Add Datalink Step",3,"showExpandButton",4,"ngIf"],["title","Parameters",3,"showExpandButton","padding",4,"ngIf"],["title","Dependent Steps",3,"showExpandButton","padding",4,"ngIf"],["title","Add Datalink Step",3,"showExpandButton"],["header",""],[3,"formGroup"],["label","Data Step Name","formControlName","name","placeholder","Enter the step name.","iconClass","fa fa-list","note","Enter a name for the data step, blank will use datalink name.",3,"autocapitalize","errors"],["label","Data Link","formControlName","datalinkKey","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","errors"],[3,"key"],["class","d-flex flex-wrap pt-1",4,"ngIf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"d-flex","flex-wrap","pt-1"],["class","input-group",4,"ngFor","ngForOf"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0",3,"placeholder","autocapitalize","formControl"],["title","Parameters",3,"showExpandButton","padding"],[3,"showEdit","parameters","formsService","parentParameters"],["title","Dependent Steps",3,"showExpandButton","padding"],["keyColumn","key","selectedKeyColumn","dependentDatalinkStepKey",3,"enableMultiSelect","columns","dataObservable","selectedItems","tags","selectedItemsChange","onSelectedChange",4,"ngIf"],["keyColumn","key","selectedKeyColumn","dependentDatalinkStepKey",3,"enableMultiSelect","columns","dataObservable","selectedItems","tags","selectedItemsChange","onSelectedChange"]],template:function(e,t){1&e&&(u.Dc(0,q,11,8,"dexih-widget-section",0),u.Dc(1,X,2,7,"dexih-widget-section",1),u.Dc(2,Q,2,3,"dexih-widget-section",2)),2&e&&(u.hc("ngIf",t.stepFormService.currentForm),u.yb(1),u.hc("ngIf",t.stepFormService.currentForm),u.yb(1),u.hc("ngIf",t.stepFormService.currentForm))},directives:[n.t,d.T,C.I,C.t,C.l,d.D,C.s,C.j,d.E,R.a,d.a,d.b,n.s,C.i,O.a,S.a],encapsulation:2}),$);function te(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button-close",5),u.Vb("click",(function(){return u.vc(a),u.Zb().close()})),u.Nb()}}function ae(e,t){if(1&e){var a=u.Pb();u.Ob(0,"dexih-button",6),u.Vb("click",(function(){u.vc(a);var e=t.items;return u.Zb().addSelected(e)})),u.Fc(1,"Add"),u.Nb()}}var ne,ie,re,oe=((ie=function(){function e(t,a,n,i,r){_classCallCheck(this,e),this.hubService=t,this.authService=a,this.formService=n,this.route=i,this.router=r,this.hasChanged=!1,this.columns=[{name:"name",title:"Name",format:"",tags:"tags"},{name:"datalinkType",title:"Datalink Type",enum:k.nb,format:"Enum"},{name:"sourceTableName",title:"Source Table",format:""},{name:"targetTableName",title:"Target Table",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new y.a(null),this.tableData=this._tableData.asObservable()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(c.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.formService.getCurrentFormObservable()).subscribe((function(t){e.hubCache=t[2],e.mainForm=t[3],e.updateDatalinks()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Index")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}},{key:"changeEvent",value:function(e){this.hasChanged=!0}},{key:"updateDatalinks",value:function(){var e=this;if(this.hubCache)if(this.hubCache.hub.dexihDatalinks){var t=this.hubCache.hub.dexihDatalinks.map((function(t){var a=e.hubCache.getTable(t.sourceDatalinkTable.sourceTableKey);return{key:t.key,name:t.name,datalinkType:t.datalinkType,sourceTableName:a?a.name:"No source table",targetTableName:t.dexihDatalinkTargets.map((function(t){var a=e.hubCache.getTable(t.tableKey);if(a)return a.name})).join(", "),updateDate:t.updateDate,tags:e.hubCache.getObjectTags(k.dc.Datalink,t.key)}}));this._tableData.next(t)}else this._tableData.next(new Array)}},{key:"watchChanges",value:function(){var e=this;this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe((function(t){t.changeClass===k.dc.Datalink&&e.updateDatalinks()}))}},{key:"close",value:function(){this.authService.navigateUp()}},{key:"addSelected",value:function(e){var t=this,a=new Array,n=this.mainForm.value.dexihDatalinkSteps;if(e.forEach((function(e){n.find((function(t){return t.datalinkKey===e.key}))&&a.push(e.name)})),a.length>0){var i=a.join(", ");this.authService.confirmDialog("Warning duplicate datalinks","The following datalinks already exist as steps within the job.  "+i+".<br />Are you sure you want these datalinks added to the job").then((function(a){a&&t.addSelectedConfirmed(e)})).catch((function(e){}))}else this.addSelectedConfirmed(e)}},{key:"addSelectedConfirmed",value:function(e){var t=this,a=this.mainForm.value.dexihDatalinkSteps,n=-1;a.forEach((function(e){e.key<=n&&(n=e.key-1)}));var i=this.mainForm.controls.dexihDatalinkSteps;e.forEach((function(e){var r=new k.p;r.name=e.name;for(var o=0;a.find((function(e){return e.name===r.name}));)r.name=e.name+"_"+o.toString(),o++;r.key=n,r.datalinkKey=e.key,r.datajobKey=t.mainForm.value.key,r.isValid=!0;var s=t.formService.datalinkStepFormGroup(t.mainForm,r);i.push(s),n--})),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||ie)(u.Kb(o.a),u.Kb(s.a),u.Kb(l.a),u.Kb(i.a),u.Kb(i.e))},ie.\u0275cmp=u.Eb({type:ie,selectors:[["datajob-add-steps"]],decls:6,vars:6,consts:[["title","Add Datalinks to Job",3,"showExpandButton","padding"],["header",""],[3,"enableMultiSelect","columns","dataObservable","tags"],["select","selectedItemsAction"],["selectedItemsAction",""],[3,"click"],["iconClass","fa fa-plus","buttonClass","btn-primary","title","Add selected datalinks to the job",3,"click"]],template:function(e,t){1&e&&(u.Ob(0,"dexih-widget-section",0),u.Dc(1,te,1,0,"ng-template",null,1,u.Ec),u.Ob(3,"dexih-table",2),u.Dc(4,ae,2,0,"ng-template",3,4,u.Ec),u.Nb(),u.Nb()),2&e&&(u.hc("showExpandButton",!1)("padding",!1),u.yb(3),u.hc("enableMultiSelect",!0)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[d.T,S.a,d.d,d.f],encapsulation:2}),ie),se=((ne=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canDeactivate",value:function(e){return!e||!e.canDeactivate||e.canDeactivate()}}]),e}()).\u0275fac=function(e){return new(e||ne)},ne.\u0275prov=u.Gb({token:ne,factory:ne.\u0275fac}),ne),ce=i.i.forChild([{path:"",component:g,canDeactivate:[se],children:[{path:"",redirectTo:"properties",data:{navigateSkip:!0}},{path:"properties",component:j,data:{navigateSkip:!0,pageTitle:"Properties"}},{path:"trigger",component:G,data:{pageTitle:"New Trigger"}},{path:"trigger/:triggerKey",component:G,data:{pageTitle:"Edit Trigger"}},{path:"step",component:ee,data:{pageTitle:"New Step"}},{path:"step/:datalinkStepKey",component:ee,data:{pageTitle:"Edit Step"}},{path:"add-steps",component:oe,data:{pageTitle:"Add Multiple Steps"}}]}]),le=a("PCNd"),ue=a("RRRx"),de=((re=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(){return{ngModule:e,providers:[l.a]}}}]),e}()).\u0275mod=u.Ib({type:re}),re.\u0275inj=u.Hb({factory:function(e){return new(e||re)},providers:[l.a,se],imports:[[le.a,n.c,C.n,ce,C.C,ue.a]]}),re)}}]);