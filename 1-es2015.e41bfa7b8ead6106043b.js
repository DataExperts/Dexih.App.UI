(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"9nsk":function(e,t,o){"use strict";o.d(t,"a",(function(){return g})),o("cvPx");var n=o("2v7R"),r=o("4Y1E"),i=o("1qMd"),l=o("fXoL"),c=o("ofXK"),a=o("3Pt+"),s=o("Wumg"),u=o("gLgY");function m(e,t){if(1&e&&(l.Ob(0,"section"),l.Lb(1,"form-input",14),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",e.columnFormService.formErrors.logicalName)}}function b(e,t){if(1&e&&(l.Ob(0,"section"),l.Lb(1,"form-textarea",15),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("showMarkdown",!0)("errors",e.columnFormService.formErrors.description)}}function h(e,t){if(1&e&&(l.Ob(0,"section",3),l.Lb(1,"form-input",16),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",e.columnFormService.formErrors.maxLength)}}function f(e,t){if(1&e&&(l.Ob(0,"section",17),l.Lb(1,"form-input",18),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",e.columnFormService.formErrors.precision)}}function d(e,t){if(1&e&&(l.Ob(0,"section",17),l.Lb(1,"form-input",19),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",e.columnFormService.formErrors.scale)}}function p(e,t){if(1&e&&(l.Ob(0,"section",3),l.Ob(1,"form-select",27),l.Lb(2,"columnValidation-edit-button",28),l.Nb(),l.Nb()),2&e){const e=l.Zb(3);l.yb(1),l.hc("allowNullSelect",!0)("items",null==e.hubCache?null:e.hubCache.hub.dexihColumnValidations),l.yb(1),l.hc("key",e.columnFormService.currentForm.controls.columnValidationKey.value)}}function y(e,t){if(1&e&&(l.Ob(0,"div"),l.Ob(1,"section"),l.Lb(2,"form-checkbox",20),l.Nb(),l.Ob(3,"section"),l.Lb(4,"form-checkbox",21),l.Nb(),l.Ob(5,"section"),l.Lb(6,"form-checkbox",22),l.Nb(),l.Ob(7,"section"),l.Lb(8,"form-checkbox",23),l.Nb(),l.Ob(9,"div",2),l.Ob(10,"section",3),l.Lb(11,"form-select",24),l.Nb(),l.Ob(12,"section",3),l.Lb(13,"form-select",25),l.Nb(),l.Nb(),l.Ob(14,"div",2),l.Ob(15,"section",3),l.Lb(16,"form-input",26),l.Nb(),l.Dc(17,p,3,3,"section",12),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(11),l.hc("errors",e.columnFormService.formErrors.deltaType)("items",e.deltaTypes),l.yb(2),l.hc("errors",e.columnFormService.formErrors.securityFlag)("items",e.securityFlags),l.yb(3),l.hc("errors",e.columnFormService.formErrors.defaultValue),l.yb(1),l.hc("ngIf",e.columnFormService.currentForm.controls.columnValidationKey)}}function v(e,t){if(1&e&&(l.Ob(0,"form",1),l.Ob(1,"fieldset"),l.Ob(2,"div",2),l.Ob(3,"section",3),l.Lb(4,"form-input",4),l.Nb(),l.Ob(5,"section",3),l.Lb(6,"form-input",5),l.Nb(),l.Nb(),l.Ob(7,"section"),l.Lb(8,"form-checkbox",6),l.Nb(),l.Dc(9,m,2,1,"section",7),l.Dc(10,b,2,2,"section",7),l.Ob(11,"div",2),l.Ob(12,"section",8),l.Lb(13,"form-select",9),l.Nb(),l.Ob(14,"section",10),l.Lb(15,"form-input",11),l.Nb(),l.Dc(16,h,2,1,"section",12),l.Dc(17,f,2,1,"section",13),l.Dc(18,d,2,1,"section",13),l.Nb(),l.Dc(19,y,18,6,"div",7),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.columnFormService.currentForm),l.yb(4),l.hc("errors",e.columnFormService.formErrors.columnGroup),l.yb(2),l.hc("errors",e.columnFormService.formErrors.name),l.yb(3),l.hc("ngIf",e.columnFormService.currentForm.value.useLogical),l.yb(1),l.hc("ngIf",e.detailedView),l.yb(3),l.hc("errors",e.columnFormService.formErrors.dataType)("items",e.typeCodes),l.yb(2),l.hc("errors",e.columnFormService.formErrors.rank),l.yb(1),l.hc("ngIf",e.columnFormService.currentForm.value.isString),l.yb(1),l.hc("ngIf",e.columnFormService.currentForm.value.isNumber),l.yb(1),l.hc("ngIf",e.columnFormService.currentForm.value.isNumber),l.yb(1),l.hc("ngIf",e.detailedView)}}let g=(()=>{class e{constructor(e){this.hubService=e,this.detailedView=!0,this.typeCodes=i.a,this.deltaTypes=n.i,this.securityFlags=n.s}ngOnInit(){this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{this.hubCache=e})}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(r.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["column-edit-base"]],inputs:{columnFormService:"columnFormService",detailedView:"detailedView"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Group","formControlName","columnGroup","placeholder","Enter a column group name","iconClass","fa fa-list","note","The group column grouping, used to distinguish duplicate column names when applying to structured data (such as json).",3,"errors"],["label","Column Name","formControlName","name","placeholder","Enter the column name.","iconClass","fa fa-list","note","The physical column name in the underlying table",3,"errors"],["label","Specify a different logical name","formControlName","useLogical"],[4,"ngIf"],[1,"form-group","col-md-4"],["label","Data Type","formControlName","dataType","itemKey","key","itemName","name",3,"errors","items"],[1,"form-group","col-md-2"],["type","number","label","Array Dimensions","formControlName","rank",3,"errors"],["class","form-group col-md-6",4,"ngIf"],["class","form-group col-md-3",4,"ngIf"],["label","Logical Name","formControlName","logicalName","placeholder","Enter the logical name.","iconClass","fa fa-list","note","The logical name is a short term to represent the column",3,"errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["label","Max Length","formControlName","maxLength","placeholder","Max Length","type","number","note","Maximum string length (blank for unlimited)",3,"errors"],[1,"form-group","col-md-3"],["label","Precision","formControlName","precision","placeholder","Precision","type","number",3,"errors"],["label","Scale","formControlName","scale","placeholder","Scale","type","number",3,"errors"],["label","Allow Nulls","formControlName","allowDbNull"],["label","Is Unicode","formControlName","isUnicode"],["label","Is an Input Column","formControlName","isInput"],["label","Is always incrementing column that can be used for change detection","formControlName","isIncrementalUpdate"],["label","Delta Type","formControlName","deltaType","itemKey","key","itemName","name","note","How to treat the column when used to update target table.",3,"errors","items"],["label","Security Flag","formControlName","securityFlag","itemKey","key","itemName","name","note","How to secure this column when reading data.",3,"errors","items"],["label","Default Value","formControlName","defaultValue","placeholder","Default Value","note","Default value if unmapped or null.",3,"errors"],["label","Validation Rule","formControlName","columnValidationKey","itemKey","key","itemName","name","note","Validation rule to apply.",3,"allowNullSelect","items"],[3,"key"]],template:function(e,t){1&e&&l.Dc(0,v,20,12,"form",0),2&e&&l.hc("ngIf",t.columnFormService.currentForm)},directives:[c.t,a.I,a.t,a.l,s.D,a.s,a.j,s.A,s.E,s.H,u.a],encapsulation:2}),e})()},Qrk8:function(e,t,o){"use strict";o.d(t,"a",(function(){return z}));var n=o("4Y1E"),r=o("2Vo4"),i=o("itXk"),l=(o("cvPx"),o("2v7R")),c=o("soiQ"),a=o("1qMd"),s=o("3WyZ"),u=o("fXoL"),m=o("tyNb"),b=o("Wumg"),h=o("ofXK"),f=o("3Pt+"),d=o("qMYE"),p=o("24Dg"),y=o("Kj3r");let v=(()=>{class e{constructor(){this.columnForm=null}ngOnInit(){}ngOnChanges(){}toggleInput(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=u.Eb({type:e,selectors:[["table-edit-input-column"]],inputs:{columnForm:"columnForm"},features:[u.wb],decls:3,vars:2,consts:[[1,"",3,"formGroup"],["formControlName","defaultValue","placeholder","Enter default value for the input column","iconClass","fa fa-dollar",3,"label"]],template:function(e,t){1&e&&(u.Ob(0,"form",0),u.Ob(1,"section"),u.Lb(2,"form-input",1),u.Nb(),u.Nb()),2&e&&(u.hc("formGroup",t.columnForm),u.yb(2),u.hc("label",t.columnForm.value.name))},directives:[f.I,f.t,f.l,b.D,f.s,f.j],encapsulation:2}),e})();var g=o("Vjuc");function C(e,t){if(1&e&&(u.Ob(0,"div"),u.Lb(1,"table-edit-input-column",12),u.Nb()),2&e){const e=t.$implicit;u.yb(1),u.hc("columnForm",e)}}function N(e,t){if(1&e&&(u.Ob(0,"section"),u.Lb(1,"form-select",13),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formService.formErrors.fileFormatKey)("items",e.hubCache.hub.dexihFileFormats)("enableFilter",!1)}}function S(e,t){if(1&e&&(u.Ob(0,"section"),u.Lb(1,"form-input",14),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formService.formErrors.rowPath)}}function F(e,t){1&e&&(u.Ob(0,"div",15),u.Ob(1,"div",16),u.Ob(2,"div",17),u.Fc(3,"Max Import Levels"),u.Nb(),u.Nb(),u.Lb(4,"input",18),u.Nb())}function T(e,t){if(1&e){const e=u.Pb();u.Ob(0,"form",4),u.Ob(1,"section"),u.Lb(2,"form-input",5),u.Nb(),u.Lb(3,"section"),u.Ob(4,"section"),u.Dc(5,C,2,1,"div",6),u.ac(6,"isValidFilter"),u.Nb(),u.Ob(7,"section"),u.Lb(8,"form-select",7),u.Nb(),u.Dc(9,N,2,3,"section",8),u.Dc(10,S,2,1,"section",8),u.Ob(11,"section",9),u.Ob(12,"dexih-button",10),u.Vb("click",(function(){u.vc(e);const t=u.Zb();return!t.formService.formSaving&&t.importTable()})),u.Fc(13,"Import "),u.Nb(),u.Dc(14,F,5,0,"div",11),u.Nb(),u.Nb()}if(2&e){const e=u.Zb();u.hc("formGroup",e.formService.currentForm),u.yb(2),u.hc("errors",e.formService.formErrors.restfulUri)("note","Specify the uri following the base path "+e.connection.server+".  To include input columns use {} in the uri definition (eg. GetWeather?City={CityName})"),u.yb(3),u.hc("ngForOf",u.bc(6,9,e.inputColumns)),u.yb(3),u.hc("items",e.formatTypes),u.yb(1),u.hc("ngIf",e.formService.currentForm.value.formatType==e.eTypeCode.Text),u.yb(1),u.hc("ngIf",e.formService.currentForm.value.formatType==e.eTypeCode.Json||e.formService.currentForm.value.formatType==e.eTypeCode.Xml),u.yb(2),u.hc("busy",e.formService.formSaving),u.yb(2),u.hc("ngIf",e.formService.currentForm.value.formatType==e.eTypeCode.Json||e.formService.currentForm.value.formatType==e.eTypeCode.Xml)}}let O=(()=>{class e{constructor(e,t,o,n){this.hubService=e,this.route=t,this.router=o,this.location=n,this.cancelToken=new s.a,this.inputTable=null,this.formatTypes=l.m,this.eTypeCode=c.pc}ngOnInit(){this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{e&&e.status===l.j.Loaded&&(this.hubCache=e,this.tables=this.hubCache.getConnectionTables())}),this._currentFormSubscription=this.formService.getCurrentFormObservable().subscribe(e=>{this.inputColumns=this.formService.currentForm.controls.dexihTableColumns.controls.filter(e=>e.value.isInput&&e.value.isValid),this._restfulUrlSubscription&&this._restfulUrlSubscription.unsubscribe(),this._restfulUrlSubscription=e.controls.restfulUri.valueChanges.pipe(Object(y.a)(500)).subscribe(e=>{this.updateInputColumns()})})}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this._restfulUrlSubscription&&this._restfulUrlSubscription.unsubscribe(),this._currentFormSubscription&&this._currentFormSubscription.unsubscribe(),this.cancelToken.cancel()}hasChanged(e){}importTable(){let e=this.formService.currentForm.value,t=this.formService.currentForm.value.dexihTableColumns.filter(e=>e.isInput&&e.isValid);t&&t.forEach(t=>{let o=e.dexihTableColumns.find(e=>e.name===t.name);o?o.inputValue=t.inputValue:(o=t,e.dexihTableColumns.push(o))}),this.hubService.importTables([e],!1,this.cancelToken).then(e=>{const t=this.formService.currentForm.controls.dexihTableColumns;for(;t.controls.length>0;)t.removeAt(0);e[0].dexihTableColumns.forEach(o=>{t.push(this.formService.tableColumn(e[0].dexihTableColumns,o))})}).catch()}updateInputColumns(){const e=/\{([^}]+)\}/g,t=this.formService.currentForm.controls.dexihTableColumns;let o;t.controls.filter(e=>e.value.isInput&&e.value.isValid).forEach(e=>{e.controls.isValid.setValue(!1)});let n=-1e3;for(;o=e.exec(this.formService.currentForm.value.restfulUri);){let e=t.controls.find(e=>e.value.name===o[1]&&e.value.isInput);if(e)e.controls.isValid.setValue(!0);else{let r=new c.I;r.name=o[1],r.isInput=!0,r.logicalName=o[1],r.dataType=c.pc.String,r.deltaType=c.qb.NaturalKey,r.maxLength=1024,r.position=n++,r.description="Url Parameter "+o[1],r.allowDbNull=!0,r.isUnique=!1,r.isValid=!0,e=this.formService.tableColumn(t.value,r),t.push(e)}}n=1,t.controls.filter(e=>e.value.isValid).sort((e,t)=>e.value.position-t.value.position).forEach(e=>{e.controls.position.setValue(n++)}),this.inputColumns=t.controls.filter(e=>e.value.isInput&&e.value.isValid)}}return e.\u0275fac=function(t){return new(t||e)(u.Kb(n.a),u.Kb(m.a),u.Kb(m.e),u.Kb(h.n))},e.\u0275cmp=u.Eb({type:e,selectors:[["dexih-table-edit-rest"]],inputs:{formService:"formService",connection:"connection"},decls:6,vars:1,consts:[[1,"list-group-item","list-group-item-info","rounded-0"],[1,"d-flex","flex-row"],[1,"container","mt-3","mb-3"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Web Service Uri String","formControlName","restfulUri","placeholder","Enter the uri.","iconClass","fa fa-feed",3,"errors","note"],[4,"ngFor","ngForOf"],["label","Format Type","formControlName","formatType","itemKey","key","itemName","name","iconClass","fa fa-database","note","The format of data.",3,"items"],[4,"ngIf"],[1,"btn-toolbar"],[3,"busy","click"],["class","input-group pl-1",4,"ngIf"],[3,"columnForm"],["label","File Format","formControlName","fileFormatKey","placeholder","File Format","itemKey","key","itemName","name","note","Specify the file format to use, if not specified, defaults will be used.",3,"errors","items","enableFilter"],["label","Optional: Web Service Row Path","formControlName","rowPath","placeholder","Enter the row path.","iconClass","fa fa-feed","note","Optional Json Path indicating where a row should be read from.",3,"errors"],[1,"input-group","pl-1"],[1,"input-group-prepend"],[1,"input-group-text"],["placeholder","Maximum levels...","title","Maximum import levels","formControlName","maxImportLevels",1,"form-control",2,"width","100%","max-width","100px"]],template:function(e,t){1&e&&(u.Ob(0,"div",0),u.Ob(1,"div",1),u.Ob(2,"h5"),u.Fc(3,"Web Service Properties"),u.Nb(),u.Nb(),u.Nb(),u.Ob(4,"div",2),u.Dc(5,T,15,11,"form",3),u.Nb()),2&e&&(u.yb(5),u.hc("ngIf",null==t.formService?null:t.formService.currentForm))},directives:[h.t,f.I,f.t,f.l,b.D,f.s,f.j,h.s,b.E,b.f,v,f.c],pipes:[g.a],encapsulation:2}),e})();var w=o("ElCs"),k=o("obiC");function I(e,t){if(1&e&&(u.Ob(0,"div"),u.Ob(1,"section"),u.Lb(2,"form-input",19),u.Nb(),u.Ob(3,"section"),u.Lb(4,"form-input",20),u.Nb(),u.Ob(5,"section"),u.Lb(6,"form-input",21),u.Nb(),u.Ob(7,"section"),u.Lb(8,"form-input",22),u.Nb(),u.Nb()),2&e){const e=u.Zb(4);u.yb(2),u.hc("errors",e.formService.formErrors.fileIncomingPath),u.yb(2),u.hc("errors",e.formService.formErrors.fileOutgoingPath),u.yb(2),u.hc("errors",e.formService.formErrors.fileProcessedPath),u.yb(2),u.hc("errors",e.formService.formErrors.fileRejectedPath)}}function x(e,t){if(1&e&&(u.Ob(0,"div"),u.Ob(1,"section"),u.Lb(2,"form-checkbox",18),u.Nb(),u.Dc(3,I,9,4,"div",5),u.Nb()),2&e){const e=u.Zb(3);u.yb(2),u.hc("note","If custom paths are not specified files will be read/written to the directory: "+e.connection.server+"/"+e.formService.currentForm.value.name+"/"),u.yb(1),u.hc("ngIf",e.formService.currentForm.value.useCustomFilePaths)}}function E(e,t){if(1&e&&(u.Ob(0,"section"),u.Lb(1,"form-input",15),u.Nb(),u.Ob(2,"section"),u.Lb(3,"form-input",16),u.Nb(),u.Ob(4,"section"),u.Lb(5,"form-checkbox",17),u.Nb(),u.Dc(6,x,4,2,"div",5)),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formService.formErrors.fileRootPath)("note","Specify the subdirectory.  This will be the connection directory ("+e.connection.server+") plus the path specified."),u.yb(2),u.hc("errors",e.formService.formErrors.fileMatchPattern),u.yb(3),u.hc("ngIf",e.formService.currentForm.value.autoManageFiles)}}function D(e,t){if(1&e&&(u.Ob(0,"section"),u.Ob(1,"form-select",23),u.Ob(2,"a",24),u.Fc(3,"("),u.Lb(4,"i",25),u.Fc(5," New Format )"),u.Nb(),u.Nb(),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formService.formErrors.fileFormatKey)("items",e.hubCache.hub.dexihFileFormats)("enableFilter",!1)("allowNullSelect",!0)}}function V(e,t){if(1&e&&(u.Ob(0,"section"),u.Lb(1,"form-input",26),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formService.formErrors.rowPath)}}function L(e,t){if(1&e){const e=u.Pb();u.Ob(0,"dexih-button-refresh",27),u.Vb("click",(function(){return u.vc(e),u.Zb(2).importTable()})),u.Nb()}if(2&e){const e=u.Zb(2);u.hc("busy",e.updatingTable)}}function P(e,t){if(1&e){const e=u.Pb();u.Ob(0,"form",2),u.Dc(1,E,7,4,"ng-template",3),u.Ob(2,"section"),u.Lb(3,"form-select",4),u.Nb(),u.Dc(4,D,6,4,"section",5),u.Dc(5,V,2,1,"section",5),u.Ob(6,"section"),u.Ob(7,"label",6),u.Fc(8,"Add a sample file which will be used to determine column names. "),u.Ob(9,"a",7),u.Vb("click",(function(){return u.vc(e),u.Zb().import()})),u.Fc(10,"("),u.Lb(11,"i",8),u.Fc(12," Import directly from source )"),u.Nb(),u.Nb(),u.Ob(13,"div",9),u.Vb("dropFiles",(function(t){return u.vc(e),u.Zb().filesDrop(t)})),u.Fc(14," Drop Sample File Here "),u.Ob(15,"div",10),u.Ob(16,"input",11),u.Vb("change",(function(t){return u.vc(e),u.Zb().uploadFile(t)})),u.Nb(),u.Ob(17,"label",12),u.Fc(18,"Choose file"),u.Nb(),u.Nb(),u.Nb(),u.Lb(19,"br"),u.Dc(20,L,1,1,"dexih-button-refresh",13),u.Ob(21,"section"),u.Lb(22,"form-input",14),u.Nb(),u.Nb(),u.Nb()}if(2&e){const e=u.Zb();u.hc("formGroup",e.formService.currentForm),u.yb(1),u.hc("ngIf",e.isFile),u.yb(2),u.hc("items",e.formatTypes),u.yb(1),u.hc("ngIf",e.formService.currentForm.value.formatType==e.eTypeCode.Text),u.yb(1),u.hc("ngIf",e.formService.currentForm.value.formatType==e.eTypeCode.Json||e.formService.currentForm.value.formatType==e.eTypeCode.Xml),u.yb(8),u.hc("requireFiles",!0),u.yb(7),u.hc("ngIf",1==(null==e.uploader||null==e.uploader.queue?null:e.uploader.queue.length)),u.yb(2),u.hc("errors",e.formService.formErrors.maxImportLevels)}}let K=(()=>{class e{constructor(e,t){this.authService=e,this.hubService=t,this.isFile=!1,this.hasBaseDropZoneOver=!1,this.updatingTable=!1,this.formatTypes=l.m,this.eTypeCode=c.pc,this.cancelToken=new s.a}ngOnInit(){try{this._subscription=this.hubService.getHubCacheObservable().subscribe(e=>{this.hubCache=e})}catch(e){this.hubService.addHubClientErrorMessage(e,"Table Edit File")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}filesDrop(e){this.doImport(e[0])}uploadFile(e){this.doImport(e.srcElement.files[0])}doImport(e){if(this.formService.currentForm.value.fileFormat&&(this.formService.currentForm.value.fileFormatKey=this.formService.currentForm.value.fileFormat.fileFormatKey),e.size>1e5){if("text/csv"!==e.type&&"text/plain"!==e.type)return void this.hubService.addHubErrorMessage(`The file size ${e.size}b exceeded the maximum of 100,000b.  Submit a smaller sample file, or a plain text file (which will be trimmed automatically) to proceed.`);e=new File([e.slice(0,1e5)],e.name)}const t=new FormData;t.append("file",e,e.name),t.append("hubKey",this.hubCache.hub.hubKey.toString()),t.append("table",this.authService.JsonNoNulls(this.formService.currentForm.value)),t.append("connectionKey",this.connection.key.toString()),t.append("save","false");let o=this.hubService.getRemoteAgentCurrent();this.authService.postFormRemoteGetKey("/api/Hub/ImportFileFormat",t,o,this.cancelToken).then(e=>{this.authService.getRemoteData(o,e,this.cancelToken,"download").then(e=>{let t=e[0];"Error"===t.entityStatus.lastStatus.toString()&&this.hubService.addHubErrorMessage(t.entityStatus.message),this.updateColumns(t.dexihTableColumns)})}).catch(e=>{e?this.hubService.addHubMessage(e):this.hubService.addHubErrorMessage("The file upload failed.  This may be due to the file being too large, try making the sample file smaller (headings only) and upload again.")})}import(){this.hubService.importTables([this.formService.currentForm.value],!1,this.cancelToken).then(e=>{e&&e.length>0&&this.updateColumns(e[0].dexihTableColumns)}).catch(e=>{e?this.hubService.addHubMessage(e):this.hubService.addHubErrorMessage("The file upload failed.  This may be due to the file being too large, try making the sample file smaller (headings only) and upload again.")})}updateColumns(e){let t=this.formService.currentForm.controls.dexihTableColumns;const o=t.controls.length;for(let n=0;n<=o;n++)t.removeAt(0);e.filter(e=>e.isValid).forEach(e=>{t.push(this.formService.tableColumn(t.value,e))})}}return e.\u0275fac=function(t){return new(t||e)(u.Kb(w.a),u.Kb(n.a))},e.\u0275cmp=u.Eb({type:e,selectors:[["dexih-table-edit-file"]],inputs:{connection:"connection",isFile:"isFile",formService:"formService"},decls:2,vars:3,consts:[["title","File Properties",3,"showExpandButton","padding"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[3,"ngIf"],["label","Format Type","formControlName","formatType","itemKey","key","itemName","name","iconClass","fa fa-database","note","The format of data.",3,"items"],[4,"ngIf"],[1,"label"],["href","javascript:void(0)",3,"click"],[1,"fa","fa-download"],["dropZone","","dropAllowedClass","nv-file-over",1,"well","my-drop-zone",3,"requireFiles","dropFiles"],[1,"custom-file","w-25","float-right"],["type","file","onclick","this.value=null",1,"custom-file-input",3,"change"],["for","inputGroupFile01",1,"custom-file-label"],["text","Import Table Columns",3,"busy","click",4,"ngIf"],["label","Max Import Levels","formControlName","maxImportLevels","placeholder","Enter the maximum node levels to query the json structure.","iconClass","fa fa-file","note","Enter the maximum levels to query the json file.",3,"errors"],["label","Files Subdirectory","formControlName","fileRootPath","placeholder","Enter the file path name.","iconClass","fa fa-file",3,"errors","note"],["label","File Match Pattern","formControlName","fileMatchPattern","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the file pattern to use to match files when bulk uploading.  Patterns can include wildcards */?, leave blank for all files.",3,"errors"],["label","Auto manage files","formControlName","autoManageFiles","note","Files loaded from the incoming directory, and moved to the processed or rejected directories when they are loaded by a datalink.  If not checked source files will be left untouched after a load."],["label","Specify custom file paths for auto-managed files","formControlName","useCustomFilePaths",3,"note"],["label","Incoming subdirectory","formControlName","fileIncomingPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for incoming files",3,"errors"],["label","Outgoing subdirectory","formControlName","fileOutgoingPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for outgoing (written) files",3,"errors"],["label","Processed subdirectory","formControlName","fileProcessedPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for processed files",3,"errors"],["label","Rejected subdirectory","formControlName","fileRejectedPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for rejected files",3,"errors"],["label","File Format","formControlName","fileFormatKey","placeholder","File Format","itemKey","key","itemName","name","note","Specify the file format to use, if not specified, a csv (command separated) format will be used.","selectNullMessage","Use default (csv) format",3,"errors","items","enableFilter","allowNullSelect"],["routerLink","../fileFormat-new"],[1,"fa","fa-sticky-note-o"],["label","Optional: Web Service Row Path","formControlName","rowPath","placeholder","Enter the row path.","iconClass","fa fa-feed","note","Optional Json Path indicating where a row should be read from.",3,"errors"],["text","Import Table Columns",3,"busy","click"]],template:function(e,t){1&e&&(u.Ob(0,"dexih-widget-section",0),u.Dc(1,P,23,8,"form",1),u.Nb()),2&e&&(u.hc("showExpandButton",!0)("padding",!0),u.yb(1),u.hc("ngIf",null==t.formService?null:t.formService.currentForm))},directives:[b.T,h.t,f.I,f.t,f.l,b.E,f.s,f.j,k.a,b.D,b.A,m.h,b.s],encapsulation:2}),e})();var Z=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(t){i(t)}}function c(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,c)}a((n=n.apply(e,t||[])).next())}))};function M(e,t){if(1&e&&(u.Ob(0,"section",5),u.Lb(1,"form-input",14),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("label",e.entityType+" Schema")("errors",e.formsService.formErrors.schema)}}function R(e,t){if(1&e&&(u.Ob(0,"section"),u.Lb(1,"form-input",15),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formsService.formErrors.logicalName)}}function _(e,t){if(1&e&&(u.Ob(0,"div",4),u.Ob(1,"section",16),u.Lb(2,"form-input",17),u.Nb(),u.Nb()),2&e){const e=u.Zb(2);u.yb(2),u.hc("errors",e.formsService.formErrors.rejectedTableName)}}function U(e,t){if(1&e&&(u.Ob(0,"section"),u.Lb(1,"form-select",18),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("errors",e.formsService.formErrors.tableType)("items",e.eTableTypeItems)}}function j(e,t){if(1&e){const e=u.Pb();u.Ob(0,"a",22),u.Vb("click",(function(){return u.vc(e),u.Zb(3).test()})),u.Fc(1," ( "),u.Lb(2,"i",23),u.Fc(3," Test) "),u.Nb()}}function G(e,t){if(1&e){const e=u.Pb();u.Ob(0,"a",22),u.Vb("click",(function(){return u.vc(e),u.Zb(3).reloadColumns()})),u.Fc(1," ( "),u.Lb(2,"i",24),u.Fc(3," Reload Columns) "),u.Nb()}}function q(e,t){1&e&&(u.Ob(0,"span"),u.Lb(1,"i",25),u.Fc(2," (Busy... please wait) "),u.Nb())}function H(e,t){if(1&e&&(u.Ob(0,"section"),u.Ob(1,"form-textarea",19),u.Dc(2,j,4,0,"a",20),u.Dc(3,G,4,0,"a",20),u.Dc(4,q,3,0,"span",2),u.Lb(5,"dexih-message",21),u.Nb(),u.Nb()),2&e){const e=u.Zb(2);u.yb(1),u.hc("hideToggle",!0)("showPreview",!1),u.yb(1),u.hc("ngIf",0==e.runningSql),u.yb(1),u.hc("ngIf",0==e.runningSql),u.yb(1),u.hc("ngIf",1==e.runningSql),u.yb(1),u.hc("message",e.sqlMessage)}}function A(e,t){1&e&&(u.Ob(0,"section"),u.Lb(1,"form-input",26),u.Nb())}function B(e,t){if(1&e&&(u.Ob(0,"form",3),u.Ob(1,"fieldset"),u.Ob(2,"div",4),u.Ob(3,"section",5),u.Ob(4,"form-select",6),u.Lb(5,"connection-edit-button",7),u.Nb(),u.Nb(),u.Ob(6,"section",5),u.Lb(7,"form-input",8),u.Nb(),u.Dc(8,M,2,2,"section",9),u.Nb(),u.Ob(9,"section"),u.Lb(10,"form-checkbox",10),u.Nb(),u.Dc(11,R,2,1,"section",2),u.Ob(12,"section"),u.Lb(13,"form-textarea",11),u.Nb(),u.Dc(14,_,3,1,"div",12),u.Dc(15,U,2,2,"section",2),u.Dc(16,H,6,6,"section",2),u.Dc(17,A,2,0,"section",2),u.Ob(18,"section"),u.Lb(19,"form-checkbox",13),u.Nb(),u.Nb(),u.Nb()),2&e){const e=u.Zb();u.hc("formGroup",e.mainForm),u.yb(4),u.hc("items",e.connections)("errors",e.formsService.formErrors.connectionKey),u.yb(1),u.hc("key",e.mainForm.controls.connectionKey.value),u.yb(2),u.hc("label",e.entityType+" Name")("errors",e.formsService.formErrors.name),u.yb(1),u.hc("ngIf",(null==e.connectionReference?null:e.connectionReference.connectionCategory)==e.eConnectionCategory.SqlDatabase),u.yb(3),u.hc("ngIf",e.formsService.currentForm.value.useLogical),u.yb(2),u.hc("showMarkdown",!0)("errors",e.formsService.formErrors.description),u.yb(1),u.hc("ngIf",(null==e.connection?null:e.connection.purpose)==e.eConnectionPurpose.Managed),u.yb(1),u.hc("ngIf",(null==e.connectionReference?null:e.connectionReference.connectionCategory)==e.eConnectionCategory.SqlDatabase),u.yb(1),u.hc("ngIf",e.formsService.currentForm.controls.tableType.value===e.eTableType.Query),u.yb(1),u.hc("ngIf",(null==e.connectionReference?null:e.connectionReference.connectionCategory)==e.eConnectionCategory.Hub)}}function X(e,t){if(1&e){const e=u.Pb();u.Ob(0,"div"),u.Ob(1,"dexih-table-edit-rest",27),u.Vb("onTableChanged",(function(t){return u.vc(e),u.Zb().onTableChanged(t)})),u.Nb(),u.Nb()}if(2&e){const e=u.Zb();u.yb(1),u.hc("formService",e.formsService)("connection",e.connection)}}function W(e,t){if(1&e){const e=u.Pb();u.Ob(0,"div"),u.Ob(1,"dexih-table-edit-file",28),u.Vb("onTableChanged",(function(t){return u.vc(e),u.Zb().onTableChanged(t)})),u.Nb(),u.Nb()}if(2&e){const e=u.Zb();u.yb(1),u.hc("formService",e.formsService)("connection",e.connection)("isFile",(null==e.connectionReference?null:e.connectionReference.connectionCategory)==e.eConnectionCategory.File)}}let z=(()=>{class e{constructor(e,t){this.hubService=e,this.route=t,this.isExpanded=!0,this.cancelToken=new s.a,this.entityType="Table",this.canEdit=!1,this.typeCodes=a.a,this.deltaTypes=l.i,this.securityFlags=l.s,this.eTableType=c.ic,this.eTableTypeItems=c.jc,this.eConnectionCategory=c.ib,this.eConnectionPurpose=c.jb,this.runningSql=!1,this._columnData=new r.a(null),this.columnData=this._columnData.asObservable()}ngOnInit(){try{this._subscription=Object(i.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.formsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(e=>Z(this,void 0,void 0,(function*(){let t=e[0];this.hubCache=e[2],this.mainForm=e[3],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.isLoaded()&&this.mainForm&&(this.connections=this.hubCache.hub.dexihConnections,this.connection=this.connections.find(e=>e.key===this.mainForm.controls.connectionKey.value),this.connectionReference=yield this.hubService.GetConnectionReference(this.connection),this._connectionSubscription&&this._connectionSubscription.unsubscribe(),this._connectionSubscription=this.mainForm.controls.connectionKey.valueChanges.subscribe(e=>Z(this,void 0,void 0,(function*(){this.connection=this.connections.find(t=>t.key===e),this.connectionReference=yield this.hubService.GetConnectionReference(this.connection)}))))})))}catch(e){this.hubService.addHubClientErrorMessage(e,"Table edit properties")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._connectionSubscription&&this._connectionSubscription.unsubscribe(),this.cancelToken.cancel()}reloadColumns(){this.runningSql=!0,this.hubService.importTables([this.mainForm.value],!1,this.cancelToken).then(e=>{if(!e||0===e.length)return;const t=e[0],o=this.formsService.currentForm.controls.dexihTableColumns;for(;o.controls.length>0;)o.removeAt(0);t.dexihTableColumns.filter(e=>e.isValid).forEach(e=>{o.push(this.formsService.tableColumn(t.dexihTableColumns,e))}),this.runningSql=!1}).catch(()=>this.runningSql=!1)}test(){this.runningSql=!0,this.hubService.doImport([this.mainForm.value],!1,this.cancelToken).then(e=>{let t=e[0].dexihTableColumns.map(e=>e.name);this.hubService.addHubSuccessMessage("The query was successful, and returned the following columns.  "+t.join(", ")),this.runningSql=!1}).catch(e=>{this.runningSql=!1,this.sqlMessage=e,this.hubService.addHubMessage(e)})}}return e.\u0275fac=function(t){return new(t||e)(u.Kb(n.a),u.Kb(m.a))},e.\u0275cmp=u.Eb({type:e,selectors:[["dexih-table-edit-properties"]],inputs:{formsService:"formsService",isExpanded:"isExpanded"},decls:4,vars:5,consts:[["title","Properties",3,"showExpandButton","isExpanded"],[3,"formGroup",4,"ngIf"],[4,"ngIf"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-4"],["label","Connection","formControlName","connectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","The connection for this table.",3,"items","errors"],[3,"key"],["formControlName","name","placeholder","Enter the physical name.","iconClass","fa fa-list","note","The physical name of the underlying entity",3,"label","errors"],["class","form-group col-md-4",4,"ngIf"],["label","Specify a different logical name","formControlName","useLogical"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["class","form-row",4,"ngIf"],["label","Table is shared in the catalog to users with read access.","formControlName","isShared"],["formControlName","schema","placeholder","Enter the (database) schema name","iconClass","fa fa-list","note","The physical name of the database schema (if applicable).",3,"label","errors"],["label","Logical Name","formControlName","logicalName","placeholder","Enter the logical name.","iconClass","fa fa-list","note","The logical name is a short term to represent the table",3,"errors"],[1,"form-group","col-md-6"],["label","Reject Table Name","formControlName","rejectedTableName","placeholder","Enter the rejected table name.","iconClass","fa fa-list","note","The name of the table to send any records that could not be written to the primary table.",3,"errors"],["label","Table Type","formControlName","tableType","itemKey","key","itemName","name",3,"errors","items"],["label","Specify the sql query","rows","15","formControlName","queryString","placeholder","Sql Query",3,"hideToggle","showPreview"],["href","javascript:void(0)",3,"click",4,"ngIf"],[3,"message"],["href","javascript:void(0)",3,"click"],[1,"fa","fa-check-circle-o"],[1,"fa","fa-refresh"],[1,"fa","fa-spin","fa-refresh"],["label","Source Connection Name","formControlName","sourceConnectionName","placeholder","Name of the source connection.","iconClass","fa fa-list","note","The name of the connection for this table in the source hub."],[3,"formService","connection","onTableChanged"],[3,"formService","connection","isFile","onTableChanged"]],template:function(e,t){1&e&&(u.Ob(0,"dexih-widget-section",0),u.Dc(1,B,20,14,"form",1),u.Nb(),u.Dc(2,X,2,2,"div",2),u.Dc(3,W,2,3,"div",2)),2&e&&(u.hc("showExpandButton",!0)("isExpanded",t.isExpanded),u.yb(1),u.hc("ngIf",t.mainForm),u.yb(1),u.hc("ngIf",(null==t.connectionReference?null:t.connectionReference.connectionCategory)==t.eConnectionCategory.WebService),u.yb(1),u.hc("ngIf",t.connection&&((null==t.connectionReference?null:t.connectionReference.connectionCategory)==t.eConnectionCategory.File||(null==t.connection?null:t.connection.purpose)!==t.eConnectionPurpose.Source)))},directives:[b.T,h.t,f.I,f.t,f.l,b.E,f.s,f.j,d.a,b.D,b.A,b.H,p.a,O,K],encapsulation:2}),e})()},dn85:function(e,t,o){"use strict";o.d(t,"a",(function(){return v}));var n=o("fXoL"),r=o("2v7R"),i=o("ElCs"),l=o("4Y1E"),c=o("cvPx"),a=o("soiQ"),s=o("3Pt+"),u=o("Wumg"),m=o("9nsk"),b=o("ofXK"),h=o("iFLP"),f=o("vDxl");function d(e,t){if(1&e){const e=n.Pb();n.Ob(0,"li"),n.Ob(1,"a",9),n.Vb("click",(function(){n.vc(e);const o=t.$implicit;return n.Zb(2).navigateToColumn(o)})),n.Fc(2),n.Nb(),n.Nb()}if(2&e){const e=t.$implicit;n.yb(2),n.Ic("",e.columnGroup?e.columnGroup+".":"","",e.name,"")}}function p(e,t){if(1&e){const e=n.Pb();n.Ob(0,"dexih-invalid-form-details",4),n.Vb("click",(function(){return n.vc(e),n.Zb().columnFormService.showErrors()})),n.Nb(),n.Ob(1,"dexih-button-dropdown",5),n.Dc(2,d,3,2,"li",6),n.Nb(),n.Ob(3,"dexih-button-apply",7),n.Vb("click",(function(){return n.vc(e),n.Zb().applyExit()})),n.Nb(),n.Ob(4,"dexih-button-cancel",8),n.Vb("click",(function(){return n.vc(e),n.Zb().cancel()})),n.Nb()}if(2&e){const e=n.Zb();n.hc("control",e.columnFormService.currentForm),n.yb(2),n.hc("ngForOf",e.columns),n.yb(1),n.hc("disabled",!(null!=e.columnFormService&&e.columnFormService.hasChanged))}}function y(e,t){if(1&e&&n.Lb(0,"table-edit-columns",10),2&e){const e=n.Zb();n.hc("tableForm",e.tableForm)("parentColumnForm",e.columnFormService.currentForm)}}let v=(()=>{class e{constructor(e,t,o){this.authService=e,this.hubService=t,this.detailedView=!0,this.isUpdated=new n.n,this.changeColumn=new n.n,this.eTypeCode=a.pc,this.columnFormService=new c.a(o,t,e)}ngOnInit(){this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{if(e.status===r.j.Loaded){if(this.hubCache=e,!this.hubCache.isLoaded()||!this.tableForm)return;this.initializeForm(),this.updateColumns()}})}ngOnChanges(){this.tableForm&&this.hubCache&&(this.initializeForm(),this.updateColumns())}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe()}initializeForm(){let e,t=this.tableForm.value.dexihTableColumns;if(this.columnKey){if(this.tableForm){if(this.originalColumn=t.find(e=>e.key===this.columnKey),!this.originalColumn)return void this.authService.navigateUp();e=this.columnFormService.tableColumn(t,this.originalColumn)}}else{let o=this.hubCache.newColumn(this.tableForm.value,this.deltaType);o?e=this.columnFormService.tableColumn(t,o):this.authService.informationDialog("Column not added.",`The column with delta type ${this.deltaType} could not be inserted into the current table.`)}this.columnFormService.startForm(e)}cancel(){this.isUpdated.emit(!1)}apply(){const e=this.columnFormService.currentForm,t=this.tableForm.controls.dexihTableColumns;this.originalColumn?t.controls.find(t=>t.value.key===e.value.key).setValue(e.value):t.push(e),this.tableForm.markAsDirty()}updateColumns(){this.tableForm&&this.originalColumn&&(this.columns=this.originalColumn.childColumns.sort((e,t)=>e.position-t.position))}navigateToColumn(e){this.apply(),this.changeColumn.emit(e.key)}applyExit(){this.columnFormService.hasChanged&&(this.apply(),this.isUpdated.emit(!0))}}return e.\u0275fac=function(t){return new(t||e)(n.Kb(i.a),n.Kb(l.a),n.Kb(s.g))},e.\u0275cmp=n.Eb({type:e,selectors:[["column-edit"]],inputs:{tableForm:"tableForm",columnKey:"columnKey",deltaType:"deltaType",detailedView:"detailedView"},outputs:{isUpdated:"isUpdated",changeColumn:"changeColumn"},features:[n.wb],decls:5,vars:4,consts:[["title","Edit Column",3,"showExpandButton"],["header",""],[3,"columnFormService","detailedView"],[3,"tableForm","parentColumnForm",4,"ngIf"],[1,"mr-1",3,"control","click"],["buttonClass","btn-primary","text","Column",1,"mr-1"],[4,"ngFor","ngForOf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"dropdown-item",3,"click"],[3,"tableForm","parentColumnForm"]],template:function(e,t){1&e&&(n.Ob(0,"dexih-widget-section",0),n.Dc(1,p,5,3,"ng-template",null,1,n.Ec),n.Lb(3,"column-edit-base",2),n.Nb(),n.Dc(4,y,1,2,"table-edit-columns",3)),2&e&&(n.hc("showExpandButton",!0),n.yb(3),n.hc("columnFormService",t.columnFormService)("detailedView",t.detailedView),n.yb(1),n.hc("ngIf",(null==t.columnFormService||null==t.columnFormService.currentForm?null:t.columnFormService.currentForm.controls.dataType.value)===t.eTypeCode.Node))},directives:[u.T,m.a,b.t,h.a,u.i,b.s,u.a,u.b,f.a],encapsulation:2}),e})()},vDxl:function(e,t,o){"use strict";o.d(t,"a",(function(){return g}));var n=o("4Y1E"),r=o("2Vo4"),i=o("cvPx"),l=o("2v7R"),c=o("soiQ"),a=o("fXoL"),s=o("tyNb"),u=o("Wumg"),m=o("H3K+"),b=o("ofXK"),h=o("zal2");function f(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button-delete",9),a.Vb("click",(function(){a.vc(e);const o=t.items;return a.Zb().deleteSelected(o)})),a.Nb(),a.Ob(1,"dexih-button",10),a.Vb("click",(function(){a.vc(e);const t=a.Zb();return t.showBulkEdit=!t.showBulkEdit})),a.Fc(2),a.Nb()}if(2&e){const e=a.Zb();a.yb(2),a.Hc(" ",e.showBulkEdit?"Hide Bulk Edit":"Show Bulk Edit"," ")}}function d(e,t){if(1&e){const e=a.Pb();a.Ob(0,"column-edit-bulk",12),a.Vb("updated",(function(){return a.vc(e),a.Zb(2).showBulkEdit=!1})),a.Nb()}if(2&e){const e=a.Zb().items,t=a.Zb();a.hc("columns",e)("columnsFormArray",t.formsService.currentForm.controls.dexihTableColumns)}}function p(e,t){if(1&e&&a.Dc(0,d,1,2,"column-edit-bulk",11),2&e){const e=t.items,o=a.Zb();a.hc("ngIf",o.formsService.currentForm&&o.showBulkEdit&&e.length>0)}}function y(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button-new",13),a.Vb("click",(function(){return a.vc(e),a.Zb().newColumn()})),a.Nb()}}function v(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button-edit",14),a.Vb("click",(function(){a.vc(e);const o=t.item;return a.Zb().editColumn(o)})),a.Nb()}}let g=(()=>{class e{constructor(e,t,o,n){this.hubService=e,this.formsService=t,this.route=o,this.router=n,this.entityType="Table",this.canEdit=!1,this.deltaTypes=l.i,this.securityFlags=l.s,this.showBulkEdit=!1,this.eConnectionPurpose=c.jb,this.columns=[{name:"position",title:"#",format:""},{name:"name",title:"Column Name",format:"",class:"nameClass",tooltip:"description"},{name:"logicalName",title:"Logical Name",format:"Md",footer:"description",class:"logicalNameClass"},{name:"isInput",title:"Input?",format:"Boolean"},{name:"dataType",title:"Data Type",format:""},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"deltaType",title:"Delta Type",format:""},{name:"defaultValue",title:"Default Value",format:""},{name:"columnValidation",title:"Column Validation",format:""},{name:"isIncrementalUpdate",title:"Is Incremental",format:"Boolean"},{name:"securityFlag",title:"Security Flag",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._columnData=new r.a(null),this.columnData=this._columnData.asObservable()}ngOnInit(){this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{e&&e.status===l.j.Loaded&&(this.hubCache=e,this.updateColumnData())})}ngOnChanges(){this._tableFormSubscription&&this._tableFormSubscription.unsubscribe(),this.formsService.currentForm&&(this._tableFormSubscription=this.formsService.currentForm.valueChanges.subscribe(()=>this.updateColumnData())),this.updateColumnData()}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this._tableFormSubscription&&this._tableFormSubscription.unsubscribe()}updateColumnData(){if(this.hubCache&&this.formsService.currentForm){let e,t=[];e=this.parentColumnForm?this.parentColumnForm.controls.childColumns:this.formsService.currentForm.controls.dexihTableColumns,e.controls.filter(e=>e.value.isValid).sort((e,t)=>e.value.position-t.value.position).forEach(e=>{let o=e;t.push({key:e.value.key,position:e.value.position,name:(e.value.columnGroup?e.value.columnGroup+".":"")+e.value.name,nameClass:o.controls.name.valid?"":"dexih-state-error",description:e.value.description,isInput:e.value.isInput,dataType:this.hubCache.dataTypeToString(e.value),allowDbNull:e.value.allowDbNull,logicalName:e.value.logicalName,logicalNameClass:o.controls.logicalName.valid?"":"dexih-error-icon",deltaType:this.deltaTypes.find(t=>t.key===e.value.deltaType).name,defaultValue:e.value.defaultValue,columnValidation:this.hubCache.getColumnValidation(e.value.columnValidationKey).name,isIncrementalUpdate:e.value.isIncrementalUpdate,securityFlag:this.securityFlags.find(t=>t.key===e.value.securityFlag).name,updateDate:e.value.updateDate})}),this._columnData.next(t)}else this._columnData.next(null)}deleteColumn(e){this.deleteSelected([e])}deleteSelected(e){let t=this.formsService.currentForm.controls.dexihTableColumns;e.forEach(e=>{let o=t.controls.findIndex(t=>t.value.key===e.key);t.removeAt(o)})}newColumn(){this.router.navigate(["column"],{relativeTo:this.route.parent})}editColumn(e){this.router.navigate(["column",e.key],{relativeTo:this.route.parent})}columnSortChange(e){let t=this.formsService.currentForm.controls.dexihTableColumns,o=1;e.forEach(e=>{t.controls.find(t=>t.value.key===e.key).controls.position.setValue(o++)}),this.updateColumnData()}}return e.\u0275fac=function(t){return new(t||e)(a.Kb(n.a),a.Kb(i.a),a.Kb(s.a),a.Kb(s.e))},e.\u0275cmp=a.Eb({type:e,selectors:[["table-edit-columns"]],inputs:{tableForm:"tableForm",parentColumnForm:"parentColumnForm"},features:[a.wb],decls:10,vars:8,consts:[["title","Columns",3,"showExpandButton","padding"],["sortColumn","position",3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","enableManualSort","columns","dataObservable","onSortChanged","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["tableHeader",""],["select","actionsTemplate"],["actions",""],["select","selectedItemAction","class","mr-1"],["selectedItemAction",""],["title","Delete selected columns",1,"mr-1",3,"click"],["iconClass","fa fa-th-list",1,"mr-1",3,"click"],["class","mr-1",3,"columns","columnsFormArray","updated",4,"ngIf"],[1,"mr-1",3,"columns","columnsFormArray","updated"],["title","Create a new column",1,"mr-1",3,"click"],["title","Edit selected column",1,"mr-1",3,"click"]],template:function(e,t){1&e&&(a.Ob(0,"dexih-widget-section",0),a.Ob(1,"dexih-table",1),a.Vb("onSortChanged",(function(e){return t.columnSortChange(e)}))("rowClick",(function(e){return t.editColumn(e)})),a.Dc(2,f,3,1,"ng-template",2,3,a.Ec),a.Dc(4,p,1,1,"ng-template",null,4,a.Ec),a.Dc(6,y,1,0,"ng-template",5,6,a.Ec),a.Dc(8,v,1,0,"ng-template",7,8,a.Ec),a.Nb(),a.Nb()),2&e&&(a.hc("showExpandButton",!0)("padding",!1),a.yb(1),a.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("enableManualSort",!0)("columns",t.columns)("dataObservable",t.columnData))},directives:[u.T,m.a,u.g,u.f,b.t,h.a,u.o,u.j],encapsulation:2}),e})()},vSNy:function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var n=o("ofXK"),r=o("PCNd"),i=o("3Pt+"),l=o("RRRx"),c=o("fXoL");let a=(()=>{class e{static forRoot(){return{ngModule:e}}}return e.\u0275mod=c.Ib({type:e}),e.\u0275inj=c.Hb({factory:function(t){return new(t||e)},imports:[[r.a,n.c,i.n,i.C,l.a]]}),e})()},zal2:function(e,t,o){"use strict";o.d(t,"a",(function(){return k}));var n=o("fXoL"),r=o("2v7R"),i=o("cvPx"),l=o("1qMd"),c=o("soiQ"),a=o("4Y1E"),s=o("Wumg"),u=o("3Pt+"),m=o("ofXK"),b=o("gLgY");function h(e,t){1&e&&(n.Ob(0,"section",11),n.Lb(1,"form-input",12),n.Nb())}function f(e,t){1&e&&(n.Ob(0,"section",13),n.Lb(1,"form-input",14),n.Nb())}function d(e,t){1&e&&(n.Ob(0,"section",13),n.Lb(1,"form-input",15),n.Nb())}function p(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",2),n.Lb(2,"form-select",6),n.Nb(),n.Ob(3,"section",7),n.Lb(4,"form-input",8),n.Nb(),n.Dc(5,h,2,0,"section",9),n.Dc(6,f,2,0,"section",10),n.Dc(7,d,2,0,"section",10),n.Nb()),2&e){const e=n.Zb();n.yb(2),n.hc("items",e.typeCodes),n.yb(3),n.hc("ngIf",e.bulkColumn.value.isString),n.yb(1),n.hc("ngIf",e.bulkColumn.value.isNumber),n.yb(1),n.hc("ngIf",e.bulkColumn.value.isNumber)}}function y(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-input",16),n.Nb(),n.Nb())}function v(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-select",17),n.Nb(),n.Nb()),2&e){const e=n.Zb();n.yb(2),n.hc("items",e.securityFlags)}}function g(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-select",18),n.Nb(),n.Nb()),2&e){const e=n.Zb();n.yb(2),n.hc("items",e.deltaTypes)}}function C(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-input",19),n.Nb(),n.Nb())}function N(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Ob(2,"form-select",20),n.Lb(3,"columnValidation-edit-button",21),n.Nb(),n.Nb(),n.Nb()),2&e){const e=n.Zb();n.yb(2),n.hc("allowNullSelect",!0)("items",null==e.hubCache?null:e.hubCache.hub.dexihColumnValidations),n.yb(1),n.hc("key",e.bulkColumn.controls.columnValidationKey.value)}}function S(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-checkbox",22),n.Nb(),n.Nb())}function F(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-checkbox",23),n.Nb(),n.Nb())}function T(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-checkbox",24),n.Nb(),n.Nb())}function O(e,t){if(1&e){const e=n.Pb();n.Ob(0,"dexih-button-apply",25),n.Vb("click",(function(){n.vc(e);const t=n.Zb();return t.applyBulkEdit(t.items)})),n.Nb(),n.Ob(1,"dexih-button-cancel",25),n.Vb("click",(function(){return n.vc(e),n.Zb().cancel()})),n.Nb()}}const w=function(){return{standalone:!0}};let k=(()=>{class e{constructor(e,t){this.hubService=e,this.formsService=t,this.updated=new n.n,this.properties=[{name:"Group Name",property:"group"},{name:"Data Type",property:"dataType"},{name:"Delta Type",property:"deltaType"},{name:"Security Flag",property:"securityFlag"},{name:"Default Value",property:"defaultValue"},{name:"Validation Rule",property:"validationRule"},{name:"Allow DbNull",property:"allowDbNull"},{name:"Is Input",property:"isInput"},{name:"Is Unicode",property:"isUnicode"}],this.typeCodes=l.a,this.deltaTypes=r.i,this.securityFlags=r.s}ngOnInit(){this.bulkColumn=this.formsService.tableColumn([],new c.I),this.subscription=this.hubService.getHubCacheObservable().subscribe(e=>{this.hubCache=e})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}getColumnForm(e){return this.columnsFormArray.controls.find(t=>t.controls.key.value===e.key)}applyBulkEdit(){let e=this.bulkColumn.value;this.columns.forEach(t=>{let o=this.getColumnForm(t);if(o)switch(this.property){case"group":o.controls.columnGroup.setValue(e.columnGroup);break;case"dataType":o.controls.dataType.setValue(e.dataType),o.controls.maxLength.setValue(e.maxLength),o.controls.rank.setValue(e.rank),o.controls.precision.setValue(e.precision),o.controls.scale.setValue(e.scale);break;case"deltaType":o.controls.deltaType.setValue(e.deltaType);break;case"securityFlag":o.controls.securityFlag.setValue(e.securityFlag);break;case"defaultValue":o.controls.defaultValue.setValue(e.defaultValue);break;case"validationRule":o.controls.columnValidationKey.setValue(e.columnValidationKey);break;case"allowDbNull":o.controls.allowDbNull.setValue(e.allowDbNull);break;case"isUnicode":o.controls.isUnicode.setValue(e.isUnicode);break;case"isInput":o.controls.isInput.setValue(e.isInput)}}),this.updated.emit()}cancel(){this.updated.emit()}setAllowDbNull(e){this.columns.forEach(t=>{this.getColumnForm(t).controls.allowDbNull.setValue(e)})}setIsInput(e){this.columns.forEach(t=>{this.getColumnForm(t).controls.isInput.setValue(e)})}setIsUnicode(e){this.columns.forEach(t=>{this.getColumnForm(t).controls.isUnicode.setValue(e)})}}return e.\u0275fac=function(t){return new(t||e)(n.Kb(a.a),n.Kb(i.a))},e.\u0275cmp=n.Eb({type:e,selectors:[["column-edit-bulk"]],inputs:{columns:"columns",columnsFormArray:"columnsFormArray"},outputs:{updated:"updated"},decls:15,vars:14,consts:[["title","Update columns","headerClass","text-white bg-primary"],[3,"formGroup"],[1,"form-group","col-md-4"],["label","Property","itemKey","property","itemName","name",3,"ngModel","ngModelOptions","items","ngModelChange"],[4,"ngIf"],["footer",""],["label","Data Type","formControlName","dataType","itemKey","key","itemName","name",3,"items"],[1,"form-group","col-md-2"],["type","number","label","Array Dimensions","formControlName","rank"],["class","form-group col-md-6",4,"ngIf"],["class","form-group col-md-3",4,"ngIf"],[1,"form-group","col-md-6"],["label","Max Length","formControlName","maxLength","placeholder","Max Length","type","number","note","Maximum string length (blank for unlimited)"],[1,"form-group","col-md-3"],["label","Precision","formControlName","precision","placeholder","Precision","type","number"],["label","Scale","formControlName","scale","placeholder","Scale","type","number"],["label","Group","formControlName","columnGroup","placeholder","Enter a column group name","iconClass","fa fa-list","note","The group column grouping, used to distinguish duplicate column names when applying to structured data (such as json)."],["label","Security Flag","formControlName","securityFlag","itemKey","key","itemName","name","note","How to secure this column when reading data.",3,"items"],["label","Delta Type","formControlName","deltaType","itemKey","key","itemName","name","note","How to treat the column when used to update target table.",3,"items"],["label","Default Value","formControlName","defaultValue","placeholder","Default Value","note","Default value if unmapped or null."],["label","Validation Rule","formControlName","columnValidationKey","itemKey","key","itemName","name","note","Validation rule to apply.",3,"allowNullSelect","items"],[3,"key"],["label","Allow Nulls","formControlName","allowDbNull"],["label","Is an Input Column","formControlName","isInput"],["label","Is Unicode","formControlName","isUnicode"],[1,"mr-1",3,"click"]],template:function(e,t){1&e&&(n.Ob(0,"dexih-widget",0),n.Ob(1,"form",1),n.Ob(2,"section",2),n.Ob(3,"form-select",3),n.Vb("ngModelChange",(function(e){return t.property=e})),n.Nb(),n.Nb(),n.Dc(4,p,8,4,"div",4),n.Dc(5,y,3,0,"div",4),n.Dc(6,v,3,1,"div",4),n.Dc(7,g,3,1,"div",4),n.Dc(8,C,3,0,"div",4),n.Dc(9,N,4,3,"div",4),n.Dc(10,S,3,0,"div",4),n.Dc(11,F,3,0,"div",4),n.Dc(12,T,3,0,"div",4),n.Nb(),n.Dc(13,O,2,0,"ng-template",null,5,n.Ec),n.Nb()),2&e&&(n.yb(1),n.hc("formGroup",t.bulkColumn),n.yb(2),n.hc("ngModel",t.property)("ngModelOptions",n.lc(13,w))("items",t.properties),n.yb(1),n.hc("ngIf","dataType"==t.property),n.yb(1),n.hc("ngIf","group"==t.property),n.yb(1),n.hc("ngIf","securityFlag"==t.property),n.yb(1),n.hc("ngIf","deltaType"==t.property),n.yb(1),n.hc("ngIf","defaultValue"==t.property),n.yb(1),n.hc("ngIf","validationRule"==t.property),n.yb(1),n.hc("ngIf","allowDbNull"==t.property),n.yb(1),n.hc("ngIf","isInput"==t.property),n.yb(1),n.hc("ngIf","isUnicode"==t.property))},directives:[s.P,u.I,u.t,u.l,s.E,u.s,u.v,m.t,u.j,s.D,b.a,s.A,s.a,s.b],encapsulation:2}),e})()}}]);