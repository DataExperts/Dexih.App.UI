function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"9nsk":function(e,t,o){"use strict";o.d(t,"a",(function(){return g})),o("cvPx");var n=o("2v7R"),r=o("4Y1E"),i=o("1qMd"),a=o("fXoL"),c=o("ofXK"),l=o("3Pt+"),s=o("Wumg"),u=o("gLgY");function m(e,t){if(1&e&&(a.Ob(0,"section"),a.Lb(1,"form-input",14),a.Nb()),2&e){var o=a.Zb(2);a.yb(1),a.hc("errors",o.columnFormService.formErrors.logicalName)}}function b(e,t){if(1&e&&(a.Ob(0,"section"),a.Lb(1,"form-textarea",15),a.Nb()),2&e){var o=a.Zb(2);a.yb(1),a.hc("showMarkdown",!0)("errors",o.columnFormService.formErrors.description)}}function f(e,t){if(1&e&&(a.Ob(0,"section",3),a.Lb(1,"form-input",16),a.Nb()),2&e){var o=a.Zb(2);a.yb(1),a.hc("errors",o.columnFormService.formErrors.maxLength)}}function h(e,t){if(1&e&&(a.Ob(0,"section",17),a.Lb(1,"form-input",18),a.Nb()),2&e){var o=a.Zb(2);a.yb(1),a.hc("errors",o.columnFormService.formErrors.precision)}}function d(e,t){if(1&e&&(a.Ob(0,"section",17),a.Lb(1,"form-input",19),a.Nb()),2&e){var o=a.Zb(2);a.yb(1),a.hc("errors",o.columnFormService.formErrors.scale)}}function p(e,t){if(1&e&&(a.Ob(0,"section",3),a.Ob(1,"form-select",27),a.Lb(2,"columnValidation-edit-button",28),a.Nb(),a.Nb()),2&e){var o=a.Zb(3);a.yb(1),a.hc("allowNullSelect",!0)("items",null==o.hubCache?null:o.hubCache.hub.dexihColumnValidations),a.yb(1),a.hc("key",o.columnFormService.currentForm.controls.columnValidationKey.value)}}function v(e,t){if(1&e&&(a.Ob(0,"div"),a.Ob(1,"section"),a.Lb(2,"form-checkbox",20),a.Nb(),a.Ob(3,"section"),a.Lb(4,"form-checkbox",21),a.Nb(),a.Ob(5,"section"),a.Lb(6,"form-checkbox",22),a.Nb(),a.Ob(7,"section"),a.Lb(8,"form-checkbox",23),a.Nb(),a.Ob(9,"div",2),a.Ob(10,"section",3),a.Lb(11,"form-select",24),a.Nb(),a.Ob(12,"section",3),a.Lb(13,"form-select",25),a.Nb(),a.Nb(),a.Ob(14,"div",2),a.Ob(15,"section",3),a.Lb(16,"form-input",26),a.Nb(),a.Dc(17,p,3,3,"section",12),a.Nb(),a.Nb()),2&e){var o=a.Zb(2);a.yb(11),a.hc("errors",o.columnFormService.formErrors.deltaType)("items",o.deltaTypes),a.yb(2),a.hc("errors",o.columnFormService.formErrors.securityFlag)("items",o.securityFlags),a.yb(3),a.hc("errors",o.columnFormService.formErrors.defaultValue),a.yb(1),a.hc("ngIf",o.columnFormService.currentForm.controls.columnValidationKey)}}function y(e,t){if(1&e&&(a.Ob(0,"form",1),a.Ob(1,"fieldset"),a.Ob(2,"div",2),a.Ob(3,"section",3),a.Lb(4,"form-input",4),a.Nb(),a.Ob(5,"section",3),a.Lb(6,"form-input",5),a.Nb(),a.Nb(),a.Ob(7,"section"),a.Lb(8,"form-checkbox",6),a.Nb(),a.Dc(9,m,2,1,"section",7),a.Dc(10,b,2,2,"section",7),a.Ob(11,"div",2),a.Ob(12,"section",8),a.Lb(13,"form-select",9),a.Nb(),a.Ob(14,"section",10),a.Lb(15,"form-input",11),a.Nb(),a.Dc(16,f,2,1,"section",12),a.Dc(17,h,2,1,"section",13),a.Dc(18,d,2,1,"section",13),a.Nb(),a.Dc(19,v,18,6,"div",7),a.Nb(),a.Nb()),2&e){var o=a.Zb();a.hc("formGroup",o.columnFormService.currentForm),a.yb(4),a.hc("errors",o.columnFormService.formErrors.columnGroup),a.yb(2),a.hc("errors",o.columnFormService.formErrors.name),a.yb(3),a.hc("ngIf",o.columnFormService.currentForm.value.useLogical),a.yb(1),a.hc("ngIf",o.detailedView),a.yb(3),a.hc("errors",o.columnFormService.formErrors.dataType)("items",o.typeCodes),a.yb(2),a.hc("errors",o.columnFormService.formErrors.rank),a.yb(1),a.hc("ngIf",o.columnFormService.currentForm.value.isString),a.yb(1),a.hc("ngIf",o.columnFormService.currentForm.value.isNumber),a.yb(1),a.hc("ngIf",o.columnFormService.currentForm.value.isNumber),a.yb(1),a.hc("ngIf",o.detailedView)}}var g=function(){var e=function(){function e(t){_classCallCheck(this,e),this.hubService=t,this.detailedView=!0,this.typeCodes=i.a,this.deltaTypes=n.i,this.securityFlags=n.s}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe((function(t){e.hubCache=t}))}},{key:"ngOnDestroy",value:function(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(a.Kb(r.a))},e.\u0275cmp=a.Eb({type:e,selectors:[["column-edit-base"]],inputs:{columnFormService:"columnFormService",detailedView:"detailedView"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Group","formControlName","columnGroup","placeholder","Enter a column group name","iconClass","fa fa-list","note","The group column grouping, used to distinguish duplicate column names when applying to structured data (such as json).",3,"errors"],["label","Column Name","formControlName","name","placeholder","Enter the column name.","iconClass","fa fa-list","note","The physical column name in the underlying table",3,"errors"],["label","Specify a different logical name","formControlName","useLogical"],[4,"ngIf"],[1,"form-group","col-md-4"],["label","Data Type","formControlName","dataType","itemKey","key","itemName","name",3,"errors","items"],[1,"form-group","col-md-2"],["type","number","label","Array Dimensions","formControlName","rank",3,"errors"],["class","form-group col-md-6",4,"ngIf"],["class","form-group col-md-3",4,"ngIf"],["label","Logical Name","formControlName","logicalName","placeholder","Enter the logical name.","iconClass","fa fa-list","note","The logical name is a short term to represent the column",3,"errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["label","Max Length","formControlName","maxLength","placeholder","Max Length","type","number","note","Maximum string length (blank for unlimited)",3,"errors"],[1,"form-group","col-md-3"],["label","Precision","formControlName","precision","placeholder","Precision","type","number",3,"errors"],["label","Scale","formControlName","scale","placeholder","Scale","type","number",3,"errors"],["label","Allow Nulls","formControlName","allowDbNull"],["label","Is Unicode","formControlName","isUnicode"],["label","Is an Input Column","formControlName","isInput"],["label","Is always incrementing column that can be used for change detection","formControlName","isIncrementalUpdate"],["label","Delta Type","formControlName","deltaType","itemKey","key","itemName","name","note","How to treat the column when used to update target table.",3,"errors","items"],["label","Security Flag","formControlName","securityFlag","itemKey","key","itemName","name","note","How to secure this column when reading data.",3,"errors","items"],["label","Default Value","formControlName","defaultValue","placeholder","Default Value","note","Default value if unmapped or null.",3,"errors"],["label","Validation Rule","formControlName","columnValidationKey","itemKey","key","itemName","name","note","Validation rule to apply.",3,"allowNullSelect","items"],[3,"key"]],template:function(e,t){1&e&&a.Dc(0,y,20,12,"form",0),2&e&&a.hc("ngIf",t.columnFormService.currentForm)},directives:[c.t,l.I,l.t,l.l,s.D,l.s,l.j,s.A,s.E,s.H,u.a],encapsulation:2}),e}()},Qrk8:function(e,t,o){"use strict";o.d(t,"a",(function(){return $}));var n,r=o("4Y1E"),i=o("2Vo4"),a=o("itXk"),c=(o("cvPx"),o("2v7R")),l=o("soiQ"),s=o("1qMd"),u=o("3WyZ"),m=o("fXoL"),b=o("tyNb"),f=o("Wumg"),h=o("ofXK"),d=o("3Pt+"),p=o("qMYE"),v=o("24Dg"),y=o("Kj3r"),g=((n=function(){function e(){_classCallCheck(this,e),this.columnForm=null}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(){}},{key:"toggleInput",value:function(e){}}]),e}()).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=m.Eb({type:n,selectors:[["table-edit-input-column"]],inputs:{columnForm:"columnForm"},features:[m.wb],decls:3,vars:2,consts:[[1,"",3,"formGroup"],["formControlName","defaultValue","placeholder","Enter default value for the input column","iconClass","fa fa-dollar",3,"label"]],template:function(e,t){1&e&&(m.Ob(0,"form",0),m.Ob(1,"section"),m.Lb(2,"form-input",1),m.Nb(),m.Nb()),2&e&&(m.hc("formGroup",t.columnForm),m.yb(2),m.hc("label",t.columnForm.value.name))},directives:[d.I,d.t,d.l,f.D,d.s,d.j],encapsulation:2}),n),C=o("Vjuc");function N(e,t){if(1&e&&(m.Ob(0,"div"),m.Lb(1,"table-edit-input-column",12),m.Nb()),2&e){var o=t.$implicit;m.yb(1),m.hc("columnForm",o)}}function S(e,t){if(1&e&&(m.Ob(0,"section"),m.Lb(1,"form-select",13),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formService.formErrors.fileFormatKey)("items",o.hubCache.hub.dexihFileFormats)("enableFilter",!1)}}function F(e,t){if(1&e&&(m.Ob(0,"section"),m.Lb(1,"form-input",14),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formService.formErrors.rowPath)}}function k(e,t){1&e&&(m.Ob(0,"div",15),m.Ob(1,"div",16),m.Ob(2,"div",17),m.Fc(3,"Max Import Levels"),m.Nb(),m.Nb(),m.Lb(4,"input",18),m.Nb())}function T(e,t){if(1&e){var o=m.Pb();m.Ob(0,"form",4),m.Ob(1,"section"),m.Lb(2,"form-input",5),m.Nb(),m.Lb(3,"section"),m.Ob(4,"section"),m.Dc(5,N,2,1,"div",6),m.ac(6,"isValidFilter"),m.Nb(),m.Ob(7,"section"),m.Lb(8,"form-select",7),m.Nb(),m.Dc(9,S,2,3,"section",8),m.Dc(10,F,2,1,"section",8),m.Ob(11,"section",9),m.Ob(12,"dexih-button",10),m.Vb("click",(function(){m.vc(o);var e=m.Zb();return!e.formService.formSaving&&e.importTable()})),m.Fc(13,"Import "),m.Nb(),m.Dc(14,k,5,0,"div",11),m.Nb(),m.Nb()}if(2&e){var n=m.Zb();m.hc("formGroup",n.formService.currentForm),m.yb(2),m.hc("errors",n.formService.formErrors.restfulUri)("note","Specify the uri following the base path "+n.connection.server+".  To include input columns use {} in the uri definition (eg. GetWeather?City={CityName})"),m.yb(3),m.hc("ngForOf",m.bc(6,9,n.inputColumns)),m.yb(3),m.hc("items",n.formatTypes),m.yb(1),m.hc("ngIf",n.formService.currentForm.value.formatType==n.eTypeCode.Text),m.yb(1),m.hc("ngIf",n.formService.currentForm.value.formatType==n.eTypeCode.Json||n.formService.currentForm.value.formatType==n.eTypeCode.Xml),m.yb(2),m.hc("busy",n.formService.formSaving),m.yb(2),m.hc("ngIf",n.formService.currentForm.value.formatType==n.eTypeCode.Json||n.formService.currentForm.value.formatType==n.eTypeCode.Xml)}}var O,w=((O=function(){function e(t,o,n,r){_classCallCheck(this,e),this.hubService=t,this.route=o,this.router=n,this.location=r,this.cancelToken=new u.a,this.inputTable=null,this.formatTypes=c.m,this.eTypeCode=l.pc}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe((function(t){t&&t.status===c.j.Loaded&&(e.hubCache=t,e.tables=e.hubCache.getConnectionTables())})),this._currentFormSubscription=this.formService.getCurrentFormObservable().subscribe((function(t){e.inputColumns=e.formService.currentForm.controls.dexihTableColumns.controls.filter((function(e){return e.value.isInput&&e.value.isValid})),e._restfulUrlSubscription&&e._restfulUrlSubscription.unsubscribe(),e._restfulUrlSubscription=t.controls.restfulUri.valueChanges.pipe(Object(y.a)(500)).subscribe((function(t){e.updateInputColumns()}))}))}},{key:"ngOnDestroy",value:function(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this._restfulUrlSubscription&&this._restfulUrlSubscription.unsubscribe(),this._currentFormSubscription&&this._currentFormSubscription.unsubscribe(),this.cancelToken.cancel()}},{key:"hasChanged",value:function(e){}},{key:"importTable",value:function(){var e=this,t=this.formService.currentForm.value,o=this.formService.currentForm.value.dexihTableColumns.filter((function(e){return e.isInput&&e.isValid}));o&&o.forEach((function(e){var o=t.dexihTableColumns.find((function(t){return t.name===e.name}));o?o.inputValue=e.inputValue:(o=e,t.dexihTableColumns.push(o))})),this.hubService.importTables([t],!1,this.cancelToken).then((function(t){for(var o=e.formService.currentForm.controls.dexihTableColumns;o.controls.length>0;)o.removeAt(0);t[0].dexihTableColumns.forEach((function(n){o.push(e.formService.tableColumn(t[0].dexihTableColumns,n))}))})).catch()}},{key:"updateInputColumns",value:function(){var e,t=/\{([^}]+)\}/g,o=this.formService.currentForm.controls.dexihTableColumns;o.controls.filter((function(e){return e.value.isInput&&e.value.isValid})).forEach((function(e){e.controls.isValid.setValue(!1)}));for(var n=-1e3;e=t.exec(this.formService.currentForm.value.restfulUri);){var r=o.controls.find((function(t){return t.value.name===e[1]&&t.value.isInput}));if(r)r.controls.isValid.setValue(!0);else{var i=new l.I;i.name=e[1],i.isInput=!0,i.logicalName=e[1],i.dataType=l.pc.String,i.deltaType=l.qb.NaturalKey,i.maxLength=1024,i.position=n++,i.description="Url Parameter "+e[1],i.allowDbNull=!0,i.isUnique=!1,i.isValid=!0,r=this.formService.tableColumn(o.value,i),o.push(r)}}n=1,o.controls.filter((function(e){return e.value.isValid})).sort((function(e,t){return e.value.position-t.value.position})).forEach((function(e){e.controls.position.setValue(n++)})),this.inputColumns=o.controls.filter((function(e){return e.value.isInput&&e.value.isValid}))}}]),e}()).\u0275fac=function(e){return new(e||O)(m.Kb(r.a),m.Kb(b.a),m.Kb(b.e),m.Kb(h.n))},O.\u0275cmp=m.Eb({type:O,selectors:[["dexih-table-edit-rest"]],inputs:{formService:"formService",connection:"connection"},decls:6,vars:1,consts:[[1,"list-group-item","list-group-item-info","rounded-0"],[1,"d-flex","flex-row"],[1,"container","mt-3","mb-3"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Web Service Uri String","formControlName","restfulUri","placeholder","Enter the uri.","iconClass","fa fa-feed",3,"errors","note"],[4,"ngFor","ngForOf"],["label","Format Type","formControlName","formatType","itemKey","key","itemName","name","iconClass","fa fa-database","note","The format of data.",3,"items"],[4,"ngIf"],[1,"btn-toolbar"],[3,"busy","click"],["class","input-group pl-1",4,"ngIf"],[3,"columnForm"],["label","File Format","formControlName","fileFormatKey","placeholder","File Format","itemKey","key","itemName","name","note","Specify the file format to use, if not specified, defaults will be used.",3,"errors","items","enableFilter"],["label","Optional: Web Service Row Path","formControlName","rowPath","placeholder","Enter the row path.","iconClass","fa fa-feed","note","Optional Json Path indicating where a row should be read from.",3,"errors"],[1,"input-group","pl-1"],[1,"input-group-prepend"],[1,"input-group-text"],["placeholder","Maximum levels...","title","Maximum import levels","formControlName","maxImportLevels",1,"form-control",2,"width","100%","max-width","100px"]],template:function(e,t){1&e&&(m.Ob(0,"div",0),m.Ob(1,"div",1),m.Ob(2,"h5"),m.Fc(3,"Web Service Properties"),m.Nb(),m.Nb(),m.Nb(),m.Ob(4,"div",2),m.Dc(5,T,15,11,"form",3),m.Nb()),2&e&&(m.yb(5),m.hc("ngIf",null==t.formService?null:t.formService.currentForm))},directives:[h.t,d.I,d.t,d.l,f.D,d.s,d.j,h.s,f.E,f.f,g,d.c],pipes:[C.a],encapsulation:2}),O),I=o("ElCs"),x=o("obiC");function E(e,t){if(1&e&&(m.Ob(0,"div"),m.Ob(1,"section"),m.Lb(2,"form-input",19),m.Nb(),m.Ob(3,"section"),m.Lb(4,"form-input",20),m.Nb(),m.Ob(5,"section"),m.Lb(6,"form-input",21),m.Nb(),m.Ob(7,"section"),m.Lb(8,"form-input",22),m.Nb(),m.Nb()),2&e){var o=m.Zb(4);m.yb(2),m.hc("errors",o.formService.formErrors.fileIncomingPath),m.yb(2),m.hc("errors",o.formService.formErrors.fileOutgoingPath),m.yb(2),m.hc("errors",o.formService.formErrors.fileProcessedPath),m.yb(2),m.hc("errors",o.formService.formErrors.fileRejectedPath)}}function D(e,t){if(1&e&&(m.Ob(0,"div"),m.Ob(1,"section"),m.Lb(2,"form-checkbox",18),m.Nb(),m.Dc(3,E,9,4,"div",5),m.Nb()),2&e){var o=m.Zb(3);m.yb(2),m.hc("note","If custom paths are not specified files will be read/written to the directory: "+o.connection.server+"/"+o.formService.currentForm.value.name+"/"),m.yb(1),m.hc("ngIf",o.formService.currentForm.value.useCustomFilePaths)}}function V(e,t){if(1&e&&(m.Ob(0,"section"),m.Lb(1,"form-input",15),m.Nb(),m.Ob(2,"section"),m.Lb(3,"form-input",16),m.Nb(),m.Ob(4,"section"),m.Lb(5,"form-checkbox",17),m.Nb(),m.Dc(6,D,4,2,"div",5)),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formService.formErrors.fileRootPath)("note","Specify the subdirectory.  This will be the connection directory ("+o.connection.server+") plus the path specified."),m.yb(2),m.hc("errors",o.formService.formErrors.fileMatchPattern),m.yb(3),m.hc("ngIf",o.formService.currentForm.value.autoManageFiles)}}function L(e,t){if(1&e&&(m.Ob(0,"section"),m.Ob(1,"form-select",23),m.Ob(2,"a",24),m.Fc(3,"("),m.Lb(4,"i",25),m.Fc(5," New Format )"),m.Nb(),m.Nb(),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formService.formErrors.fileFormatKey)("items",o.hubCache.hub.dexihFileFormats)("enableFilter",!1)("allowNullSelect",!0)}}function P(e,t){if(1&e&&(m.Ob(0,"section"),m.Lb(1,"form-input",26),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formService.formErrors.rowPath)}}function K(e,t){if(1&e){var o=m.Pb();m.Ob(0,"dexih-button-refresh",27),m.Vb("click",(function(){return m.vc(o),m.Zb(2).importTable()})),m.Nb()}if(2&e){var n=m.Zb(2);m.hc("busy",n.updatingTable)}}function _(e,t){if(1&e){var o=m.Pb();m.Ob(0,"form",2),m.Dc(1,V,7,4,"ng-template",3),m.Ob(2,"section"),m.Lb(3,"form-select",4),m.Nb(),m.Dc(4,L,6,4,"section",5),m.Dc(5,P,2,1,"section",5),m.Ob(6,"section"),m.Ob(7,"label",6),m.Fc(8,"Add a sample file which will be used to determine column names. "),m.Ob(9,"a",7),m.Vb("click",(function(){return m.vc(o),m.Zb().import()})),m.Fc(10,"("),m.Lb(11,"i",8),m.Fc(12," Import directly from source )"),m.Nb(),m.Nb(),m.Ob(13,"div",9),m.Vb("dropFiles",(function(e){return m.vc(o),m.Zb().filesDrop(e)})),m.Fc(14," Drop Sample File Here "),m.Ob(15,"div",10),m.Ob(16,"input",11),m.Vb("change",(function(e){return m.vc(o),m.Zb().uploadFile(e)})),m.Nb(),m.Ob(17,"label",12),m.Fc(18,"Choose file"),m.Nb(),m.Nb(),m.Nb(),m.Lb(19,"br"),m.Dc(20,K,1,1,"dexih-button-refresh",13),m.Ob(21,"section"),m.Lb(22,"form-input",14),m.Nb(),m.Nb(),m.Nb()}if(2&e){var n=m.Zb();m.hc("formGroup",n.formService.currentForm),m.yb(1),m.hc("ngIf",n.isFile),m.yb(2),m.hc("items",n.formatTypes),m.yb(1),m.hc("ngIf",n.formService.currentForm.value.formatType==n.eTypeCode.Text),m.yb(1),m.hc("ngIf",n.formService.currentForm.value.formatType==n.eTypeCode.Json||n.formService.currentForm.value.formatType==n.eTypeCode.Xml),m.yb(8),m.hc("requireFiles",!0),m.yb(7),m.hc("ngIf",1==(null==n.uploader||null==n.uploader.queue?null:n.uploader.queue.length)),m.yb(2),m.hc("errors",n.formService.formErrors.maxImportLevels)}}var Z,M=((Z=function(){function e(t,o){_classCallCheck(this,e),this.authService=t,this.hubService=o,this.isFile=!1,this.hasBaseDropZoneOver=!1,this.updatingTable=!1,this.formatTypes=c.m,this.eTypeCode=l.pc,this.cancelToken=new u.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=this.hubService.getHubCacheObservable().subscribe((function(t){e.hubCache=t}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Table Edit File")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}},{key:"filesDrop",value:function(e){this.doImport(e[0])}},{key:"uploadFile",value:function(e){this.doImport(e.srcElement.files[0])}},{key:"doImport",value:function(e){var t=this;if(this.formService.currentForm.value.fileFormat&&(this.formService.currentForm.value.fileFormatKey=this.formService.currentForm.value.fileFormat.fileFormatKey),e.size>1e5){if("text/csv"!==e.type&&"text/plain"!==e.type)return void this.hubService.addHubErrorMessage("The file size ".concat(e.size,"b exceeded the maximum of 100,000b.  Submit a smaller sample file, or a plain text file (which will be trimmed automatically) to proceed."));e=new File([e.slice(0,1e5)],e.name)}var o=new FormData;o.append("file",e,e.name),o.append("hubKey",this.hubCache.hub.hubKey.toString()),o.append("table",this.authService.JsonNoNulls(this.formService.currentForm.value)),o.append("connectionKey",this.connection.key.toString()),o.append("save","false");var n=this.hubService.getRemoteAgentCurrent();this.authService.postFormRemoteGetKey("/api/Hub/ImportFileFormat",o,n,this.cancelToken).then((function(e){t.authService.getRemoteData(n,e,t.cancelToken,"download").then((function(e){var o=e[0];"Error"===o.entityStatus.lastStatus.toString()&&t.hubService.addHubErrorMessage(o.entityStatus.message),t.updateColumns(o.dexihTableColumns)}))})).catch((function(e){e?t.hubService.addHubMessage(e):t.hubService.addHubErrorMessage("The file upload failed.  This may be due to the file being too large, try making the sample file smaller (headings only) and upload again.")}))}},{key:"import",value:function(){var e=this;this.hubService.importTables([this.formService.currentForm.value],!1,this.cancelToken).then((function(t){t&&t.length>0&&e.updateColumns(t[0].dexihTableColumns)})).catch((function(t){t?e.hubService.addHubMessage(t):e.hubService.addHubErrorMessage("The file upload failed.  This may be due to the file being too large, try making the sample file smaller (headings only) and upload again.")}))}},{key:"updateColumns",value:function(e){for(var t=this,o=this.formService.currentForm.controls.dexihTableColumns,n=o.controls.length,r=0;r<=n;r++)o.removeAt(0);e.filter((function(e){return e.isValid})).forEach((function(e){o.push(t.formService.tableColumn(o.value,e))}))}}]),e}()).\u0275fac=function(e){return new(e||Z)(m.Kb(I.a),m.Kb(r.a))},Z.\u0275cmp=m.Eb({type:Z,selectors:[["dexih-table-edit-file"]],inputs:{connection:"connection",isFile:"isFile",formService:"formService"},decls:2,vars:3,consts:[["title","File Properties",3,"showExpandButton","padding"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[3,"ngIf"],["label","Format Type","formControlName","formatType","itemKey","key","itemName","name","iconClass","fa fa-database","note","The format of data.",3,"items"],[4,"ngIf"],[1,"label"],["href","javascript:void(0)",3,"click"],[1,"fa","fa-download"],["dropZone","","dropAllowedClass","nv-file-over",1,"well","my-drop-zone",3,"requireFiles","dropFiles"],[1,"custom-file","w-25","float-right"],["type","file","onclick","this.value=null",1,"custom-file-input",3,"change"],["for","inputGroupFile01",1,"custom-file-label"],["text","Import Table Columns",3,"busy","click",4,"ngIf"],["label","Max Import Levels","formControlName","maxImportLevels","placeholder","Enter the maximum node levels to query the json structure.","iconClass","fa fa-file","note","Enter the maximum levels to query the json file.",3,"errors"],["label","Files Subdirectory","formControlName","fileRootPath","placeholder","Enter the file path name.","iconClass","fa fa-file",3,"errors","note"],["label","File Match Pattern","formControlName","fileMatchPattern","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the file pattern to use to match files when bulk uploading.  Patterns can include wildcards */?, leave blank for all files.",3,"errors"],["label","Auto manage files","formControlName","autoManageFiles","note","Files loaded from the incoming directory, and moved to the processed or rejected directories when they are loaded by a datalink.  If not checked source files will be left untouched after a load."],["label","Specify custom file paths for auto-managed files","formControlName","useCustomFilePaths",3,"note"],["label","Incoming subdirectory","formControlName","fileIncomingPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for incoming files",3,"errors"],["label","Outgoing subdirectory","formControlName","fileOutgoingPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for outgoing (written) files",3,"errors"],["label","Processed subdirectory","formControlName","fileProcessedPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for processed files",3,"errors"],["label","Rejected subdirectory","formControlName","fileRejectedPath","placeholder","Enter the file path.","iconClass","fa fa-file","note","Specify the sub-directory for rejected files",3,"errors"],["label","File Format","formControlName","fileFormatKey","placeholder","File Format","itemKey","key","itemName","name","note","Specify the file format to use, if not specified, a csv (command separated) format will be used.","selectNullMessage","Use default (csv) format",3,"errors","items","enableFilter","allowNullSelect"],["routerLink","../fileFormat-new"],[1,"fa","fa-sticky-note-o"],["label","Optional: Web Service Row Path","formControlName","rowPath","placeholder","Enter the row path.","iconClass","fa fa-feed","note","Optional Json Path indicating where a row should be read from.",3,"errors"],["text","Import Table Columns",3,"busy","click"]],template:function(e,t){1&e&&(m.Ob(0,"dexih-widget-section",0),m.Dc(1,_,23,8,"form",1),m.Nb()),2&e&&(m.hc("showExpandButton",!0)("padding",!0),m.yb(1),m.hc("ngIf",null==t.formService?null:t.formService.currentForm))},directives:[f.T,h.t,d.I,d.t,d.l,f.E,d.s,d.j,x.a,f.D,f.A,b.h,f.s],encapsulation:2}),Z),R=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{l(n.next(e))}catch(t){i(t)}}function c(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,c)}l((n=n.apply(e,t||[])).next())}))};function j(e,t){if(1&e&&(m.Ob(0,"section",5),m.Lb(1,"form-input",14),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("label",o.entityType+" Schema")("errors",o.formsService.formErrors.schema)}}function U(e,t){if(1&e&&(m.Ob(0,"section"),m.Lb(1,"form-input",15),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formsService.formErrors.logicalName)}}function G(e,t){if(1&e&&(m.Ob(0,"div",4),m.Ob(1,"section",16),m.Lb(2,"form-input",17),m.Nb(),m.Nb()),2&e){var o=m.Zb(2);m.yb(2),m.hc("errors",o.formsService.formErrors.rejectedTableName)}}function q(e,t){if(1&e&&(m.Ob(0,"section"),m.Lb(1,"form-select",18),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("errors",o.formsService.formErrors.tableType)("items",o.eTableTypeItems)}}function H(e,t){if(1&e){var o=m.Pb();m.Ob(0,"a",22),m.Vb("click",(function(){return m.vc(o),m.Zb(3).test()})),m.Fc(1," ( "),m.Lb(2,"i",23),m.Fc(3," Test) "),m.Nb()}}function A(e,t){if(1&e){var o=m.Pb();m.Ob(0,"a",22),m.Vb("click",(function(){return m.vc(o),m.Zb(3).reloadColumns()})),m.Fc(1," ( "),m.Lb(2,"i",24),m.Fc(3," Reload Columns) "),m.Nb()}}function B(e,t){1&e&&(m.Ob(0,"span"),m.Lb(1,"i",25),m.Fc(2," (Busy... please wait) "),m.Nb())}function X(e,t){if(1&e&&(m.Ob(0,"section"),m.Ob(1,"form-textarea",19),m.Dc(2,H,4,0,"a",20),m.Dc(3,A,4,0,"a",20),m.Dc(4,B,3,0,"span",2),m.Lb(5,"dexih-message",21),m.Nb(),m.Nb()),2&e){var o=m.Zb(2);m.yb(1),m.hc("hideToggle",!0)("showPreview",!1),m.yb(1),m.hc("ngIf",0==o.runningSql),m.yb(1),m.hc("ngIf",0==o.runningSql),m.yb(1),m.hc("ngIf",1==o.runningSql),m.yb(1),m.hc("message",o.sqlMessage)}}function W(e,t){1&e&&(m.Ob(0,"section"),m.Lb(1,"form-input",26),m.Nb())}function z(e,t){if(1&e&&(m.Ob(0,"form",3),m.Ob(1,"fieldset"),m.Ob(2,"div",4),m.Ob(3,"section",5),m.Ob(4,"form-select",6),m.Lb(5,"connection-edit-button",7),m.Nb(),m.Nb(),m.Ob(6,"section",5),m.Lb(7,"form-input",8),m.Nb(),m.Dc(8,j,2,2,"section",9),m.Nb(),m.Ob(9,"section"),m.Lb(10,"form-checkbox",10),m.Nb(),m.Dc(11,U,2,1,"section",2),m.Ob(12,"section"),m.Lb(13,"form-textarea",11),m.Nb(),m.Dc(14,G,3,1,"div",12),m.Dc(15,q,2,2,"section",2),m.Dc(16,X,6,6,"section",2),m.Dc(17,W,2,0,"section",2),m.Ob(18,"section"),m.Lb(19,"form-checkbox",13),m.Nb(),m.Nb(),m.Nb()),2&e){var o=m.Zb();m.hc("formGroup",o.mainForm),m.yb(4),m.hc("items",o.connections)("errors",o.formsService.formErrors.connectionKey),m.yb(1),m.hc("key",o.mainForm.controls.connectionKey.value),m.yb(2),m.hc("label",o.entityType+" Name")("errors",o.formsService.formErrors.name),m.yb(1),m.hc("ngIf",(null==o.connectionReference?null:o.connectionReference.connectionCategory)==o.eConnectionCategory.SqlDatabase),m.yb(3),m.hc("ngIf",o.formsService.currentForm.value.useLogical),m.yb(2),m.hc("showMarkdown",!0)("errors",o.formsService.formErrors.description),m.yb(1),m.hc("ngIf",(null==o.connection?null:o.connection.purpose)==o.eConnectionPurpose.Managed),m.yb(1),m.hc("ngIf",(null==o.connectionReference?null:o.connectionReference.connectionCategory)==o.eConnectionCategory.SqlDatabase),m.yb(1),m.hc("ngIf",o.formsService.currentForm.controls.tableType.value===o.eTableType.Query),m.yb(1),m.hc("ngIf",(null==o.connectionReference?null:o.connectionReference.connectionCategory)==o.eConnectionCategory.Hub)}}function J(e,t){if(1&e){var o=m.Pb();m.Ob(0,"div"),m.Ob(1,"dexih-table-edit-rest",27),m.Vb("onTableChanged",(function(e){return m.vc(o),m.Zb().onTableChanged(e)})),m.Nb(),m.Nb()}if(2&e){var n=m.Zb();m.yb(1),m.hc("formService",n.formsService)("connection",n.connection)}}function Y(e,t){if(1&e){var o=m.Pb();m.Ob(0,"div"),m.Ob(1,"dexih-table-edit-file",28),m.Vb("onTableChanged",(function(e){return m.vc(o),m.Zb().onTableChanged(e)})),m.Nb(),m.Nb()}if(2&e){var n=m.Zb();m.yb(1),m.hc("formService",n.formsService)("connection",n.connection)("isFile",(null==n.connectionReference?null:n.connectionReference.connectionCategory)==n.eConnectionCategory.File)}}var Q,$=((Q=function(){function e(t,o){_classCallCheck(this,e),this.hubService=t,this.route=o,this.isExpanded=!0,this.cancelToken=new u.a,this.entityType="Table",this.canEdit=!1,this.typeCodes=s.a,this.deltaTypes=c.i,this.securityFlags=c.s,this.eTableType=l.ic,this.eTableTypeItems=l.jc,this.eConnectionCategory=l.ib,this.eConnectionPurpose=l.jb,this.runningSql=!1,this._columnData=new i.a(null),this.columnData=this._columnData.asObservable()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(a.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.formsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(t){return R(e,void 0,void 0,regeneratorRuntime.mark((function e(){var o,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t[0],this.hubCache=t[2],this.mainForm=t[3],this.action=o.action,this.pageTitle=o.pageTitle,e.t0=this.hubCache&&this.hubCache.isLoaded()&&this.mainForm,!e.t0){e.next=14;break}return this.connections=this.hubCache.hub.dexihConnections,this.connection=this.connections.find((function(e){return e.key===n.mainForm.controls.connectionKey.value})),e.next=11,this.hubService.GetConnectionReference(this.connection);case 11:this.connectionReference=e.sent,this._connectionSubscription&&this._connectionSubscription.unsubscribe(),this._connectionSubscription=this.mainForm.controls.connectionKey.valueChanges.subscribe((function(e){return R(n,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.connection=this.connections.find((function(t){return t.key===e})),t.next=3,this.hubService.GetConnectionReference(this.connection);case 3:this.connectionReference=t.sent;case 4:case"end":return t.stop()}}),t,this)})))}));case 14:case"end":return e.stop()}}),e,this)})))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Table edit properties")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._connectionSubscription&&this._connectionSubscription.unsubscribe(),this.cancelToken.cancel()}},{key:"reloadColumns",value:function(){var e=this;this.runningSql=!0,this.hubService.importTables([this.mainForm.value],!1,this.cancelToken).then((function(t){if(t&&0!==t.length){for(var o=t[0],n=e.formsService.currentForm.controls.dexihTableColumns;n.controls.length>0;)n.removeAt(0);o.dexihTableColumns.filter((function(e){return e.isValid})).forEach((function(t){n.push(e.formsService.tableColumn(o.dexihTableColumns,t))})),e.runningSql=!1}})).catch((function(){return e.runningSql=!1}))}},{key:"test",value:function(){var e=this;this.runningSql=!0,this.hubService.doImport([this.mainForm.value],!1,this.cancelToken).then((function(t){var o=t[0].dexihTableColumns.map((function(e){return e.name}));e.hubService.addHubSuccessMessage("The query was successful, and returned the following columns.  "+o.join(", ")),e.runningSql=!1})).catch((function(t){e.runningSql=!1,e.sqlMessage=t,e.hubService.addHubMessage(t)}))}}]),e}()).\u0275fac=function(e){return new(e||Q)(m.Kb(r.a),m.Kb(b.a))},Q.\u0275cmp=m.Eb({type:Q,selectors:[["dexih-table-edit-properties"]],inputs:{formsService:"formsService",isExpanded:"isExpanded"},decls:4,vars:5,consts:[["title","Properties",3,"showExpandButton","isExpanded"],[3,"formGroup",4,"ngIf"],[4,"ngIf"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-4"],["label","Connection","formControlName","connectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","The connection for this table.",3,"items","errors"],[3,"key"],["formControlName","name","placeholder","Enter the physical name.","iconClass","fa fa-list","note","The physical name of the underlying entity",3,"label","errors"],["class","form-group col-md-4",4,"ngIf"],["label","Specify a different logical name","formControlName","useLogical"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["class","form-row",4,"ngIf"],["label","Table is shared in the catalog to users with read access.","formControlName","isShared"],["formControlName","schema","placeholder","Enter the (database) schema name","iconClass","fa fa-list","note","The physical name of the database schema (if applicable).",3,"label","errors"],["label","Logical Name","formControlName","logicalName","placeholder","Enter the logical name.","iconClass","fa fa-list","note","The logical name is a short term to represent the table",3,"errors"],[1,"form-group","col-md-6"],["label","Reject Table Name","formControlName","rejectedTableName","placeholder","Enter the rejected table name.","iconClass","fa fa-list","note","The name of the table to send any records that could not be written to the primary table.",3,"errors"],["label","Table Type","formControlName","tableType","itemKey","key","itemName","name",3,"errors","items"],["label","Specify the sql query","rows","15","formControlName","queryString","placeholder","Sql Query",3,"hideToggle","showPreview"],["href","javascript:void(0)",3,"click",4,"ngIf"],[3,"message"],["href","javascript:void(0)",3,"click"],[1,"fa","fa-check-circle-o"],[1,"fa","fa-refresh"],[1,"fa","fa-spin","fa-refresh"],["label","Source Connection Name","formControlName","sourceConnectionName","placeholder","Name of the source connection.","iconClass","fa fa-list","note","The name of the connection for this table in the source hub."],[3,"formService","connection","onTableChanged"],[3,"formService","connection","isFile","onTableChanged"]],template:function(e,t){1&e&&(m.Ob(0,"dexih-widget-section",0),m.Dc(1,z,20,14,"form",1),m.Nb(),m.Dc(2,J,2,2,"div",2),m.Dc(3,Y,2,3,"div",2)),2&e&&(m.hc("showExpandButton",!0)("isExpanded",t.isExpanded),m.yb(1),m.hc("ngIf",t.mainForm),m.yb(1),m.hc("ngIf",(null==t.connectionReference?null:t.connectionReference.connectionCategory)==t.eConnectionCategory.WebService),m.yb(1),m.hc("ngIf",t.connection&&((null==t.connectionReference?null:t.connectionReference.connectionCategory)==t.eConnectionCategory.File||(null==t.connection?null:t.connection.purpose)!==t.eConnectionPurpose.Source)))},directives:[f.T,h.t,d.I,d.t,d.l,f.E,d.s,d.j,p.a,f.D,f.A,f.H,v.a,w,M],encapsulation:2}),Q)},dn85:function(e,t,o){"use strict";o.d(t,"a",(function(){return y}));var n=o("fXoL"),r=o("2v7R"),i=o("ElCs"),a=o("4Y1E"),c=o("cvPx"),l=o("soiQ"),s=o("3Pt+"),u=o("Wumg"),m=o("9nsk"),b=o("ofXK"),f=o("iFLP"),h=o("vDxl");function d(e,t){if(1&e){var o=n.Pb();n.Ob(0,"li"),n.Ob(1,"a",9),n.Vb("click",(function(){n.vc(o);var e=t.$implicit;return n.Zb(2).navigateToColumn(e)})),n.Fc(2),n.Nb(),n.Nb()}if(2&e){var r=t.$implicit;n.yb(2),n.Ic("",r.columnGroup?r.columnGroup+".":"","",r.name,"")}}function p(e,t){if(1&e){var o=n.Pb();n.Ob(0,"dexih-invalid-form-details",4),n.Vb("click",(function(){return n.vc(o),n.Zb().columnFormService.showErrors()})),n.Nb(),n.Ob(1,"dexih-button-dropdown",5),n.Dc(2,d,3,2,"li",6),n.Nb(),n.Ob(3,"dexih-button-apply",7),n.Vb("click",(function(){return n.vc(o),n.Zb().applyExit()})),n.Nb(),n.Ob(4,"dexih-button-cancel",8),n.Vb("click",(function(){return n.vc(o),n.Zb().cancel()})),n.Nb()}if(2&e){var r=n.Zb();n.hc("control",r.columnFormService.currentForm),n.yb(2),n.hc("ngForOf",r.columns),n.yb(1),n.hc("disabled",!(null!=r.columnFormService&&r.columnFormService.hasChanged))}}function v(e,t){if(1&e&&n.Lb(0,"table-edit-columns",10),2&e){var o=n.Zb();n.hc("tableForm",o.tableForm)("parentColumnForm",o.columnFormService.currentForm)}}var y=function(){var e=function(){function e(t,o,r){_classCallCheck(this,e),this.authService=t,this.hubService=o,this.detailedView=!0,this.isUpdated=new n.n,this.changeColumn=new n.n,this.eTypeCode=l.pc,this.columnFormService=new c.a(r,o,t)}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe((function(t){if(t.status===r.j.Loaded){if(e.hubCache=t,!e.hubCache.isLoaded()||!e.tableForm)return;e.initializeForm(),e.updateColumns()}}))}},{key:"ngOnChanges",value:function(){this.tableForm&&this.hubCache&&(this.initializeForm(),this.updateColumns())}},{key:"ngOnDestroy",value:function(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe()}},{key:"initializeForm",value:function(){var e,t=this,o=this.tableForm.value.dexihTableColumns;if(this.columnKey){if(this.tableForm){if(this.originalColumn=o.find((function(e){return e.key===t.columnKey})),!this.originalColumn)return void this.authService.navigateUp();e=this.columnFormService.tableColumn(o,this.originalColumn)}}else{var n=this.hubCache.newColumn(this.tableForm.value,this.deltaType);n?e=this.columnFormService.tableColumn(o,n):this.authService.informationDialog("Column not added.","The column with delta type ".concat(this.deltaType," could not be inserted into the current table."))}this.columnFormService.startForm(e)}},{key:"cancel",value:function(){this.isUpdated.emit(!1)}},{key:"apply",value:function(){var e=this.columnFormService.currentForm,t=this.tableForm.controls.dexihTableColumns;this.originalColumn?t.controls.find((function(t){return t.value.key===e.value.key})).setValue(e.value):t.push(e),this.tableForm.markAsDirty()}},{key:"updateColumns",value:function(){this.tableForm&&this.originalColumn&&(this.columns=this.originalColumn.childColumns.sort((function(e,t){return e.position-t.position})))}},{key:"navigateToColumn",value:function(e){this.apply(),this.changeColumn.emit(e.key)}},{key:"applyExit",value:function(){this.columnFormService.hasChanged&&(this.apply(),this.isUpdated.emit(!0))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(n.Kb(i.a),n.Kb(a.a),n.Kb(s.g))},e.\u0275cmp=n.Eb({type:e,selectors:[["column-edit"]],inputs:{tableForm:"tableForm",columnKey:"columnKey",deltaType:"deltaType",detailedView:"detailedView"},outputs:{isUpdated:"isUpdated",changeColumn:"changeColumn"},features:[n.wb],decls:5,vars:4,consts:[["title","Edit Column",3,"showExpandButton"],["header",""],[3,"columnFormService","detailedView"],[3,"tableForm","parentColumnForm",4,"ngIf"],[1,"mr-1",3,"control","click"],["buttonClass","btn-primary","text","Column",1,"mr-1"],[4,"ngFor","ngForOf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"dropdown-item",3,"click"],[3,"tableForm","parentColumnForm"]],template:function(e,t){1&e&&(n.Ob(0,"dexih-widget-section",0),n.Dc(1,p,5,3,"ng-template",null,1,n.Ec),n.Lb(3,"column-edit-base",2),n.Nb(),n.Dc(4,v,1,2,"table-edit-columns",3)),2&e&&(n.hc("showExpandButton",!0),n.yb(3),n.hc("columnFormService",t.columnFormService)("detailedView",t.detailedView),n.yb(1),n.hc("ngIf",(null==t.columnFormService||null==t.columnFormService.currentForm?null:t.columnFormService.currentForm.controls.dataType.value)===t.eTypeCode.Node))},directives:[u.T,m.a,b.t,f.a,u.i,b.s,u.a,u.b,h.a],encapsulation:2}),e}()},vDxl:function(e,t,o){"use strict";o.d(t,"a",(function(){return g}));var n=o("4Y1E"),r=o("2Vo4"),i=o("cvPx"),a=o("2v7R"),c=o("soiQ"),l=o("fXoL"),s=o("tyNb"),u=o("Wumg"),m=o("H3K+"),b=o("ofXK"),f=o("zal2");function h(e,t){if(1&e){var o=l.Pb();l.Ob(0,"dexih-button-delete",9),l.Vb("click",(function(){l.vc(o);var e=t.items;return l.Zb().deleteSelected(e)})),l.Nb(),l.Ob(1,"dexih-button",10),l.Vb("click",(function(){l.vc(o);var e=l.Zb();return e.showBulkEdit=!e.showBulkEdit})),l.Fc(2),l.Nb()}if(2&e){var n=l.Zb();l.yb(2),l.Hc(" ",n.showBulkEdit?"Hide Bulk Edit":"Show Bulk Edit"," ")}}function d(e,t){if(1&e){var o=l.Pb();l.Ob(0,"column-edit-bulk",12),l.Vb("updated",(function(){return l.vc(o),l.Zb(2).showBulkEdit=!1})),l.Nb()}if(2&e){var n=l.Zb().items,r=l.Zb();l.hc("columns",n)("columnsFormArray",r.formsService.currentForm.controls.dexihTableColumns)}}function p(e,t){if(1&e&&l.Dc(0,d,1,2,"column-edit-bulk",11),2&e){var o=t.items,n=l.Zb();l.hc("ngIf",n.formsService.currentForm&&n.showBulkEdit&&o.length>0)}}function v(e,t){if(1&e){var o=l.Pb();l.Ob(0,"dexih-button-new",13),l.Vb("click",(function(){return l.vc(o),l.Zb().newColumn()})),l.Nb()}}function y(e,t){if(1&e){var o=l.Pb();l.Ob(0,"dexih-button-edit",14),l.Vb("click",(function(){l.vc(o);var e=t.item;return l.Zb().editColumn(e)})),l.Nb()}}var g=function(){var e=function(){function e(t,o,n,i){_classCallCheck(this,e),this.hubService=t,this.formsService=o,this.route=n,this.router=i,this.entityType="Table",this.canEdit=!1,this.deltaTypes=a.i,this.securityFlags=a.s,this.showBulkEdit=!1,this.eConnectionPurpose=c.jb,this.columns=[{name:"position",title:"#",format:""},{name:"name",title:"Column Name",format:"",class:"nameClass",tooltip:"description"},{name:"logicalName",title:"Logical Name",format:"Md",footer:"description",class:"logicalNameClass"},{name:"isInput",title:"Input?",format:"Boolean"},{name:"dataType",title:"Data Type",format:""},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"deltaType",title:"Delta Type",format:""},{name:"defaultValue",title:"Default Value",format:""},{name:"columnValidation",title:"Column Validation",format:""},{name:"isIncrementalUpdate",title:"Is Incremental",format:"Boolean"},{name:"securityFlag",title:"Security Flag",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._columnData=new r.a(null),this.columnData=this._columnData.asObservable()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe((function(t){t&&t.status===a.j.Loaded&&(e.hubCache=t,e.updateColumnData())}))}},{key:"ngOnChanges",value:function(){var e=this;this._tableFormSubscription&&this._tableFormSubscription.unsubscribe(),this.formsService.currentForm&&(this._tableFormSubscription=this.formsService.currentForm.valueChanges.subscribe((function(){return e.updateColumnData()}))),this.updateColumnData()}},{key:"ngOnDestroy",value:function(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this._tableFormSubscription&&this._tableFormSubscription.unsubscribe()}},{key:"updateColumnData",value:function(){var e=this;if(this.hubCache&&this.formsService.currentForm){var t=[];(this.parentColumnForm?this.parentColumnForm.controls.childColumns:this.formsService.currentForm.controls.dexihTableColumns).controls.filter((function(e){return e.value.isValid})).sort((function(e,t){return e.value.position-t.value.position})).forEach((function(o){var n=o;t.push({key:o.value.key,position:o.value.position,name:(o.value.columnGroup?o.value.columnGroup+".":"")+o.value.name,nameClass:n.controls.name.valid?"":"dexih-state-error",description:o.value.description,isInput:o.value.isInput,dataType:e.hubCache.dataTypeToString(o.value),allowDbNull:o.value.allowDbNull,logicalName:o.value.logicalName,logicalNameClass:n.controls.logicalName.valid?"":"dexih-error-icon",deltaType:e.deltaTypes.find((function(e){return e.key===o.value.deltaType})).name,defaultValue:o.value.defaultValue,columnValidation:e.hubCache.getColumnValidation(o.value.columnValidationKey).name,isIncrementalUpdate:o.value.isIncrementalUpdate,securityFlag:e.securityFlags.find((function(e){return e.key===o.value.securityFlag})).name,updateDate:o.value.updateDate})})),this._columnData.next(t)}else this._columnData.next(null)}},{key:"deleteColumn",value:function(e){this.deleteSelected([e])}},{key:"deleteSelected",value:function(e){var t=this.formsService.currentForm.controls.dexihTableColumns;e.forEach((function(e){var o=t.controls.findIndex((function(t){return t.value.key===e.key}));t.removeAt(o)}))}},{key:"newColumn",value:function(){this.router.navigate(["column"],{relativeTo:this.route.parent})}},{key:"editColumn",value:function(e){this.router.navigate(["column",e.key],{relativeTo:this.route.parent})}},{key:"columnSortChange",value:function(e){var t=this.formsService.currentForm.controls.dexihTableColumns,o=1;e.forEach((function(e){t.controls.find((function(t){return t.value.key===e.key})).controls.position.setValue(o++)})),this.updateColumnData()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(l.Kb(n.a),l.Kb(i.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["table-edit-columns"]],inputs:{tableForm:"tableForm",parentColumnForm:"parentColumnForm"},features:[l.wb],decls:10,vars:8,consts:[["title","Columns",3,"showExpandButton","padding"],["sortColumn","position",3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","enableManualSort","columns","dataObservable","onSortChanged","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["tableHeader",""],["select","actionsTemplate"],["actions",""],["select","selectedItemAction","class","mr-1"],["selectedItemAction",""],["title","Delete selected columns",1,"mr-1",3,"click"],["iconClass","fa fa-th-list",1,"mr-1",3,"click"],["class","mr-1",3,"columns","columnsFormArray","updated",4,"ngIf"],[1,"mr-1",3,"columns","columnsFormArray","updated"],["title","Create a new column",1,"mr-1",3,"click"],["title","Edit selected column",1,"mr-1",3,"click"]],template:function(e,t){1&e&&(l.Ob(0,"dexih-widget-section",0),l.Ob(1,"dexih-table",1),l.Vb("onSortChanged",(function(e){return t.columnSortChange(e)}))("rowClick",(function(e){return t.editColumn(e)})),l.Dc(2,h,3,1,"ng-template",2,3,l.Ec),l.Dc(4,p,1,1,"ng-template",null,4,l.Ec),l.Dc(6,v,1,0,"ng-template",5,6,l.Ec),l.Dc(8,y,1,0,"ng-template",7,8,l.Ec),l.Nb(),l.Nb()),2&e&&(l.hc("showExpandButton",!0)("padding",!1),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("enableManualSort",!0)("columns",t.columns)("dataObservable",t.columnData))},directives:[u.T,m.a,u.g,u.f,b.t,f.a,u.o,u.j],encapsulation:2}),e}()},vSNy:function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));var n=o("ofXK"),r=o("PCNd"),i=o("3Pt+"),a=o("RRRx"),c=o("fXoL"),l=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(){return{ngModule:e}}}]),e}();return e.\u0275mod=c.Ib({type:e}),e.\u0275inj=c.Hb({factory:function(t){return new(t||e)},imports:[[r.a,n.c,i.n,i.C,a.a]]}),e}()},zal2:function(e,t,o){"use strict";o.d(t,"a",(function(){return w}));var n=o("fXoL"),r=o("2v7R"),i=o("cvPx"),a=o("1qMd"),c=o("soiQ"),l=o("4Y1E"),s=o("Wumg"),u=o("3Pt+"),m=o("ofXK"),b=o("gLgY");function f(e,t){1&e&&(n.Ob(0,"section",11),n.Lb(1,"form-input",12),n.Nb())}function h(e,t){1&e&&(n.Ob(0,"section",13),n.Lb(1,"form-input",14),n.Nb())}function d(e,t){1&e&&(n.Ob(0,"section",13),n.Lb(1,"form-input",15),n.Nb())}function p(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",2),n.Lb(2,"form-select",6),n.Nb(),n.Ob(3,"section",7),n.Lb(4,"form-input",8),n.Nb(),n.Dc(5,f,2,0,"section",9),n.Dc(6,h,2,0,"section",10),n.Dc(7,d,2,0,"section",10),n.Nb()),2&e){var o=n.Zb();n.yb(2),n.hc("items",o.typeCodes),n.yb(3),n.hc("ngIf",o.bulkColumn.value.isString),n.yb(1),n.hc("ngIf",o.bulkColumn.value.isNumber),n.yb(1),n.hc("ngIf",o.bulkColumn.value.isNumber)}}function v(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-input",16),n.Nb(),n.Nb())}function y(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-select",17),n.Nb(),n.Nb()),2&e){var o=n.Zb();n.yb(2),n.hc("items",o.securityFlags)}}function g(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-select",18),n.Nb(),n.Nb()),2&e){var o=n.Zb();n.yb(2),n.hc("items",o.deltaTypes)}}function C(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-input",19),n.Nb(),n.Nb())}function N(e,t){if(1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Ob(2,"form-select",20),n.Lb(3,"columnValidation-edit-button",21),n.Nb(),n.Nb(),n.Nb()),2&e){var o=n.Zb();n.yb(2),n.hc("allowNullSelect",!0)("items",null==o.hubCache?null:o.hubCache.hub.dexihColumnValidations),n.yb(1),n.hc("key",o.bulkColumn.controls.columnValidationKey.value)}}function S(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-checkbox",22),n.Nb(),n.Nb())}function F(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-checkbox",23),n.Nb(),n.Nb())}function k(e,t){1&e&&(n.Ob(0,"div"),n.Ob(1,"section",11),n.Lb(2,"form-checkbox",24),n.Nb(),n.Nb())}function T(e,t){if(1&e){var o=n.Pb();n.Ob(0,"dexih-button-apply",25),n.Vb("click",(function(){n.vc(o);var e=n.Zb();return e.applyBulkEdit(e.items)})),n.Nb(),n.Ob(1,"dexih-button-cancel",25),n.Vb("click",(function(){return n.vc(o),n.Zb().cancel()})),n.Nb()}}var O=function(){return{standalone:!0}},w=function(){var e=function(){function e(t,o){_classCallCheck(this,e),this.hubService=t,this.formsService=o,this.updated=new n.n,this.properties=[{name:"Group Name",property:"group"},{name:"Data Type",property:"dataType"},{name:"Delta Type",property:"deltaType"},{name:"Security Flag",property:"securityFlag"},{name:"Default Value",property:"defaultValue"},{name:"Validation Rule",property:"validationRule"},{name:"Allow DbNull",property:"allowDbNull"},{name:"Is Input",property:"isInput"},{name:"Is Unicode",property:"isUnicode"}],this.typeCodes=a.a,this.deltaTypes=r.i,this.securityFlags=r.s}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.bulkColumn=this.formsService.tableColumn([],new c.I),this.subscription=this.hubService.getHubCacheObservable().subscribe((function(t){e.hubCache=t}))}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"getColumnForm",value:function(e){return this.columnsFormArray.controls.find((function(t){return t.controls.key.value===e.key}))}},{key:"applyBulkEdit",value:function(){var e=this,t=this.bulkColumn.value;this.columns.forEach((function(o){var n=e.getColumnForm(o);if(n)switch(e.property){case"group":n.controls.columnGroup.setValue(t.columnGroup);break;case"dataType":n.controls.dataType.setValue(t.dataType),n.controls.maxLength.setValue(t.maxLength),n.controls.rank.setValue(t.rank),n.controls.precision.setValue(t.precision),n.controls.scale.setValue(t.scale);break;case"deltaType":n.controls.deltaType.setValue(t.deltaType);break;case"securityFlag":n.controls.securityFlag.setValue(t.securityFlag);break;case"defaultValue":n.controls.defaultValue.setValue(t.defaultValue);break;case"validationRule":n.controls.columnValidationKey.setValue(t.columnValidationKey);break;case"allowDbNull":n.controls.allowDbNull.setValue(t.allowDbNull);break;case"isUnicode":n.controls.isUnicode.setValue(t.isUnicode);break;case"isInput":n.controls.isInput.setValue(t.isInput)}})),this.updated.emit()}},{key:"cancel",value:function(){this.updated.emit()}},{key:"setAllowDbNull",value:function(e){var t=this;this.columns.forEach((function(o){t.getColumnForm(o).controls.allowDbNull.setValue(e)}))}},{key:"setIsInput",value:function(e){var t=this;this.columns.forEach((function(o){t.getColumnForm(o).controls.isInput.setValue(e)}))}},{key:"setIsUnicode",value:function(e){var t=this;this.columns.forEach((function(o){t.getColumnForm(o).controls.isUnicode.setValue(e)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(n.Kb(l.a),n.Kb(i.a))},e.\u0275cmp=n.Eb({type:e,selectors:[["column-edit-bulk"]],inputs:{columns:"columns",columnsFormArray:"columnsFormArray"},outputs:{updated:"updated"},decls:15,vars:14,consts:[["title","Update columns","headerClass","text-white bg-primary"],[3,"formGroup"],[1,"form-group","col-md-4"],["label","Property","itemKey","property","itemName","name",3,"ngModel","ngModelOptions","items","ngModelChange"],[4,"ngIf"],["footer",""],["label","Data Type","formControlName","dataType","itemKey","key","itemName","name",3,"items"],[1,"form-group","col-md-2"],["type","number","label","Array Dimensions","formControlName","rank"],["class","form-group col-md-6",4,"ngIf"],["class","form-group col-md-3",4,"ngIf"],[1,"form-group","col-md-6"],["label","Max Length","formControlName","maxLength","placeholder","Max Length","type","number","note","Maximum string length (blank for unlimited)"],[1,"form-group","col-md-3"],["label","Precision","formControlName","precision","placeholder","Precision","type","number"],["label","Scale","formControlName","scale","placeholder","Scale","type","number"],["label","Group","formControlName","columnGroup","placeholder","Enter a column group name","iconClass","fa fa-list","note","The group column grouping, used to distinguish duplicate column names when applying to structured data (such as json)."],["label","Security Flag","formControlName","securityFlag","itemKey","key","itemName","name","note","How to secure this column when reading data.",3,"items"],["label","Delta Type","formControlName","deltaType","itemKey","key","itemName","name","note","How to treat the column when used to update target table.",3,"items"],["label","Default Value","formControlName","defaultValue","placeholder","Default Value","note","Default value if unmapped or null."],["label","Validation Rule","formControlName","columnValidationKey","itemKey","key","itemName","name","note","Validation rule to apply.",3,"allowNullSelect","items"],[3,"key"],["label","Allow Nulls","formControlName","allowDbNull"],["label","Is an Input Column","formControlName","isInput"],["label","Is Unicode","formControlName","isUnicode"],[1,"mr-1",3,"click"]],template:function(e,t){1&e&&(n.Ob(0,"dexih-widget",0),n.Ob(1,"form",1),n.Ob(2,"section",2),n.Ob(3,"form-select",3),n.Vb("ngModelChange",(function(e){return t.property=e})),n.Nb(),n.Nb(),n.Dc(4,p,8,4,"div",4),n.Dc(5,v,3,0,"div",4),n.Dc(6,y,3,1,"div",4),n.Dc(7,g,3,1,"div",4),n.Dc(8,C,3,0,"div",4),n.Dc(9,N,4,3,"div",4),n.Dc(10,S,3,0,"div",4),n.Dc(11,F,3,0,"div",4),n.Dc(12,k,3,0,"div",4),n.Nb(),n.Dc(13,T,2,0,"ng-template",null,5,n.Ec),n.Nb()),2&e&&(n.yb(1),n.hc("formGroup",t.bulkColumn),n.yb(2),n.hc("ngModel",t.property)("ngModelOptions",n.lc(13,O))("items",t.properties),n.yb(1),n.hc("ngIf","dataType"==t.property),n.yb(1),n.hc("ngIf","group"==t.property),n.yb(1),n.hc("ngIf","securityFlag"==t.property),n.yb(1),n.hc("ngIf","deltaType"==t.property),n.yb(1),n.hc("ngIf","defaultValue"==t.property),n.yb(1),n.hc("ngIf","validationRule"==t.property),n.yb(1),n.hc("ngIf","allowDbNull"==t.property),n.yb(1),n.hc("ngIf","isInput"==t.property),n.yb(1),n.hc("ngIf","isUnicode"==t.property))},directives:[s.P,u.I,u.t,u.l,s.E,u.s,u.v,m.t,u.j,s.D,b.a,s.A,s.a,s.b],encapsulation:2}),e}()}}]);