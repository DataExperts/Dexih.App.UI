function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"8Hfl":function(e,t,n){"use strict";n.r(t),n.d(t,"DatalinkEditModule",(function(){return io}));var a,r=n("ofXK"),i=n("tyNb"),o=n("itXk"),l=n("soiQ"),s=n("fXoL"),u=n("4Y1E"),c=n("rgmq"),m=n("Z+eP"),b=n("2Vo4"),d=n("ElCs"),f=n("cvPx"),h=((a=function(){function e(t,n,a){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.hubFormsService=a,this.showAllErrors=!1,this.logger=new c.a("datalink-edit.service"),this.savingDatalink=new b.a(!1)}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"init",value:function(e){this._hubCache=e}},{key:"ngOnDestroy",value:function(){this.hubFormsService.ngOnDestroy()}},{key:"savingDataLinkObservable",value:function(){return this.savingDatalink.asObservable()}},{key:"getValidationTransform",value:function(){return this.logger.LogC((function(){return"getValidationTransform"}),c.b.Trace),this.hubFormsService.currentForm.controls.dexihDatalinkTransforms.controls.find((function(e){return e.value.transformType===l.lc.Validation}))}},{key:"getDatalinkTransform",value:function(e){return this.logger.LogC((function(){return"getDatalinkTransform"}),c.b.Trace),this.hubFormsService.currentForm.controls.dexihDatalinkTransforms.controls.find((function(t){return t.value.key===e}))}},{key:"getDatalinkTransformItem",value:function(e,t){this.logger.LogC((function(){return"getDatalinkTransformItem, key:".concat(t,".")}),c.b.Trace);var n=e.controls.dexihDatalinkTransformItems.controls.find((function(e){return e.value.key===t}));return this.logger.LogC((function(){return"getDatalinkTransformItem finished."}),c.b.Trace),n}},{key:"fixMappings",value:function(e){var t=this,n=new m.b;e.controls.dexihDatalinkTransforms.controls.forEach((function(e){var a=e.controls.runTime.value.inputColumns,r=null;e.value.joinDatalinkTable&&(r=e.value.joinDatalinkTable.dexihDatalinkColumns);var i=t.getNodeColumns(a);t.fixMapping(i,e.controls.nodeDatalinkColumn),t.fixMapping(r,e.controls.joinSortDatalinkColumn),e.controls.nodeDatalinkColumn.value&&(a=n.getAvailableColumns(a,e.controls.nodeDatalinkColumn.value.key,0)),e.controls.dexihDatalinkTransformItems.controls.forEach((function(e){t.fixMapping(a,e.controls.sourceDatalinkColumn),t.fixMapping(r,e.controls.joinDatalinkColumn),t.fixMapping(a,e.controls.filterDatalinkColumn),e.controls.dexihFunctionParameters.controls.forEach((function(e){switch(e.controls.direction.value){case l.Vb.Input:t.fixMapping(a,e.controls.datalinkColumn);break;case l.Vb.Join:t.fixMapping(r,e.controls.datalinkColumn)}e.controls.arrayParameters.controls.forEach((function(e){switch(e.controls.direction.value){case l.Vb.Input:t.fixMapping(a,e.controls.datalinkColumn);break;case l.Vb.Join:t.fixMapping(r,e.controls.datalinkColumn)}}))}))}))}))}},{key:"getNodeColumns",value:function(e){var t=this,n=[];return e&&e.filter((function(e){return e.dataType===l.pc.Node&&e.isValid})).forEach((function(e){n.push(e),e.childColumns&&e.childColumns.length>0&&(n=n.concat(t.getNodeColumns(e.childColumns)))})),n}},{key:"fixMapping",value:function(e,t){var n=t.value;if(e&&n&&e.findIndex((function(e){return e.key===n.key}))<0){var a=e.find((function(e){return e.name===n.name&&e.columnGroup===n.columnGroup}));a||(a=e.find((function(e){return e.name===n.name}))),a&&t.setValue(a)}}},{key:"getFunctionType",value:function(e){var t;switch(e.transformType){case l.lc.Filter:t=l.Cb.Condition;break;case l.lc.Mapping:t=l.Cb.Map;break;case l.lc.Join:t=l.Cb.JoinCondition;break;case l.lc.Group:case l.lc.Aggregate:t=l.Cb.Aggregate;break;case l.lc.Series:t=l.Cb.Series;break;case l.lc.Sort:t=l.Cb.Sort;break;case l.lc.Validation:t=l.Cb.Validate;break;case l.lc.Rows:t=l.Cb.Rows;break;case l.lc.Lookup:t=l.Cb.JoinCondition}return t}},{key:"getVariables",value:function(){return this.hubFormsService.currentForm.controls.parameters.value.map((function(e){return"{"+e.name+"}"})).concat(this._hubCache.hub.dexihHubVariables.map((function(e){return"{"+e.name+"}"})))}},{key:"getColumnGroups",value:function(e){var t=null,n=[],a=null;return e.filter((function(e){return e.isValid})).sort((function(e,t){return e.position-t.position})).forEach((function(e){var r=e.columnGroup?e.columnGroup:"(un-grouped)";r!==t&&(a&&n.push({group:t,columns:a}),t=r,a=[]),a.push(e)})),a&&a.length>0&&n.push({group:t,columns:a}),n}},{key:"insertDatalinkTransformItem",value:function(e,t){this.logger.LogC((function(){return"insertDatalinkTransformItem"}),c.b.Trace);var n=t.value,a=e.controls.dexihDatalinkTransformItems;if(n.key){var r=a.controls.findIndex((function(e){return e.value.key===n.key}));a.removeAt(r);var i=this.hubFormsService.datalinkDatalinkTransformItemFormGroup(e,n);a.push(i)}else{n.key=this._hubCache.getNextSequence(),n.position=0===a.controls.length?1:Math.max.apply(Math,a.controls.map((function(e){return e.value.position})))+1;var o=this.hubFormsService.datalinkDatalinkTransformItemFormGroup(e,n);a.push(o)}return this.fixMappings(this.hubFormsService.currentForm),this.logger.LogC((function(){return"insertDatalinkTransformItem finished"}),c.b.Trace),n}},{key:"deleteDatalinkTransformItem",value:function(e,t){this.logger.LogC((function(){return"deleteDatalinkTransformItem"}),c.b.Trace);var n=e.controls.dexihDatalinkTransformItems,a=n.controls.indexOf(t);n.removeAt(a),this.fixMappings(this.hubFormsService.currentForm)}},{key:"deleteDatalinkTarget",value:function(e,t){this.logger.LogC((function(){return"deleteDatalinkTarget"}),c.b.Trace);var n=e.controls.dexihDatalinkTargets,a=n.controls.findIndex((function(e){return e.value.key===t}));a>=0&&n.removeAt(a)}},{key:"insertDatalinkTransform",value:function(e,t){this.logger.LogC((function(){return"insertDatalinkTransform"}),c.b.Trace);var n=this.hubFormsService.currentForm.controls.dexihDatalinkTransforms,a=new l.w,r=-1;switch(n.controls.forEach((function(e){e.value.key<=r&&(r=e.value.key-1)})),this.logger.LogC((function(){return"insertDatalinkTransform key:"+r}),c.b.Trace),a.key=r,a.transformType=t.transformType,a.transformAssemblyName=t.transformAssemblyName,a.transformClassName=t.transformClassName,a.dexihDatalinkTransformItems=new Array,a.isValid=!0,t.transformType){case l.lc.Group:case l.lc.Rows:case l.lc.Mapping:a.passThroughColumns=!1;break;default:a.passThroughColumns=!0}if(t.transformType!==l.lc.Join&&t.transformType!==l.lc.Lookup&&t.transformType!==l.lc.Concatenate||(a.joinDatalinkTable=new l.r,a.joinDatalinkTable.key=this._hubCache.getNextSequence()),t.transformType===l.lc.Series){var i=new l.x;i.transformItemType=l.kc.Series,i.position=0,i.isValid=!0,a.dexihDatalinkTransformItems.push(i)}a.position=e;var o=this.hubFormsService.datalinkTransformFormGroup(a);return n.push(o),this.resetDatalinkTransformPositions(),this.logger.LogC((function(){return"insertDatalinkTransform finished."}),c.b.Trace),o}},{key:"deleteDatalinkTransform",value:function(e){var t=this;return new Promise((function(n){t.authService.confirmDialog("Delete Transform","Are you sure you would like to remove the transform ".concat(e.name,"?")).then((function(a){if(a){var r=t.hubFormsService.currentForm.controls.dexihDatalinkTransforms,i=r.controls.findIndex((function(t){return t.value.key===e.key}));r.removeAt(i),t.resetDatalinkTransformPositions()}n(a)})).catch((function(){n(!1)}))}))}},{key:"resetDatalinkTransformPositions",value:function(){return e=this,n=regeneratorRuntime.mark((function e(){var t,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.hubFormsService.currentForm.controls.dexihDatalinkTransforms,e.next=3,this.hubService.GetUserConfigTransformReference();case 3:n=e.sent,a=10,t.controls.sort((function(e,t){return e.value.position-t.value.position})).forEach((function(e){var t=e;n.find((function(t){return t.transformClassName===e.value.transformClassName}))?(t.controls.position.setValue(a),a+=10):t.controls.position.setValue(1e6)}));case 6:case"end":return e.stop()}}),e,this)})),new((t=void 0)||(t=Promise))((function(a,r){function i(e){try{l(n.next(e))}catch(t){r(t)}}function o(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,o)}l((n=n.apply(e,[])).next())}));var e,t,n}},{key:"importFunctionMappings",value:function(e,t,n){var a=this.hubFormsService.getDatalinkValue();return this.hubService.hubPostRemote("/api/Hub/ImportFunctionMappings",{hubKey:this._hubCache.hub.hubKey,remoteAgentId:this.hubService.getCurrentRemoteAgentId(),datalink:a,datalinkTransformKey:e,datalinkTransformItem:t},"Importing function mappings...",n)}},{key:"reBuildDatalinkTable",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n?this.authService.confirmDialog("Rebuild Columns?","This action will load the selected table columns, and replace or delete any existing columns.  This may require fixing some mappings.  Do you want to proceed?").then((function(n){n&&t.doRebuildDatalinkTable(e)})).catch():this.doRebuildDatalinkTable(e)}},{key:"doRebuildDatalinkTable",value:function(e){switch(e.dexihDatalinkColumns.forEach((function(e){return e.isValid=!1})),e.sourceType){case l.gc.Table:var t=this._hubCache.getTable(e.sourceTableKey);t&&(e.name=t.name,e.dexihDatalinkColumns=this.mergeDatalinkColumns(e.name,e.key,t.dexihTableColumns,e.dexihDatalinkColumns));break;case l.gc.Datalink:var n=this._hubCache.hub.dexihDatalinks.find((function(t){return t.key===e.sourceDatalinkKey}));if(n){var a;if(e.name=n.name,(new m.b).buildInputOutput(this._hubCache,n),0===n.dexihDatalinkTransforms.length)a=n.sourceDatalinkTable.dexihDatalinkColumns;else{var r=n.dexihDatalinkTransforms.sort((function(e,t){return e.position-t.position}));a=r[r.length-1].runTime.outputColumns}e.dexihDatalinkColumns=this.mergeDatalinkColumns(e.name,e.key,a,e.dexihDatalinkColumns)}break;case l.gc.Rows:e.name="Static Row Set";var i=e.dexihDatalinkColumns.find((function(e){return"RowNumber"===e.name}));i||((i=new l.m).key=this._hubCache.getNextSequence(),i.datalinkTableKey=e.key,e.dexihDatalinkColumns.push(i)),i.name="RowNumber",i.logicalName=i.name,i.dataType=l.pc.Int32,i.isMandatory=!0,i.isValid=!0,i.description="The generated row number of the static row set"}}},{key:"mergeDatalinkColumns",value:function(e,t,n,a){var r=this;return n.forEach((function(n){var i=a.find((function(t){return t.name===n.name&&t.columnGroup===e}));i||(i=a.find((function(e){return e.name===n.name}))),i||((i=new l.m).key=r._hubCache.getNextSequence(),i.datalinkTableKey=t,a.push(i)),Object.keys(i).forEach((function(a){"childColumns"===a?i[a]=n[a]&&n[a].length>0?r.mergeDatalinkColumns(e,t,n[a],i[a]):[]:"key"!==a&&n[a]?i[a]=n[a]:"columnGroup"===a&&e&&(i[a]=i[a]&&i[a]!==e?e+"."+i[a]:e)}))})),a}}]),e}()).\u0275fac=function(e){return new(e||a)(s.Sb(u.a),s.Sb(d.a),s.Sb(f.a))},a.\u0275prov=s.Gb({token:a,factory:a.\u0275fac}),a),p=n("Wumg"),v=n("YcGA"),g=n("3Pt+");function k(e,t){if(1&e&&(s.Ob(0,"form",4),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-select",5),s.Nb(),s.Ob(4,"section"),s.Lb(5,"form-input",6),s.Nb(),s.Ob(6,"section"),s.Lb(7,"form-textarea",7),s.Nb(),s.Ob(8,"section"),s.Lb(9,"form-select",8),s.Nb(),s.Ob(10,"section"),s.Lb(11,"form-checkbox",9),s.Nb(),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.hc("formGroup",n.datalinkForm),s.yb(3),s.hc("items",n.eDatalinkTypeItems)("enableFilter",!1),s.yb(2),s.hc("autocapitalize",!0)("errors",n.editDatalinkService.hubFormsService.formErrors.name),s.yb(2),s.hc("showMarkdown",!0)("errors",n.editDatalinkService.hubFormsService.formErrors.description),s.yb(2),s.hc("items",n.eAlertLevelItems)("errors",n.editDatalinkService.hubFormsService.formErrors.alertLevel)("enableFilter",!1)}}var y,T=((y=function(){function e(t,n,a){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.route=a,this.eConnectionPurpose=l.jb,this.eDatalinkTypeItems=l.ob.filter((function(e){return e.key>0})),this.eAlertLevelItems=l.bb,this.eAlertLevel=l.ab}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle,e.datalinkForm=t[3]}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Properties")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}}]),e}()).\u0275fac=function(e){return new(e||y)(s.Kb(u.a),s.Kb(h),s.Kb(i.a))},y.\u0275cmp=s.Eb({type:y,selectors:[["dexih-datalink-edit-properties-form"]],decls:4,vars:6,consts:[["title","Properties",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["title","Input Parameters",3,"showExpandButton"],[3,"showEdit","parameters","formsService"],[3,"formGroup"],["label","Datalink Type","formControlName","datalinkType","itemKey","key","itemName","description","iconClass","fa fa-database","note","Categorize the type of function this datalink is performing.",3,"items","enableFilter"],["label","Datalink Name","formControlName","name","placeholder","Enter the datalink name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],["label","Alerting Level","formControlName","alertLevel","itemKey","key","itemName","description","iconClass","fa fa-bell","note","When alerts should be sent.",3,"items","errors","enableFilter"],["label","Datalink is shared in the catalog to users with read access.","formControlName","isShared"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,k,12,10,"form",1),s.Nb(),s.Ob(2,"dexih-widget-section",2),s.Lb(3,"input-parameters",3),s.Nb()),2&e&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",t.datalinkForm),s.yb(1),s.hc("showExpandButton",!0),s.yb(1),s.hc("showEdit",!0)("parameters",t.datalinkForm.controls.parameters)("formsService",t.editDatalinkService.hubFormsService))},directives:[p.T,r.t,v.a,g.I,g.t,g.l,p.E,g.s,g.j,p.D,p.H,p.A],encapsulation:2}),y),C=n("2v7R"),F=n("Npcx"),D=n("3WyZ"),w=n("iFLP"),S=n("64E1"),N=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{s(a.next(e))}catch(t){i(t)}}function l(e){try{s(a.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,l)}s((a=a.apply(e,t||[])).next())}))};function O(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-splitdropdown",4),s.Vb("buttonClick",(function(){return s.vc(n),s.Zb().saveDatalink(!1)})),s.Ob(1,"li"),s.Ob(2,"a",5),s.Vb("click",(function(){return s.vc(n),s.Zb().saveDatalink(!1)})),s.Lb(3,"i",6),s.Fc(4," Save"),s.Nb(),s.Nb(),s.Ob(5,"li"),s.Ob(6,"a",7),s.Vb("click",(function(){return s.vc(n),s.Zb().editDatalinkService.hubFormsService.saveLocal()})),s.Lb(7,"i",8),s.Fc(8," Save as file"),s.Nb(),s.Nb(),s.Ob(9,"li"),s.Ob(10,"a",9),s.Vb("click",(function(){return s.vc(n),s.Zb().saveDatalink(!0)})),s.Lb(11,"i",10),s.Fc(12," Save As..."),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("disabled",!a.editDatalinkService.hubFormsService.hasChanged)}}function I(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-dropdown",11),s.Ob(1,"a",12),s.Vb("click",(function(){return s.vc(n),s.Zb().fixMappings()})),s.Fc(2,"Fix Mappings"),s.Nb(),s.Ob(3,"a",13),s.Vb("click",(function(){return s.vc(n),s.Zb().runDatalink(!1,!1)})),s.Fc(4,"Run"),s.Nb(),s.Ob(5,"a",13),s.Vb("click",(function(){return s.vc(n),s.Zb().runDatalink(!0,!0)})),s.Fc(6,"Run (with truncate)"),s.Nb(),s.Ob(7,"a",14),s.Vb("click",(function(){return s.vc(n),s.Zb().runDatalink(!1,!0)})),s.Fc(8,"Run (reset incremental)"),s.Nb(),s.Ob(9,"a",15),s.Vb("click",(function(){return s.vc(n),s.Zb().preview()})),s.Fc(10,"Preview Datalink"),s.Nb(),s.Ob(11,"a",16),s.Vb("click",(function(){return s.vc(n),s.Zb().download()})),s.Fc(12,"Download Datalink Data"),s.Nb(),s.Nb()}2&e&&s.hc("pullRight",!0)}var x,P=((x=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.authService=a,this.router=r,this.route=i,this.cancelToken=new D.a,this.eUpdateStrategy=l.qc}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getHubCacheObservable()).subscribe((function(t){e.datalinkForm=t[0],e.hubCache=t[1]}))}catch(t){this.hubService.addHubClientErrorMessage(t,"datalink save button")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}},{key:"saveDatalink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return N(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a,r,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.editDatalinkService.savingDatalink.next(!0),!this.datalinkForm.controls.dexihDatalinkTargets.dirty){t.next=10;break}if(n=this.datalinkForm.controls.dexihDatalinkTargets,a=n.controls.map((function(e){var t=e.controls.table;if(t)return t})).filter((function(e){return e.value.key>0&&e.dirty})).map((function(e){return e.value.name})).join(", "),r=function(){return N(i,void 0,void 0,regeneratorRuntime.mark((function t(){var a,r,i,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=_createForOfIteratorHelper(n.controls),t.prev=1,a.s();case 3:if((r=a.n()).done){t.next=13;break}if(!(i=r.value).dirty){t.next=11;break}return o=i,t.next=9,this.hubService.saveTables([o.controls.table.value]);case 9:l=t.sent,o.setControl("table",this.editDatalinkService.hubFormsService.tableForm(l[0])),o.controls.tableKey.setValue(l[0].key);case 11:t.next=3;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),a.e(t.t0);case 18:return t.prev=18,a.f(),t.finish(18);case 21:this.editDatalinkService.hubFormsService.save(!1,e),this.editDatalinkService.savingDatalink.next(!1);case 22:case"end":return t.stop()}}),t,this,[[1,15,18,21]])})))},0!==a.length){t.next=7;break}return t.next=5,r();case 5:t.next=8;break;case 7:this.authService.confirmDialog("Save Target Tables?","The existing target table(s)\n                ".concat(a," have changed.\n                This is a shared object, and may impact other dependencies if changed.\n                Note, this will only save the metadata, use the 'Create Table' function to overwrite the physical table.")).then((function(e){return N(i,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e,!t.t0){t.next=4;break}return t.next=4,r();case 4:case"end":return t.stop()}}),t)})))})).catch((function(){return i.editDatalinkService.savingDatalink.next(!1)}));case 8:t.next=11;break;case 10:this.editDatalinkService.hubFormsService.save(!1,e),this.editDatalinkService.savingDatalink.next(!1);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"preview",value:function(){var e=this.datalinkForm.controls.dexihDatalinkTransforms.controls.sort((function(e,t){return t.value.position-e.value.position}));e.length>0&&this.router.navigate(["transforms/transform",e[0].value.key,"preview-transform-data"],{relativeTo:this.route})}},{key:"download",value:function(){var e=this;this.datalinkForm.dirty?this.authService.confirmDialog("Save Datalink","The datalink must be saved before a data download task can be started.  Do you want to save the datalink?").then((function(t){t&&(e.saveDatalink(),e.doDownload())})):this.doDownload()}},{key:"doDownload",value:function(){var e=new Array,t=new l.M;t.objectKey=this.datalinkForm.controls.key.value,t.objectType=l.lb.Datalink,e.push(t),this.hubService.downloadData(e,!0,l.rb.Csv,this.cancelToken)}},{key:"cancel",value:function(){this.editDatalinkService.hubFormsService.cancel()}},{key:"runDatalink",value:function(e,t){var n=this;this.editDatalinkService.hubFormsService.hasChanged?this.authService.confirmDialog("Save Datalink","The datalink must be saved before running.  Would you like to save now?").then((function(a){a&&(n.saveDatalink(),n.editDatalinkService.savingDatalink.toPromise().then((function(a){a&&n.hubService.runDatalinks([n.datalinkForm.controls.key.value],e,t,null,null,null,n.cancelToken)})))})):this.hubService.runDatalinks([this.datalinkForm.controls.key.value],e,t,null,null,null,this.cancelToken)}},{key:"fixMappings",value:function(){this.editDatalinkService.fixMappings(this.datalinkForm)}}]),e}()).\u0275fac=function(e){return new(e||x)(s.Kb(u.a),s.Kb(h),s.Kb(d.a),s.Kb(i.e),s.Kb(i.a))},x.\u0275cmp=s.Eb({type:x,selectors:[["datalink-save-button"]],decls:4,vars:4,consts:[[1,"mr-1",3,"control"],["buttonClass","btn-primary","iconClass","fa fa-save","text","Save","class","mr-1",3,"disabled","buttonClick",4,"ngIf"],["class","mr-1","text","Actions","iconClass","fa fa-bolt","buttonClass","btn-primary",3,"pullRight",4,"ngIf"],[3,"formsService"],["buttonClass","btn-primary","iconClass","fa fa-save","text","Save",1,"mr-1",3,"disabled","buttonClick"],["title","Save in the hub",1,"dropdown-item",3,"click"],[1,"fa","fa-cloud"],["title","Export as a local file",1,"dropdown-item",3,"click"],[1,"fa","fa-floppy-o"],["title","Save another version",1,"dropdown-item",3,"click"],[1,"fa","fa-plus-circle"],["text","Actions","iconClass","fa fa-bolt","buttonClass","btn-primary",1,"mr-1",3,"pullRight"],["title","Attempt to fix mappings broken when removing/inserting transforms.",1,"dropdown-item",3,"click"],["title","Run datalink, truncating the target table for each.",1,"dropdown-item",3,"click"],["title","Run datalink, resetting the incremental (i.e. reload all source data rows) ",1,"dropdown-item",3,"click"],["title","Preview the output of this datalink",1,"dropdown-item",3,"click"],["title","Download the output from this datalink",1,"dropdown-item",3,"click"]],template:function(e,t){1&e&&(s.Lb(0,"dexih-invalid-form-details",0),s.Dc(1,O,13,1,"dexih-button-splitdropdown",1),s.Dc(2,I,13,1,"dexih-button-dropdown",2),s.Lb(3,"cancel-button",3)),2&e&&(s.hc("control",t.datalinkForm),s.yb(1),s.hc("ngIf",t.hubCache.canWrite),s.yb(1),s.hc("ngIf",t.hubCache.canWrite&&(null==t.datalinkForm?null:t.datalinkForm.controls.dexihDatalinkTargets.value.length)>0),s.yb(1),s.hc("formsService",t.editDatalinkService.hubFormsService))},directives:[w.a,r.t,S.a,p.w,p.i],encapsulation:2}),x),V=n("ZKkd"),E=n("/pur");function K(e,t){1&e&&(s.Ob(0,"li",19),s.Ob(1,"a",28),s.Lb(2,"i",29),s.Fc(3," Validation"),s.Nb(),s.Nb())}function L(e,t){1&e&&(s.Ob(0,"li",19),s.Ob(1,"a",30),s.Lb(2,"i",31),s.Fc(3," Profiling"),s.Nb(),s.Nb())}function M(e,t){if(1&e&&(s.Ob(0,"li",19),s.Ob(1,"a",22),s.Lb(2,"i",23),s.Fc(3," Transforms "),s.Lb(4,"dexih-invalid-form-icon",24),s.Nb(),s.Nb(),s.Dc(5,K,4,0,"li",25),s.Dc(6,L,4,0,"li",25),s.Ob(7,"li",19),s.Ob(8,"a",26),s.Lb(9,"i",27),s.Fc(10," Target"),s.Nb(),s.Nb()),2&e){var n=s.Zb(3);s.yb(4),s.hc("control",n.datalinkForm.controls.dexihDatalinkTransforms),s.yb(1),s.hc("ngIf",!n.datalinkForm.controls.isQuery.value),s.yb(1),s.hc("ngIf",!n.datalinkForm.controls.isQuery.value)}}function Z(e,t){if(1&e&&(s.Ob(0,"div",17),s.Ob(1,"ul",18),s.Ob(2,"li",19),s.Ob(3,"a",20),s.Lb(4,"i",10),s.Fc(5,"Properties"),s.Nb(),s.Nb(),s.Ob(6,"li",19),s.Ob(7,"a",21),s.Lb(8,"i",12),s.Fc(9," Source"),s.Nb(),s.Nb(),s.Dc(10,M,11,3,"ng-template",13),s.Nb(),s.Nb()),2&e){var n=s.Zb(2);s.yb(10),s.hc("ngIf",null==n.datalinkForm?null:n.datalinkForm.controls.sourceDatalinkTable.value)}}function A(e,t){1&e&&(s.Ob(0,"a",36),s.Lb(1,"i",29),s.Fc(2,"Validation"),s.Nb())}function _(e,t){1&e&&(s.Ob(0,"a",37),s.Lb(1,"i",31),s.Fc(2,"Profiling"),s.Nb())}function G(e,t){if(1&e&&(s.Ob(0,"a",32),s.Lb(1,"i",23),s.Fc(2,"Transforms"),s.Nb(),s.Dc(3,A,3,0,"a",33),s.Dc(4,_,3,0,"a",34),s.Ob(5,"a",35),s.Lb(6,"i",27),s.Fc(7,"Target"),s.Nb()),2&e){var n=s.Zb(2);s.yb(3),s.hc("ngIf",!n.datalinkForm.controls.isQuery.value),s.yb(1),s.hc("ngIf",!n.datalinkForm.controls.isQuery.value)}}function R(e,t){if(1&e&&s.Lb(0,"dexih-help",38),2&e){var n=s.Zb(2);s.jc("path","/assets/help/reference/",n.help,"")}}function j(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",1),s.Ob(1,"dexih-widget",2),s.Vb("close",(function(){return s.vc(n),s.Zb().cancel()})),s.Dc(2,Z,11,1,"ng-template",null,3,s.Ec),s.Ob(4,"ul",4),s.Ob(5,"li",5),s.Ob(6,"div",6),s.Ob(7,"div",7),s.Ob(8,"dexih-button-dropdown",8),s.Ob(9,"a",9),s.Lb(10,"i",10),s.Fc(11,"Properties"),s.Nb(),s.Ob(12,"a",11),s.Lb(13,"i",12),s.Fc(14,"Source"),s.Nb(),s.Dc(15,G,8,2,"ng-template",13),s.Nb(),s.Nb(),s.Lb(16,"datalink-status",14),s.Ob(17,"div",15),s.Lb(18,"datalink-save-button"),s.Nb(),s.Nb(),s.Nb(),s.Lb(19,"router-outlet"),s.Nb(),s.Nb(),s.Dc(20,R,1,1,"dexih-help",16),s.Nb()}if(2&e){var a=s.Zb();s.yb(1),s.hc("showCloseButton",!0)("padding",!1),s.yb(14),s.hc("ngIf",a.datalinkForm.controls.sourceDatalinkTable.value),s.yb(1),s.hc("datalinkKey",null==a.datalinkForm?null:a.datalinkForm.controls.key.value),s.yb(4),s.hc("ngIf",a.help)}}var H,J=((H=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.savingDatalink=!1,this.logger=new c.a("datalink-edit.component"),this.logCount=0,this.eTransformWriterMethod=l.nc,this.isLoaded=!1,this.showPage=!1,this.showPageMessage="Loading datalink..."}return _createClass(e,[{key:"getHelp",value:function(){for(var e=this.router.routerState.root.snapshot;e.firstChild;)e=e.firstChild;this.help=e.data.help}},{key:"ngOnInit",value:function(){var e=this;this.logger.LogC((function(){return"OnInit"}),c.b.Trace);try{this.router.events.subscribe((function(t){t instanceof i.b&&e.getHelp()})),this.getHelp(),this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe((function(t){e.action=t[0].action,e.pageTitle=t[0].pageTitle,e.params=t[1],e.hubCache=t[2],e.hubCache&&e.hubCache.status===C.j.Loaded&&(e.editDatalinkService.init(e.hubCache),e.isLoaded&&"new"===e.action||(e.isLoaded&&e.editDatalinkService.hubFormsService.hasChanged?e.authService.confirmDialog("Datalink synchronization warning","The hub was disconnected, meaning the datalink could have been changed by another session.  Would you like to discard the current changes, and reload the latest version of the datalink?").then((function(t){t&&e.load()})).catch((function(e){})):e.load()))})),this.editDatalinkService.ngOnInit()}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe(),this.editDatalinkService.ngOnDestroy()}},{key:"load",value:function(){var e=this;if(this.logger.LogC((function(){return"Subscription count: "+e.logCount++}),c.b.Trace),"edit"===this.action){var t=+this.params.datalinkKey;if(t){var n=this.hubCache.hub.dexihDatalinks.find((function(e){return e.key===t}));n?(this.editDatalinkService.hubFormsService.datalink(n),this.route.snapshot.data.pageTitle="Datalink ("+n.name+")"):(this.logger.LogC((function(){return"no datalink found. key: "+t}),c.b.Warning),this.hubService.addHubErrorMessage("A datalink with the key "+t+" could not be found in the repository."),this.showPageMessage="Edit failed...")}else this.logger.LogC((function(){return"no datalink found."}),c.b.Warning),this.hubService.addHubErrorMessage("There was no datalink specified to edit."),this.showPageMessage="Edit failed...",this.editDatalinkService.hubFormsService.datalink(null)}else if(this.isLoaded||"new"!==this.action)if(this.isLoaded||"copy"!==this.action){if("sourceTable"===this.action){var a=new l.l;a.datalinkType=l.nb.Query,a.sourceDatalinkTable=new l.r,a.sourceDatalinkTable.sourceType=l.gc.Table,a.sourceDatalinkTable.sourceTableKey=+this.params.sourceTableKey,this.editDatalinkService.reBuildDatalinkTable(a.sourceDatalinkTable),a.name="Datalink query for "+a.sourceDatalinkTable.name,this.editDatalinkService.hubFormsService.datalink(a),this.editDatalinkService.hubFormsService.currentForm.markAsDirty(),this.editDatalinkService.hubFormsService.hasChanged=!0,this.logger.LogC((function(){return"new source table datalink set."}),c.b.Warning)}}else{var r=+this.params.datalinkKey;if(r){var i=this.hubCache.hub.dexihDatalinks.find((function(e){return e.key===r}));if(i){var o=this.hubCache.CopyDatalink(i);this.editDatalinkService.hubFormsService.datalink(o),this.editDatalinkService.hubFormsService.hasChanged=!0,this.route.snapshot.data.pageTitle="Datalink ("+o.name+")"}else this.logger.LogC((function(){return"no datalink found. key: "+r}),c.b.Warning),this.hubService.addHubErrorMessage("A datalink with the key "+r+" could not be found in the repository."),this.showPageMessage="Copy failed..."}else this.logger.LogC((function(){return"no datalink found."}),c.b.Warning),this.hubService.addHubErrorMessage("There was no datalink specified to copy."),this.showPageMessage="Copy failed...",this.editDatalinkService.hubFormsService.datalink(null)}else{var s=new l.l;s.sourceDatalinkTable=new l.r,this.editDatalinkService.hubFormsService.datalink(s),this.logger.LogC((function(){return"new datalink set."}),c.b.Warning)}this.isLoaded=!0,this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe(),this._datalinkFormSubscription=this.editDatalinkService.hubFormsService.getCurrentFormObservable().subscribe((function(t){if(t){e.datalinkForm=t;var n=t.controls.key.value;if(n&&history.pushState){var a=window.location.pathname.replace("/new","/edit/"+n);e.router.navigateByUrl(a)}}})),this.showPage=!0,this.showPageMessage=""}},{key:"canDeactivate",value:function(){var e=this;return new Promise((function(t){e.editDatalinkService.hubFormsService.hasChanged?e.authService.confirmDialog("Datalink changes have not been saved","The datalink changes have not been saved.  Do you want to discard the changes and exit?").then((function(e){t(e)})).catch((function(e){t(!1)})):t(!0)}))}},{key:"unloadNotification",value:function(e){this.editDatalinkService.hubFormsService.hasChanged&&(e.returnValue="The datalink changes have not been saved.  Do you want to discard the changes and exit?")}},{key:"saveDatalink",value:function(){this.editDatalinkService.hubFormsService.save()}},{key:"cancel",value:function(){this.editDatalinkService.hubFormsService.cancel()}}]),e}()).\u0275fac=function(e){return new(e||H)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},H.\u0275cmp=s.Eb({type:H,selectors:[["dexih-datalink-edit-form"]],hostBindings:function(e,t){1&e&&s.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,s.uc)},decls:1,vars:1,consts:[["class","container-fluid",4,"ngIf"],[1,"container-fluid"],["title","Edit Datalink","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","padding","close"],["header",""],[1,"list-group"],[1,"list-group-item","rounded-0"],[1,"d-flex"],[1,"d-xl-none"],["buttonClass","btn btn-success","text","Navigate"],["routerLinkActive","active","routerLink","properties",1,"dropdown-item"],[1,"fa","fa-cog"],["routerLinkActive","active","routerLink","source-table",1,"dropdown-item"],[1,"fa","fa-arrow-circle-o-right"],[3,"ngIf"],[1,"d-none","d-xl-inline",3,"datalinkKey"],[1,"ml-auto"],["class","m-3","title","Datalinks",3,"path",4,"ngIf"],[1,"d-none","d-xl-inline"],[1,"nav","nav-tabs","card-header-tabs"],[1,"nav-item"],["routerLink","properties","routerLinkActive","active",1,"nav-link"],["routerLink","source-table","routerLinkActive","active",1,"nav-link"],["routerLink","transforms","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-share-alt"],[3,"control"],["class","nav-item",4,"ngIf"],["routerLink","target","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-arrow-circle-right"],["routerLink","validation","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-check-square-o"],["routerLink","profile-rules","routerLinkActive","active",1,"nav-link"],[1,"fa","fa-bug"],["routerLinkActive","active","routerLink","transforms",1,"dropdown-item"],["class","dropdown-item","routerLink","validation","routerLinkActive","active",4,"ngIf"],["class","dropdown-item","routerLink","profile-rules","routerLinkActive","active",4,"ngIf"],["routerLink","target","routerLinkActive","active",1,"dropdown-item"],["routerLink","validation","routerLinkActive","active",1,"dropdown-item"],["routerLink","profile-rules","routerLinkActive","active",1,"dropdown-item"],["title","Datalinks",1,"m-3",3,"path"]],template:function(e,t){1&e&&s.Dc(0,j,21,5,"div",0),2&e&&s.hc("ngIf",t.datalinkForm&&!t.datalinkForm.pending)},directives:[r.t,p.P,p.i,i.h,i.g,F.a,P,i.j,V.a,E.a],encapsulation:2}),H),B=n("H3K+"),$=n("VRyK"),U=n("+F4M"),q=n("hJJo");function z(e,t){if(1&e&&(s.Ob(0,"section"),s.Ob(1,"form-select",8),s.Lb(2,"table-edit-button",9),s.Nb(),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("errors",null==n.errors?null:n.errors.sourceTableKey)("items",n.connectionTables),s.yb(1),s.hc("key",n.datalinkTableForm.controls.sourceTableKey.value)}}function W(e,t){if(1&e&&(s.Ob(0,"section"),s.Ob(1,"form-select",10),s.Lb(2,"datalink-edit-button",9),s.Nb(),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("errors",null==n.errors?null:n.errors.sourceDatalinkKey)("items",n.datalinks),s.yb(1),s.hc("key",n.datalinkTableForm.controls.sourceDatalinkKey.value)}}function Q(e,t){1&e&&(s.Ob(0,"section"),s.Lb(1,"form-input",11),s.Lb(2,"form-input",12),s.Lb(3,"form-input",13),s.Nb())}function Y(e,t){1&e&&s.Lb(0,"form-checkbox",14)}function X(e,t){if(1&e){var n=s.Pb();s.Ob(0,"form",1),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-select",2),s.Nb(),s.Dc(4,z,3,3,"section",3),s.Dc(5,W,3,3,"section",3),s.Dc(6,Q,4,0,"section",3),s.Ob(7,"section"),s.Lb(8,"form-checkbox",4),s.Dc(9,Y,1,0,"form-checkbox",5),s.Lb(10,"form-input",6),s.Nb(),s.Ob(11,"dexih-button-refresh",7),s.Vb("click",(function(){return s.vc(n),s.Zb().refreshColumns()})),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("formGroup",a.datalinkTableForm),s.yb(3),s.hc("items",a.sourceTypes)("enableFilter",!1),s.yb(1),s.hc("ngIf",a.datalinkTableForm.value.sourceType==a.eSourceType.Table),s.yb(1),s.hc("ngIf",a.datalinkTableForm.value.sourceType==a.eSourceType.Datalink),s.yb(1),s.hc("ngIf",a.datalinkTableForm.value.sourceType==a.eSourceType.Rows),s.yb(3),s.hc("ngIf",a.isVersioned)}}var ee,te=((ee=function(){function e(t,n){_classCallCheck(this,e),this.hubService=t,this.datalinkEditService=n,this.eSourceType=l.gc,this.sourceTypes=C.w,this.connectionTables=[],this.datalinks=[],this.isVersioned=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.errors=this.datalinkEditService.hubFormsService.getFormErrorMessages(this.datalinkTableForm,!0);try{this._subscription=Object(o.a)(this.hubService.getHubCacheObservable()).subscribe((function(t){e.hubCache=t[0],e.subscribeDatalinkChanges(),e.hubCache&&e.hubCache.isLoaded()&&e.datalinkTableForm&&(e.connectionTables=e.hubCache.getConnectionTables(),e.datalinks=e.hubCache.hub.dexihDatalinks,e.updateIsVersioned())}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Selected datalink table")}}},{key:"updateIsVersioned",value:function(){if(this.datalinkTableForm.controls.sourceType.value===l.gc.Table){var e=this.hubCache.getTable(this.datalinkTableForm.controls.sourceTableKey.value);e&&(this.isVersioned=e.isVersioned)}}},{key:"subscribeDatalinkChanges",value:function(){var e=this;this._datalinkTableSubscription&&this._datalinkTableSubscription.unsubscribe(),this._datalinkTableSubscription=Object($.a)(this.datalinkTableForm.controls.sourceType.valueChanges,this.datalinkTableForm.controls.sourceTableKey.valueChanges,this.datalinkTableForm.controls.sourceDatalinkKey.valueChanges).subscribe((function(){e.errors=e.datalinkEditService.hubFormsService.getFormErrorMessages(e.datalinkTableForm,!0),e.refreshColumns()}))}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._datalinkTableSubscription&&this._datalinkTableSubscription.unsubscribe()}},{key:"refreshColumns",value:function(){var e=this;try{this._datalinkTableSubscription&&this._datalinkTableSubscription.unsubscribe();var t=this.datalinkTableForm.value;t.sourceType=this.datalinkTableForm.controls.sourceType.value,t.sourceTableKey=this.datalinkTableForm.controls.sourceTableKey.value,t.sourceDatalinkKey=this.datalinkTableForm.controls.sourceDatalinkKey.value,this.datalinkEditService.reBuildDatalinkTable(t),this.datalinkEditService.fixMappings(this.datalinkEditService.hubFormsService.currentForm),this.datalinkTableForm.controls.name.setValue(t.name),this.datalinkTableForm.controls.rowsEndAt.setValue(t.rowsEndAt),this.datalinkTableForm.controls.rowsStartAt.setValue(t.rowsStartAt),this.datalinkTableForm.controls.rowsIncrement.setValue(t.rowsIncrement),this.datalinkTableForm.controls.sourceType.setValue(t.sourceType),this.updateIsVersioned();for(var n=this.datalinkTableForm.controls.dexihDatalinkColumns;n.length>0;)n.removeAt(0);t.dexihDatalinkColumns.sort((function(e,t){return e.position-t.position})).filter((function(e){return e.isValid})).forEach((function(t){n.push(e.datalinkEditService.hubFormsService.datalinkTableColumn(n.value,t))})),this.subscribeDatalinkChanges()}catch(a){this.hubService.addHubClientErrorMessage(a,"Refresh datalink columns")}}}]),e}()).\u0275fac=function(e){return new(e||ee)(s.Kb(u.a),s.Kb(h))},ee.\u0275cmp=s.Eb({type:ee,selectors:[["datalink-table"]],inputs:{datalinkTableForm:"datalinkTableForm"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Data Source Type","formControlName","sourceType","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the source type for this table",3,"items","enableFilter"],[4,"ngIf"],["label","Disable query logic being pushed down to the database","formControlName","disablePushDown"],["label","Disable source table versions","formControlName","disableVersioning",4,"ngIf"],["label","Table Alias","formControlName","name","note","An alias that can be used to describe the table instance (this is generally used to differentiate self-joined tables)."],["tooltip","Refresh the columns from the source table.",3,"click"],["label","Source Table","formControlName","sourceTableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the source table",3,"errors","items"],[3,"key"],["label","Source Datalink","formControlName","sourceDatalinkKey","itemKey","key","itemName","name","note","Select the source datalink",3,"errors","items"],["label","Start At","type","number","formControlName","rowsStartAt","placeholder","Enter start row number","iconClass","fa fa-list"],["label","End At","type","number","formControlName","rowsEndAt","placeholder","Enter end row number","iconClass","fa fa-list"],["label","Increment By","type","number","formControlName","rowsIncrement","placeholder","Enter increment value","iconClass","fa fa-list"],["label","Disable source table versions","formControlName","disableVersioning"]],template:function(e,t){1&e&&s.Dc(0,X,12,7,"form",0),2&e&&s.hc("ngIf",t.datalinkTableForm)},directives:[r.t,g.I,g.t,g.l,p.E,g.s,g.j,p.A,p.D,p.s,U.a,q.a],encapsulation:2}),ee),ne=function(e){return["table-edit",e]};function ae(e,t){if(1&e&&(s.Ob(0,"dexih-button-edit",13),s.Fc(1," Table "),s.Nb()),2&e){var n=s.Zb(2);s.hc("routerLink",s.mc(1,ne,n.datalinkForm.controls.sourceDatalinkTable.value.sourceTableKey))}}var re=function(e){return["../../edit",e]};function ie(e,t){if(1&e&&(s.Ob(0,"dexih-button-edit",13),s.Fc(1," Datalink "),s.Nb()),2&e){var n=s.Zb(2);s.hc("routerLink",s.mc(1,re,n.datalinkForm.controls.sourceDatalinkTable.value.sourceDatalinkKey))}}function oe(e,t){if(1&e){var n=s.Pb();s.Dc(0,ae,2,3,"dexih-button-edit",11),s.Dc(1,ie,2,3,"dexih-button-edit",11),s.Ob(2,"dexih-button-preview",12),s.Vb("click",(function(){return s.vc(n),s.Zb().previewData()})),s.Nb()}if(2&e){var a=s.Zb();s.hc("ngIf",a.datalinkForm.controls.sourceDatalinkTable.value.sourceType==a.eSourceType.Table&&a.datalinkForm.controls.sourceDatalinkTable.value.sourceTableKey),s.yb(1),s.hc("ngIf",a.datalinkForm.controls.sourceDatalinkTable.value.sourceType==a.eSourceType.Datalink&&a.datalinkForm.controls.sourceDatalinkTable.value.sourceDatalinkKey)}}function le(e,t){if(1&e&&s.Lb(0,"datalink-table",14),2&e){var n=s.Zb();s.hc("datalinkTableForm",n.datalinkForm.controls.sourceDatalinkTable)}}function se(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-delete",15),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb().deleteSelected(e)})),s.Nb()}}function ue(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-new",16),s.Vb("click",(function(){return s.vc(n),s.Zb().newColumn()})),s.Nb()}}function ce(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-edit",17),s.Vb("click",(function(){s.vc(n);var e=t.item;return s.Zb().editColumn(e)})),s.Nb()}}var me,be=((me=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.authService=t,this.hubService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.eMappingStatus=C.k,this.eSourceType=l.gc,this.sourceTypes=C.w,this.columns=[{name:"position",title:"#",format:""},{name:"columnStatus",title:"Impact",format:"Html"},{name:"columnGroup",title:"Group",format:""},{name:"name",title:"Name",format:""},{name:"logicalName",title:"Logical",format:""},{name:"dataType",title:"Data Type",format:""},{name:"deltaType",title:"Delta Type",format:"Enum",enum:l.qb},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"isIncrementalUpdate",title:"Incremental?",format:"Boolean"},{name:"securityFlag",title:"Security Flag",format:"Enum",enum:l.Zb},{name:"isInput",title:"Input?",format:"Boolean"}],this._tableData=new b.a(null),this.tableData=this._tableData.asObservable()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle,e.hubCache=t[2],e.datalinkForm=t[3],e.datalinkForm&&(e.updateData(),e._sourceSubscription&&e._sourceSubscription.unsubscribe(),e._sourceSubscription=e.datalinkForm.controls.sourceDatalinkTable.valueChanges.subscribe((function(){e.updateData()})))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit Source Table")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._sourceSubscription&&this._sourceSubscription.unsubscribe()}},{key:"previewData",value:function(){var e=this.datalinkForm.controls.sourceDatalinkTable.value;switch(e.sourceType){case l.gc.Table:this.router.navigate(["preview-table-data","table",e.sourceTableKey],{relativeTo:this.route});break;case l.gc.Datalink:this.router.navigate(["preview-table-data","datalink",e.sourceDatalinkKey],{relativeTo:this.route});break;default:this.authService.informationDialog("Cannot Preview","Previews are only available for tables and datalinks.")}}},{key:"columnStatus",value:function(e){var t=new m.a(m.c.SourceTable,m.d.Source,this.datalinkForm.value,e,null,null,null,C.k.PassThroughMap,this.hubCache).createDatalinkImpact(!0),n=C.n.find((function(e){return e.key===t}));if(n)return"".concat(n.name,'<i class="float-right ').concat(n.statusClass,'"></i>')}},{key:"updateData",value:function(){var e=this,t=[];this.datalinkForm.controls.sourceDatalinkTable.controls.dexihDatalinkColumns.controls.filter((function(e){return e.value.isValid})).sort((function(e,t){return e.value.position-t.value.position})).forEach((function(n){var a=n.value,r={key:a.key,position:a.position,columnStatus:e.columnStatus(a),columnGroup:a.columnGroup,name:a.name,dataType:e.hubCache.dataTypeToString(a),deltaType:a.deltaType,allowDbNull:a.allowDbNull,logicalName:a.logicalName,isIncrementalUpdate:a.isIncrementalUpdate,securityFlag:a.securityFlag,isInput:a.isInput};t.push(r)})),this._tableData.next(t)}},{key:"deleteSelected",value:function(e){var t=this.datalinkForm.controls.sourceDatalinkTable.controls.dexihDatalinkColumns;e.forEach((function(e){var n=t.controls.findIndex((function(t){return t.value.key===e.key}));t.removeAt(n)})),this.updateData()}},{key:"newColumn",value:function(){this.router.navigate(["newcolumn"],{relativeTo:this.route.parent})}},{key:"editColumn",value:function(e){this.router.navigate(["column",e.key],{relativeTo:this.route.parent})}},{key:"columnSortChange",value:function(e){var t=this.datalinkForm.controls.sourceDatalinkTable.controls.dexihDatalinkColumns,n=1;e.forEach((function(e){var a=t.controls.find((function(t){return t.value.key===e.key}));a&&a.controls.position.setValue(n++)})),this.updateData()}}]),e}()).\u0275fac=function(e){return new(e||me)(s.Kb(d.a),s.Kb(u.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},me.\u0275cmp=s.Eb({type:me,selectors:[["dexih-datalink-edit-source-table-form"]],decls:12,vars:8,consts:[["title","Source Type",3,"showExpandButton"],["header",""],[3,"datalinkTableForm",4,"ngIf"],["title","Columns",3,"showExpandButton","padding"],[3,"enableMultiSelect","enableManualSort","columns","dataObservable","onSortChanged","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","actionsTemplate"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["class","mr-1",3,"routerLink",4,"ngIf"],[3,"click"],[1,"mr-1",3,"routerLink"],[3,"datalinkTableForm"],["title","Delete selected columns",3,"click"],["title","Create a new column",3,"click"],["title","Edit selected column",3,"click"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,oe,3,2,"ng-template",null,1,s.Ec),s.Dc(3,le,1,1,"datalink-table",2),s.Nb(),s.Ob(4,"dexih-widget-section",3),s.Ob(5,"dexih-table",4),s.Vb("onSortChanged",(function(e){return t.columnSortChange(e)}))("rowClick",(function(e){return t.editColumn(e)})),s.Dc(6,se,1,0,"ng-template",5,6,s.Ec),s.Dc(8,ue,1,0,"ng-template",7,8,s.Ec),s.Dc(10,ce,1,0,"ng-template",9,10,s.Ec),s.Nb(),s.Nb()),2&e&&(s.hc("showExpandButton",!0),s.yb(3),s.hc("ngIf",t.datalinkForm),s.yb(1),s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("columns",t.columns)("dataObservable",t.tableData))},directives:[p.T,r.t,B.a,p.q,p.j,i.f,te,p.g,p.o],encapsulation:2}),me),de=n("qMYE");function fe(e,t){if(1&e&&(s.Ob(0,"span"),s.Ob(1,"section"),s.Lb(2,"form-select",6),s.Nb(),s.Ob(3,"section"),s.Lb(4,"form-select",7),s.Nb(),s.Ob(5,"section"),s.Ob(6,"form-select",8),s.Lb(7,"connection-edit-button",9),s.Nb(),s.Nb(),s.Ob(8,"div",10),s.Ob(9,"section",11),s.Lb(10,"form-input",12),s.Nb(),s.Ob(11,"section",11),s.Lb(12,"form-input",13),s.Nb(),s.Nb(),s.Ob(13,"div",14),s.Lb(14,"form-checkbox",15),s.Nb(),s.Nb()),2&e){var n=s.Zb(2);s.yb(2),s.hc("items",n.loadStrategies)("errors",n.editDatalinkService.hubFormsService.formErrors.loadStrategy),s.yb(2),s.hc("items",n.updateStrategies)("errors",n.editDatalinkService.hubFormsService.formErrors.updateStrategy),s.yb(2),s.hc("items",n.managedConnections)("errors",n.editDatalinkService.hubFormsService.formErrors.auditConnectionKey),s.yb(1),s.hc("key",n.datalinkForm.controls.auditConnectionKey.value),s.yb(3),s.hc("errors",n.editDatalinkService.hubFormsService.formErrors.rowsPerCommit),s.yb(2),s.hc("errors",n.editDatalinkService.hubFormsService.formErrors.rowsPerProgress),s.yb(2),s.hc("errors",n.editDatalinkService.hubFormsService.formErrors.addDefaultRow)}}function he(e,t){if(1&e&&(s.Ob(0,"form",3),s.Ob(1,"fieldset"),s.Lb(2,"form-checkbox",4),s.Dc(3,fe,15,10,"span",5),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.hc("formGroup",n.datalinkForm),s.yb(2),s.hc("errors",n.editDatalinkService.hubFormsService.formErrors.isQuery),s.yb(1),s.hc("ngIf",!(null!=n.datalinkForm&&n.datalinkForm.controls.isQuery.value))}}function pe(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-new",23),s.Vb("click",(function(){return s.vc(n),s.Zb(2).addTable()})),s.Nb()}}function ve(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-edit",23),s.Vb("click",(function(){s.vc(n);var e=t.item;return s.Zb(2).editTable(e)})),s.Nb()}}function ge(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-delete",23),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb(2).deleteTables(e)})),s.Nb()}}function ke(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-widget-section",16),s.Ob(1,"dexih-table",17),s.Vb("onSortChanged",(function(e){return s.vc(n),s.Zb().targetSortChange(e)}))("rowClick",(function(e){return s.vc(n),s.Zb().editTable(e)})),s.Dc(2,pe,1,0,"ng-template",null,18,s.Ec),s.Dc(4,ve,1,0,"ng-template",19,20,s.Ec),s.Dc(6,ge,1,0,"ng-template",21,22,s.Ec),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("enableSort",!1)("enableFilter",!1)("columns",a.targetTableColumns)("data",a.targets)}}var ye,Te=((ye=function(){function e(t,n,a,r,i,o){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=a,this.route=r,this.router=i,this.eMappingStatus=C.k,this.eDeltaType=l.qb,this.eUpdateStrategy=l.qc,this.updateStrategies=C.y,this.eTransformWriterMethod=l.nc,this.loadStrategies=C.q,this.showTableProperties=!1,this.targets=[],this.logger=new c.a("datalink-edit-target-table"),this.targetTableColumns=[{name:"table.name",title:"Name",format:""},{name:"table.logicalName",title:"Logical",format:""},{name:"nodeDatalinkColumn.logicalName",title:"Node",format:""}],this.tableFormService=new f.a(o,t,n)}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.logger.LogC((function(){return"ngOnInit"}),c.b.Trace);try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(t){var n=t[0];e.hubCache=t[2],e.datalinkForm=t[3],e.action=n.action,e.pageTitle=n.pageTitle,e.hubCache.isLoaded()&&e.datalinkForm&&(e.connectionTables=e.hubCache.getConnectionTables(),e.managedConnections=e.hubCache.getManagedConnections(),e.logger.LogC((function(){return"ngOnInit - completed"}),c.b.Trace)),e.updateTargets()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Target Table")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._loadStrategySubscription&&this._loadStrategySubscription.unsubscribe()}},{key:"updateTargets",value:function(){this.targets=this.datalinkForm.controls.dexihDatalinkTargets.value.sort((function(e,t){return e.position-t.position}))}},{key:"editTable",value:function(e){this.router.navigate(["table-edit",e.key],{relativeTo:this.route})}},{key:"addTable",value:function(){this.router.navigate(["table-new"],{relativeTo:this.route})}},{key:"deleteTables",value:function(e){var t=this;e.forEach((function(e){t.editDatalinkService.deleteDatalinkTarget(t.datalinkForm,e.key),t.updateTargets()}))}},{key:"targetSortChange",value:function(e){var t=1;e.forEach((function(e){e.position=t++})),this.updateTargets()}}]),e}()).\u0275fac=function(e){return new(e||ye)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e),s.Kb(g.g))},ye.\u0275cmp=s.Eb({type:ye,selectors:[["dexih-datalink-edit-target-form"]],decls:4,vars:3,consts:[["title","Target Load Rules",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["title","Tables",3,"showExpandButton","padding",4,"ngIf"],[3,"formGroup"],["label","Datalink is a query and does not populate target tables.","formControlName","isQuery",3,"errors"],[4,"ngIf"],["label","Load Strategy","formControlName","loadStrategy","itemKey","key","itemName","description","iconClass","fa fa-database","note","Specify processing method for target table(s).",3,"items","errors"],["label","Update Strategy","formControlName","updateStrategy","itemKey","key","itemName","description","iconClass","fa fa-database","note","Specify how records should be inserted/updated in the target table.",3,"items","errors"],["label","Audit Connection","formControlName","auditConnectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the connection where audit data (such as job results) should be written to.",3,"items","errors"],[3,"key"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Maximum Rows Per Commit","type","number","formControlName","rowsPerCommit","placeholder","Enter maximum rows per commit","iconClass","fa fa-list",3,"errors"],["label","Maximum Rows Per Progress Update","type","number","formControlName","rowsPerProgress","placeholder","Enter maximum rows per progress update","iconClass","fa fa-list",3,"errors"],[1,"form-row","mb-2"],["label","Add a default row to the target table.  Edit the 'Default Value' of the target columns determine the value to populate.","formControlName","addDefaultRow",3,"errors"],["title","Tables",3,"showExpandButton","padding"],[3,"enableMultiSelect","enableManualSort","enableSort","enableFilter","columns","data","onSortChanged","rowClick"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],[1,"mr-1",3,"click"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,he,4,3,"form",1),s.Nb(),s.Dc(2,ke,8,8,"dexih-widget-section",2),s.Lb(3,"router-outlet")),2&e&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",t.datalinkForm),s.yb(1),s.hc("ngIf",!(null!=t.datalinkForm&&t.datalinkForm.controls.isQuery.value)))},directives:[p.T,r.t,i.j,g.I,g.t,g.l,p.A,g.s,g.j,p.E,de.a,p.D,B.a,p.o,p.j,p.g],encapsulation:2}),ye),Ce=n("5+WD"),Fe=n("Th2U");function De(e,t){if(1&e&&s.Lb(0,"input-column",8),2&e){var n=t.$implicit,a=s.Zb(2);s.hc("column",n)("datalinkTransformForm",a.datalinkTransformForm)}}function we(e,t){if(1&e&&(s.Ob(0,"div",6),s.Dc(1,De,1,2,"input-column",7),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("ngForOf",n.childColumns)}}var Se,Ne=((Se=function(){function e(t,n){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.column=null,this.eMappingStatus=C.k,this.eTypeCode=l.pc}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.hubCache=t[0],e.datalinkForm=t[1];var n=e.datalinkTransformForm.value,a=new m.a(m.c.Transform,m.d.Target,e.datalinkForm.value,e.column,null,n,null,C.k.NotMapped,e.hubCache),r=a.createDatalinkImpact(!1);e.mappingStatusInfoImpact=C.n.find((function(e){return e.key===r}));var i=a.createDatalinkLineage(!0);e.mappingStatusInfoLineage=C.p.find((function(e){return e.key===i})),(new m.b).findColumn(e.column,n.nodeDatalinkColumn?n.nodeDatalinkColumn.key:null)&&(e.childColumns=e.column.childColumns)}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Input Column")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}}]),e}()).\u0275fac=function(e){return new(e||Se)(s.Kb(u.a),s.Kb(h))},Se.\u0275cmp=s.Eb({type:Se,selectors:[["input-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm"},decls:7,vars:8,consts:[["dragZone","","zone","input-column","zone","input-column",1,"list-group-item","p-0","rounded-0",3,"data"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0",2,"overflow","hidden","text-overflow","ellipsis",3,"title"],[1,"input-group-text","rounded-0","border-0","border-l1",3,"ngClass","title"],["class","p-2",4,"ngIf"],[1,"p-2"],[3,"column","datalinkTransformForm",4,"ngFor","ngForOf"],[3,"column","datalinkTransformForm"]],template:function(e,t){1&e&&(s.Ob(0,"div",0),s.Ob(1,"div",1),s.Lb(2,"i",2),s.Ob(3,"a",3),s.Fc(4),s.Nb(),s.Lb(5,"i",4),s.Nb(),s.Nb(),s.Dc(6,we,2,1,"div",5)),2&e&&(s.hc("data",t.column),s.yb(2),s.hc("ngClass",t.mappingStatusInfoLineage.statusClass)("title",t.mappingStatusInfoLineage.name),s.yb(1),s.hc("title",t.column.logicalName+" "+t.eTypeCode[t.column.dataType]),s.yb(1),s.Hc(" ",t.column.logicalName," "),s.yb(1),s.hc("ngClass",t.mappingStatusInfoImpact.statusClass)("title",t.mappingStatusInfoImpact.name),s.yb(1),s.hc("ngIf",(null==t.childColumns?null:t.childColumns.length)>0))},directives:[Fe.a,r.q,r.t,r.s,Se],encapsulation:2}),Se),Oe=n("Vjuc"),Ie=n("1mVc");function xe(e,t){if(1&e&&s.Lb(0,"input-column",9),2&e){var n=t.$implicit,a=s.Zb(4);s.hc("datalinkTransformForm",a.datalinkTransformForm)("column",n)}}function Pe(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",6),s.Ob(1,"div",7),s.Dc(2,xe,1,2,"input-column",8),s.ac(3,"isValidFilter"),s.ac(4,"fieldSort"),s.Nb(),s.Nb()),2&e){var n=s.Zb().$implicit;s.hc("title",n.name)("padding",!1)("showExpandButton",!0),s.yb(2),s.hc("ngForOf",s.bc(3,4,s.cc(4,6,n.dexihDatalinkColumns,"position")))}}function Ve(e,t){if(1&e&&(s.Ob(0,"span"),s.Dc(1,Pe,5,9,"dexih-widget-section",5),s.Nb()),2&e){var n=t.$implicit;s.yb(1),s.hc("ngIf",n.dexihDatalinkColumns.length>0)}}function Ee(e,t){if(1&e&&(s.Ob(0,"div"),s.Lb(1,"input-column",9),s.Nb()),2&e){var n=t.$implicit,a=s.Zb(3);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("column",n)}}function Ke(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",6),s.Dc(1,Ee,2,2,"div",3),s.ac(2,"isValidFilter"),s.ac(3,"fieldSort"),s.Nb()),2&e){var n=t.$implicit;s.hc("title",n.group)("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(2,4,s.cc(3,6,n.columns,"position")))}}function Le(e,t){if(1&e&&(s.Ob(0,"div",1,2),s.Dc(2,Ve,2,1,"span",3),s.Dc(3,Ke,4,9,"dexih-widget-section",4),s.Nb()),2&e){var n=s.Zb();s.yb(2),s.hc("ngForOf",n.inputTables),s.yb(1),s.hc("ngForOf",n.columnGroups)}}var Me,Ze=((Me=function(){function e(t){_classCallCheck(this,e),this.editDatalinkService=t,this.columns=[],this.columnGroups=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(){var e=this;this._inputColumnsSubscribe&&this._inputColumnsSubscribe.unsubscribe(),this.columnGroups=this.editDatalinkService.getColumnGroups(this.datalinkTransformForm.controls.runTime.value.inputColumns),this._inputColumnsSubscribe=this.datalinkTransformForm.controls.runTime.valueChanges.subscribe((function(){e.columnGroups=e.editDatalinkService.getColumnGroups(e.datalinkTransformForm.controls.runTime.value.inputColumns)}))}},{key:"ngOnDestroy",value:function(){this._inputColumnsSubscribe&&this._inputColumnsSubscribe.unsubscribe()}}]),e}()).\u0275fac=function(e){return new(e||Me)(s.Kb(h))},Me.\u0275cmp=s.Eb({type:Me,selectors:[["input-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm"},features:[s.wb],decls:1,vars:1,consts:[["cdkDropList","",4,"ngIf"],["cdkDropList",""],["cdkDropList","cdkDropList"],[4,"ngFor","ngForOf"],[3,"title","padding","showExpandButton",4,"ngFor","ngForOf"],[3,"title","padding","showExpandButton",4,"ngIf"],[3,"title","padding","showExpandButton"],[1,"list-group"],[3,"datalinkTransformForm","column",4,"ngFor","ngForOf"],[3,"datalinkTransformForm","column"]],template:function(e,t){1&e&&s.Dc(0,Le,4,2,"div",0),2&e&&s.hc("ngIf",t.datalinkTransformForm)},directives:[r.t,Ce.e,r.s,p.T,Ne],pipes:[Oe.a,Ie.a],encapsulation:2}),Me),Ae=n("obiC");function _e(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(n),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Lb(5,"i",3),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("title",a.column.logicalName+" "+a.column.dataType),s.yb(2),s.hc("ngClass",a.mappingStatusInfoLineage.statusClass)("title",a.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",a.column.logicalName," "),s.yb(1),s.hc("ngClass",a.mappingStatusInfoImpact.statusClass)("title",a.mappingStatusInfoImpact.name)}}function Ge(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(n),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Lb(5,"i",3),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("title",a.column.logicalName+" "+a.eTypeCode[a.column.dataType]),s.yb(2),s.hc("ngClass",a.mappingStatusInfoLineage.statusClass)("title",a.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",a.column.logicalName," "),s.yb(1),s.hc("ngClass",a.mappingStatusInfoImpact.statusClass)("title",a.mappingStatusInfoImpact.name)}}var Re,je=((Re=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.authService=t,this.hubService=n,this.editDatalinkService=a,this.router=r,this.route=i,this.column=null,this.inputTables=null,this.inputOutputDrop=new s.n,this.eMappingStatus=C.k,this.logger=new c.a("output-column.component"),this.logCount=0,this.eTypeCode=l.pc}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.hubCache=t[0],e.datalinkForm=t[1],e.logger.LogC((function(){return"Subscription count: "+e.logCount++}),c.b.Trace),e.childColumns=e.column.childColumns,e.refreshStatus()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Output Column")}}},{key:"ngOnChanges",value:function(){this.refreshStatus()}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"refreshStatus",value:function(){var e=this;if(this.datalinkForm){var t=new m.a(m.c.Transform,m.d.Target,this.datalinkForm.value,this.column,null,this.datalinkTransformForm.value,null,C.k.NotMapped,this.hubCache);this.mappingStatusLineage=t.createDatalinkLineage(!1),this.mappingStatusInfoLineage=C.p.find((function(t){return t.key===e.mappingStatusLineage}));var n=t.createDatalinkImpact(!0);this.mappingStatusLineage===C.k.NotMapped&&n!==C.k.AutoGenerate&&(n=C.k.NotMapped),this.mappingStatusInfoImpact=C.n.find((function(e){return e.key===n}))}}},{key:"editColumn",value:function(){!this.column.key||this.mappingStatusLineage!==C.k.Mapped&&this.mappingStatusLineage!==C.k.MappedToNothing?this.authService.informationDialog("Can not edit column","This column is not created by the current transform (i.e. a pass-through or target column).  To edit a column first create a mapping."):this.router.navigate(["column",this.column.key],{relativeTo:this.route.parent})}}]),e}()).\u0275fac=function(e){return new(e||Re)(s.Kb(d.a),s.Kb(u.a),s.Kb(h),s.Kb(i.e),s.Kb(i.a))},Re.\u0275cmp=s.Eb({type:Re,selectors:[["output-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm",inputTables:"inputTables"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:2,vars:2,consts:[["class","list-group-item p-0 rounded-0",3,"title","click",4,"ngIf"],[1,"list-group-item","p-0","rounded-0",3,"title","click"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0"]],template:function(e,t){1&e&&(s.Dc(0,_e,6,6,"div",0),s.Dc(1,Ge,6,6,"div",0)),2&e&&(s.hc("ngIf",t.mappingStatusInfoLineage.key!=t.eMappingStatus.Mapped),s.yb(1),s.hc("ngIf",t.mappingStatusInfoLineage.key==t.eMappingStatus.Mapped))},directives:[r.t,r.q],encapsulation:2}),Re);function He(e,t){if(1&e){var n=s.Pb();s.Ob(0,"li",5),s.Vb("dropData",(function(e){return s.vc(n),s.Zb(2).newOutputDrop(e)})),s.Fc(1," \xa0(Drop\xa0Column) "),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("zone",a.allowMappingOutputs?"input-column":"")}}function Je(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",8),s.Vb("dropData",(function(e){s.vc(n);var a=t.$implicit;return s.Zb(3).newInputOutputDrop(e,a)})),s.Lb(1,"output-column",9),s.Nb()}if(2&e){var a=t.$implicit,r=s.Zb(3);s.hc("zone",r.allowMappingOutputs?"input-column":""),s.yb(1),s.hc("datalinkTransformForm",r.datalinkTransformForm)("column",a)}}function Be(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",6),s.Dc(1,Je,2,3,"div",7),s.ac(2,"isValidFilter"),s.ac(3,"fieldSort"),s.Nb()),2&e){var n=t.$implicit;s.hc("title",n.group)("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(2,4,s.cc(3,6,n.columns,"position")))}}function $e(e,t){if(1&e&&(s.Ob(0,"div",1,2),s.Dc(2,He,2,1,"li",3),s.Dc(3,Be,4,9,"dexih-widget-section",4),s.Nb()),2&e){var n=s.Zb();s.yb(2),s.hc("ngIf",n.allowMappingOutputs),s.yb(1),s.hc("ngForOf",n.columnGroups)}}var Ue,qe=((Ue=function(){function e(){_classCallCheck(this,e),this.allowMappingOutputs=!0,this.inputOutputDrop=new s.n,this.columns=[],this.columnGroups=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(){var e=this;this._outputColumnsSubscribe&&this._outputColumnsSubscribe.unsubscribe(),this.refreshColumns(this.datalinkTransformForm.controls.runTime.value.transformColumns),this._outputColumnsSubscribe=this.datalinkTransformForm.controls.runTime.valueChanges.subscribe((function(){e.refreshColumns(e.datalinkTransformForm.controls.runTime.value.transformColumns)}))}},{key:"ngOnDestroy",value:function(){this._outputColumnsSubscribe&&this._outputColumnsSubscribe.unsubscribe()}},{key:"refreshColumns",value:function(e){var t=null,n=[],a=null;e.filter((function(e){return e.isValid})).sort((function(e,t){return e.position-t.position})).forEach((function(e){var r=e.columnGroup?e.columnGroup:"(un-grouped)";r!==t&&(a&&n.push({group:t,columns:a}),t=r,a=[]),a.push(e)})),a&&a.length>0&&n.push({group:t,columns:a}),this.columnGroups=n}},{key:"newOutputDrop",value:function(e){var t=this.columns.find((function(t){return t.name===e.name}));this.inputOutputDrop.emit({inputColumn:e,outputColumn:t})}},{key:"newInputOutputDrop",value:function(e,t){this.inputOutputDrop.emit({inputColumn:e,outputColumn:t})}}]),e}()).\u0275fac=function(e){return new(e||Ue)},Ue.\u0275cmp=s.Eb({type:Ue,selectors:[["output-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm",allowMappingOutputs:"allowMappingOutputs"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:1,vars:1,consts:[["cdkDropList","",4,"ngIf"],["cdkDropList",""],["cdkDropList","cdkDropList"],["class","list-group-item p-1 dexih-overflow b-0","style","height: 40px;","title","drop to create new mapping...","dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData",4,"ngIf"],[3,"title","padding","showExpandButton",4,"ngFor","ngForOf"],["title","drop to create new mapping...","dropZone","","dropAllowedClass","drop-zone-green",1,"list-group-item","p-1","dexih-overflow","b-0",2,"height","40px",3,"zone","dropData"],[3,"title","padding","showExpandButton"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData",4,"ngFor","ngForOf"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData"],[3,"datalinkTransformForm","column"]],template:function(e,t){1&e&&s.Dc(0,$e,4,2,"div",0),2&e&&s.hc("ngIf",t.datalinkTransformForm)},directives:[r.t,Ce.e,r.s,Ae.a,p.T,je],pipes:[Oe.a,Ie.a],encapsulation:2}),Ue);function ze(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(n),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("title",a.column.logicalName+" "+a.eTypeCode[a.column.dataType]),s.yb(2),s.hc("ngClass",a.mappingStatusInfoLineage.statusClass)("title",a.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",a.column.logicalName," ")}}function We(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",1),s.Vb("click",(function(){return s.vc(n),s.Zb().editColumn()})),s.Ob(1,"div",2),s.Lb(2,"i",3),s.Ob(3,"span",4),s.Fc(4),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("title",a.column.logicalName+" "+a.eTypeCode[a.column.dataType]),s.yb(2),s.hc("ngClass",a.mappingStatusInfoLineage.statusClass)("title",a.mappingStatusInfoLineage.name),s.yb(2),s.Hc(" ",a.column.logicalName," ")}}var Qe,Ye=((Qe=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.authService=t,this.hubService=n,this.editDatalinkService=a,this.router=r,this.route=i,this.column=null,this.inputTables=null,this.inputOutputDrop=new s.n,this.eMappingStatus=C.k,this.eTypeCode=l.pc,this.logger=new c.a("output-column.component"),this.logCount=0}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.hubCache=t[0],e.datalinkForm=t[1],e.logger.LogC((function(){return"Subscription count: "+e.logCount++}),c.b.Trace),e.childColumns=e.column.childColumns,e.refreshStatus()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Output Column")}}},{key:"ngOnChanges",value:function(){this.refreshStatus()}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"refreshStatus",value:function(){var e=this;if(this.datalinkForm){var t=new m.a(m.c.TargetTable,m.d.Target,this.datalinkForm.value,null,this.column,null,null,C.k.NotMapped,this.hubCache);this.mappingStatusLineage=t.createDatalinkLineage(!0),this.mappingStatusInfoLineage=C.p.find((function(t){return t.key===e.mappingStatusLineage}))}}},{key:"editColumn",value:function(){!this.column.key||this.mappingStatusLineage!==C.k.Mapped&&this.mappingStatusLineage!==C.k.MappedToNothing?this.authService.informationDialog("Can not edit column","This column is not created by the current transform (i.e. a pass-through or target column).  To edit a column first create a mapping."):this.router.navigate(["column",this.column.key],{relativeTo:this.route.parent})}}]),e}()).\u0275fac=function(e){return new(e||Qe)(s.Kb(d.a),s.Kb(u.a),s.Kb(h),s.Kb(i.e),s.Kb(i.a))},Qe.\u0275cmp=s.Eb({type:Qe,selectors:[["target-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm",inputTables:"inputTables"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:2,vars:2,consts:[["class","list-group-item p-0 rounded-0",3,"title","click",4,"ngIf"],[1,"list-group-item","p-0","rounded-0",3,"title","click"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0"]],template:function(e,t){1&e&&(s.Dc(0,ze,5,4,"div",0),s.Dc(1,We,5,4,"div",0)),2&e&&(s.hc("ngIf",t.mappingStatusInfoLineage.key!=t.eMappingStatus.Mapped),s.yb(1),s.hc("ngIf",t.mappingStatusInfoLineage.key==t.eMappingStatus.Mapped))},directives:[r.t,r.q],encapsulation:2}),Qe);function Xe(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",6),s.Vb("dropData",(function(e){s.vc(n);var a=t.$implicit;return s.Zb(3).newInputOutputDrop(e,a)})),s.Lb(1,"target-column",7),s.Nb()}if(2&e){var a=t.$implicit,r=s.Zb(3);s.hc("zone",r.allowMappingOutputs?"input-column":""),s.yb(1),s.hc("datalinkTransformForm",r.datalinkTransformForm)("column",a)}}function et(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",4),s.Dc(1,Xe,2,3,"div",5),s.ac(2,"isValidFilter"),s.ac(3,"fieldSort"),s.Nb()),2&e){var n=t.$implicit;s.hc("title","Target ("+n.table.name+")")("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(2,4,s.cc(3,6,n.table.dexihTableColumns,"position")))}}function tt(e,t){if(1&e&&(s.Ob(0,"div",1,2),s.Dc(2,et,4,9,"dexih-widget-section",3),s.Nb()),2&e){var n=s.Zb();s.yb(2),s.hc("ngForOf",n.targets)}}var nt,at=((nt=function(){function e(){_classCallCheck(this,e),this.allowMappingOutputs=!0,this.inputOutputDrop=new s.n}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(){}},{key:"ngOnDestroy",value:function(){}},{key:"newInputOutputDrop",value:function(e,t){this.inputOutputDrop.emit({inputColumn:e,outputColumn:t})}}]),e}()).\u0275fac=function(e){return new(e||nt)},nt.\u0275cmp=s.Eb({type:nt,selectors:[["target-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm",targets:"targets",allowMappingOutputs:"allowMappingOutputs"},outputs:{inputOutputDrop:"inputOutputDrop"},features:[s.wb],decls:1,vars:1,consts:[["cdkDropList","",4,"ngIf"],["cdkDropList",""],["cdkDropList","cdkDropList"],[3,"title","padding","showExpandButton",4,"ngFor","ngForOf"],[3,"title","padding","showExpandButton"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData",4,"ngFor","ngForOf"],["dropZone","","dropAllowedClass","drop-zone-green",3,"zone","dropData"],[3,"datalinkTransformForm","column"]],template:function(e,t){1&e&&s.Dc(0,tt,3,1,"div",0),2&e&&s.hc("ngIf",t.targets)},directives:[r.t,Ce.e,r.s,p.T,Ae.a,Ye],pipes:[Oe.a,Ie.a],encapsulation:2}),nt);function rt(e,t){if(1&e&&(s.Ob(0,"a",5),s.Fc(1),s.Nb()),2&e){var n=s.Zb();s.hc("title",n.column.logicalName+" "+n.eTypeCode[n.column.dataType]),s.yb(1),s.Hc(" ",n.column.logicalName," ")}}function it(e,t){if(1&e&&(s.Ob(0,"a",5),s.Fc(1),s.Nb()),2&e){var n=s.Zb();s.hc("title",n.column.logicalName+" "+n.eTypeCode[n.column.dataType]),s.yb(1),s.Hc(" ",n.column.logicalName," ")}}var ot,lt=((ot=function(){function e(t){_classCallCheck(this,e),this.hubService=t,this.column=null,this.inputTables=null,this.inputJoinDrop=new s.n,this.eMappingStatus=C.k,this.eTypeCode=l.pc}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe((function(t){if(t.isLoaded()){e.hubCache=t;var n=new m.a(m.c.Transform,m.d.Target,e.datalinkForm.value,e.column,null,e.datalinkTransformForm.value,null,C.k.NotMapped,e.hubCache),a=n.createDatalinkLineage(!1);e.mappingStatusInfoLineage=C.p.find((function(e){return e.key===a}));var r=n.createDatalinkImpact(!1);e.mappingStatusInfoImpact=C.n.find((function(e){return e.key===r}))}}))}},{key:"ngOnDestroy",value:function(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe()}}]),e}()).\u0275fac=function(e){return new(e||ot)(s.Kb(u.a))},ot.\u0275cmp=s.Eb({type:ot,selectors:[["join-column"]],inputs:{column:"column",datalinkTransformForm:"datalinkTransformForm",datalinkForm:"datalinkForm",inputTables:"inputTables"},outputs:{inputJoinDrop:"inputJoinDrop"},decls:6,vars:6,consts:[[1,"list-group-item","p-0","rounded-0"],[1,"d-flex","flex-row"],[1,"input-group-text","rounded-0","border-0","border-r1",3,"ngClass","title"],["class","flex-fill input-group-text ellipsis-overflow rounded-0 border-0","style","overflow:hidden; text-overflow :ellipsis;",3,"title",4,"ngIf"],[1,"input-group-text","rounded-0","border-0","border-l1",3,"ngClass","title"],[1,"flex-fill","input-group-text","ellipsis-overflow","rounded-0","border-0",2,"overflow","hidden","text-overflow","ellipsis",3,"title"]],template:function(e,t){1&e&&(s.Ob(0,"div",0),s.Ob(1,"div",1),s.Lb(2,"i",2),s.Dc(3,rt,2,2,"a",3),s.Dc(4,it,2,2,"a",3),s.Lb(5,"i",4),s.Nb(),s.Nb()),2&e&&(s.yb(2),s.hc("ngClass",t.mappingStatusInfoLineage.statusClass)("title",t.mappingStatusInfoLineage.name),s.yb(1),s.hc("ngIf",t.mappingStatusInfoLineage.key!=t.eMappingStatus.Joined),s.yb(1),s.hc("ngIf",t.mappingStatusInfoLineage.key==t.eMappingStatus.Joined),s.yb(1),s.hc("ngClass",t.mappingStatusInfoImpact.statusClass)("title",t.mappingStatusInfoImpact.name))},directives:[r.q,r.t],encapsulation:2}),ot);function st(e,t){if(1&e){var n=s.Pb();s.Ob(0,"join-column",3),s.Vb("dropData",(function(e){s.vc(n);var a=t.$implicit;return s.Zb(2).newInputJoinDrop(e,a)})),s.Nb()}if(2&e){var a=t.$implicit,r=s.Zb(2);s.hc("datalinkForm",r.datalinkForm)("datalinkTransformForm",r.datalinkTransformForm)("column",a)}}function ut(e,t){if(1&e&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,st,1,3,"join-column",2),s.ac(3,"isValidFilter"),s.ac(4,"fieldSort"),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("title",(null==n.joinTable?null:n.joinTable.name)+"("+n.eTransformType[n.datalinkTransformForm.value.transformType]+")")("padding",!1)("showExpandButton",!0),s.yb(1),s.hc("ngForOf",s.bc(3,4,s.cc(4,6,n.joinColumns,"position")))}}var ct,mt=((ct=function(){function e(t,n){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.inputJoinDrop=new s.n,this.eTransformType=l.lc}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.datalinkForm=t[1],e.datalinkForm&&e.updateTableData()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function")}}},{key:"ngOnChanges",value:function(){var e=this;this.updateTableData(),this._changesSubscription&&this._changesSubscription.unsubscribe(),this._changesSubscription=this.datalinkTransformForm.controls.joinDatalinkTable.valueChanges.subscribe((function(){e.updateTableData()}))}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._changesSubscription&&this._changesSubscription.unsubscribe()}},{key:"updateTableData",value:function(){var e=this;this.datalinkTransformForm&&this.datalinkTransformForm.controls.joinDatalinkTable.value?(this.joinTable=this.datalinkTransformForm.controls.joinDatalinkTable.value,this.joinTable?(this.joinColumns=new Array,this.joinTable.dexihDatalinkColumns.forEach((function(t){e.joinColumns.push(t)}))):this.joinColumns=null):this.joinColumns=null}},{key:"newInputJoinDrop",value:function(e,t){this.inputJoinDrop.emit({inputColumn:e,joinColumn:t})}}]),e}()).\u0275fac=function(e){return new(e||ct)(s.Kb(u.a),s.Kb(h))},ct.\u0275cmp=s.Eb({type:ct,selectors:[["join-columns"]],inputs:{datalinkTransformForm:"datalinkTransformForm"},outputs:{inputJoinDrop:"inputJoinDrop"},features:[s.wb],decls:1,vars:1,consts:[[4,"ngIf"],[3,"title","padding","showExpandButton"],["dropZone","","zone","input-column","dropAllowedClass","drop-zone-green",3,"datalinkForm","datalinkTransformForm","column","dropData",4,"ngFor","ngForOf"],["dropZone","","zone","input-column","dropAllowedClass","drop-zone-green",3,"datalinkForm","datalinkTransformForm","column","dropData"]],template:function(e,t){1&e&&s.Dc(0,ut,5,9,"div",0),2&e&&s.hc("ngIf",t.joinColumns)},directives:[r.t,p.T,r.s,lt,Ae.a],pipes:[Oe.a,Ie.a],encapsulation:2}),ct),bt=n("F2jK"),dt=n("Xjf6");function ft(e,t){if(1&e&&(s.Ob(0,"div",7),s.Lb(1,"i",8),s.Fc(2),s.Nb()),2&e){var n=s.Zb(2);s.yb(2),s.Hc(" ",n.error," ")}}function ht(e,t){if(1&e&&s.Lb(0,"i",10),2&e){var n=s.Zb(3);s.hc("title",n.source.error)}}function pt(e,t){if(1&e&&(s.Ob(0,"div",4),s.Dc(1,ht,1,1,"i",9),s.Fc(2),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("ngIf",!n.source.valid),s.yb(1),s.Gc(n.source.text)}}function vt(e,t){1&e&&s.Lb(0,"i",13)}function gt(e,t){if(1&e&&s.Lb(0,"i",10),2&e){var n=s.Zb(3);s.hc("title",n.target.error)}}function kt(e,t){if(1&e&&(s.Ob(0,"span",14),s.Fc(1),s.Nb()),2&e){var n=s.Zb(3);s.yb(1),s.Gc(n.compare)}}function yt(e,t){if(1&e&&(s.Ob(0,"div",4),s.Dc(1,vt,1,0,"i",11),s.Dc(2,gt,1,1,"i",9),s.Dc(3,kt,2,1,"span",12),s.Fc(4),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("ngIf",n.source&&!n.compare),s.yb(1),s.hc("ngIf",!n.target.valid),s.yb(1),s.hc("ngIf",n.compare),s.yb(1),s.Hc(" ",n.target.text," ")}}function Tt(e,t){if(1&e&&(s.Ob(0,"div",3),s.Ob(1,"div",4),s.Ob(2,"h5"),s.Fc(3),s.Nb(),s.Dc(4,ft,3,1,"div",5),s.Nb(),s.Dc(5,pt,3,2,"div",6),s.Dc(6,yt,5,4,"div",6),s.Nb()),2&e){var n=s.Zb();s.yb(3),s.Gc(n.label),s.yb(1),s.hc("ngIf",n.error),s.yb(1),s.hc("ngIf",n.source),s.yb(1),s.hc("ngIf",n.target)}}function Ct(e,t){if(1&e&&s.Lb(0,"i",10),2&e){var n=s.Zb(3);s.hc("title",n.source.error)}}function Ft(e,t){if(1&e&&(s.Ob(0,"div"),s.Dc(1,Ct,1,1,"i",9),s.Fc(2),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("ngIf",!n.source.valid),s.yb(1),s.Hc("Source = ",n.source.text," ")}}function Dt(e,t){if(1&e&&(s.Ob(0,"div"),s.Fc(1),s.Nb()),2&e){var n=s.Zb(2).$implicit;s.yb(1),s.Gc(n.name)}}function wt(e,t){1&e&&s.Lb(0,"i",8)}function St(e,t){if(1&e&&(s.Ob(0,"div",15),s.Ob(1,"div",22),s.Dc(2,Dt,2,1,"div",17),s.Nb(),s.Ob(3,"div",23),s.Dc(4,wt,1,0,"i",24),s.Fc(5),s.Nb(),s.Nb()),2&e){var n=t.$implicit,a=t.index,r=s.Zb().$implicit;s.yb(2),s.hc("ngIf",0==a),s.yb(1),s.hc("title",n.error),s.yb(1),s.hc("ngIf",!n.valid),s.yb(1),s.Hc(" ",(r.values.length>1?"["+a+"] ":"")+n.text," ")}}function Nt(e,t){1&e&&s.Dc(0,St,6,4,"div",21),2&e&&s.hc("ngForOf",t.$implicit.values)}function Ot(e,t){if(1&e&&(s.Ob(0,"div",18),s.Ob(1,"div",16),s.Ob(2,"h5"),s.Fc(3,"Inputs"),s.Nb(),s.Nb(),s.Nb(),s.Ob(4,"div",15),s.Ob(5,"div",19),s.Fc(6,"Parameter"),s.Nb(),s.Ob(7,"div",19),s.Fc(8,"Column / Value"),s.Nb(),s.Nb(),s.Dc(9,Nt,1,1,"ng-template",20)),2&e){var n=s.Zb(2);s.yb(9),s.hc("ngForOf",n.inputParameters)}}function It(e,t){if(1&e&&(s.Ob(0,"div",19),s.Fc(1),s.Nb()),2&e){var n=t.$implicit;s.yb(1),s.Gc(n.name)}}function xt(e,t){1&e&&s.Lb(0,"i",8)}function Pt(e,t){if(1&e&&(s.Ob(0,"div",29),s.Dc(1,xt,1,0,"i",24),s.Fc(2),s.Nb()),2&e){var n=t.$implicit,a=s.Zb().index;s.hc("title",n.values[a].error),s.yb(1),s.hc("ngIf",!n.values[a].valid),s.yb(1),s.Hc(" ",n.values[a].text," ")}}function Vt(e,t){if(1&e&&(s.Ob(0,"div",15),s.Dc(1,Pt,3,3,"div",28),s.Nb()),2&e){var n=s.Zb().$implicit;s.yb(1),s.hc("ngForOf",n.parameters)}}function Et(e,t){if(1&e&&(s.Ob(0,"div"),s.Ob(1,"div",18),s.Ob(2,"div",26),s.Ob(3,"h5"),s.Fc(4),s.Nb(),s.Nb(),s.Nb(),s.Ob(5,"div",15),s.Dc(6,It,2,1,"div",27),s.Nb(),s.Dc(7,Vt,2,1,"div",21),s.Nb()),2&e){var n=t.$implicit;s.yb(4),s.Gc(n.name),s.yb(2),s.hc("ngForOf",n.parameters),s.yb(1),s.hc("ngForOf",n.parameters[0].values)}}function Kt(e,t){if(1&e&&s.Dc(0,Et,8,3,"div",25),2&e){var n=s.Zb(2);s.hc("ngForOf",n.mapParameters)}}function Lt(e,t){if(1&e&&(s.Ob(0,"div"),s.Fc(1),s.Nb()),2&e){var n=s.Zb(2).$implicit;s.yb(1),s.Gc(n.name)}}function Mt(e,t){1&e&&s.Lb(0,"i",8)}function Zt(e,t){if(1&e&&(s.Ob(0,"div",15),s.Ob(1,"div",22),s.Dc(2,Lt,2,1,"div",17),s.Nb(),s.Ob(3,"div",30),s.Dc(4,Mt,1,0,"i",24),s.Fc(5),s.Nb(),s.Nb()),2&e){var n=t.$implicit,a=t.index,r=s.Zb().$implicit;s.yb(2),s.hc("ngIf",0==a),s.yb(1),s.hc("title",n.error),s.yb(1),s.hc("ngIf",!n.valid),s.yb(1),s.Hc(" ",(r.values.length>1?"["+a+"] ":"")+n.text," ")}}function At(e,t){1&e&&s.Dc(0,Zt,6,4,"div",21),2&e&&s.hc("ngForOf",t.$implicit.values)}function _t(e,t){if(1&e&&(s.Ob(0,"div",18),s.Ob(1,"div",16),s.Ob(2,"h5"),s.Fc(3,"Outputs"),s.Nb(),s.Nb(),s.Nb(),s.Ob(4,"div",15),s.Ob(5,"div",19),s.Fc(6,"Parameter"),s.Nb(),s.Ob(7,"div",19),s.Fc(8,"Column / Value"),s.Nb(),s.Nb(),s.Dc(9,At,1,1,"ng-template",20)),2&e){var n=s.Zb(2);s.yb(9),s.hc("ngForOf",n.outputParameters)}}function Gt(e,t){if(1&e&&(s.Ob(0,"div",15),s.Ob(1,"div",16),s.Ob(2,"h5"),s.Fc(3),s.Nb(),s.Nb(),s.Nb(),s.Dc(4,Ft,3,2,"div",17),s.Dc(5,Ot,10,1,"ng-template",2),s.Dc(6,Kt,1,1,"ng-template",2),s.Dc(7,_t,10,1,"ng-template",2)),2&e){var n=s.Zb();s.yb(3),s.Gc(n.label),s.yb(1),s.hc("ngIf",n.source),s.yb(1),s.hc("ngIf",(null==n.inputParameters?null:n.inputParameters.length)>0),s.yb(1),s.hc("ngIf",n.mapParameters),s.yb(1),s.hc("ngIf",(null==n.outputParameters?null:n.outputParameters.length)>0)}}var Rt,jt=((Rt=function(){function e(t){_classCallCheck(this,e),this.hubService=t}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription&&this._subscription.unsubscribe(),this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(t){e.hubCache=t[0],e.updateMapping()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Mappings")}}},{key:"updateMapping",value:function(){return e=this,n=regeneratorRuntime.mark((function e(){var t,n,a,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.transformItem,n=C.x.find((function(e){return e.key===t.transformItemType})),e.t0=t.transformItemType,e.next=e.t0===l.kc.BuiltInFunction?4:e.t0===l.kc.CustomFunction?13:e.t0===l.kc.AggregatePair?15:e.t0===l.kc.Sort?17:e.t0===l.kc.UnGroup?19:21;break;case 4:if(!t.functionClassName){e.next=11;break}return e.next=7,this.hubService.GetFunctionReference(t);case 7:(a=e.sent)?(this.label=a.name,this.addBuiltInFunctionParameters(a)):this.error="Error, function ".concat(t.functionClassName,".").concat(t.functionMethodName," not found."),e.next=12;break;case 11:t.customFunctionKey?(r=this.hubCache.hub.dexihCustomFunctions.find((function(e){return e.key===t.customFunctionKey})))?(this.label=r.name,this.addCustomFunctionParameters()):this.error="Error, function not found.":this.error="Error, function not found";case 12:return e.abrupt("break",22);case 13:return this.addCustomFunctionParameters(),e.abrupt("break",22);case 15:return this.label=l.Y[t.aggregate],e.abrupt("break",22);case 17:return this.label=l.fc[t.sortDirection],e.abrupt("break",22);case 19:return this.label="UnGroup",this.addUnGroupParameters(),e.abrupt("break",22);case 21:this.label=n.name;case 22:n.useSource&&(this.source=this.columnOrValue(null,t.sourceDatalinkColumn,t.sourceValue)),n.useTarget&&(this.target=this.describeDatalinkColumn(null,t.targetDatalinkColumn)),n.useJoin&&(this.target=this.describeDatalinkColumn(null,t.joinDatalinkColumn)),n.useFilter&&(this.target=this.columnOrValue(null,t.filterDatalinkColumn,t.filterValue)),n.useFilter||n.useJoin?(null===(i=t.filterCompare)&&(i=l.hb.IsEqual),this.compare=bt.a.find((function(e){return e.key===i})).name):this.compare=null;case 23:case"end":return e.stop()}}),e,this)})),new((t=void 0)||(t=Promise))((function(a,r){function i(e){try{l(n.next(e))}catch(t){r(t)}}function o(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,o)}l((n=n.apply(e,[])).next())}));var e,t,n}},{key:"columnOrValue",value:function(e,t,n){return t?this.describeDatalinkColumn(e,t):{text:this.describeStaticValue(n),valid:!0,error:""}}},{key:"concat",value:function(){for(var e=[],t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach((function(t){t&&(e=e.concat(t))})),e}},{key:"addBuiltInFunctionParameters",value:function(e){var t=this,n=this.concat(e.inputParameters,e.resultInputParameters),a=this.concat(e.outputParameters,e.returnParameters,e.resultOutputParameters,e.resultReturnParameters),r=this.transformItem.dexihFunctionParameters.filter((function(e){return e.direction===l.Vb.Input||e.direction===l.Vb.ResultInput||e.direction===l.Vb.Join}));this.inputParameters=n.filter((function(e){return e&&!e.linkedName})).map((function(e){var n=r.find((function(t){return t.name===e.parameterName}));if(n){if(0===n.rank){var a=t.columnOrValue(n.dataType,n.datalinkColumn,n.value);return{name:t.describeParameterName(n),values:[a]}}var i=n.arrayParameters.sort((function(e,t){return e.position-t.position})).map((function(e){return t.columnOrValue(e.dataType,e.datalinkColumn,e.value)}));return{name:t.describeParameterName(n),values:i}}return{name:t.describeParameterName(n),values:[{valid:!1,error:"Not Mapped",text:""}]}}));var i=this.transformItem.dexihFunctionParameters.filter((function(e){return C.e.parameterIsOutput(e)}));this.outputParameters=a.filter((function(e){return e&&!e.linkedName})).map((function(e){var n=i.find((function(t){return t.name===e.parameterName}));if(n){if(t.allowCondition&&(n.direction===l.Vb.ReturnValue||n.direction===l.Vb.ResultReturnValue))return null;if(0===n.rank||null!==n.datalinkColumn){var a=t.describeDatalinkColumn(n.dataType,n.datalinkColumn);return{name:t.describeParameterName(n),values:[a]}}var r=n.arrayParameters.sort((function(e,t){return e.position-t.position})).map((function(e){return t.describeDatalinkColumn(e.dataType,e.datalinkColumn)}));return{name:t.describeParameterName(n),values:r}}return null})).filter((function(e){return null!==e}));var o=Array.from(new Set(this.concat(n,a).map((function(e){return e&&e.linkedName})).filter((function(e){return e}))));this.mapParameters=o.map((function(e){var o=n.filter((function(t){return t.linkedName===e})).map((function(e){var n=r.find((function(t){return t.name===e.parameterName})).arrayParameters.sort((function(e,t){return e.position-t.position})).map((function(e){return t.columnOrValue(e.dataType,e.datalinkColumn,e.value)}));return{name:t.describeParameterName(e),values:n}})),l=a.filter((function(t){return t.linkedName===e})).map((function(e){var n=i.find((function(t){return t.name===e.parameterName})).arrayParameters.sort((function(e,t){return e.position-t.position})).map((function(e){return t.describeDatalinkColumn(e.dataType,e.datalinkColumn)}));return{name:t.describeParameterName(e),values:n}}));return{name:e,parameters:t.concat(o,l)}}))}},{key:"addCustomFunctionParameters",value:function(){var e=this,t=this.transformItem.dexihFunctionParameters.filter((function(e){return e.direction===l.Vb.Input||e.direction===l.Vb.ResultInput||e.direction===l.Vb.Join}));this.inputParameters=t.map((function(t){if(0===t.rank){var n=e.columnOrValue(t.dataType,t.datalinkColumn,t.value);return{name:e.describeParameterName(t),values:[n]}}var a=t.arrayParameters.sort((function(e,t){return e.position-t.position})).map((function(t){return e.columnOrValue(t.dataType,t.datalinkColumn,t.value)}));return{name:e.describeParameterName(t),values:a}}));var n=this.transformItem.dexihFunctionParameters.filter((function(e){return C.e.parameterIsOutput(e)}));this.outputParameters=n.map((function(t){if(0===t.rank){var n=e.describeDatalinkColumn(t.dataType,t.datalinkColumn);return{name:e.describeParameterName(t),values:[n]}}var a=t.arrayParameters.sort((function(e,t){return e.position-t.position})).map((function(t){return e.describeDatalinkColumn(t.dataType,t.datalinkColumn)}));return{name:e.describeParameterName(t),values:a}}))}},{key:"addUnGroupParameters",value:function(){var e=this,t=this.transformItem.dexihFunctionParameters,n=this.transform.runTime.inputColumns.find((function(t){return t.key===e.transformItem.sourceDatalinkColumn.key}));n&&(this.outputParameters=t.map((function(t){return t.datalinkColumn?n.childColumns.find((function(e){return e.key===t.datalinkColumn.key}))?{name:e.describeParameterName(t),values:[{valid:!0,error:"",text:t.datalinkColumn.name}]}:{name:e.describeParameterName(t),values:[{valid:!1,error:"(Invalid column) ",text:t.datalinkColumn.name}]}:{name:e.describeParameterName(t),values:[{valid:!1,error:"(No column)",text:""}]}})))}},{key:"describeParameterName",value:function(e){return e.name+" ("+l.pc[e.dataType]+")"}},{key:"describeDatalinkColumn",value:function(e,t){if(!t)return{error:"(not mapped)",text:"",valid:!1};var n=this.transform.runTime,a=n.inputColumns,r=this.transform.nodeDatalinkColumn?this.transform.nodeDatalinkColumn:null,i=r?r.key:null,o=null;if((new m.b).findValidColumn(t,i,a)&&(o=(t.columnGroup?"("+t.columnGroup+")":"")+t.logicalName),o||n.transformColumns.forEach((function(e){o||e.key!==t.key||(o=t.logicalName)})),!o&&this.transform.joinDatalinkTable){var s=this.transform.joinDatalinkTable;s.dexihDatalinkColumns.forEach((function(e){o||e.key!==t.key||(o="("+s.name+") "+t.logicalName)}))}return o?null==e||t.dataType===e?{text:o,valid:!0,error:""}:{text:o,error:"(inconsistent datatype "+l.pc[t.dataType]+")",valid:!1}:{text:t.logicalName,error:"(Invalid column) ",valid:!1}}},{key:"describeStaticValue",value:function(e){return" "===e?"<space>":e?'"'+e+'"':"<null>"}}]),e}()).\u0275fac=function(e){return new(e||Rt)(s.Kb(dt.a))},Rt.\u0275cmp=s.Eb({type:Rt,selectors:[["mapping-item"]],inputs:{transform:"transform",transformItem:"transformItem",allowCondition:"allowCondition"},decls:3,vars:2,consts:[[1,"container"],["class","row justify-content-start",4,"ngIf"],[3,"ngIf"],[1,"row","justify-content-start"],[1,"col-auto"],["class","text-danger",4,"ngIf"],["class","col-auto",4,"ngIf"],[1,"text-danger"],[1,"fa","fa-exclamation-circle","text-danger"],["class","fa fa-exclamation-circle text-danger",3,"title",4,"ngIf"],[1,"fa","fa-exclamation-circle","text-danger",3,"title"],["class","fa fa-arrow-right mr-2",4,"ngIf"],["class","mr-2",4,"ngIf"],[1,"fa","fa-arrow-right","mr-2"],[1,"mr-2"],[1,"row"],[1,"col"],[4,"ngIf"],[1,"row","pt-2"],[1,"col","border","bg-primary","text-white","font-weight-bold","text-truncate"],["ngFor","",3,"ngForOf"],["class","row",4,"ngFor","ngForOf"],[1,"col","border","bg-secondary","text-white","text-truncate"],[1,"col","border","border","text-white","bg-secondary","text-truncate",3,"title"],["class","fa fa-exclamation-circle text-danger",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col","text-truncate"],["class","col border bg-primary text-white font-weight-bold text-truncate",4,"ngFor","ngForOf"],["class","col border bg-secondary text-white text-truncate",3,"title",4,"ngFor","ngForOf"],[1,"col","border","bg-secondary","text-white","text-truncate",3,"title"],[1,"col","border","border","bg-secondary","text-white","text-truncate",3,"title"]],template:function(e,t){1&e&&(s.Ob(0,"div",0),s.Dc(1,Tt,7,4,"div",1),s.Dc(2,Gt,8,5,"ng-template",2),s.Nb()),2&e&&(s.yb(1),s.hc("ngIf",!t.outputParameters),s.yb(1),s.hc("ngIf",t.outputParameters))},directives:[r.t,r.s],encapsulation:2}),Rt),Ht=["mappingTable"];function Jt(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-edit",9),s.Vb("click",(function(){s.vc(n);var e=t.item;return s.Zb().editMapping(e)})),s.Nb()}}function Bt(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-delete",10),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb().deleteSelected(e)})),s.Nb()}}function $t(e,t){if(1&e){var n=s.Pb();s.Ob(0,"mapping-item",11),s.Vb("click",(function(){s.vc(n);var e=t.item;return s.Zb().editMapping(e)})),s.Nb()}if(2&e){var a=t.item,r=s.Zb();s.hc("transform",r.datalinkTransformForm.value)("transformItem",a.datalinkTransformItem)("allowCondition",r.allowCondition)}}function Ut(e,t){if(1&e){var n=s.Pb();s.Ob(0,"li"),s.Ob(1,"a",16),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb(3).addGroup(e)})),s.Fc(2),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit;s.yb(1),s.hc("title","Add all "+a.group),s.yb(1),s.Hc("Add all ",a.group,"")}}function qt(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-splitdropdown",13),s.Vb("buttonClick",(function(){s.vc(n);var e=s.Zb(2);return e.newMapping(e.eTransformItemType.ColumnPair)})),s.Ob(1,"li"),s.Ob(2,"a",14),s.Vb("click",(function(){return s.vc(n),s.Zb(2).addAll()})),s.Fc(3,"Add all input columns"),s.Nb(),s.Nb(),s.Dc(4,Ut,3,2,"li",15),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(4),s.hc("ngForOf",a.columnGroups)}}function zt(e,t){if(1&e&&(s.Ob(0,"dexih-button",17),s.Fc(1,"Filter "),s.Nb()),2&e){var n=s.Zb(2);s.jc("routerLink","mapping-edit/",n.eTransformItemType.FilterPair,"")}}function Wt(e,t){if(1&e&&(s.Ob(0,"dexih-button",18),s.Fc(1," Aggregate"),s.Nb()),2&e){var n=s.Zb(2);s.jc("routerLink","mapping-edit/",n.eTransformItemType.AggregatePair,"")}}var Qt=function(e){return["standard-function-edit",e]},Yt=function(e){return["custom-function-edit",e]};function Xt(e,t){if(1&e&&(s.Ob(0,"dexih-button",19),s.Fc(1," Standard"),s.Nb(),s.Ob(2,"dexih-button",20),s.Fc(3,"Custom"),s.Nb()),2&e){var n=s.Zb(2);s.hc("routerLink",s.mc(2,Qt,n.functionType)),s.yb(2),s.hc("routerLink",s.mc(4,Yt,n.functionType))}}function en(e,t){1&e&&(s.Ob(0,"dexih-button",21),s.Fc(1,"Un-Group"),s.Nb())}function tn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"li"),s.Ob(1,"a",16),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb(3).addValidFromTo(e)})),s.Fc(2),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit;s.yb(1),s.hc("title",a.name),s.yb(1),s.Gc(a.name)}}function nn(e,t){if(1&e&&(s.Ob(0,"dexih-button",22),s.Fc(1,"Join "),s.Nb(),s.Ob(2,"dexih-button",23),s.Fc(3," Filter"),s.Nb(),s.Ob(4,"dexih-button",24),s.Fc(5,"Custom Filter"),s.Nb(),s.Ob(6,"dexih-button-dropdown",25),s.Dc(7,tn,3,2,"li",15),s.Nb()),2&e){var n=s.Zb(2);s.jc("routerLink","mapping-edit/",n.eTransformItemType.JoinPair,""),s.yb(2),s.hc("routerLink",s.mc(4,Qt,n.functionType)),s.yb(2),s.hc("routerLink",s.mc(6,Yt,n.functionType)),s.yb(3),s.hc("ngForOf",n.inputDateColumns)}}function an(e,t){if(1&e&&(s.Ob(0,"dexih-button",26),s.Fc(1,"Sort"),s.Nb()),2&e){var n=s.Zb(2);s.jc("routerLink","mapping-edit/",n.eTransformItemType.Sort,"")}}function rn(e,t){if(1&e&&(s.Ob(0,"dexih-button",27),s.Fc(1,"Group"),s.Nb()),2&e){var n=s.Zb(2);s.jc("routerLink","mapping-edit/",n.eTransformItemType.Column,"")}}function on(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button",28),s.Vb("click",(function(){return s.vc(n),s.Zb(2).createJoinNode()})),s.Fc(1,"Node"),s.Nb()}}function ln(e,t){if(1&e&&(s.Dc(0,qt,5,1,"ng-template",12),s.Dc(1,zt,2,1,"ng-template",12),s.Dc(2,Wt,2,1,"ng-template",12),s.Dc(3,Xt,4,6,"ng-template",12),s.Dc(4,en,2,0,"ng-template",12),s.Dc(5,nn,8,8,"ng-template",12),s.Dc(6,an,2,1,"ng-template",12),s.Dc(7,rn,2,1,"ng-template",12),s.Dc(8,on,2,0,"ng-template",12)),2&e){var n=s.Zb();s.hc("ngIf",n.allowMapping),s.yb(1),s.hc("ngIf",n.allowCondition&&!n.allowValidation),s.yb(1),s.hc("ngIf",n.allowAggregate),s.yb(1),s.hc("ngIf",n.allowStandard||n.allowAggregate||n.allowCondition||n.allowRow||n.allowValidation),s.yb(1),s.hc("ngIf",n.allowRow),s.yb(1),s.hc("ngIf",n.allowJoin),s.yb(1),s.hc("ngIf",n.allowSort),s.yb(1),s.hc("ngIf",n.allowGroup),s.yb(1),s.hc("ngIf",n.allowJoinNode)}}var sn,un=((sn=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.authService=t,this.hubService=n,this.editDatalinkService=a,this.router=r,this.route=i,this.allowStandard=!1,this.allowMapping=!1,this.allowAggregate=!1,this.allowRow=!1,this.allowCondition=!1,this.allowValidation=!1,this.allowOutput=!1,this.allowGroup=!1,this.allowJoin=!1,this.allowSort=!1,this.allowSeries=!1,this.allowJoinNode=!1,this.addMapping=new s.n,this.removeMapping=new s.n,this.updateMapping=new s.n,this.hasChanged=new s.n,this.onColumnDrop=new s.n,this._tableData=new b.a(null),this.tableData=this._tableData.asObservable(),this.eTransformType=l.lc,this.eTransformItemType=l.kc,this.columnGroups=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._changesSubscription&&this._changesSubscription.unsubscribe()}},{key:"ngOnChanges",value:function(){var e=this;try{this.columns=[],this._subscription&&this._subscription.unsubscribe(),this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(){e.functionType=e.editDatalinkService.getFunctionType(e.datalinkTransformForm.value),e.transformType=e.datalinkTransformForm.value.transformType,e.updateTableData(),e._changesSubscription&&e._changesSubscription.unsubscribe(),e._changesSubscription=e.datalinkTransformForm.valueChanges.subscribe((function(){return e.updateTableData()}))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Mappings")}}},{key:"updateTableData",value:function(){try{if(this.datalinkTransformForm){var e=this.datalinkTransformForm.controls.runTime.value.inputColumns;this.inputDateColumns=e.filter((function(e){return e.dataType===l.pc.DateTime||e.dataType===l.pc.Date})),this.columnGroups=this.editDatalinkService.getColumnGroups(e);var t=[],n=this.datalinkTransformForm.controls.dexihDatalinkTransformItems,a=[];this.allowJoinNode&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.JoinNode})))),this.allowGroup&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.Column})))),(this.allowStandard||this.allowJoin)&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.BuiltInFunction||e.value.transformItemType===l.kc.CustomFunction})))),this.allowAggregate&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.AggregatePair})))),this.allowMapping&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.ColumnPair})))),this.allowCondition&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.FilterPair})))),this.allowJoin&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.JoinPair})))),this.allowRow&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.UnGroup})))),this.allowSort&&(a=a.concat(n.controls.filter((function(e){return e.value.transformItemType===l.kc.Sort})))),a.sort((function(e,t){return e.value.position-t.value.position})).forEach((function(e){var n=e.value;t.push({datalinkTransformItem:n,key:n.key})})),this._tableData.next(t)}}catch(r){this.hubService.addHubClientErrorMessage(r,"Mappings, update data")}}},{key:"getItemFormGroup",value:function(e){return this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find((function(t){return t.value.key===e}))}},{key:"editMapping",value:function(e){var t=e.key,n=this.getItemFormGroup(t).value.transformItemType;switch(n){case l.kc.BuiltInFunction:this.router.navigate(["standard-function-edit",this.functionType,t],{relativeTo:this.route.parent});break;case l.kc.CustomFunction:this.router.navigate(["custom-function-edit",this.functionType,t],{relativeTo:this.route.parent});break;case l.kc.Column:case l.kc.JoinNode:case l.kc.GroupNode:case l.kc.ColumnPair:case l.kc.Sort:case l.kc.JoinPair:case l.kc.FilterPair:case l.kc.AggregatePair:case l.kc.Series:this.router.navigate(["mapping-edit",n,t],{relativeTo:this.route.parent});break;case l.kc.UnGroup:this.router.navigate(["unGroup-edit",t],{relativeTo:this.route.parent})}}},{key:"deleteMapping",value:function(e){this.deleteSelected([e])}},{key:"deleteSelected",value:function(e){var t=this;e.forEach((function(e){var n=t.getItemFormGroup(e.key);t.editDatalinkService.deleteDatalinkTransformItem(t.datalinkTransformForm,n)}))}},{key:"datalinkItemSortChange",value:function(e){var t=this;e.forEach((function(e,n){var a=t.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find((function(t){return t.value.key===e.key}));a&&a.controls.position.setValue(n)}))}},{key:"newOutputDrop",value:function(e){this.onColumnDrop.emit({inputColumn:e,outputColumn:null})}},{key:"createJoinNode",value:function(){var e=this;if(this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find((function(e){return e.value.transformItemType===l.kc.JoinNode})))this.authService.informationDialog("Can not add node","Only one join node can be added.");else{var t=this.datalinkTransformForm.value.joinDatalinkTable,n=new l.x,a=new l.m;a.position=0,a.key=this.hubService.getHubCache().getNextSequence(),a.name=t.name,a.logicalName=t.name;var r=new m.b,i=t.dexihDatalinkColumns.map((function(t,n){var a=r.copyDatalinkColumn(t,n,"Join Node");return a.key=e.hubService.getHubCache().getNextSequence(),a.datalinkTableKey=null,a}));a.childColumns=i,a.dataType=l.pc.Node,n.position=-1,n.datalinkTransformKey=this.datalinkTransformForm.value.key,n.targetDatalinkColumn=a,n.isValid=!0,n.transformItemType=l.kc.JoinNode;var o=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,n);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,o)}}},{key:"createGroupNode",value:function(){if(this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find((function(e){return e.value.transformItemType===l.kc.GroupNode})))this.authService.informationDialog("Can not add node","Only one group node can be added.");else{var e=new l.x,t=new l.m;t.position=0,t.key=this.hubService.getHubCache().getNextSequence(),t.name="Group",t.logicalName="Group",t.dataType=l.pc.Node,e.position=-1,e.datalinkTransformKey=this.datalinkTransformForm.value.key,e.targetDatalinkColumn=t,e.isValid=!0,e.transformItemType=l.kc.GroupNode;var n=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,e);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,n)}}},{key:"newMapping",value:function(e){this.router.navigate(["mapping-edit",e],{relativeTo:this.route})}},{key:"addAll",value:function(){var e=this;this.datalinkTransformForm.controls.runTime.value.inputColumns.forEach((function(t){e.createMapping(t)}))}},{key:"addGroup",value:function(e){var t=this;e.columns.forEach((function(e){t.createMapping(e)}))}},{key:"createMapping",value:function(e){var t=this;if(!(this.datalinkTransformForm.controls.runTime.value.outputColumns.findIndex((function(t){return t.name===e.name}))>=0)){var n=new l.x,a=(new m.b).copyDatalinkColumn(e,0,"mapping");a.key=this.hubService.getHubCache().getNextSequence(),a.childColumns&&a.childColumns.forEach((function(e){e.key=t.hubService.getHubCache().getNextSequence()})),a.datalinkTableKey=null,n.datalinkTransformKey=this.datalinkTransformForm.value.key,n.sourceDatalinkColumn=e,n.targetDatalinkColumn=a,n.transformItemType=l.kc.ColumnPair,n.isValid=!0;var r=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,n);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,r)}}},{key:"addValidFromTo",value:function(e){var t=this.datalinkTransformForm.value.joinDatalinkTable,n=t.dexihDatalinkColumns.find((function(e){return e.deltaType===l.qb.ValidFromDate})),a=t.dexihDatalinkColumns.find((function(e){return e.deltaType===l.qb.ValidToDate}));if(n&&a){var r=new l.x;r.sourceDatalinkColumn=e,r.joinDatalinkColumn=n,r.transformItemType=l.kc.JoinPair,r.filterCompare=l.hb.GreaterThanEqual;var i=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,r);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,i),(r=new l.x).sourceDatalinkColumn=e,r.joinDatalinkColumn=a,r.transformItemType=l.kc.JoinPair,r.filterCompare=l.hb.LessThan,i=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,r),this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,i)}else this.authService.informationDialog("No valid from","The join table does not contain a columns with a valid from/to delta type.")}}]),e}()).\u0275fac=function(e){return new(e||sn)(s.Kb(d.a),s.Kb(u.a),s.Kb(h),s.Kb(i.e),s.Kb(i.a))},sn.\u0275cmp=s.Eb({type:sn,selectors:[["mapping"]],viewQuery:function(e,t){var n;1&e&&s.Bc(Ht,!0),2&e&&s.rc(n=s.Wb())&&(t.mappingTable=n.first)},inputs:{datalinkTransformForm:"datalinkTransformForm",allowStandard:"allowStandard",allowMapping:"allowMapping",allowAggregate:"allowAggregate",allowRow:"allowRow",allowCondition:"allowCondition",allowValidation:"allowValidation",allowOutput:"allowOutput",allowGroup:"allowGroup",allowJoin:"allowJoin",allowSort:"allowSort",allowSeries:"allowSeries",allowJoinNode:"allowJoinNode",title:"title"},outputs:{addMapping:"addMapping",removeMapping:"removeMapping",updateMapping:"updateMapping",hasChanged:"hasChanged",onColumnDrop:"onColumnDrop"},features:[s.wb],decls:11,vars:9,consts:[[3,"title","scrollable","showExpandButton"],["tableClass","table table-striped table-hover m-0","dropZone","","zone","input-column","dropAllowedClass","drop-zone-green","actionHeading","Mappings",3,"enableMultiSelect","enableManualSort","columns","dataObservable","enableStickyToolbar","toolbarZIndex","rowClick","onSortChanged","dropData"],["mappingTable",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["rowAction",""],["actions",""],["title","Edit this mapping",1,"mr-1",3,"click"],["title","Delete selected mapping functions",1,"mr-1",3,"click"],[3,"transform","transformItem","allowCondition","click"],[3,"ngIf"],["buttonClass","btn-primary","iconClass","fa fa-map","title","Create a new mapping, or drop a column to create new mapping.","text","Mapping",1,"mr-1",3,"buttonClick"],["title","Add all",1,"dropdown-item",3,"click"],[4,"ngFor","ngForOf"],[1,"dropdown-item",3,"title","click"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-filter","title","Create a simple filter",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-cubes","title","Create a simple aggregate",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-dollar","title","Create a new standard function",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-code","title","Create a new custom function",3,"routerLink"],["routerLink","unGroup-edit","buttonClass","btn-primary mr-1 ","iconClass","fa fa-map","title","Un-Group a Node"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-link","title","Create a new join",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-dollar","title","Create a new standard filter",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-code","title","Create a new custom filter",3,"routerLink"],["buttonClass","btn-primary","iconClass","fa fa-calendar","title","Add a joins between the column and the valid from/to","text","Valid From/To",1,"mr-1"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-sort-alpha-asc","title","New Sort",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-list","title","New Group",3,"routerLink"],["buttonClass","btn-primary mr-1 ","iconClass","fa fa-list","title","Join Node",3,"click"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget",0),s.Ob(1,"dexih-table",1,2),s.Vb("rowClick",(function(e){return t.editMapping(e)}))("onSortChanged",(function(e){return t.datalinkItemSortChange(e)}))("dropData",(function(e){return t.newOutputDrop(e)})),s.Dc(3,Jt,1,0,"ng-template",3,4,s.Ec),s.Dc(5,Bt,1,0,"ng-template",5,6,s.Ec),s.Dc(7,$t,1,3,"ng-template",null,7,s.Ec),s.Dc(9,ln,9,9,"ng-template",null,8,s.Ec),s.Nb(),s.Nb()),2&e&&(s.hc("title",t.title)("scrollable",!0)("showExpandButton",!0),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("columns",t.columns)("dataObservable",t.tableData)("enableStickyToolbar",!0)("toolbarZIndex",100))},directives:[p.P,B.a,Ae.a,p.j,p.g,jt,r.t,p.w,r.s,p.f,i.f,p.i],encapsulation:2}),sn);function cn(e,t){1&e&&(s.Ob(0,"div"),s.Ob(1,"section"),s.Lb(2,"form-checkbox",16),s.Nb(),s.Nb())}function mn(e,t){if(1&e&&(s.Ob(0,"section"),s.Lb(1,"form-select",17),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("items",n.nodes)("enableKeySelect",!1)("allowNullSelect",!0)}}function bn(e,t){if(1&e&&(s.Ob(0,"form",8),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-input",9),s.Nb(),s.Ob(4,"section"),s.Lb(5,"form-textarea",10),s.Nb(),s.Dc(6,cn,3,0,"div",11),s.Dc(7,mn,2,3,"section",11),s.Ob(8,"div",12),s.Ob(9,"section",13),s.Lb(10,"form-input",14),s.Nb(),s.Ob(11,"section",13),s.Lb(12,"form-input",15),s.Nb(),s.Nb(),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.hc("formGroup",n.datalinkTransformForm),s.yb(3),s.hc("autocapitalize",!0)("errors",n.formErrors.name),s.yb(2),s.hc("errors",n.formErrors.description),s.yb(1),s.hc("ngIf",n.datalinkTransformForm.value.transformType==n.eTransformType.Aggregate||n.datalinkTransformForm.value.transformType==n.eTransformType.Series||n.datalinkTransformForm.value.transformType==n.eTransformType.Rows||n.datalinkTransformForm.value.transformType==n.eTransformType.Mapping),s.yb(1),s.hc("ngIf",(null==n.nodes?null:n.nodes.length)>0)}}function dn(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",18),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Lb(3,"datalink-table",19),s.Ob(4,"div",12),s.Ob(5,"section",13),s.Lb(6,"form-select",20),s.Nb(),s.Ob(7,"section",13),s.Lb(8,"form-select",21),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.hc("showExpandButton",!0),s.yb(1),s.hc("formGroup",n.datalinkTransformForm),s.yb(2),s.hc("datalinkTableForm",n.datalinkTransformForm.controls.joinDatalinkTable),s.yb(3),s.hc("label","Strategy when "+n.eTransformType[n.datalinkTransformForm.value.transformType]+" produces duplicate matches")("items",n.eDuplicateStrategyItems),s.yb(2),s.hc("label","Strategy when "+n.eTransformType[n.datalinkTransformForm.value.transformType]+" produces no match ")("items",n.eJoinNotFoundStrategyItems)}}function fn(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",22),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Lb(3,"datalink-table",19),s.Nb(),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.hc("showExpandButton",!0),s.yb(1),s.hc("formGroup",n.datalinkTransformForm),s.yb(2),s.hc("datalinkTableForm",n.datalinkTransformForm.controls.joinDatalinkTable)}}function hn(e,t){1&e&&(s.Ob(0,"div",12),s.Ob(1,"section",13),s.Lb(2,"form-input",28),s.Nb(),s.Ob(3,"section",13),s.Lb(4,"form-input",29),s.Nb(),s.Nb())}function pn(e,t){1&e&&(s.Ob(0,"div",12),s.Ob(1,"section",13),s.Lb(2,"form-input",30),s.Nb(),s.Ob(3,"section",13),s.Lb(4,"form-input",31),s.Nb(),s.Nb())}function vn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-widget-section",23),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Ob(3,"div",12),s.Ob(4,"section",13),s.Lb(5,"form-select",24),s.Nb(),s.Ob(6,"section",13),s.Ob(7,"form-select",25),s.Vb("textValueChange",(function(e){return s.vc(n),s.Zb().sourceValue=e})),s.Nb(),s.Nb(),s.Nb(),s.Lb(8,"form-checkbox",26),s.Dc(9,hn,5,0,"div",27),s.Dc(10,pn,5,0,"div",27),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("showExpandButton",!0),s.yb(1),s.hc("formGroup",a.seriesForm),s.yb(4),s.hc("items",a.seriesGrains),s.yb(2),s.hc("items",a.inputColumns)("textValue",a.sourceValue)("enableKeySelect",!1)("errors",a.sourceErrors),s.yb(2),s.hc("ngIf",a.seriesForm.controls.seriesFill.value&&a.seriesForm.controls.seriesGrain.value!==a.eSeriesGrain.Number),s.yb(1),s.hc("ngIf",a.seriesForm.controls.seriesFill.value&&a.seriesForm.controls.seriesGrain.value===a.eSeriesGrain.Number)}}var gn=function(){return{standalone:!0}};function kn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"section",13),s.Ob(1,"form-input",35),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb(2).nodeName=e}))("ngModelChange",(function(e){return s.vc(n),s.Zb(2).updateNode(e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("ngModelOptions",s.lc(2,gn))("ngModel",a.nodeName)}}function yn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-widget-section",32),s.Ob(1,"form"),s.Ob(2,"fieldset"),s.Ob(3,"form-checkbox",33),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb().allowNode=e}))("ngModelChange",(function(e){return s.vc(n),s.Zb().toggleNode(e)})),s.Nb(),s.Dc(4,kn,2,3,"section",34),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.hc("showExpandButton",!0),s.yb(3),s.hc("ngModelOptions",s.lc(4,gn))("ngModel",a.allowNode),s.yb(1),s.hc("ngIf",a.allowNode)}}function Tn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",44),s.Ob(1,"join-columns",45),s.Vb("inputJoinDrop",(function(e){return s.vc(n),s.Zb(2).newDragDropJoin(e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)}}function Cn(e,t){if(1&e&&(s.Ob(0,"div"),s.Lb(1,"mapping",46),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.jc("title","",n.eTransformType[n.datalinkTransformForm.value.transformType]," Table"),s.hc("datalinkTransformForm",n.datalinkTransformForm)("allowJoin",!0)}}function Fn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",47),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowStandard",!0)("allowMapping",!0)("allowOutput",!0)}}function Dn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",48),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.Sort,e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowSort",!0)}}function wn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",49),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.Column,e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowGroup",!0)("allowSeries",a.datalinkTransformForm.value.transformType==a.eTransformType.Series)}}function Sn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",50),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.AggregatePair,e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowStandard",!0)("allowAggregate",!0)("allowOutput",!0)}}function Nn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",51),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.AggregatePair,e)})),s.Nb(),s.Ob(2,"mapping",52),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowStandard",!0)("allowAggregate",!0)("allowSeries",!0)("allowOutput",!0),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowMapping",!0)("allowOutput",!0)}}function On(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"mapping",50),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.AggregatePair,e)})),s.Nb(),s.Ob(2,"mapping",52),s.Vb("onColumnDrop",(function(e){s.vc(n);var t=s.Zb(2);return t.newDragDropMapping(t.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowStandard",!0)("allowAggregate",!0)("allowOutput",!0),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowMapping",!0)("allowOutput",!0)}}function In(e,t){if(1&e&&(s.Ob(0,"div"),s.Lb(1,"mapping",53),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",n.datalinkTransformForm)("allowStandard",!0)("allowCondition",!0)("allowOutput",!1)}}function xn(e,t){if(1&e&&(s.Ob(0,"div"),s.Lb(1,"mapping",54),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("datalinkTransformForm",n.datalinkTransformForm)("allowRow",!0)("allowStandard",!0)("allowJoinNode",!1)("allowOutput",!0)("allowCondition",!0)}}function Pn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",36),s.Ob(1,"dexih-widget",37),s.Lb(2,"input-columns",38),s.Dc(3,Tn,2,1,"div",39),s.Nb(),s.Ob(4,"div",40),s.Dc(5,Cn,2,3,"div",11),s.Dc(6,Fn,2,4,"div",11),s.Dc(7,Dn,2,2,"div",11),s.Dc(8,wn,2,3,"div",11),s.Dc(9,Sn,2,4,"div",11),s.Dc(10,Nn,3,8,"div",11),s.Dc(11,On,3,7,"div",11),s.Dc(12,In,2,4,"div",11),s.Dc(13,xn,2,6,"div",11),s.Nb(),s.Ob(14,"dexih-widget",41),s.Ob(15,"output-columns",42),s.Vb("inputOutputDrop",(function(e){s.vc(n);var t=s.Zb();return t.newDragDropMapping(t.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Ob(16,"target-columns",43),s.Vb("inputOutputDrop",(function(e){s.vc(n);var t=s.Zb();return t.newDragDropMapping(t.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.yb(1),s.hc("scrollable",!0),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.controls.joinDatalinkTable.value),s.yb(2),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Join||a.datalinkTransformForm.value.transformType==a.eTransformType.Lookup),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Mapping),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Sort),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Group||a.datalinkTransformForm.value.transformType==a.eTransformType.Aggregate||a.datalinkTransformForm.value.transformType==a.eTransformType.Series||a.datalinkTransformForm.value.transformType==a.eTransformType.Rows),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Group),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Series),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Aggregate),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Filter),s.yb(1),s.hc("ngIf",a.datalinkTransformForm.value.transformType==a.eTransformType.Rows),s.yb(1),s.hc("title","Outputs"+(null!=a.datalinkTransformForm.controls.nodeDatalinkColumn&&a.datalinkTransformForm.controls.nodeDatalinkColumn.value?"(@"+a.datalinkTransformForm.controls.nodeDatalinkColumn.value.name+")":""))("scrollable",!0),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowMappingOutputs",a.allowMappingOutputs),s.yb(1),s.hc("datalinkTransformForm",a.datalinkTransformForm)("targets",a.datalinkForm.controls.dexihDatalinkTargets.value)("allowMappingOutputs",a.allowMappingOutputs)}}var Vn,En=((Vn=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.pageTitle="Transform",this.showName=!1,this.showDescription=!1,this.eTransformType=l.lc,this.eTransformItemType=l.kc,this.eDuplicateStrategyItems=l.ub,this.eJoinNotFoundStrategyItems=l.Pb,this.eSeriesGrain=l.ac,this.seriesGrains=C.t,this.allowNode=!1,this.nodeName="",this.logger=new c.a("datalink-edit-transform"),this.nodes=[],this.formErrors={}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.logger.LogC((function(){return"OnInit"}),c.b.Trace);try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){if(e.action=t[0].action,e.pageTitle=t[0].pageTitle,e.datalinkTransformKey=+t[1].datalinkTransformKey,e.datalinkForm=t[2],e.datalinkForm){var n=e.datalinkForm.controls.dexihDatalinkTransforms;if(e._transformsArraySubscription&&e._transformsArraySubscription.unsubscribe(),e._transformsArraySubscription=n.valueChanges.subscribe((function(t){t.find((function(t){return t.datalinkTransformKey===e.datalinkTransformKey}))||e.router.navigate(["transforms"],{relativeTo:e.route.parent.parent.parent})})),e.datalinkTransformForm=n.controls.find((function(t){return t.value.key===e.datalinkTransformKey})),!e.datalinkTransformForm)return void e.authService.navigateUp();var a=e.datalinkTransformForm.value,r=e.datalinkTransformForm.controls.dexihDatalinkTransformItems;if(a.transformType===l.lc.Series&&(e.seriesForm=r.controls.filter((function(e){return e.value.transformItemType===l.kc.Series}))[0]),a.transformType===l.lc.Aggregate&&(e.nodeType=l.kc.GroupNode),a.transformType!==l.lc.Lookup&&a.transformType!==l.lc.Join||(e.nodeType=l.kc.JoinNode),e.nodeType){var i=a.dexihDatalinkTransformItems.find((function(t){return t.transformItemType===e.nodeType}));i?(e.allowNode=!0,e.nodeName=i.targetDatalinkColumn.name):e.allowNode=!1}e.inputColumns=a.runTime.inputColumns,e.nodes=[],e.addNodeColumns(e.inputColumns,"");var o=a.transformType;e.allowMappingOutputs=o===l.lc.Series||o===l.lc.Rows||o===l.lc.Mapping||o===l.lc.Validation,e._datalinkFormSubscription&&e._datalinkFormSubscription.unsubscribe(),e._datalinkFormSubscription=e.datalinkForm.valueChanges.subscribe((function(t){e.formErrors=e.editDatalinkService.hubFormsService.getFormErrorMessages(e.datalinkForm,!0)})),e.datalinkTransformForm||e.router.navigate(["properties"],{relativeTo:e.route.parent.parent.parent}),e.logger.LogC((function(){return"datalink form is loaded"}),c.b.Trace)}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Transform")}}},{key:"addNodeColumns",value:function(e,t){var n=this;e&&e.filter((function(e){return e.dataType===l.pc.Node&&e.isValid})).forEach((function(e){var a=t?t+"."+e.logicalName:e.logicalName;n.nodes.push({key:e.key,name:a}),e.childColumns&&e.childColumns.length>0&&n.addNodeColumns(e.childColumns,a)}))}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._transformsArraySubscription&&this._transformsArraySubscription.unsubscribe(),this._datalinkFormSubscription&&this._datalinkFormSubscription.unsubscribe()}},{key:"deleteTransform",value:function(){this.logger.LogC((function(){return"deleteTransform"}),c.b.Trace),this.editDatalinkService.deleteDatalinkTransform(this.datalinkTransformForm.value),this.router.navigate(["properties"],{relativeTo:this.route.parent.parent})}},{key:"previewData",value:function(){this.router.navigate(["preview-transform-data"],{relativeTo:this.route.parent})}},{key:"toggleNode",value:function(e){var t=this,n=this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find((function(e){return e.value.transformItemType===t.nodeType}));if(e){if(this.nodeName||(this.nodeName=l.kc[this.nodeType]),n)return void this.authService.informationDialog("Can not add node","Only one node can be added per transform.");var a=new l.x,r=new l.m;r.position=0,r.key=this.hubService.getHubCache().getNextSequence(),r.name=this.nodeName,r.logicalName=this.nodeName,r.dataType=l.pc.Node,a.position=-1,a.datalinkTransformKey=this.datalinkTransformForm.value.key,a.targetDatalinkColumn=r,a.isValid=!0,a.transformItemType=this.nodeType;var i=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,a);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,i)}else this.editDatalinkService.deleteDatalinkTransformItem(this.datalinkTransformForm,n)}},{key:"updateNode",value:function(e){var t=this,n=this.datalinkTransformForm.controls.dexihDatalinkTransformItems.controls.find((function(e){return e.value.transformItemType===t.nodeType}));if(n){var a=n.controls.targetDatalinkColumn.value;a&&(a.name=e,a.logicalName=e,n.controls.targetDatalinkColumn.setValue(a))}}},{key:"newDragDropMapping",value:function(e,t){var n=this,a=new l.x,r=t.outputColumn,i=t.inputColumn,o=new m.b;switch(e){case l.kc.ColumnPair:r||(r=o.copyDatalinkColumn(i,0,"mapping")),r.key=this.hubService.getHubCache().getNextSequence(),r.childColumns&&r.childColumns.forEach((function(e){e.key=n.hubService.getHubCache().getNextSequence()})),r.datalinkTableKey=null;break;case l.kc.Sort:a.sortDirection=l.fc.Ascending;break;case l.kc.AggregatePair:r||(r=o.copyDatalinkColumn(i,0,"mapping")),r.key=this.hubService.getHubCache().getNextSequence(),r.childColumns&&r.childColumns.forEach((function(e){e.key=n.hubService.getHubCache().getNextSequence()})),r.datalinkTableKey=null,a.aggregate=l.Y.Sum}if(e){a.datalinkTransformKey=this.datalinkTransformForm.value.key,a.sourceDatalinkColumn=i,a.targetDatalinkColumn=r,a.isValid=!0,a.transformItemType=e;var s=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,a);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,s)}}},{key:"newDragDropJoin",value:function(e){var t=this.datalinkTransformForm.value.transformType;if(t===l.lc.Join||t===l.lc.Lookup){var n=e.joinColumn,a=e.inputColumn,r=new l.x;r.transformItemType=l.kc.JoinPair,r.datalinkTransformKey=this.datalinkTransformForm.value.key,r.sourceDatalinkColumn=a,r.joinDatalinkColumn=n,r.isValid=!0;var i=this.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(this.datalinkTransformForm,r);this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,i)}}}]),e}()).\u0275fac=function(e){return new(e||Vn)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},Vn.\u0275cmp=s.Eb({type:Vn,selectors:[["dexih-datalink-edit-transform-form"]],decls:8,vars:8,consts:[["title","Properties",3,"showExpandButton","isExpanded"],[3,"formGroup",4,"ngIf"],["title","Join Settings",3,"showExpandButton",4,"ngIf"],["title","Concatenate Settings",3,"showExpandButton",4,"ngIf"],["title","Series Settings",3,"showExpandButton",4,"ngIf"],["title","Group Node",3,"showExpandButton",4,"ngIf"],[1,"list-group-item","p-1"],["class","d-flex","cdkDropListGroup","",4,"ngIf"],[3,"formGroup"],["label","Transform Name","formControlName","name","placeholder","Enter a name for the transform","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"errors"],[4,"ngIf"],[1,"form-row"],[1,"form-group","col-md-6"],["type","number","formControlName","maxInputRows","label","Maximum number of rows to input into the transform (0 = unlimited)"],["type","number","formControlName","maxOutputRows","label","Maximum number of rows to output into the transform (0 = unlimited)"],["label","Allow unmapped input columns to pass through to the next transform.","formControlName","passThroughColumns"],["label","Node level","formControlName","nodeDatalinkColumn","itemKey","key","itemName","name","node","Specify the node where the transform should be applied to.","selectNullMessage","Use top level",3,"items","enableKeySelect","allowNullSelect"],["title","Join Settings",3,"showExpandButton"],[3,"datalinkTableForm"],["formControlName","joinDuplicateStrategy","itemKey","key","itemName","name",3,"label","items"],["formControlName","joinNotFoundStrategy","itemKey","key","itemName","description",3,"label","items"],["title","Concatenate Settings",3,"showExpandButton"],["title","Series Settings",3,"showExpandButton"],["label","Series Grain","formControlName","seriesGrain","itemKey","key","itemName","name",3,"items"],["label","Input Column","formControlName","sourceDatalinkColumn","itemKey","key","itemName","name",3,"items","textValue","enableKeySelect","errors","textValueChange"],["label","Fill empty series values","formControlName","seriesFill"],["class","form-row",4,"ngIf"],["type","date","formControlName","seriesStart","label","Series Start Date (empty to use first value)"],["type","date","formControlName","seriesFinish","label","Series Finish Date (empty to use last value)"],["formControlName","seriesStart","label","Series Start Number (empty to use first value)"],["formControlName","seriesFinish","label","Series Finish Number (empty to use last value)"],["title","Group Node",3,"showExpandButton"],["label","Group rows under a node",3,"ngModelOptions","ngModel","ngModelChange"],["class","form-group col-md-6",4,"ngIf"],["label","Name of the node",3,"ngModelOptions","ngModel","ngModelChange"],["cdkDropListGroup","",1,"d-flex"],["title","Inputs","height","80vh",1,"d-none","d-lg-inline",2,"width","300px",3,"scrollable"],[3,"datalinkTransformForm"],["class","mt-1",4,"ngIf"],[1,"w-100","mr-1","ml-1"],["height","80vh",1,"d-none","d-lg-inline",2,"width","300px",3,"title","scrollable"],[3,"datalinkTransformForm","allowMappingOutputs","inputOutputDrop"],[3,"datalinkTransformForm","targets","allowMappingOutputs","inputOutputDrop"],[1,"mt-1"],[3,"datalinkTransformForm","inputJoinDrop"],[3,"datalinkTransformForm","allowJoin","title"],["title","Mapping Functions",3,"datalinkTransformForm","allowStandard","allowMapping","allowOutput","onColumnDrop"],["title","Sort Columns",3,"datalinkTransformForm","allowSort","onColumnDrop"],["title","Group Columns",3,"datalinkTransformForm","allowGroup","allowSeries","onColumnDrop"],["title","Aggregate Functions",3,"datalinkTransformForm","allowStandard","allowAggregate","allowOutput","onColumnDrop"],["title","Series/Aggregate Functions",3,"datalinkTransformForm","allowStandard","allowAggregate","allowSeries","allowOutput","onColumnDrop"],["title","Mappings",3,"datalinkTransformForm","allowMapping","allowOutput","onColumnDrop"],["title","Filters",3,"datalinkTransformForm","allowStandard","allowCondition","allowOutput"],["title","Row Functions",3,"datalinkTransformForm","allowRow","allowStandard","allowJoinNode","allowOutput","allowCondition"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,bn,13,6,"form",1),s.Nb(),s.Dc(2,dn,9,7,"dexih-widget-section",2),s.Dc(3,fn,4,3,"dexih-widget-section",3),s.Dc(4,vn,11,9,"dexih-widget-section",4),s.Dc(5,yn,5,5,"dexih-widget-section",5),s.Ob(6,"div",6),s.Dc(7,Pn,17,19,"div",7),s.Nb()),2&e&&(s.hc("showExpandButton",!0)("isExpanded",!1),s.yb(1),s.hc("ngIf",t.datalinkTransformForm),s.yb(1),s.hc("ngIf",t.datalinkTransformForm&&(t.datalinkTransformForm.value.transformType==t.eTransformType.Join||t.datalinkTransformForm.value.transformType==t.eTransformType.Lookup)),s.yb(1),s.hc("ngIf",t.datalinkTransformForm&&t.datalinkTransformForm.value.transformType==t.eTransformType.Concatenate),s.yb(1),s.hc("ngIf",t.datalinkTransformForm&&t.datalinkTransformForm.value.transformType==t.eTransformType.Series),s.yb(1),s.hc("ngIf",t.datalinkTransformForm&&t.nodeType),s.yb(2),s.hc("ngIf",t.datalinkTransformForm))},directives:[p.T,r.t,g.I,g.t,g.l,p.D,g.s,g.j,p.H,p.A,p.E,te,g.u,g.v,Ce.f,p.P,Ze,qe,at,mt,un],encapsulation:2}),Vn);function Kn(e,t){if(1&e&&(s.Ob(0,"form",5),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Lb(3,"form-input",6),s.Nb(),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.hc("formGroup",n.datalinkForm),s.yb(3),s.hc("autocapitalize",!0)}}function Ln(e,t){if(1&e){var n=s.Pb();s.Ob(0,"form-checkbox",7),s.Vb("ngModelChange",(function(e){return s.vc(n),t.item.detailedResults=e}))("change",(function(){s.vc(n);var e=t.item;return s.Zb().updateProfileRule(e)})),s.Nb()}2&e&&s.hc("ngModel",t.item.detailedResults)}var Mn,Zn=((Mn=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.selectedProfileRules=new Array,this.columns=[{name:"name",title:"Profile Name",format:""},{name:"description",title:"Description",format:""}],this._tableData=new b.a(null),this.tableData=this._tableData.asObservable()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){return n=e,r=regeneratorRuntime.mark((function e(){var n,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hubCache=t[0],this.datalinkForm=t[1],!this.datalinkForm||!this.hubCache.isLoaded()){e.next=6;break}return this.selectedProfileRules=this.datalinkForm.value.dexihDatalinkProfiles,e.next=4,this.hubService.GetFunctionsByType(l.Cb.Profile);case 4:n=e.sent.map((function(e){var t=a.selectedProfileRules.find((function(t){return t.functionAssemblyName===e.functionAssemblyName&&t.functionClassName===e.functionClassName&&t.functionMethodName===e.functionMethodName}));return{functionAssemblyName:e.functionAssemblyName,functionClassName:e.functionClassName,functionMethodName:e.functionMethodName,detailedResults:!!t&&t.detailedResults}})),this._tableData.next(n);case 6:case"end":return e.stop()}}),e,this)})),new((a=void 0)||(a=Promise))((function(e,t){function i(e){try{l(r.next(e))}catch(n){t(n)}}function o(e){try{l(r.throw(e))}catch(n){t(n)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(i,o)}l((r=r.apply(n,[])).next())}));var n,a,r}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function")}}},{key:"updateProfileRules",value:function(){var e=this;if(this.datalinkForm){var t=this.datalinkForm.controls.dexihDatalinkProfiles;t.controls.forEach((function(e){e.controls.isValid.setValue(!1)})),this.selectedProfileRules.forEach((function(n){var a=t.controls.find((function(e){return e.value.functionAssemblyName===n.functionAssemblyName&&e.value.functionClassName===n.functionClassName&&e.value.functionMethodName===n.functionMethodName}));if(a)a.controls.isValid.setValue(!0);else{var r=new l.o;r.key=e.hubCache.getNextSequence(),r.datalinkKey=e.datalinkForm.value.key,r.functionAssemblyName=n.functionAssemblyName,r.functionClassName=n.functionClassName,r.functionMethodName=n.functionMethodName,r.detailedResults=n.detailedResults,r.isValid=!0,a=e.editDatalinkService.hubFormsService.datalinkProfileFormGroup(r),t.push(a)}}));for(var n=t.controls.length-1;n>=0;n--)t.controls[n].value.isValid||t.removeAt(n)}}},{key:"updateProfileRule",value:function(e){this.datalinkForm.controls.dexihDatalinkProfiles.controls.find((function(t){return t.value.functionAssemblyName===e.functionAssemblyName&&t.value.functionClassName===e.functionClassName&&t.value.functionMethodName===e.functionMethodName})).controls.detailedResults.setValue(e.detailedResults),this.editDatalinkService.hubFormsService.hasChanged=!0}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this.updateProfileRules()}},{key:"hasChanged",value:function(e){e&&(this.selectedProfileRules=e),this.updateProfileRules(),this.editDatalinkService.hubFormsService.hasChanged=!0}}]),e}()).\u0275fac=function(e){return new(e||Mn)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},Mn.\u0275cmp=s.Eb({type:Mn,selectors:[["profile-rules"]],decls:5,vars:8,consts:[["title","Profile Rules",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["keyColumn","functionMethodName",3,"enableMultiSelect","enableManualSort","enableFilter","columns","dataObservable","selectedItems","selectedItemsChange","onSelectedChange"],["select","rowAction"],["rowAction",""],[3,"formGroup"],["label","Profile Table Name","formControlName","profileTableName","placeholder","Enter the profile table name.","iconClass","fa fa-list","note","Specify the table name in the 'Audit Connection' to send the profile results to.  If this table does not exist, it will be created on first run.",3,"autocapitalize"],["label","Capture Detailed Distribution","name","detailedResults",3,"ngModel","ngModelChange","change"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,Kn,4,2,"form",1),s.Ob(2,"dexih-table",2),s.Vb("selectedItemsChange",(function(e){return t.selectedProfileRules=e}))("onSelectedChange",(function(e){return t.hasChanged(e)})),s.Dc(3,Ln,1,1,"ng-template",3,4,s.Ec),s.Nb(),s.Nb()),2&e&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",t.datalinkForm),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!1)("enableFilter",!1)("columns",t.columns)("dataObservable",t.tableData)("selectedItems",t.selectedProfileRules))},directives:[p.T,r.t,B.a,g.I,g.t,g.l,p.D,g.s,g.j,p.A,g.v],encapsulation:2}),Mn);function An(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button",5),s.Vb("click",(function(){return s.vc(n),s.Zb(2).enableValidation()})),s.Fc(1,"Enable Validation"),s.Nb()}2&e&&s.hc("autoCompact",!1)}function _n(e,t){if(1&e&&(s.Ob(0,"div"),s.Ob(1,"h4"),s.Fc(2,"Target column validation is not currently enabled. "),s.Nb(),s.Dc(3,An,2,1,"dexih-button",4),s.Nb()),2&e){var n=s.Zb();s.yb(3),s.hc("ngIf",!n.datalinkTransformForm)}}function Gn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"form",7),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Ob(3,"dexih-button",5),s.Vb("click",(function(){return s.vc(n),s.Zb(2).disableValidation()})),s.Fc(4,"Disable Validation"),s.Nb(),s.Nb(),s.Ob(5,"section"),s.Lb(6,"form-textarea",8),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("formGroup",a.datalinkTransformForm),s.yb(3),s.hc("autoCompact",!1)}}function Rn(e,t){if(1&e&&(s.Ob(0,"div"),s.Dc(1,Gn,7,2,"form",6),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("ngIf",n.datalinkTransformForm)}}function jn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",9),s.Ob(1,"div",10),s.Ob(2,"div"),s.Ob(3,"div",11),s.Ob(4,"h4"),s.Fc(5,"Inputs"),s.Nb(),s.Nb(),s.Ob(6,"div"),s.Lb(7,"input-columns",12),s.Nb(),s.Nb(),s.Nb(),s.Ob(8,"div",13),s.Lb(9,"mapping",14),s.Nb(),s.Ob(10,"div",15),s.Ob(11,"div",11),s.Ob(12,"h4"),s.Fc(13,"Outputs "),s.Lb(14,"div",16),s.Nb(),s.Nb(),s.Ob(15,"output-columns",17),s.Vb("inputOutputDrop",(function(e){s.vc(n);var t=s.Zb();return t.newDragDropMapping(t.eTransformItemType.ColumnPair,e)})),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.yb(7),s.hc("datalinkTransformForm",a.datalinkTransformForm),s.yb(2),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowCondition",!0)("allowOutput",!0)("allowStandard",!0)("allowValidation",!0),s.yb(6),s.hc("datalinkTransformForm",a.datalinkTransformForm)("allowMappingOutputs",a.allowMappingOutputs)}}var Hn,Jn,Bn=((Jn=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.pageTitle="Validation",this.showName=!1,this.showDescription=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle,e.hubCache=t[1],e.datalinkForm=t[2],e.remoteLibraries=t[3],e.hubCache.isLoaded()&&e.datalinkForm&&(e.datalinkTransformForm=e.editDatalinkService.getValidationTransform())}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit Validation")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"enableValidation",value:function(){var e=this.remoteLibraries.transforms.find((function(e){return e.transformType===l.lc.Validation}));this.datalinkTransformForm=this.editDatalinkService.insertDatalinkTransform(1,e)}},{key:"disableValidation",value:function(){this.editDatalinkService.deleteDatalinkTransform(this.datalinkTransformForm.value),this.datalinkTransformForm=null}}]),e}()).\u0275fac=function(e){return new(e||Jn)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},Jn.\u0275cmp=s.Eb({type:Jn,selectors:[["dexih-datalink-edit-validation-form"]],decls:5,vars:4,consts:[["title","Validation",3,"showExpandButton"],[4,"ngIf"],[1,"list-group-item","p-1"],["class","d-flex",4,"ngIf"],["buttonClass","btn btn-success","iconClass","fa fa-check","title","Enable the validation on the target table.",3,"autoCompact","click",4,"ngIf"],["buttonClass","btn btn-success","iconClass","fa fa-check","title","Enable the validation on the target table.",3,"autoCompact","click"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Description","formControlName","description","placeholder","Enter the description."],[1,"d-flex"],[1,"mr-1","d-none","d-md-inline"],[1,"alert","alert-primary","mb-1"],[3,"datalinkTransformForm"],[1,"w-100"],["title","Validation",3,"datalinkTransformForm","allowCondition","allowOutput","allowStandard","allowValidation"],[1,"ml-1","d-none","d-md-inline"],[1,"float-right"],[3,"datalinkTransformForm","allowMappingOutputs","inputOutputDrop"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,_n,4,1,"div",1),s.Dc(2,Rn,2,1,"div",1),s.Nb(),s.Ob(3,"div",2),s.Dc(4,jn,16,8,"div",3),s.Nb()),2&e&&(s.hc("showExpandButton",!0),s.yb(1),s.hc("ngIf",!t.datalinkTransformForm),s.yb(1),s.hc("ngIf",t.datalinkTransformForm),s.yb(2),s.hc("ngIf",t.datalinkTransformForm))},directives:[p.T,r.t,p.f,g.I,g.t,g.l,p.H,g.s,g.j,Ze,un,qe],encapsulation:2}),Jn),$n=((Hn=function(){function e(t,n,a){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.route=a,this.allowSave=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle,e.datalinkForm=t[3]}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Run Plan")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}}]),e}()).\u0275fac=function(e){return new(e||Hn)(s.Kb(u.a),s.Kb(h),s.Kb(i.a))},Hn.\u0275cmp=s.Eb({type:Hn,selectors:[["dexih-datalink-run-plan"]],decls:9,vars:0,consts:[[1,"no-padding"],[1,"widget-body"],["section","",1,"widget-body-toolbar"],[1,"form-row"],[1,"col-sm-6"],[1,"col-sm-6","text-right"]],template:function(e,t){1&e&&(s.Ob(0,"div",0),s.Ob(1,"div",1),s.Ob(2,"div",2),s.Ob(3,"div",3),s.Ob(4,"div",4),s.Ob(5,"h4"),s.Fc(6,"Run Plan"),s.Nb(),s.Nb(),s.Lb(7,"div",5),s.Nb(),s.Nb(),s.Fc(8," NOT COMPLETED "),s.Nb(),s.Nb())},encapsulation:2}),Hn),Un=n("1qMd"),qn=n("zXKq"),zn=n("l2bN");function Wn(e,t){if(1&e&&(s.Ob(0,"div",11),s.Ob(1,"div",12),s.Fc(2),s.Nb(),s.Nb()),2&e){var n=s.Zb().$implicit,a=s.Zb();s.yb(2),s.Ic(" ",(null==n.value.runTime||null==n.value.runTime.functionParameter?null:n.value.runTime.functionParameter.name)+"("+a.eTypeCode[a.type.dataType]+")"," ",a.rank>0?"[]":""," ")}}function Qn(e,t){1&e&&(s.Ob(0,"div",13),s.Lb(1,"form-input",14),s.Nb()),2&e&&(s.yb(1),s.hc("border",!1))}function Yn(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",13),s.Ob(1,"form-select",15),s.Vb("textValueChange",(function(e){s.vc(n);var t=s.Zb().index;return s.Zb().inputs[t].staticValue=e}))("textValueChange",(function(e){s.vc(n);var t=s.Zb().index;return s.Zb().updateStatic(e,t)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb().index,r=s.Zb();s.yb(1),s.hc("border",!1)("items",r.inputColumnGroups)("textValue",r.inputs[a].staticValue)("enableKeySelect",!1)("enableTextEntry",0===r.rank)("enableTextEntryMatch",!1)("setTextEntryToValue",!1)("textEntryNote",r.rank>0?"Select an array type source (otherwise select add to build an array)":"Select a column or enter a static value.")("textEntryItems",r.inputs[a].textItems)("errors",r.errors[a].datalinkColumn)}}var Xn=function(){return{standalone:!0}};function ea(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",13),s.Ob(1,"form-input",16),s.Vb("ngModelChange",(function(e){s.vc(n);var t=s.Zb().index;return s.Zb().inputs[t].staticValue=e})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb().index,r=s.Zb();s.yb(1),s.hc("border",!1)("ngModel",r.inputs[a].staticValue)("ngModelOptions",s.lc(3,Xn))}}function ta(e,t){if(1&e&&(s.Ob(0,"div",12),s.Fc(1),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.Hc(" ","("+n.eTypeCode[n.type.dataType]+")"," ")}}function na(e,t){if(1&e&&(s.Ob(0,"div",13),s.Lb(1,"form-select",17),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("border",!1)("items",n.typeCodes)}}function aa(e,t){1&e&&(s.Ob(0,"div",18),s.Lb(1,"form-checkbox",19),s.Nb()),2&e&&(s.yb(1),s.hc("border",!1))}function ra(e,t){if(1&e&&(s.Ob(0,"form",5),s.Ob(1,"div",6),s.Dc(2,Wn,3,2,"div",7),s.Dc(3,Qn,2,1,"div",8),s.Dc(4,Yn,2,10,"div",8),s.Dc(5,ea,2,4,"div",8),s.Dc(6,ta,2,1,"div",9),s.Dc(7,na,2,2,"div",8),s.Dc(8,aa,2,1,"div",10),s.Nb(),s.Nb()),2&e){var n=t.$implicit,a=s.Zb();s.hc("formGroup",n),s.yb(2),s.hc("ngIf",!a.allowNameSelect),s.yb(1),s.hc("ngIf",1==a.allowNameSelect),s.yb(1),s.hc("ngIf",!(null!=n.value.runTime&&null!=n.value.runTime.functionParameter&&n.value.runTime.functionParameter.isLabel)),s.yb(1),s.hc("ngIf",null==n.value.runTime||null==n.value.runTime.functionParameter?null:n.value.runTime.functionParameter.isLabel),s.yb(1),s.hc("ngIf",0==a.allowDataTypeSelect&&1==a.allowNameSelect),s.yb(1),s.hc("ngIf",1==a.allowDataTypeSelect),s.yb(1),s.hc("ngIf",1==a.allowDataTypeSelect)}}function ia(e,t){if(1&e){var n=s.Pb();s.Ob(0,"form",20),s.Ob(1,"form-select",21),s.Vb("textValueChange",(function(e){s.vc(n);var a=t.index;return s.Zb().updateNewColumn(e,a)})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=s.Zb();s.hc("formGroup",a),s.yb(1),s.hc("border",!1)("items",r.outputTables)("enableKeySelect",!1)("enableTextEntry",!0)("setTextEntryToValue",!1)}}function oa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"button",25),s.Vb("click",(function(){return s.vc(n),s.Zb(2).add()})),s.Lb(1,"i",26),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("disabled",!a.allowAdd)}}function la(e,t){if(1&e){var n=s.Pb();s.Ob(0,"button",27),s.Vb("click",(function(){return s.vc(n),s.Zb(2).remove()})),s.Lb(1,"i",28),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("disabled",!a.allowRemove)}}function sa(e,t){if(1&e&&(s.Ob(0,"div",22),s.Dc(1,oa,2,1,"button",23),s.Dc(2,la,2,1,"button",24),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("ngIf",n.allowAdd),s.yb(1),s.hc("ngIf",n.allowRemove)}}function ua(e,t){if(1&e&&(s.Ob(0,"small",29),s.Lb(1,"markdown",30),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("data",n.inputParameterForms[0].value.runTime.functionParameter.description)}}var ca,ma=function e(){_classCallCheck(this,e)},ba=((ca=function(){function e(t,n){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.allowDataTypeSelect=!1,this.allowNameSelect=!1,this.allowAdd=!1,this.allowRemove=!1,this.inputParameterForms=[],this.inputColumns=null,this.updateParameterName=!1,this.rank=0,this.nodeDatalinkColumnKey=null,this.outputParameterForms=null,this.outputColumns=null,this.datalinkTargets=null,this.variables=[],this.addParameter=new s.n,this.removeParameter=new s.n,this.eBasicType=Un.c,this.typeCodes=Un.a,this.eTypeCode=l.pc,this.inputColumnGroups=[],this.inputs=[],this.ignoreChanges=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.inputs=this.inputParameterForms.map((function(e){return new ma})),this.errors=this.inputParameterForms.map((function(t){return e.editDatalinkService.hubFormsService.getFormErrorMessages(t,!0)}));var t=new m.b;this.nodeDatalinkColumnKey&&(this.inputColumns=t.getAvailableColumns(this.inputColumns,this.nodeDatalinkColumnKey,0)),this.rank>0&&this.inputColumns&&(this.inputColumns=this.inputColumns.filter((function(e){return e.rank>0}))),this.inputColumnGroups=this.inputColumns?this.editDatalinkService.getColumnGroups(this.inputColumns):[];for(var n=0;n<this.inputParameterForms.length;n++){var a=this.inputParameterForms[n].value;this.inputs[n].staticValue=a.datalinkColumn||null==a.value?"":a.value,this.inputs[n].textItems=[],a.dataType===l.pc.Boolean&&(this.inputs[n].textItems=this.inputs[n].textItems.concat(["true","false"]),this.inputs[n].staticValue=this.inputs[n].staticValue.toString()),a.runTime&&a.runTime.functionParameter.listOfValues&&(this.inputs[n].textItems=this.inputs[n].textItems.concat(a.runTime.functionParameter.listOfValues)),this.inputs[n].textItems=this.inputs[n].textItems.concat(this.variables)}this.updateItems();for(var r=function(t){var n=e.inputParameterForms[t].value.runTime;n&&n.functionParameter&&n.functionParameter.listOfValues||(e.inputs[t].inputParameterSubscription=e.inputParameterForms[t].valueChanges.subscribe((function(){e.ignoreChanges||(e.updateItems(),e.ignoreChanges=!0,e.inputParameterForms[t].controls.value.setValue(e.inputParameterForms[t].controls.datalinkColumn.value?null:e.inputs[t].staticValue),e.ignoreChanges=!1),e.errors[t]=e.editDatalinkService.hubFormsService.getFormErrorMessages(e.inputParameterForms[t],!0)}))),e.updateParameterName&&(e.inputs[t].datalinkColumnSubscription=e.inputParameterForms[t].controls.datalinkColumn.valueChanges.subscribe((function(n){n?(e.inputParameterForms[t].controls.dataType.setValue(n.dataType),e.inputParameterForms[t].controls.name.setValue(n.name)):(e.inputParameterForms[t].controls.dataType.setValue(l.pc.String),e.inputParameterForms[t].controls.name.setValue("")),e.errors[t]=e.editDatalinkService.hubFormsService.getFormErrorMessages(e.inputParameterForms[t],!0)})))},i=0;i<this.inputParameterForms.length;i++)r(i)}},{key:"updateStatic",value:function(e,t){this.inputParameterForms[t].controls.value.setValue(e)}},{key:"ngOnDestroy",value:function(){this.inputs&&this.inputs.forEach((function(e){e.datalinkColumnSubscription&&e.datalinkColumnSubscription.unsubscribe(),e.inputParameterSubscription&&e.inputParameterSubscription.unsubscribe()}))}},{key:"ngOnChanges",value:function(){var e=this,t=new l.H;t.name="Output Columns",t.dexihTableColumns=this.outputColumns,this.outputTables=[t],this.datalinkTargets&&this.datalinkTargets.forEach((function(t){e.outputTables.push(t.table)}))}},{key:"updateItems",value:function(){for(var e=0;e<this.inputParameterForms.length;e++){var t=this.inputParameterForms[e].value;this.type=new Un.b(t.dataType,null,null,null),this.inputs[e].name=this.allowDataTypeSelect||this.allowNameSelect?t.name:t.name+"("+this.type.dataType+")"+(this.rank>0?"[]":"")}}},{key:"add",value:function(){this.addParameter.emit(this.inputParameterForms[0])}},{key:"remove",value:function(){this.removeParameter.emit(this.inputParameterForms[0])}},{key:"updateNewColumn",value:function(e,t){var n=this.outputParameterForms[t].controls.targetDatalinkColumn.value;!e||n&&e===n.name||(this.newColumn||(this.newColumn=new l.m,this.newColumn.position=1e3-this.newColumn.key,this.newColumn.key=this.hubService.getHubCache().getNextSequence()),this.newColumn.dataType=this.outputParameterForms[t].controls.dataType.value,this.newColumn.name=e,this.newColumn.logicalName=e,this.outputParameterForms[t].controls.datalinkColumn.setValue(this.newColumn),this.updateItems())}}]),e}()).\u0275fac=function(e){return new(e||ca)(s.Kb(u.a),s.Kb(h))},ca.\u0275cmp=s.Eb({type:ca,selectors:[["input-parameter"]],inputs:{allowDataTypeSelect:"allowDataTypeSelect",allowNameSelect:"allowNameSelect",allowAdd:"allowAdd",allowRemove:"allowRemove",inputParameterForms:"inputParameterForms",inputColumns:"inputColumns",updateParameterName:"updateParameterName",rank:"rank",nodeDatalinkColumnKey:"nodeDatalinkColumnKey",outputParameterForms:"outputParameterForms",outputColumns:"outputColumns",datalinkTargets:"datalinkTargets",variables:"variables"},outputs:{addParameter:"addParameter",removeParameter:"removeParameter"},features:[s.wb],decls:6,vars:4,consts:[[1,"input-group","d-flex"],["class","flex-fill",3,"formGroup",4,"ngFor","ngForOf"],["class","ml-1  flex-fill",3,"formGroup",4,"ngFor","ngForOf"],["class","input-group-append flex-shrink-1 ml-1 ",4,"ngIf"],["class","form-text text-muted",4,"ngIf"],[1,"flex-fill",3,"formGroup"],[1,"input-group"],["class","input-group-prepend",4,"ngIf"],["class","form-control p-0",4,"ngIf"],["class","input-group-text",4,"ngIf"],["class","form-control",4,"ngIf"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0"],["formControlName","name","type","text","placeholder","Enter a name for the parameter",3,"border"],["formControlName","datalinkColumn","parentName","group","childItems","columns","itemKey","key","itemName","logicalName","textEntryItemsTitle","Variables",3,"border","items","textValue","enableKeySelect","enableTextEntry","enableTextEntryMatch","setTextEntryToValue","textEntryNote","textEntryItems","errors","textValueChange"],["type","text","placeholder","Enter a static value.",3,"border","ngModel","ngModelOptions","ngModelChange"],["formControlName","dataType","itemKey","key","itemName","name",3,"border","items"],[1,"form-control"],["label","Allow Null","formControlName","allowNull",3,"border"],[1,"ml-1","flex-fill",3,"formGroup"],["formControlName","datalinkColumn","parentName","name","childItems","dexihTableColumns","itemKey","key","itemName","logicalName","textEntryNote","Enter new column name, or select existing",1,"form-control","p-0",3,"border","items","enableKeySelect","enableTextEntry","setTextEntryToValue","textValueChange"],[1,"input-group-append","flex-shrink-1","ml-1"],["class","btn btn-light","type","button","value","Add",3,"disabled","click",4,"ngIf"],["class","btn btn-light","type","button","value","Remove",3,"disabled","click",4,"ngIf"],["type","button","value","Add",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-minus-square-o"],[1,"form-text","text-muted"],[3,"data"]],template:function(e,t){1&e&&(s.Ob(0,"section"),s.Ob(1,"div",0),s.Dc(2,ra,9,8,"form",1),s.Dc(3,ia,2,6,"form",2),s.Dc(4,sa,3,2,"div",3),s.Nb(),s.Dc(5,ua,2,1,"small",4),s.Nb()),2&e&&(s.yb(2),s.hc("ngForOf",t.inputParameterForms),s.yb(1),s.hc("ngForOf",t.outputParameterForms),s.yb(1),s.hc("ngIf",t.allowAdd&&t.allowRemove),s.yb(1),s.hc("ngIf",!t.allowAdd&&(null==t.inputParameterForms[0].value.runTime||null==t.inputParameterForms[0].value.runTime.functionParameter?null:t.inputParameterForms[0].value.runTime.functionParameter.description)))},directives:[r.s,r.t,g.I,g.t,g.l,p.D,g.s,g.j,p.E,g.v,p.A,zn.a],encapsulation:2}),ca);function da(e,t){if(1&e&&(s.Ob(0,"div",15),s.Ob(1,"div",16),s.Fc(2),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.yb(2),s.Ic(" ",(null==n.outputParameterForm.value.runTime||null==n.outputParameterForm.value.runTime.functionParameter?null:n.outputParameterForm.value.runTime.functionParameter.name)+"("+n.eTypeCode[n.type.dataType]+")"," ",n.rank>0?"[]":""," ")}}function fa(e,t){if(1&e&&(s.Ob(0,"div",15),s.Ob(1,"div",16),s.Fc(2),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.yb(2),s.Hc(" ",null==n.outputParameterForm.value.runTime||null==n.outputParameterForm.value.runTime.functionParameter?null:n.outputParameterForm.value.runTime.functionParameter.name," ")}}function ha(e,t){1&e&&(s.Ob(0,"div",5),s.Lb(1,"form-input",17),s.Lb(2,"span",18),s.Nb()),2&e&&(s.yb(1),s.hc("border",!1))}function pa(e,t){if(1&e&&(s.Ob(0,"div",16),s.Fc(1),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.Hc(" ","("+n.eTypeCode[n.type.dataType]+")"," ")}}function va(e,t){if(1&e&&(s.Ob(0,"div",5),s.Lb(1,"form-select",19),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("border",!1)("items",n.typeCodes)}}function ga(e,t){1&e&&(s.Ob(0,"div",20),s.Lb(1,"form-checkbox",21),s.Nb()),2&e&&(s.yb(1),s.hc("border",!1))}function ka(e,t){if(1&e){var n=s.Pb();s.Ob(0,"button",22),s.Vb("click",(function(){return s.vc(n),s.Zb().fixDataType()})),s.Lb(1,"i",23),s.Nb()}}function ya(e,t){if(1&e&&(s.Ob(0,"small",24),s.Lb(1,"markdown",25),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("data",n.outputParameterForm.value.runTime.functionParameter.description)}}var Ta,Ca=((Ta=function(){function e(t,n){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.allowDataTypeSelect=!1,this.allowNameSelect=!1,this.allowAdd=!1,this.allowRemove=!1,this.outputParameterForm=null,this.outputColumns=null,this.datalinkTargets=null,this.updateParameterName=!1,this.rank=0,this.addParameter=new s.n,this.removeParameter=new s.n,this.hasChanged=new s.n,this.eBasicType=Un.c,this.eTypeCode=l.pc,this.typeCodes=Un.a,this.ignoreChanges=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.updateItems(),this.errors=this.editDatalinkService.hubFormsService.getFormErrorMessages(this.outputParameterForm,!0),this.updateParameterName&&(this._datalinkColumnSubscription=this.outputParameterForm.controls.datalinkColumn.valueChanges.subscribe((function(t){e.outputParameterForm.controls.dataType.setValue(t.dataType),e.outputParameterForm.controls.name.setValue(t.name)}))),this._parameterSubscription=this.outputParameterForm.valueChanges.subscribe((function(t){e.errors=e.editDatalinkService.hubFormsService.getFormErrorMessages(e.outputParameterForm,!0),e.updateItems()})),this._dataTypeSubscription=this.outputParameterForm.controls.dataType.valueChanges.subscribe((function(t){e.newColumn&&(e.newColumn.dataType=t)}))}},{key:"ngOnChanges",value:function(){var e=this,t=new l.H;t.name="Output Columns",t.dexihTableColumns=this.outputColumns,this.outputTables=[t],this.datalinkTargets&&this.datalinkTargets.forEach((function(t){e.outputTables.push(t.table)}))}},{key:"ngOnDestroy",value:function(){this._datalinkColumnSubscription&&this._datalinkColumnSubscription.unsubscribe(),this._parameterSubscription&&this._parameterSubscription.unsubscribe(),this._dataTypeSubscription&&this._dataTypeSubscription.unsubscribe()}},{key:"updateItems",value:function(){this.type=new Un.b(this.outputParameterForm.value.dataType,null,null,null)}},{key:"add",value:function(){this.addParameter.emit(this.outputParameterForm)}},{key:"remove",value:function(){this.removeParameter.emit(this.outputParameterForm)}},{key:"fixDataType",value:function(){this.outputParameterForm.controls.datalinkColumn.value.dataType=this.outputParameterForm.controls.dataType.value}},{key:"updateNewColumn",value:function(e){var t=this.outputParameterForm.controls.datalinkColumn.value;!e||t&&t.name===e||(this.newColumn||(this.newColumn=new l.m,this.newColumn.key=this.hubService.getHubCache().getNextSequence(),this.newColumn.position=1e3-this.newColumn.key),this.newColumn.dataType=this.outputParameterForm.controls.dataType.value,this.newColumn.allowDbNull=!0,this.newColumn.name=e,this.newColumn.logicalName=e,this.newColumn.rank=this.rank,this.newColumn.columnGroup="mapping",this.outputParameterForm.controls.datalinkColumn.setValue(this.newColumn),this.updateItems())}}]),e}()).\u0275fac=function(e){return new(e||Ta)(s.Kb(u.a),s.Kb(h))},Ta.\u0275cmp=s.Eb({type:Ta,selectors:[["output-parameter"]],inputs:{allowDataTypeSelect:"allowDataTypeSelect",allowNameSelect:"allowNameSelect",allowAdd:"allowAdd",allowRemove:"allowRemove",outputParameterForm:"outputParameterForm",outputColumns:"outputColumns",datalinkTargets:"datalinkTargets",updateParameterName:"updateParameterName",rank:"rank"},outputs:{addParameter:"addParameter",removeParameter:"removeParameter",hasChanged:"hasChanged"},features:[s.wb],decls:18,vars:17,consts:[[1,"mb-1",3,"formGroup"],[1,"input-group"],["class","input-group-prepend",4,"ngIf"],["class","form-control p-0",4,"ngIf"],["class","input-group-text",4,"ngIf"],[1,"form-control","p-0"],["formControlName","datalinkColumn","parentName","name","childItems","dexihTableColumns","itemKey","key","itemName","logicalName","textEntryNote","Enter new column name, or select existing",3,"border","items","enableKeySelect","enableTextEntry","setTextEntryToValue","errors","textValueChange"],["class","form-control",4,"ngIf"],[1,"input-group-append"],["class","btn btn-danger","type","button","title","fix target column datatype",3,"click",4,"ngIf"],["type","button","value","Add",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-light",3,"disabled","click"],[1,"fa","fa-minus-square-o"],["class","form-text text-muted",4,"ngIf"],[1,"input-group-prepend"],[1,"input-group-text"],["formControlName","name","type","text","name","name","placeholder","Enter a name for the parameter",3,"border"],[1,"input-group-btn",2,"width","0px"],["formControlName","dataType","itemKey","key","itemName","name",3,"border","items"],[1,"form-control"],["label","Allow Null","formControlName","allowNull",3,"border"],["type","button","title","fix target column datatype",1,"btn","btn-danger",3,"click"],[1,"fa","fa-medkit"],[1,"form-text","text-muted"],[3,"data"]],template:function(e,t){1&e&&(s.Ob(0,"form",0),s.Ob(1,"section"),s.Ob(2,"div",1),s.Dc(3,da,3,2,"div",2),s.Dc(4,fa,3,1,"div",2),s.Dc(5,ha,3,1,"div",3),s.Dc(6,pa,2,1,"div",4),s.Ob(7,"div",5),s.Ob(8,"form-select",6),s.Vb("textValueChange",(function(e){return t.updateNewColumn(e)})),s.Nb(),s.Nb(),s.Dc(9,va,2,2,"div",3),s.Dc(10,ga,2,1,"div",7),s.Ob(11,"div",8),s.Dc(12,ka,2,0,"button",9),s.Ob(13,"button",10),s.Vb("click",(function(){return t.add()})),s.Lb(14,"i",11),s.Nb(),s.Ob(15,"button",12),s.Vb("click",(function(){return t.remove()})),s.Lb(16,"i",13),s.Nb(),s.Nb(),s.Nb(),s.Dc(17,ya,2,1,"small",14),s.Nb(),s.Nb()),2&e&&(s.hc("formGroup",t.outputParameterForm),s.yb(3),s.hc("ngIf",0==t.allowDataTypeSelect&&0==t.allowNameSelect),s.yb(1),s.hc("ngIf",1==t.allowDataTypeSelect&&0==t.allowNameSelect),s.yb(1),s.hc("ngIf",t.allowNameSelect),s.yb(1),s.hc("ngIf",0==t.allowDataTypeSelect&&1==t.allowNameSelect),s.yb(2),s.hc("border",!1)("items",t.outputTables)("enableKeySelect",!1)("enableTextEntry",!0)("setTextEntryToValue",!1)("errors",t.errors.datalinkColumn),s.yb(1),s.hc("ngIf",1==t.allowDataTypeSelect),s.yb(1),s.hc("ngIf",1==t.allowDataTypeSelect),s.yb(2),s.hc("ngIf",(null==t.outputParameterForm.controls.datalinkColumn?null:t.outputParameterForm.controls.datalinkColumn.value)&&t.outputParameterForm.controls.dataType.value!==(null==t.outputParameterForm.controls.datalinkColumn||null==t.outputParameterForm.controls.datalinkColumn.value?null:t.outputParameterForm.controls.datalinkColumn.value.dataType)),s.yb(1),s.hc("disabled",!t.allowAdd),s.yb(2),s.hc("disabled",!t.allowRemove),s.yb(2),s.hc("ngIf",null==t.outputParameterForm.value.runTime||null==t.outputParameterForm.value.runTime.functionParameter?null:t.outputParameterForm.value.runTime.functionParameter.description))},directives:[g.I,g.t,g.l,r.t,p.E,g.s,g.j,p.D,p.A,zn.a],encapsulation:2}),Ta);function Fa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-apply",4),s.Vb("click",(function(){s.vc(n);var e=s.Zb(2);return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(1,"dexih-button-cancel",5),s.Vb("click",(function(){return s.vc(n),s.Zb(2).cancel()})),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("disabled",a.newDatalinkTransformItemForm.pristine)}}var Da=function(){return{standalone:!0}};function wa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"section"),s.Ob(1,"form-checkbox",11),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb(3).useCustomFunction=e})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(3);s.yb(1),s.hc("ngModel",a.useCustomFunction)("ngModelOptions",s.lc(2,Da))}}var Sa=function(){return{"z-index":499,position:"relative"}};function Na(e,t){if(1&e&&(s.Ob(0,"section",12),s.Ob(1,"form-select",13),s.Lb(2,"customFunction-edit-button",14),s.Nb(),s.Nb()),2&e){var n=s.Zb(3);s.hc("ngStyle",s.lc(3,Sa)),s.yb(1),s.hc("items",n.customFunctions),s.yb(1),s.hc("key",n.newDatalinkTransformItemForm.controls.customFunctionKey.value)}}var Oa=function(){return{"z-index":500,position:"relative"}};function Ia(e,t){if(1&e){var n=s.Pb();s.Ob(0,"section",12),s.Ob(1,"form-select",15),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb(3).functionCategory=e}))("ngModelChange",(function(e){return s.vc(n),s.Zb(3).updateCategory(e)})),s.Nb(),s.Nb(),s.Ob(2,"section",12),s.Ob(3,"form-select",16),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb(3).selectFunction(e,!0)}))("ngModelChange",(function(e){return s.vc(n),s.Zb(3).selectedFunction=e})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(3);s.hc("ngStyle",s.lc(13,Oa)),s.yb(1),s.hc("items",a.functionCategories)("allowNullSelect",!0)("ngModelOptions",s.lc(14,Da))("ngModel",a.functionCategory)("sortItems",!0),s.yb(1),s.hc("ngStyle",s.lc(15,Sa)),s.yb(1),s.hc("ngModel",a.selectedFunction)("ngModelOptions",s.lc(16,Da))("items",a.filteredFunctions)("enableKeySelect",!1)("note",null==a.selectedFunction?null:a.selectedFunction.description)("sortItems",!0)}}var xa=function(){return{"z-index":405,position:"relative"}};function Pa(e,t){if(1&e&&(s.Ob(0,"section",19),s.Lb(1,"form-select",25),s.Nb()),2&e){var n=s.Zb(4);s.hc("ngStyle",s.lc(3,xa)),s.yb(1),s.hc("items",n.eErrorActionItems)("enableFilter",!1)}}var Va=function(){return{"z-index":402,position:"relative"}};function Ea(e,t){if(1&e&&(s.Ob(0,"div",19),s.Lb(1,"form-select",26),s.Nb()),2&e){var n=s.Zb(4);s.hc("ngStyle",s.lc(3,Va)),s.yb(1),s.hc("items",n.eInvalidActionItems)("enableFilter",!1)}}function Ka(e,t){1&e&&(s.Ob(0,"section",27),s.Lb(1,"form-checkbox",28),s.Nb())}function La(e,t){if(1&e&&(s.Ob(0,"section",23),s.Lb(1,"form-select",29),s.Nb()),2&e){var n=s.Zb(4);s.yb(1),s.hc("items",n.typeCodes)}}var Ma=function(){return{"z-index":404,position:"relative"}};function Za(e,t){if(1&e&&(s.Ob(0,"div",17),s.Dc(1,Pa,2,4,"section",18),s.Ob(2,"section",19),s.Lb(3,"form-select",20),s.Nb(),s.Dc(4,Ea,2,4,"div",18),s.Dc(5,Ka,2,0,"section",21),s.Dc(6,La,2,1,"section",22),s.Ob(7,"section",23),s.Lb(8,"form-select",24),s.Nb(),s.Nb()),2&e){var n=s.Zb(3);s.yb(1),s.hc("ngIf",n.transformFunctionType!=n.eFunctionType.Validate&&n.transformFunctionType!=n.eFunctionType.condition),s.yb(1),s.hc("ngStyle",s.lc(8,Ma)),s.yb(1),s.hc("items",n.eErrorActionItems)("enableFilter",!1),s.yb(1),s.hc("ngIf",n.transformFunctionType==n.eFunctionType.Validate),s.yb(1),s.hc("ngIf","Boolean"==(null==n.selectedFunction?null:n.selectedFunction.returnType)||n.selectedCustomFunction&&"Boolean"==(null==n.selectedCustomFunction?null:n.selectedCustomFunction.returnType)),s.yb(1),s.hc("ngIf",(null==n.selectedFunction?null:n.selectedFunction.genericType)!==n.eGenericType.None),s.yb(2),s.hc("items",n.functionCache)}}function Aa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button",43),s.Vb("click",(function(){s.vc(n);var e=s.Zb(2).$implicit;return s.Zb(4).importMappings(e)})),s.Nb()}}var _a=function(e){return[e]};function Ga(e,t){if(1&e&&s.Lb(0,"input-parameter",44),2&e){var n=s.Zb(2).$implicit,a=s.Zb(4);s.hc("inputParameterForms",s.mc(8,_a,n))("nodeDatalinkColumnKey",null==a.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:a.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("inputColumns",a.inputColumns)("allowAdd",!1)("allowRemove",!1)("updateParameterName",!1)("rank",n.value.rank)("variables",a.variables)}}function Ra(e,t){if(1&e&&(s.Ob(0,"small",48),s.Lb(1,"markdown",49),s.Nb()),2&e){var n=s.Zb().$implicit;s.yb(1),s.hc("data",n.value.runTime.functionParameter.description)}}var ja=function(e){return{"z-index":e,position:"relative"}};function Ha(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",45),s.Ob(1,"input-parameter",46),s.Vb("addParameter",(function(){s.vc(n);var e=t.index,a=s.Zb(2).$implicit,r=s.Zb(4);return r.addParameter(a,r.eParameterDirection.Input,e)}))("removeParameter",(function(){s.vc(n);var e=t.index,a=s.Zb(2).$implicit;return s.Zb(4).removeParameter(a,e)})),s.Nb(),s.Dc(2,Ra,2,1,"small",47),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=t.last,o=s.Zb(6);s.hc("ngStyle",s.mc(9,ja,300-r)),s.yb(1),s.hc("inputParameterForms",s.mc(11,_a,a))("inputColumns",o.inputColumns)("allowAdd",!0)("nodeDatalinkColumnKey",null==o.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:o.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("allowRemove",!0)("updateParameterName",!1)("variables",o.variables),s.yb(1),s.hc("ngIf",i&&(null==a.value.runTime||null==a.value.runTime.functionParameter?null:a.value.runTime.functionParameter.description))}}function Ja(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",31),s.Ob(2,"div",35),s.Fc(3),s.Nb(),s.Ob(4,"div",36),s.Dc(5,Aa,1,0,"dexih-button",37),s.Ob(6,"dexih-button",38),s.Vb("click",(function(){s.vc(n);var e=s.Zb().$implicit,t=s.Zb(4);return t.addParameter(e,t.eParameterDirection.Input)})),s.Nb(),s.Ob(7,"dexih-button",39),s.Vb("click",(function(){s.vc(n);var e=s.Zb().$implicit;return s.Zb(4).addAllColumns(e)})),s.Nb(),s.Ob(8,"dexih-button",40),s.Vb("click",(function(){s.vc(n);var e=s.Zb().$implicit;return s.Zb(4).clearArray(e)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(9,Ga,1,10,"input-parameter",41),s.Dc(10,Ha,3,13,"div",42),s.Nb()}if(2&e){var a=s.Zb().$implicit,r=s.Zb(4);s.yb(3),s.Hc(" Array - ",a.value.name," "),s.yb(2),s.hc("ngIf",r.selectedFunction.importMethodName),s.yb(4),s.hc("ngIf",0===a.controls.arrayParameters.controls.length),s.yb(1),s.hc("ngForOf",a.controls.arrayParameters.controls)}}function Ba(e,t){if(1&e&&s.Lb(0,"input-parameter",50),2&e){var n=s.Zb().$implicit,a=s.Zb(4);s.hc("inputParameterForms",s.mc(7,_a,n))("inputColumns",a.inputColumns)("nodeDatalinkColumnKey",null==a.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:a.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("allowAdd",!1)("allowRemove",!1)("updateParameterName",!1)("variables",a.variables)}}function $a(e,t){if(1&e&&(s.Ob(0,"div",33),s.Dc(1,Ja,11,4,"div",0),s.Dc(2,Ba,1,9,"input-parameter",34),s.Nb()),2&e){var n=t.$implicit;s.hc("ngStyle",s.mc(3,ja,300-t.index)),s.yb(1),s.hc("ngIf",n.value.rank>0&&!n.value.runTime.functionParameter.linkedName),s.yb(1),s.hc("ngIf",0==n.value.rank&&!n.value.runTime.functionParameter.linkedName)}}function Ua(e,t){if(1&e&&(s.Ob(0,"div",30),s.Ob(1,"div",31),s.Fc(2," Input Parameters "),s.Nb(),s.Dc(3,$a,3,5,"div",32),s.Nb()),2&e){var n=s.Zb(3);s.yb(3),s.hc("ngForOf",n.inputParameterControls)}}function qa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button",43),s.Vb("click",(function(){s.vc(n);var e=s.Zb().$implicit;return s.Zb(3).importInputOutputMappings(e)})),s.Nb()}}function za(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",53),s.Ob(1,"input-parameter",54),s.Vb("addParameter",(function(){s.vc(n);var e=t.index,a=s.Zb().$implicit;return s.Zb(3).addInputOutputParameter(a,e)}))("removeParameter",(function(){s.vc(n);var e=t.index,a=s.Zb().$implicit;return s.Zb(3).removeInputOutputParameter(a,e)})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=s.Zb(4);s.hc("ngStyle",s.mc(11,ja,200-r)),s.yb(1),s.hc("inputParameterForms",a.inputItems)("outputParameterForms",a.outputItems)("nodeDatalinkColumnKey",null==i.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:i.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("inputColumns",i.inputColumns)("outputColumns",i.outputColumns)("datalinkTargets",i.datalinkTargets)("allowAdd",!0)("allowRemove",!0)("updateParameterName",!1)("variables",i.variables)}}function Wa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",30),s.Ob(1,"div",31),s.Fc(2),s.Ob(3,"div",36),s.Dc(4,qa,1,0,"dexih-button",37),s.Ob(5,"dexih-button",51),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb(3).addInputOutputParameter(e)})),s.Nb(),s.Ob(6,"dexih-button",39),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb(3).addAllInputOutputColumns(e)})),s.Nb(),s.Ob(7,"dexih-button",40),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb(3).clearInputOutputArray(e)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(8,za,2,13,"div",52),s.Nb()}if(2&e){var a=t.$implicit,r=s.Zb(3);s.yb(2),s.Hc(" ",a.name," "),s.yb(2),s.hc("ngIf",r.selectedFunction.importMethodName),s.yb(4),s.hc("ngForOf",a.parameterItems)}}function Qa(e,t){if(1&e&&s.Lb(0,"output-parameter",60),2&e){var n=s.Zb(2).$implicit,a=s.Zb(4);s.hc("outputParameterForm",n)("outputColumns",a.outputColumns)("datalinkTargets",a.datalinkTargets)("allowAdd",!1)("allowRemove",!1)("rank",n.value.rank)}}function Ya(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",53),s.Ob(1,"output-parameter",61),s.Vb("addParameter",(function(){s.vc(n);var e=t.index,a=s.Zb(2).$implicit,r=s.Zb(4);return r.addParameter(a,r.eParameterDirection.Output,e)}))("removeParameter",(function(){s.vc(n);var e=t.index,a=s.Zb(2).$implicit;return s.Zb(4).removeParameter(a,e)})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=s.Zb(6);s.hc("ngStyle",s.mc(6,ja,200-r)),s.yb(1),s.hc("outputParameterForm",a)("outputColumns",i.outputColumns)("datalinkTargets",i.datalinkTargets)("allowAdd",!0)("allowRemove",!0)}}function Xa(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",31),s.Ob(2,"div",35),s.Fc(3),s.Nb(),s.Ob(4,"div",36),s.Ob(5,"dexih-button",38),s.Vb("click",(function(){s.vc(n);var e=s.Zb().$implicit,t=s.Zb(4);return t.addParameter(e,t.eParameterDirection.Output)})),s.Nb(),s.Ob(6,"dexih-button",40),s.Vb("click",(function(){s.vc(n);var e=s.Zb().$implicit;return s.Zb(4).clearArray(e)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(7,Qa,1,6,"output-parameter",59),s.Dc(8,Ya,2,8,"div",52),s.Nb()}if(2&e){var a=s.Zb().$implicit;s.yb(3),s.Hc(" Array - ",a.value.name," "),s.yb(4),s.hc("ngIf",0===a.controls.arrayParameters.controls.length),s.yb(1),s.hc("ngForOf",a.controls.arrayParameters.controls)}}function er(e,t){if(1&e&&s.Lb(0,"output-parameter",62),2&e){var n=s.Zb().$implicit,a=s.Zb(4);s.hc("outputParameterForm",n)("outputColumns",a.outputColumns)("datalinkTargets",a.datalinkTargets)("allowAdd",!1)("allowRemove",!1)}}function tr(e,t){if(1&e&&(s.Ob(0,"div",12),s.Dc(1,Xa,9,3,"div",0),s.Dc(2,er,1,5,"output-parameter",58),s.Nb()),2&e){var n=t.$implicit;s.hc("ngStyle",s.mc(3,ja,100-t.index)),s.yb(1),s.hc("ngIf",n.value.rank>0&&!n.value.runTime.functionParameter.linkedName),s.yb(1),s.hc("ngIf",0==n.value.rank)}}function nr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",30),s.Ob(1,"label",55),s.Ob(2,"div"),s.Fc(3," Output Parameters "),s.Nb(),s.Ob(4,"div",36),s.Ob(5,"dexih-button",56),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.autoMap(e.outputParameter)})),s.Nb(),s.Nb(),s.Nb(),s.Dc(6,tr,3,5,"div",57),s.Nb()}if(2&e){var a=s.Zb(3);s.yb(6),s.hc("ngForOf",a.outputParameterControls)}}function ar(e,t){if(1&e&&(s.Ob(0,"form",6),s.Ob(1,"fieldset"),s.Dc(2,wa,2,3,"section",0),s.Dc(3,Na,3,4,"ng-template",7),s.Dc(4,Ia,4,17,"ng-template",7),s.Dc(5,Za,9,9,"div",8),s.Dc(6,Ua,4,1,"div",9),s.Dc(7,Wa,9,3,"div",10),s.Dc(8,nr,7,1,"div",9),s.Nb(),s.Nb()),2&e){var n=s.Zb(2);s.hc("formGroup",n.newDatalinkTransformItemForm),s.yb(2),s.hc("ngIf",(null==n.hubCache?null:n.hubCache.hub.dexihCustomFunctions.length)>0),s.yb(1),s.hc("ngIf",n.useCustomFunction),s.yb(1),s.hc("ngIf",!n.useCustomFunction),s.yb(1),s.hc("ngIf",n.selectedFunction||n.selectedCustomFunction),s.yb(1),s.hc("ngIf",(n.selectedFunction||n.selectedCustomFunction)&&n.inputParameterControls.length>0),s.yb(1),s.hc("ngForOf",n.arrayParameters),s.yb(1),s.hc("ngIf",(n.selectedFunction||n.selectedCustomFunction)&&n.allowOutput)}}function rr(e,t){if(1&e&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,Fa,2,1,"ng-template",null,2,s.Ec),s.Dc(4,ar,9,8,"form",3),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("showExpandButton",!1),s.yb(3),s.hc("ngIf",n.datalinkTransformForm)}}var ir,or=function(){function e(){_classCallCheck(this,e),this.inputParameterForms=[],this.outputParameterForms=[],this.parameterItems=[]}return _createClass(e,[{key:"resetItems",value:function(){for(var e=this,t=this.inputParameterForms[0].controls.arrayParameters,n=function(t){var n=new lr;e.inputParameterForms.forEach((function(e){n.inputItems.push(e.controls.arrayParameters.controls[t])})),e.outputParameterForms.forEach((function(e){n.outputItems.push(e.controls.arrayParameters.controls[t])})),e.parameterItems.push(n)},a=0;a<t.controls.length;a++)n(a)}}]),e}(),lr=function e(){_classCallCheck(this,e),this.inputItems=[],this.outputItems=[]},sr=((ir=function(){function e(t,n,a,r){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.eFunctionType=l.Cb,this.eParameterDirection=l.Vb,this.typeCodes=Un.a,this.cancelToken=new D.a,this.invalidActions=C.g,this.functionCache=C.d,this.eGenericType=l.Db,this.variables=[],this.allowOutput=!1,this.allowReturn=!0,this.arrayParameters=[],this.eInvalidActionItems=l.Gb.filter((function(e){return e.key>0})),this.eErrorActionItems=l.xb.filter((function(e){return e.key>0})),this.logger=new c.a("standard-function-edit"),this.isJoin=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle;var n=t[1];if(e.hubCache=t[2],e.remoteLibraries=t[3],e.datalinkForm=t[4],e.logger.LogC((function(){return"OnInit"}),c.b.Trace),e.hubCache&&e.hubCache.isLoaded()&&e.datalinkForm&&e.remoteLibraries&&e.remoteLibraries.functions.length>0){if(e.transformFunctionType=+n.functionType,e.transformFunctionType===l.Cb.Validate?(e.datalinkTransformForm=e.editDatalinkService.getValidationTransform(),e.datalinkTransformKey=e.datalinkTransformForm.value.key):(e.datalinkTransformKey=+n.datalinkTransformKey,e.datalinkTransformForm=e.editDatalinkService.getDatalinkTransform(e.datalinkTransformKey)),e.variables=e.editDatalinkService.getVariables(),e.useCustomFunction=!!e.datalinkTransformForm.controls.customFunctionKey,e.datalinkTransformItemKey=+n.datalinkTransformItemKey,e.isJoin=e.datalinkTransformForm.value.transformType===l.lc.Join||e.datalinkTransformForm.value.transformType===l.lc.Lookup,e.isJoin){var a=e.datalinkTransformForm.controls.joinDatalinkTable.value;if(!a)return e.hubService.addHubErrorMessage("The join table could not be found."),void e.authService.navigateUp();e.inputColumns=a.dexihDatalinkColumns}else{var r=e.datalinkTransformForm.controls.nodeDatalinkColumn.value,i=r?r.key:null,o=new m.b;e.inputColumns=i?o.getAvailableColumns(e.datalinkTransformForm.controls.runTime.value.inputColumns,i,0):e.datalinkTransformForm.controls.runTime.value.inputColumns}if(e.outputColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns,e.datalinkTargets=e.datalinkForm.controls.dexihDatalinkTargets.value,e.datalinkTransformItemKey){if(e.datalinkTransformItemForm=e.editDatalinkService.getDatalinkTransformItem(e.datalinkTransformForm,e.datalinkTransformItemKey),!e.datalinkTransformItemForm)return void e.authService.navigateUp();if(e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,e.datalinkTransformItemForm.value),e.datalinkTransformItemForm.controls.customFunctionKey.value)e.selectCustomFunction(e.datalinkTransformItemForm.value.customFunctionKey,!1);else{var s=e.remoteLibraries.functions.find((function(t){return t.functionClassName===e.datalinkTransformItemForm.value.functionClassName&&t.functionMethodName===e.datalinkTransformItemForm.value.functionMethodName&&t.functionAssemblyName===e.datalinkTransformItemForm.value.functionAssemblyName}));e.selectFunction(s,!1)}}else{var u=new l.x;u.datalinkTransformKey=e.datalinkTransformKey,u.transformItemType=l.kc.BuiltInFunction,e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,u)}switch(e.transformFunctionType){case l.Cb.Condition:case l.Cb.JoinCondition:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Condition})),e.allowOutput=!1;break;case l.Cb.Validate:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Condition||e.functionType===l.Cb.Validate})),e.allowOutput=!0;break;case l.Cb.Map:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Condition||e.functionType===l.Cb.Validate||e.functionType===l.Cb.Map})),e.allowOutput=!0;break;case l.Cb.Aggregate:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Aggregate})),e.allowOutput=!0;break;case l.Cb.Series:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Series||e.functionType===l.Cb.Aggregate})),e.allowOutput=!0;break;case l.Cb.Rows:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Rows})),e.allowOutput=!0,e.allowReturn=!1;break;case l.Cb.Profile:e.functions=e.remoteLibraries.functions.filter((function(e){return e.functionType===l.Cb.Profile})),e.allowOutput=!1;break;default:e.functions=null}e.functionCategories=Array.from(new Set(e.functions.map((function(e){return e.category})))),e.filteredFunctions=e.functions,e.customFunctions=e.hubCache.hub.dexihCustomFunctions,e.datalinkTransformItemForm&&e.datalinkTransformItemForm.value.customFunctionKey&&(e.useCustomFunction=!0,e.selectedCustomFunction=e.hubCache.hub.dexihCustomFunctions.find((function(t){return t.key===e.datalinkTransformItemForm.value.customFunctionKey}))),e._functionSubscription&&e._functionSubscription.unsubscribe(),e._functionSubscription=e.newDatalinkTransformItemForm.controls.customFunctionKey.valueChanges.subscribe((function(t){e.selectCustomFunction(t,!1)}))}e._saveSubscription&&e._saveSubscription.unsubscribe(),e._saveSubscription=e.editDatalinkService.savingDatalink.subscribe((function(t){t&&e.apply()}))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Standard Function Edit")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._returnParameterSubscription&&this._returnParameterSubscription.unsubscribe(),this._functionSubscription&&this._functionSubscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe(),this.cancelToken.cancel()}},{key:"updateCategory",value:function(e){this.filteredFunctions=e?this.functions.filter((function(t){return t.category===e})):this.functions}},{key:"canDeactivate",value:function(){var e=this;return new Promise((function(t){e.newDatalinkTransformItemForm&&!e.newDatalinkTransformItemForm.pristine?e.authService.confirmDialog("The function has changed","The function has changed.  Do you want to discard the changes and continue?").then((function(e){t(e)})).catch((function(){t(!1)})):t(!0)}))}},{key:"parametersArray",value:function(){return this.newDatalinkTransformItemForm.controls.dexihFunctionParameters}},{key:"refreshParameters",value:function(){var e,t,n,a,r,i=this,o=this.parametersArray();this.inputParameterControls=o.controls.sort((function(e,t){return e.value.position-t.value.position})).filter((function(e){return e.value.direction===l.Vb.Input||e.value.direction===l.Vb.ResultInput||e.value.direction===l.Vb.Join})),this.outputParameterControls=o.controls.sort((function(e,t){return e.value.position-t.value.position})).filter((function(e){return C.e.parameterIsOutput(e.value)})),this.transformFunctionType===l.Cb.Validate&&(this.outputParameterControls=this.outputParameterControls.filter((function(e){return e.value.direction!==l.Vb.ReturnValue}))),this.arrayParameters=[],this.selectedFunction&&(null===(e=this.selectedFunction.inputParameters)||void 0===e||e.filter((function(e){return e.linkedName})).forEach((function(e){i.addArrayParameter(e,!0)})),null===(t=this.selectedFunction.outputParameters)||void 0===t||t.filter((function(e){return e.linkedName})).forEach((function(e){i.addArrayParameter(e,!1)})),null===(n=this.selectedFunction.resultInputParameters)||void 0===n||n.filter((function(e){return e.linkedName})).forEach((function(e){i.addArrayParameter(e,!0)})),null===(a=this.selectedFunction.resultOutputParameters)||void 0===a||a.filter((function(e){return e.linkedName})).forEach((function(e){i.addArrayParameter(e,!1)})),null===(r=this.selectedFunction.resultReturnParameters)||void 0===r||r.filter((function(e){return e.linkedName})).forEach((function(e){i.addArrayParameter(e,!1)}))),this.arrayParameters.forEach((function(e){return e.resetItems()}))}},{key:"addArrayParameter",value:function(e,t){var n=this.arrayParameters.find((function(t){return t.name===e.linkedName}));if(n||((n=new or).name=e.linkedName,n.functionParameter=e,this.arrayParameters.push(n)),t){var a=this.inputParameterControls.find((function(t){return t.controls.name.value===e.name}));n.inputParameterForms.push(a)}else{var r=this.outputParameterControls.find((function(t){return t.controls.name.value===e.name}));n.outputParameterForms.push(r)}}},{key:"selectFunction",value:function(e,t){var n=this;if(this.selectedFunction=e,null!=e){switch(this.newDatalinkTransformItemForm.controls.functionAssemblyName.setValue(this.selectedFunction.functionAssemblyName),this.newDatalinkTransformItemForm.controls.functionClassName.setValue(this.selectedFunction.functionClassName),this.newDatalinkTransformItemForm.controls.functionMethodName.setValue(this.selectedFunction.functionMethodName),this.newDatalinkTransformItemForm.controls.targetDatalinkColumn.setValue(null),this.newDatalinkTransformItemForm.controls.genericTypeCode.value||this.newDatalinkTransformItemForm.controls.genericTypeCode.setValue(this.selectedFunction.genericTypeDefault?this.selectedFunction.genericTypeDefault:this.selectedFunction.genericType===l.Db.Numeric?l.pc.Decimal:l.pc.String),this.selectedFunction.genericType){case l.Db.All:this.typeCodes=Un.a;break;case l.Db.Numeric:this.typeCodes=Un.a.filter((function(e){return e.isNumeric}));break;case l.Db.String:this.typeCodes=Un.a.filter((function(e){return e.isString}));break;case l.Db.None:this.typeCodes=[]}if(this.selectedFunction){for(var a=this.parametersArray(),r=[];a.length;)r.push(a.value[0]),a.removeAt(0);this.selectedFunction.inputParameters&&this.selectedFunction.inputParameters.forEach((function(e,t){e&&a.push(n.newParameter(r,e,t,n.isJoin?l.Vb.Join:l.Vb.Input,n.selectedFunction.genericTypeDefault))})),this.selectedFunction.outputParameters&&this.selectedFunction.outputParameters.forEach((function(e,t){e&&e&&a.push(n.newParameter(r,e,t+100,l.Vb.Output,n.selectedFunction.genericTypeDefault))})),this.selectedFunction.resultInputParameters&&this.selectedFunction.resultInputParameters.forEach((function(e,t){e&&a.push(n.newParameter(r,e,t+200,l.Vb.ResultInput,n.selectedFunction.genericTypeDefault))})),this.selectedFunction.resultOutputParameters&&this.selectedFunction.resultOutputParameters.forEach((function(e,t){e&&e&&a.push(n.newParameter(r,e,t+300,l.Vb.ResultOutput,n.selectedFunction.genericTypeDefault))})),this.selectedFunction.returnParameters&&this.allowReturn&&this.selectedFunction.returnParameters.length>0&&this.selectedFunction.returnParameters.forEach((function(e,t){a.push(n.newParameter(r,e,t+400,l.Vb.ReturnValue,n.selectedFunction.genericTypeDefault))})),this.selectedFunction.resultReturnParameters&&this.allowReturn&&this.selectedFunction.resultReturnParameters.length>0&&this.selectedFunction.resultReturnParameters.forEach((function(e){a.push(n.newParameter(r,e,0,l.Vb.ResultReturnValue,n.selectedFunction.genericTypeDefault))})),this.refreshParameters(),t&&this.newDatalinkTransformItemForm.markAsDirty()}else this.selectedFunction=null}}},{key:"newParameter",value:function(e,t,n,a,r){var i=e.find((function(e){return e.name===t.parameterName})),o=new l.A;return o.name=t.parameterName,o.rank=t.rank,o.direction=a,o.isGeneric=t.isGeneric,o.position=n,o.key=this.hubCache.getNextSequence(),o.runTime={functionParameter:t},i?(o.key=i.key,o.datalinkColumn=i.datalinkColumn,o.value=i.value,o.dataType=t.isGeneric?i.dataType:t.dataType,i.arrayParameters.forEach((function(e){e.runTime={functionParameter:t}})),o.arrayParameters=i.arrayParameters):(o.value=t.defaultValue,o.dataType=t.isGeneric?r:t.dataType),o.isValid=!0,this.editDatalinkService.hubFormsService.datalinkFunctionParametersFormGroup(o)}},{key:"selectCustomFunction",value:function(e,t){var n=this;if(this.selectedCustomFunction=this.hubCache.hub.dexihCustomFunctions.find((function(t){return t.key===e})),this.selectedCustomFunction){for(var a=this.parametersArray(),r=[];a.length;)r.push(a.value[0]),a.removeAt(0);this.selectedCustomFunction.dexihCustomFunctionParameters.filter((function(e){return(e.direction===l.Vb.Input||e.direction===l.Vb.Join)&&e.isValid})).forEach((function(e,t){if(e){var i=n.newParameter(r,e,t,n.isJoin?l.Vb.Join:l.Vb.Input,n.selectedCustomFunction.genericTypeDefault);a.push(i)}})),this.selectedCustomFunction.dexihCustomFunctionParameters.filter((function(e){return e.direction===l.Vb.Output&&e.isValid})).forEach((function(e,t){if(e){var i=n.newParameter(r,e,t,l.Vb.Output,n.selectedCustomFunction.genericTypeDefault);a.push(i)}}));var i=new l.A;i.dataType=this.selectedCustomFunction.returnType,i.name="Return",i.direction=l.Vb.Output,i.rank=0,i.position=-1,i.isValid=!0;var o=this.newParameter(r,i,0,l.Vb.ReturnValue,this.selectedCustomFunction.genericTypeDefault);a.push(o),this.refreshParameters(),t&&this.newDatalinkTransformItemForm.markAsDirty()}}},{key:"createArrayParameter",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,r=e.runTime.functionParameter,i=new l.z;return i.isGeneric=r.isGeneric,i.dataType=r.isGeneric?a:e.dataType,i.position=n?n+1:1e7,i.name=r.name,i.direction=t,i.rank=0,i.key=this.hubCache.getNextSequence(),i.datalinkColumn=null,i.isValid=!0,i.runTime={functionParameter:r},i}},{key:"addParameter",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t===l.Vb.Input&&this.isJoin&&(t=l.Vb.Join);var a=this.createArrayParameter(e.value,t,0,this.newDatalinkTransformItemForm.controls.genericTypeCode.value),r=this.editDatalinkService.hubFormsService.datalinkFunctionArrayParametersFormGroup(a),i=e.controls.arrayParameters;return null!==n?i.insert(n+1,r):i.push(r),i.controls.forEach((function(e,t){e.controls.position.setValue(10*t)})),this.refreshParameters(),r}},{key:"addInputOutputParameter",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=new lr;e.inputParameterForms.forEach((function(e){var r=t.addParameter(e,t.isJoin?l.Vb.Join:l.Vb.Input,n);a.inputItems.push(r)})),e.outputParameterForms.forEach((function(e){var r=t.addParameter(e,l.Vb.Output,n);a.outputItems.push(r)})),null!==n?e.parameterItems.splice(n,0,a):e.parameterItems.push(a)}},{key:"removeParameter",value:function(e,t){t>-1&&(e.controls.arrayParameters.removeAt(t),this.newDatalinkTransformItemForm.markAsDirty(),this.refreshParameters())}},{key:"removeInputOutputParameter",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.inputParameterForms.forEach((function(e){t.removeParameter(e,n)})),e.outputParameterForms.forEach((function(e){t.removeParameter(e,n)})),e.parameterItems.splice(null!==n?n:e.parameterItems.length-1,1)}},{key:"addAllColumns",value:function(e){var t=this;this.clearArray(e);var n=e.value.runTime.functionParameter.isLabel,a=e.value,r=e.controls.arrayParameters,i=1;this.inputColumns.forEach((function(e){var o=t.createArrayParameter(a,t.isJoin?l.Vb.Join:l.Vb.Input,i++,t.selectedFunction.genericTypeDefault);n?o.value=e.name:o.datalinkColumn=e;var s=t.editDatalinkService.hubFormsService.datalinkFunctionArrayParametersFormGroup(o);r.push(s)})),this.refreshParameters()}},{key:"addAllInputOutputColumns",value:function(e){this.addAllColumns(e.inputParameterForms[0]);var t=e.inputParameterForms[0].controls.arrayParameters;if(e.inputParameterForms.length>1){this.clearArray(e.inputParameterForms[1]);for(var n=0;n<t.length;n++){var a=this.addParameter(e.inputParameterForms[1],this.isJoin?l.Vb.Join:l.Vb.Input);e.inputParameterForms[0].value.runTime.functionParameter.isLabel&&a.controls.datalinkColumn.setValue(this.inputColumns[n])}for(var r=2;r<e.inputParameterForms.length;r++){this.clearArray(e.inputParameterForms[r]);for(var i=0;i<t.length;i++)this.addParameter(e.inputParameterForms[r],this.isJoin?l.Vb.Join:l.Vb.Input).controls.value.setValue(e.inputParameterForms[r].value.runTime.functionParameter.defaultValue)}}if(e.outputParameterForms.length>0)for(var o=0;o<e.outputParameterForms.length;o++){this.clearArray(e.outputParameterForms[o]);for(var s=0;s<t.length;s++);}e.resetItems()}},{key:"clearArray",value:function(e){for(var t=e.controls.arrayParameters,n=t.controls.length-1;n>=0;n--)t.removeAt(n);this.refreshParameters()}},{key:"clearInputOutputArray",value:function(e){var t=this;e.inputParameterForms.forEach((function(e){t.clearArray(e)})),e.outputParameterForms.forEach((function(e){t.clearArray(e)}))}},{key:"importInputOutputMappings",value:function(e){return t=this,a=regeneratorRuntime.mark((function t(){var n,a,r,i,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.editDatalinkService.importFunctionMappings(this.datalinkTransformKey,this.newDatalinkTransformItemForm.value,this.cancelToken);case 2:if(null!==(n=t.sent)){t.next=5;break}return t.abrupt("return");case 5:for(a=e.inputParameterForms[0].controls.arrayParameters,this.clearArray(e.inputParameterForms[0]),r=0;r<n.length;r++)this.addParameter(e.inputParameterForms[0],this.isJoin?l.Vb.Join:l.Vb.Input).controls.value.setValue(n[r]);for(i=1;i<e.inputParameterForms.length;i++)for(this.clearArray(e.inputParameterForms[i]),o=0;o<a.length;o++)this.addParameter(e.inputParameterForms[i],this.isJoin?l.Vb.Join:l.Vb.Input).controls.value.setValue(e.inputParameterForms[i].value.runTime.functionParameter.defaultValue);if(e.outputParameterForms.length>0)for(s=0;s<e.outputParameterForms.length;s++)for(this.clearArray(e.outputParameterForms[s]),u=0;u<a.length;u++);e.resetItems();case 11:case"end":return t.stop()}}),t,this)})),new((n=void 0)||(n=Promise))((function(e,r){function i(e){try{l(a.next(e))}catch(t){r(t)}}function o(e){try{l(a.throw(e))}catch(t){r(t)}}function l(t){var a;t.done?e(t.value):(a=t.value,a instanceof n?a:new n((function(e){e(a)}))).then(i,o)}l((a=a.apply(t,[])).next())}));var t,n,a}},{key:"autoMap",value:function(){var e=this;this.outputParameterControls.forEach((function(t){var n=new l.m;n.key=e.hubService.getHubCache().getNextSequence(),n.position=1e3-n.key;var a=t.value;n.dataType=a.dataType,n.allowDbNull=!0,n.name=a.runTime.functionParameter.name,n.logicalName=a.runTime.functionParameter.name,n.rank=a.rank,t.controls.datalinkColumn.setValue(n),e.newDatalinkTransformItemForm.markAsDirty()}))}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"apply",value:function(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm),this.newDatalinkTransformItemForm.markAsPristine()}},{key:"applyExit",value:function(){this.apply(),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||ir)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a))},ir.\u0275cmp=s.Eb({type:ir,selectors:[["dexih-function-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],["title","Edit Function",3,"showExpandButton"],["header",""],[3,"formGroup",4,"ngIf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[3,"formGroup"],[3,"ngIf"],["class","form-row",4,"ngIf"],["class","mt-1",4,"ngIf"],["class","mt-1",4,"ngFor","ngForOf"],["label","Use a custom function",3,"ngModel","ngModelOptions","ngModelChange"],[3,"ngStyle"],["label","Select a hub function","formControlName","customFunctionKey","itemKey","key","itemName","name","itemTitle","description",3,"items"],[3,"key"],["label","Category","selectNullMessage","(All functions)",3,"items","allowNullSelect","ngModelOptions","ngModel","sortItems","ngModelChange"],["label","Select a standard function","itemKey","name","itemName","name","itemTitle","description",3,"ngModel","ngModelOptions","items","enableKeySelect","note","sortItems","ngModelChange"],[1,"form-row"],["class","col-xs-12 col-sm-6 col-md-3",3,"ngStyle",4,"ngIf"],[1,"col-xs-12","col-sm-6","col-md-3",3,"ngStyle"],["label","Action when error","formControlName","onError","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],["class","col-xs-12 col-sm-6 col-md-4",4,"ngIf"],["class","col-xs-12 col-sm-6 col-md-3",4,"ngIf"],[1,"col-xs-12","col-sm-6","col-md-3"],["label","Cache Options","formControlName","functionCaching","itemKey","key","itemName","name",3,"items"],["label","Action when null","formControlName","onNull","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],["label","Action when false","formControlName","invalidAction","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],[1,"col-xs-12","col-sm-6","col-md-4"],["label","Return 'NOT' result","formControlName","notCondition"],["label","Data Type","formControlName","genericTypeCode","itemKey","key","itemName","name",3,"items"],[1,"mt-1"],[1,"d-flex","flex-row","mb-1"],["class","mb-1",3,"ngStyle",4,"ngFor","ngForOf"],[1,"mb-1",3,"ngStyle"],[3,"inputParameterForms","inputColumns","nodeDatalinkColumnKey","allowAdd","allowRemove","updateParameterName","variables",4,"ngIf"],[1,"input-group-text"],[1,"ml-auto"],["iconClass","fa fa-download","text","Import Mappings","title","Attempt to import the mappings from the source data","class","mr-1",3,"click",4,"ngIf"],["iconClass","fa fa-plus","text","Add Parameter","title","Add a parameter to the array",1,"mr-1",3,"click"],["iconClass","fa fa-columns","text","Add All Inputs","title","Add all the input columns to the array",1,"mr-1",3,"click"],["iconClass","fa fa-eraser","text","Clear",3,"click"],[3,"inputParameterForms","nodeDatalinkColumnKey","inputColumns","allowAdd","allowRemove","updateParameterName","rank","variables",4,"ngIf"],["class","pl-2 mb-1",3,"ngStyle",4,"ngFor","ngForOf"],["iconClass","fa fa-download","text","Import Mappings","title","Attempt to import the mappings from the source data",1,"mr-1",3,"click"],[3,"inputParameterForms","nodeDatalinkColumnKey","inputColumns","allowAdd","allowRemove","updateParameterName","rank","variables"],[1,"pl-2","mb-1",3,"ngStyle"],[3,"inputParameterForms","inputColumns","allowAdd","nodeDatalinkColumnKey","allowRemove","updateParameterName","variables","addParameter","removeParameter"],["class","form-text text-muted",4,"ngIf"],[1,"form-text","text-muted"],[3,"data"],[3,"inputParameterForms","inputColumns","nodeDatalinkColumnKey","allowAdd","allowRemove","updateParameterName","variables"],["iconClass","fa fa-plus","text","Add Mapping","title","Add a parameter to the array",1,"mr-1",3,"click"],["class","pl-2",3,"ngStyle",4,"ngFor","ngForOf"],[1,"pl-2",3,"ngStyle"],[3,"inputParameterForms","outputParameterForms","nodeDatalinkColumnKey","inputColumns","outputColumns","datalinkTargets","allowAdd","allowRemove","updateParameterName","variables","addParameter","removeParameter"],[1,"d-flex","flex-row"],["text","Auto Map","buttonClass","btn-sm btn-outline-primary",3,"click"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove",4,"ngIf"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove","rank",4,"ngIf"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove","rank"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove","addParameter","removeParameter"],[3,"outputParameterForm","outputColumns","datalinkTargets","allowAdd","allowRemove"]],template:function(e,t){1&e&&s.Dc(0,rr,5,2,"div",0),2&e&&s.hc("ngIf",t.newDatalinkTransformItemForm&&t.inputColumns&&t.outputColumns)},directives:[r.t,p.T,p.a,p.b,g.I,g.t,g.l,r.s,p.A,g.s,g.v,r.w,p.E,g.j,qn.a,p.f,ba,zn.a,Ca],encapsulation:2}),ir);function ur(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-validate",6),s.Vb("click",(function(){return s.vc(n),s.Zb(3).test()})),s.Nb(),s.Ob(1,"dexih-button-download",7),s.Vb("click",(function(){return s.vc(n),s.Zb(3).downloadCode()})),s.Nb(),s.Ob(2,"dexih-button-apply",8),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(3,"dexih-button-cancel",9),s.Vb("click",(function(){return s.vc(n),s.Zb(3).cancel()})),s.Nb()}if(2&e){var a=s.Zb(3);s.yb(2),s.hc("disabled",a.newDatalinkTransformItemForm.pristine)}}var cr=function(){return{"z-index":305,position:"relative"}};function mr(e,t){if(1&e&&(s.Ob(0,"section",13),s.Lb(1,"form-select",19),s.Nb()),2&e){var n=s.Zb(4);s.hc("ngStyle",s.lc(3,cr)),s.yb(1),s.hc("items",n.eErrorActionItems)("enableFilter",!1)}}var br=function(){return{"z-index":303,position:"relative"}};function dr(e,t){1&e&&(s.Ob(0,"section",13),s.Lb(1,"form-checkbox",20),s.Nb()),2&e&&s.hc("ngStyle",s.lc(1,br))}var fr=function(){return{"z-index":302,position:"relative"}};function hr(e,t){if(1&e&&(s.Ob(0,"div",13),s.Lb(1,"form-select",21),s.Nb()),2&e){var n=s.Zb(4);s.hc("ngStyle",s.lc(3,fr)),s.yb(1),s.hc("items",n.eInvalidActionItems)("enableFilter",!1)}}function pr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",22),s.Ob(1,"dexih-button",23),s.Vb("click",(function(){s.vc(n);var e=s.Zb(4);return e.addParameter(null,e.eParameterDirection.Input)})),s.Fc(2,"Add Parameter "),s.Nb(),s.Nb()}}var vr=function(e){return{"z-index":e,position:"relative"}},gr=function(e){return[e]};function kr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",24),s.Ob(1,"input-parameter",25),s.Vb("hasChanged",(function(e){return s.vc(n),s.Zb(4).parameterHasChanged(e)}))("addParameter",(function(e){s.vc(n);var t=s.Zb(4);return t.addParameter(e,t.eParameterDirection.Input)}))("removeParameter",(function(e){return s.vc(n),s.Zb(4).removeParameter(e)})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=s.Zb(4);s.hc("ngStyle",s.mc(9,vr,200-r)),s.yb(1),s.hc("allowNameSelect",!0)("allowDataTypeSelect",!0)("inputParameterForms",s.mc(11,gr,a))("inputColumns",i.inputColumns)("nodeDatalinkColumnKey",null==i.datalinkTransformForm.controls.nodeDatalinkColumn.value?null:i.datalinkTransformForm.controls.nodeDatalinkColumn.value.key)("updateParameterName",!0)("allowAdd",!0)("allowRemove",!0)}}function yr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"dexih-button",23),s.Vb("click",(function(){s.vc(n);var e=s.Zb(5);return e.addParameter(null,e.eParameterDirection.Output)})),s.Fc(2,"Add Parameter "),s.Nb(),s.Nb()}}function Tr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",27),s.Ob(1,"output-parameter",30),s.Vb("addParameter",(function(e){s.vc(n);var t=s.Zb(5);return t.addParameter(e,t.eParameterDirection.Output)}))("removeParameter",(function(e){return s.vc(n),s.Zb(5).removeParameter(e)})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=s.Zb(5);s.hc("ngStyle",s.mc(9,vr,100-r)),s.yb(1),s.hc("allowNameSelect",!0)("allowDataTypeSelect",!0)("outputParameterForm",a)("outputColumns",i.outputColumns)("datalinkTargets",i.datalinkTargets)("updateParameterName",!0)("allowAdd",!0)("allowRemove",!0)}}var Cr=function(){return{"z-index":101,position:"relative"}};function Fr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",26),s.Fc(2," Output Parameters "),s.Nb(),s.Ob(3,"div",27),s.Ob(4,"output-parameter",28),s.Vb("addParameter",(function(e){s.vc(n);var t=s.Zb(4);return t.addParameter(e,t.eParameterDirection.Output)})),s.Nb(),s.Nb(),s.Dc(5,yr,3,0,"div",0),s.Dc(6,Tr,2,11,"div",29),s.Nb()}if(2&e){var a=s.Zb(4);s.yb(3),s.hc("ngStyle",s.lc(8,Cr)),s.yb(1),s.hc("allowNameSelect",!1)("allowDataTypeSelect",!0)("outputParameterForm",a.returnParameterForm)("outputColumns",a.outputColumns)("datalinkTargets",a.datalinkTargets),s.yb(1),s.hc("ngIf",0===a.outputParameters.length),s.yb(1),s.hc("ngForOf",a.outputParameters)}}var Dr=function(){return{"z-index":304,position:"relative"}};function wr(e,t){if(1&e&&(s.Ob(0,"form",10),s.Ob(1,"fieldset"),s.Ob(2,"div",11),s.Dc(3,mr,2,4,"section",12),s.Ob(4,"section",13),s.Lb(5,"form-select",14),s.Nb(),s.Dc(6,dr,2,2,"section",12),s.Dc(7,hr,2,4,"div",12),s.Nb(),s.Ob(8,"div"),s.Ob(9,"div",15),s.Fc(10," Input Parameters "),s.Nb(),s.Dc(11,pr,3,0,"div",16),s.Dc(12,kr,2,13,"div",17),s.Nb(),s.Dc(13,Fr,7,9,"div",0),s.Fc(14," Function Code "),s.Lb(15,"textarea",18),s.Nb(),s.Nb()),2&e){var n=s.Zb(3);s.hc("formGroup",n.newDatalinkTransformItemForm),s.yb(3),s.hc("ngIf",n.functionType!=n.eFunctionType.Validate&&n.functionType!=n.eFunctionType.condition),s.yb(1),s.hc("ngStyle",s.lc(10,Dr)),s.yb(1),s.hc("items",n.eErrorActionItems)("enableFilter",!1),s.yb(1),s.hc("ngIf",n.selectedFunction&&"Boolean"==(null==n.selectedFunction?null:n.selectedFunction.returnType)),s.yb(1),s.hc("ngIf",n.functionType==n.eFunctionType.Validate),s.yb(4),s.hc("ngIf",0===n.inputParameters.length),s.yb(1),s.hc("ngForOf",n.inputParameters),s.yb(1),s.hc("ngIf",n.functionType!=n.eFunctionType.Condition&&n.functionType!=n.eFunctionType.JoinCondition)}}function Sr(e,t){if(1&e&&(s.Ob(0,"dexih-widget-section",3),s.Dc(1,ur,4,1,"ng-template",null,4,s.Ec),s.Dc(3,wr,16,11,"form",5),s.Nb()),2&e){var n=s.Zb(2);s.hc("showExpandButton",!0),s.yb(3),s.hc("ngIf",n.newDatalinkTransformItemForm)}}function Nr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"button",34),s.Vb("click",(function(){return s.vc(n),s.Zb(3).test()})),s.Fc(1,"Syntax Check"),s.Nb(),s.Ob(2,"button",34),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.test(e.inputParameterValues)})),s.Fc(3,"Run"),s.Nb(),s.Ob(4,"button",35),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.downloadCode(e.inputParameterValues)})),s.Fc(5,"Download Code"),s.Nb()}}function Or(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",27),s.Ob(1,"form-input",36),s.Vb("ngModelChange",(function(e){s.vc(n);var a=t.index;return s.Zb(3).inputParameterValues[a]=e})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=s.Zb(3);s.hc("ngStyle",s.mc(4,vr,200-r)),s.yb(1),s.hc("label",a.controls.name.value)("ngModel",i.inputParameterValues[r])("name","inputParameterValues"+r)}}function Ir(e,t){1&e&&(s.Ob(0,"div",15),s.Fc(1," Outputs Parameters "),s.Nb())}function xr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",27),s.Ob(1,"form-input",37),s.Vb("ngModelChange",(function(e){s.vc(n);var a=t.index;return s.Zb(3).outputParameterValues[a]=e})),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.index,i=s.Zb(3);s.hc("ngStyle",s.mc(5,vr,200-r)),s.yb(1),s.hc("disabled",!0)("label",a.controls.name.value)("ngModel",i.outputParameterValues[r])("name","outputParameterValues"+r)}}function Pr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-widget-section",31),s.Dc(1,Nr,6,0,"ng-template",null,4,s.Ec),s.Ob(3,"form"),s.Ob(4,"div",15),s.Fc(5," Input Parameters "),s.Nb(),s.Dc(6,Or,2,6,"div",29),s.Ob(7,"form-input",32),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb(2).returnParameterValue=e})),s.Nb(),s.Dc(8,Ir,2,0,"div",33),s.Dc(9,xr,2,7,"div",29),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("showExpandButton",!0),s.yb(6),s.hc("ngForOf",a.inputParameters),s.yb(1),s.hc("disabled",!0)("ngModel",a.returnParameterValue),s.yb(1),s.hc("ngIf",a.outputParameters.length>0),s.yb(1),s.hc("ngForOf",a.outputParameters)}}function Vr(e,t){if(1&e&&(s.Ob(0,"div"),s.Dc(1,Sr,4,2,"dexih-widget-section",1),s.Dc(2,Pr,10,6,"dexih-widget-section",2),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("ngIf",n.datalinkTransformForm),s.yb(1),s.hc("ngIf",n.datalinkTransformForm&&n.newDatalinkTransformItemForm)}}var Er,Kr=((Er=function(){function e(t,n,a,r,i,o){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.location=o,this.cancelToken=new D.a,this.eFunctionType=l.Cb,this.eParameterDirection=l.Vb,this.eInvalidActionItems=l.Gb.filter((function(e){return e.key>0})),this.eErrorActionItems=l.xb.filter((function(e){return e.key>0})),this.inputParameters=[],this.outputParameters=[],this.inputParameterValues=[],this.outputParameterValues=[]}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(t){if(e.pageTitle=t[0].pageTitle,e.hubCache=t[2],e.datalinkForm=t[3],e.functionType=t[1].functionType,e.functionType===l.Cb.Validate?(e.datalinkTransformForm=e.editDatalinkService.getValidationTransform(),e.datalinkTransformKey=e.datalinkTransformForm.value.key):(e.datalinkTransformKey=+t[1].datalinkTransformKey,e.datalinkTransformForm=e.editDatalinkService.getDatalinkTransform(e.datalinkTransformKey)),e.datalinkTransformItemKey=+t[1].datalinkTransformItemKey,e.datalinkTransformForm){var n=e.datalinkTransformForm.controls.nodeDatalinkColumn.value,a=n?n.key:null,r=new m.b;if(e.inputColumns=a?r.getAvailableColumns(e.datalinkTransformForm.controls.runTime.value.inputColumns,a,0):e.datalinkTransformForm.controls.runTime.value.inputColumns,e.outputColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns,e.datalinkTargets=e.datalinkForm.controls.dexihDatalinkTargets.value,e.datalinkTransformItemKey){if(e.datalinkTransformItemForm=e.editDatalinkService.getDatalinkTransformItem(e.datalinkTransformForm,e.datalinkTransformItemKey),e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,e.datalinkTransformItemForm.value),!e.newDatalinkTransformItemForm)return void e.authService.navigateUp()}else{var i=new l.x;i.datalinkTransformKey=e.datalinkTransformKey,i.transformItemType=l.kc.CustomFunction;var o=new l.A;o.dataType=e.functionType===l.Cb.Condition||e.functionType===l.Cb.JoinCondition||e.functionType===l.Cb.Validate?l.pc.Boolean:l.pc.String,o.name="Return",o.direction=l.Vb.ReturnValue,o.rank=0,o.position=-1,o.datalinkColumn=null,o.isValid=!0;var s=new l.O;s.name="Return",o.runTime={functionParameter:s},i.dexihFunctionParameters=new Array,i.dexihFunctionParameters.push(o),e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,i)}e.parameters=e.newDatalinkTransformItemForm.controls.dexihFunctionParameters,e.setParameters(e.parameters.controls),e._parametersSubscription&&e._parametersSubscription.unsubscribe(),e._parametersSubscription=e.parameters.valueChanges.subscribe((function(t){e.setParameters(t)}))}e._saveSubscription&&e._saveSubscription.unsubscribe(),e._saveSubscription=e.editDatalinkService.savingDatalink.subscribe((function(t){t&&e.apply()}))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._returnParameterSubscription&&this._returnParameterSubscription.unsubscribe(),this._parametersSubscription&&this._parametersSubscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe(),this.cancelToken.cancel()}},{key:"canDeactivate",value:function(){var e=this;return new Promise((function(t){e.newDatalinkTransformItemForm&&!e.newDatalinkTransformItemForm.pristine?e.authService.confirmDialog("Function has changed","The function has changed.  Would you like to discard the changes and return to the previous screen?").then((function(e){t(e)})).catch((function(e){t(!1)})):t(!0)}))}},{key:"setParameters",value:function(e){this.inputParameters=this.parameters.controls.sort((function(e,t){return e.value.position-t.value.position})).filter((function(e){return e.value.direction===l.Vb.Input})),this.inputParameterValues=new Array(this.inputParameters.length),this.outputParameters=this.parameters.controls.sort((function(e,t){return e.value.position-t.value.position})).filter((function(e){return e.value.direction===l.Vb.Output})),this.outputParameterValues=new Array(this.inputParameters.length),this.returnParameterForm=this.parameters.controls.find((function(e){return e.value.direction===l.Vb.ReturnValue}))}},{key:"parametersArray",value:function(){return this.newDatalinkTransformItemForm.controls.dexihFunctionParameters}},{key:"addParameter",value:function(e,t){try{var n=new l.A;if(e){var a=e.value;n.dataType=a.dataType,n.name=a.name,n.position=a.position+1}n.name="",n.datalinkColumn=null,n.value=null,n.dataType=l.pc.String,n.direction=t,n.rank=0,n.isValid=!0;var r=this.parametersArray(),i=this.editDatalinkService.hubFormsService.datalinkFunctionParametersFormGroup(n);r.push(i),r.controls.sort((function(e,t){return e.value.position-t.value.position})).forEach((function(e,t){e.controls.position.setValue(10*t)}))}catch(o){this.hubService.addHubClientErrorMessage(o,"Edit Custom Function, add parameter")}}},{key:"removeParameter",value:function(e){try{var t=this.parametersArray(),n=t.controls.indexOf(e);n>-1&&t.removeAt(n)}catch(a){this.hubService.addHubClientErrorMessage(a,"Edit Custom Function, remove parameter")}}},{key:"newDefaultParameter",value:function(){try{var e=new l.A;return e.datalinkTransformItemKey=this.newDatalinkTransformItemForm.value.key,e.dataType=l.pc.String,e.rank=0,e.isValid=!0,e}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function, default parameter")}}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"apply",value:function(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm),this.newDatalinkTransformItemForm.markAsPristine()}},{key:"applyExit",value:function(){this.apply(),this.authService.navigateUp()}},{key:"downloadCode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hubService.downloadCustomFunction(this.newDatalinkTransformItemForm.value,e).catch((function(e){}))}},{key:"test",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hubService.testCustomFunction(this.newDatalinkTransformItemForm.value,t,this.cancelToken).then((function(t){e.hubService.addHubSuccessMessage("The function has successfully compiled."),t&&t.length>0?t.forEach((function(t,n){0===n?e.returnParameterValue=t:e.outputParameterValues[n-1]=t})):(e.returnParameterValue=null,e.outputParameterValues.forEach((function(e){return null})))})).catch((function(t){e.returnParameterValue=null,e.outputParameterValues.forEach((function(e){return null})),e.hubService.addHubMessage(t)}))}}]),e}()).\u0275fac=function(e){return new(e||Er)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e),s.Kb(r.n))},Er.\u0275cmp=s.Eb({type:Er,selectors:[["dexih-custom-function-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],["title","Edit Custom Function",3,"showExpandButton",4,"ngIf"],["title","Test Function",3,"showExpandButton",4,"ngIf"],["title","Edit Custom Function",3,"showExpandButton"],["header",""],[3,"formGroup",4,"ngIf"],["text","Syntax Check",1,"mr-1",3,"click"],["text","Download Code",1,"mr-1",3,"click"],[1,"mr-1",3,"disabled","click"],[3,"click"],[3,"formGroup"],[1,"form-row"],["class","col col-xs-4",3,"ngStyle",4,"ngIf"],[1,"col","col-xs-4",3,"ngStyle"],["label","Action when error","formControlName","onError","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],[1,"label"],["class","mb-1",4,"ngIf"],["class","pl-2",3,"ngStyle",4,"ngFor","ngForOf"],["rows","20","width","100%","spellcheck","false","formControlName","functionCode",1,"form-control"],["label","Action when null","formControlName","onNull","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],["label","Return 'NOT' result","formControlName","notCondition"],["label","Action when false","formControlName","invalidAction","itemKey","key","itemName","name","iconClass","fa fa-database",3,"items","enableFilter"],[1,"mb-1"],["iconClass","fa fa-plus-square-o","title","Click to add a parameter",3,"click"],[1,"pl-2",3,"ngStyle"],[3,"allowNameSelect","allowDataTypeSelect","inputParameterForms","inputColumns","nodeDatalinkColumnKey","updateParameterName","allowAdd","allowRemove","hasChanged","addParameter","removeParameter"],[1,"label","mb-1"],[3,"ngStyle"],[3,"allowNameSelect","allowDataTypeSelect","outputParameterForm","outputColumns","datalinkTargets","addParameter"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"allowNameSelect","allowDataTypeSelect","outputParameterForm","outputColumns","datalinkTargets","updateParameterName","allowAdd","allowRemove","addParameter","removeParameter"],["title","Test Function",3,"showExpandButton"],["label","Return Value","name","returnParameterValue","type","text",3,"disabled","ngModel","ngModelChange"],["class","label",4,"ngIf"],[1,"btn","btn-success","mr-1",3,"click"],[1,"btn","btn-success",3,"click"],["type","text","placeholder","Enter a test value for the parameter",3,"label","ngModel","name","ngModelChange"],["type","text",3,"disabled","label","ngModel","name","ngModelChange"]],template:function(e,t){1&e&&s.Dc(0,Vr,3,2,"div",0),2&e&&s.hc("ngIf",t.newDatalinkTransformItemForm&&t.inputColumns&&t.outputColumns)},directives:[r.t,p.T,p.x,p.h,p.a,p.b,g.I,g.t,g.l,r.w,p.E,g.s,g.j,r.s,g.c,p.A,p.f,ba,Ca,g.u,p.D,g.v],encapsulation:2}),Er);function Lr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-apply",6),s.Vb("click",(function(){s.vc(n);var e=s.Zb(2);return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(1,"dexih-button-cancel",7),s.Vb("click",(function(){return s.vc(n),s.Zb(2).cancel()})),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("disabled",a.newDatalinkTransformItemForm.pristine)}}function Mr(e,t){if(1&e&&(s.Ob(0,"section",8),s.Lb(1,"form-select",9),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("items",n.eAggregateItems)}}function Zr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"section",8),s.Ob(1,"form-select",10),s.Vb("textValueChange",(function(e){return s.vc(n),s.Zb(2).sourceValue=e}))("textValueChange",(function(e){return s.vc(n),s.Zb(2).updateSourceValue(e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("items",a.inputColumns)("textValue",a.sourceValue)("enableKeySelect",!1)("enableTextEntry",!0)("enableTextEntryMatch",!1)("errors",a.sourceErrors)}}function Ar(e,t){if(1&e&&(s.Ob(0,"section",8),s.Lb(1,"form-select",11),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("items",n.compare)}}function _r(e,t){if(1&e){var n=s.Pb();s.Ob(0,"section",8),s.Ob(1,"form-select",12),s.Vb("textValueChange",(function(e){return s.vc(n),s.Zb(2).filterValue=e}))("textValueChange",(function(e){return s.vc(n),s.Zb(2).updateFilterValue(e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("items",a.inputColumns)("enableTextEntry",!0)("textValue",a.filterValue)("enableTextEntryMatch",!1)("enableKeySelect",!1)("errors",a.filterValueErrors)("textEntryItems",a.variables)("setTextEntryToValue",!1)}}function Gr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"section",8),s.Ob(1,"form-select",13),s.Vb("textValueChange",(function(e){return s.vc(n),s.Zb(2).updateNewColumn(e)})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("items",a.outputTables)("enableKeySelect",!1)("enableTextEntry",!0)("setTextEntryToValue",!1)("errors",a.targetErrors)}}function Rr(e,t){if(1&e&&(s.Ob(0,"section",8),s.Lb(1,"form-select",14),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("items",n.sortDirections)}}function jr(e,t){if(1&e&&(s.Ob(0,"section",8),s.Lb(1,"form-select",15),s.Nb()),2&e){var n=s.Zb(2);s.yb(1),s.hc("items",n.joinColumns)("enableKeySelect",!1)("errors",n.joinErrors)}}function Hr(e,t){if(1&e&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,Lr,2,1,"ng-template",null,2,s.Ec),s.Ob(4,"form",3),s.Ob(5,"fieldset"),s.Ob(6,"div",4),s.Dc(7,Mr,2,1,"section",5),s.Dc(8,Zr,2,6,"section",5),s.Dc(9,Ar,2,1,"section",5),s.Dc(10,_r,2,8,"section",5),s.Dc(11,Gr,2,5,"section",5),s.Dc(12,Rr,2,1,"section",5),s.Dc(13,jr,2,3,"section",5),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("title",n.pageTitle)("showExpandButton",!1),s.yb(3),s.hc("formGroup",n.newDatalinkTransformItemForm),s.yb(3),s.hc("ngIf",n.transformItemType==n.eTransformItemType.AggregatePair),s.yb(1),s.hc("ngIf",n.showInput),s.yb(1),s.hc("ngIf",n.transformItemType==n.eTransformItemType.FilterPair||n.transformItemType==n.eTransformItemType.JoinPair),s.yb(1),s.hc("ngIf",n.transformItemType==n.eTransformItemType.FilterPair&&n.newDatalinkTransformItemForm.controls.filterCompare.value!=n.eCompare.IsNotNull&&n.newDatalinkTransformItemForm.controls.filterCompare.value!=n.eCompare.IsNull),s.yb(1),s.hc("ngIf",n.showOutput),s.yb(1),s.hc("ngIf",n.transformItemType==n.eTransformItemType.Sort),s.yb(1),s.hc("ngIf",n.transformItemType==n.eTransformItemType.JoinPair)}}var Jr,Br,$r=((Br=function(){function e(t,n,a,r){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.eTransformItemType=l.kc,this.inputColumns=[],this.showInput=!0,this.showOutput=!0,this.eAggregate=l.Y,this.eAggregateItems=l.Z.filter((function(e){return e.key>0})),this.compare=bt.a,this.eCompare=l.hb,this.sortDirections=C.v}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle;var n=t[1];e.hubCache=t[2];var a=t[3];if(e.hubCache.isLoaded()){if(e.datalinkForm=a,e.variables=e.editDatalinkService.getVariables(),e.datalinkTransformItemKey=+n.datalinkTransformItemKey,e.datalinkTransformKey=+n.datalinkTransformKey,e.transformItemType=+n.type,e.datalinkForm){switch(e.datalinkTransformForm=e.editDatalinkService.getDatalinkTransform(e.datalinkTransformKey),e.transformItemType){case l.kc.JoinPair:e.showInput=!0,e.showOutput=!1,e.pageTitle="Edit Join";break;case l.kc.Column:e.showInput=!0,e.showOutput=!1,e.pageTitle="Edit Group";break;case l.kc.JoinNode:e.showInput=!1,e.showOutput=!0,e.pageTitle="Edit Join Node";break;case l.kc.GroupNode:e.showInput=!1,e.showOutput=!0,e.pageTitle="Edit Group Node";break;case l.kc.Sort:e.showInput=!0,e.showOutput=!1,e.pageTitle="Edit Sort";break;case l.kc.FilterPair:e.showInput=!0,e.showOutput=!1,e.pageTitle="Edit Condition";break;case l.kc.AggregatePair:e.pageTitle="Edit Aggregate",e.showInput=!0,e.showOutput=!0;break;default:e.pageTitle="Edit Mapping",e.showInput=!0,e.showOutput=!0}var r=e.datalinkTransformForm.controls.nodeDatalinkColumn.value,i=r?r.key:null,o=new m.b;if(i){var s=o.getAvailableColumns(e.datalinkTransformForm.controls.runTime.value.inputColumns,i,0);e.inputColumns=e.editDatalinkService.getColumnGroups(s),e.outputColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns}else e.inputColumns=e.editDatalinkService.getColumnGroups(e.datalinkTransformForm.controls.runTime.value.inputColumns),e.outputColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns;e.datalinkTransformForm.value.joinDatalinkTable&&(e.joinColumns=e.datalinkTransformForm.value.joinDatalinkTable.dexihDatalinkColumns),e.datalinkTargets=e.datalinkForm.controls.dexihDatalinkTargets.value;var u=new l.H;if(u.name="Output Columns",u.dexihTableColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns,e.outputTables=[u],e.datalinkTargets&&e.datalinkTargets.forEach((function(t){e.outputTables.push(t.table)})),e.datalinkTransformItemKey)e.datalinkTransformItemForm=e.editDatalinkService.getDatalinkTransformItem(e.datalinkTransformForm,e.datalinkTransformItemKey),e.filterValue=e.datalinkTransformItemForm.controls.filterValue.value,e.sourceValue=e.datalinkTransformItemForm.controls.sourceValue.value,e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,e.datalinkTransformItemForm.value);else{var c=new l.x;c.datalinkTransformKey=e.datalinkTransformKey,c.transformItemType=e.transformItemType,e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,c)}e.getErrors(),e._formChangesObserve&&e._formChangesObserve.unsubscribe(),e._formChangesObserve=e.newDatalinkTransformItemForm.statusChanges.subscribe((function(){e.getErrors()}))}e._saveSubscription&&e._saveSubscription.unsubscribe(),e._saveSubscription=e.editDatalinkService.savingDatalink.subscribe((function(t){t&&e.apply()}))}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Mapping Function")}}},{key:"ngOnDestroy",value:function(){this._formChangesObserve&&this._formChangesObserve.unsubscribe(),this._subscription&&this._subscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe()}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"getErrors",value:function(){this.targetErrors=this.editDatalinkService.hubFormsService.getErrorMessage(this.newDatalinkTransformItemForm.controls.targetDatalinkColumn),this.sourceErrors=this.editDatalinkService.hubFormsService.getErrorMessage(this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn),this.joinErrors=this.editDatalinkService.hubFormsService.getErrorMessage(this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn)}},{key:"apply",value:function(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm)}},{key:"updateNewColumn",value:function(e){var t=this.newDatalinkTransformItemForm.controls.targetDatalinkColumn.value;if(e&&(!t||t.name!==e)){var n;n=this.newColumn?this.newColumn.key:this.hubService.getHubCache().getNextSequence();var a=this.newDatalinkTransformItemForm.controls.sourceDatalinkColumn.value;if(a){var r=new m.b;this.newColumn=r.copyDatalinkColumn(a,1e3-n,"mapping")}else this.newColumn=new l.m,this.newColumn.position=1e3-n,this.transformItemType===l.kc.JoinNode?(this.newColumn.dataType=l.pc.Node,this.newColumn.childColumns=this.joinColumns):this.newColumn.dataType=l.pc.String;this.newColumn.name=e,this.newColumn.logicalName=e,this.newColumn.columnGroup="mapping",this.newColumn.key=n,this.newDatalinkTransformItemForm.controls.targetDatalinkColumn.setValue(this.newColumn)}}},{key:"updateFilterValue",value:function(e){this.newDatalinkTransformItemForm.controls.filterValue.setValue(e)}},{key:"updateSourceValue",value:function(e){this.newDatalinkTransformItemForm.controls.sourceValue.setValue(e)}},{key:"applyExit",value:function(){this.apply(),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||Br)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a))},Br.\u0275cmp=s.Eb({type:Br,selectors:[["mapping-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],[3,"title","showExpandButton"],["header",""],[3,"formGroup"],[1,"form-row"],["class","form-group col-md-4",4,"ngIf"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"form-group","col-md-4"],["label","Aggregate","formControlName","aggregate","itemKey","key","itemName","name",3,"items"],["label","Input Column","formControlName","sourceDatalinkColumn","parentName","group","childItems","columns","itemName","logicalName","itemKey","key",3,"items","textValue","enableKeySelect","enableTextEntry","enableTextEntryMatch","errors","textValueChange"],["label","Compare","formControlName","filterCompare","itemKey","key","itemName","name",3,"items"],["label","Compare Column/Value","formControlName","filterDatalinkColumn","parentName","group","childItems","columns","itemKey","key","itemName","logicalName","textEntryItemsTitle","Variables","note","Note: For static date values use format YYYY-MM-DD (e.g. 2018-01-30)",3,"items","enableTextEntry","textValue","enableTextEntryMatch","enableKeySelect","errors","textEntryItems","setTextEntryToValue","textValueChange"],["label","Output Column","formControlName","targetDatalinkColumn","parentName","name","childItems","dexihTableColumns","itemKey","key","itemName","logicalName","note","Enter new column, or select existing","textEntryNote","Enter new column name, or select existing",3,"items","enableKeySelect","enableTextEntry","setTextEntryToValue","errors","textValueChange"],["label","Direction","formControlName","sortDirection","itemKey","key","itemName","name",3,"items"],["label","Join Column","formControlName","joinDatalinkColumn","itemKey","key","itemName","logicalName","note","Select a join column","textEntryNote","Enter a value to add a new column",3,"items","enableKeySelect","errors"]],template:function(e,t){1&e&&s.Dc(0,Hr,14,10,"div",0),2&e&&s.hc("ngIf",t.newDatalinkTransformItemForm&&t.inputColumns&&t.outputColumns)},directives:[r.t,p.T,g.I,g.t,g.l,p.a,p.b,p.E,g.s,g.j],encapsulation:2}),Br),Ur=((Jr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canDeactivate",value:function(e){return!e||!e.canDeactivate||e.canDeactivate()}}]),e}()).\u0275fac=function(e){return new(e||Jr)},Jr.\u0275prov=s.Gb({token:Jr,factory:Jr.\u0275fac}),Jr),qr=n("NHAS");function zr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-close",3),s.Vb("click",(function(){return s.vc(n),s.Zb().close()})),s.Nb()}}var Wr,Qr=((Wr=function(){function e(t,n,a,r){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.eDataObjectType=l.lb}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){var n=t[0],a=t[1];e.hubCache=t[2],e.datalinkForm=t[4],e.action=n.action,e.pageTitle=n.pageTitle,e.hubCache.isLoaded()&&(e.datalinkTransformKey=+a.datalinkTransformKey)}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Preview Transform Data")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"close",value:function(){this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||Wr)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a))},Wr.\u0275cmp=s.Eb({type:Wr,selectors:[["datalink-preview-data"]],decls:4,vars:5,consts:[["title","Preview Transform Data",3,"showExpandButton","padding"],["header",""],[3,"datalink","datalinkTransformKey","viewSource"],[3,"click"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,zr,1,0,"ng-template",null,1,s.Ec),s.Lb(3,"preview-data",2),s.Nb()),2&e&&(s.hc("showExpandButton",!0)("padding",!1),s.yb(3),s.hc("datalink",null==t.datalinkForm?null:t.datalinkForm.value)("datalinkTransformKey",t.datalinkTransformKey)("viewSource",t.eDataObjectType.Datalink))},directives:[p.T,qr.a,p.d],encapsulation:2}),Wr);function Yr(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-close",3),s.Vb("click",(function(){return s.vc(n),s.Zb().close()})),s.Nb()}}function Xr(e,t){if(1&e&&s.Lb(0,"preview-data",4),2&e){var n=s.Zb();s.hc("key",n.tableKey)("viewSource",n.eDataObjectType.Table)}}function ei(e,t){if(1&e&&s.Lb(0,"preview-data",4),2&e){var n=s.Zb();s.hc("key",n.datalinkKey)("viewSource",n.eDataObjectType.Datalink)}}var ti,ni=((ti=function(){function e(t,n,a){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.route=a,this.eDataObjectType=l.lb}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe((function(t){var n=t[0],a=t[1];if(e.hubCache=t[2],e.action=n.action,e.pageTitle=n.pageTitle,e.hubCache.isLoaded())if(a.tableKey){e.tableKey=+a.tableKey;var r=e.hubCache.getTable(e.tableKey);r&&(e.name=r.name)}else{e.datalinkKey=+a.datalinkKey;var i=e.hubCache.hub.dexihDatalinks.find((function(t){return t.key==e.datalinkKey}));i&&(e.name=i.name)}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Preview Table Data")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"close",value:function(){this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||ti)(s.Kb(u.a),s.Kb(d.a),s.Kb(i.a))},ti.\u0275cmp=s.Eb({type:ti,selectors:[["datalink-preview-table"]],decls:5,vars:5,consts:[[3,"title","showExpandButton","padding"],["header",""],[3,"key","viewSource",4,"ngIf"],[3,"click"],[3,"key","viewSource"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,Yr,1,0,"ng-template",null,1,s.Ec),s.Dc(3,Xr,1,2,"preview-data",2),s.Dc(4,ei,1,2,"preview-data",2),s.Nb()),2&e&&(s.hc("title","Preview "+t.name)("showExpandButton",!1)("padding",!1),s.yb(3),s.hc("ngIf",t.tableKey),s.yb(1),s.hc("ngIf",t.datalinkKey))},directives:[p.T,r.t,p.d,qr.a],encapsulation:2}),ti);function ai(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-delete",12),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb().deleteSelected(e)})),s.Nb()}}function ri(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-edit",13),s.Vb("click",(function(){s.vc(n);var e=t.item;return s.Zb().editColumn(e)})),s.Nb()}}function ii(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-new",14),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb().deleteSelected(e)})),s.Nb()}}var oi,li=((oi=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.canEdit=!1,this.typeCodes=Un.a,this.deltaTypes=C.i,this.securityFlags=C.s,this.eConnectionPurpose=l.jb,this.columns=[{name:"position",title:"#",format:""},{control:"name",title:"Column Name",format:"",tooltip:"description"},{name:"dataType",title:"Data Type",format:""},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"logicalName",title:"Logical Name",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._columnData=new b.a(null),this.columnData=this._columnData.asObservable()}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle;var n=t[1];e.hubCache=t[2],e.datalinkTransformKey=+n.datalinkTransformKey,e.datalinkTransformForm=e.editDatalinkService.getDatalinkTransform(e.datalinkTransformKey),e.transformTableForm=e.datalinkTransformForm.controls.transformTable,e.updateColumnData()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Transform Table Edit")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"updateColumnData",value:function(){var e=[];this.transformTableForm.controls.dexihTableColumns.controls.filter((function(e){return e.value.isValid})).sort((function(e,t){return e.value.position-t.value.position})).forEach((function(t){e.push({key:t.value.key,position:t.value.position,name:t.controls.name,description:t.value.description,dataType:t.value.dataType,allowDbNull:t.value.allowDbNull,logicalName:t.value.logicalName,updateDate:t.value.updateDate})})),this._columnData.next(e)}},{key:"deleteColumn",value:function(e){this.deleteSelected([e])}},{key:"deleteSelected",value:function(e){var t=this,n=this.transformTableForm.controls.dexihTableColumns;e.forEach((function(e){var a=n.controls.findIndex((function(t){return t.value.key===e.key}));a>=0&&n.removeAt(a),t.updateColumnData()}))}},{key:"newColumn",value:function(){this.router.navigate(["column"],{relativeTo:this.route.parent})}},{key:"editColumn",value:function(e){this.router.navigate(["column",e.key],{relativeTo:this.route.parent})}},{key:"columnSortChange",value:function(e){var t=this.transformTableForm.controls.dexihTableColumns,n=1;e.forEach((function(e){t.controls.find((function(t){return t.value.key===e.key})).controls.position.setValue(n++)})),this.updateColumnData()}},{key:"close",value:function(){this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||oi)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},oi.\u0275cmp=s.Eb({type:oi,selectors:[["transform-table-edit-form"]],decls:15,vars:4,consts:[[1,"widget-body-toolbar"],[1,"form-row"],[1,"col-sm-6"],[1,"col-sm-6","text-right"],[3,"click"],["sortColumn","position",3,"enableMultiSelect","enableManualSort","columns","dataObservable","onSortChanged"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["select","actionsTemplate"],["actions",""],["title","Delete selected columns",3,"click"],["title","Edit the column",3,"click"],["title","Create a new column",3,"click"]],template:function(e,t){1&e&&(s.Ob(0,"div"),s.Ob(1,"div",0),s.Ob(2,"div",1),s.Ob(3,"div",2),s.Ob(4,"h5"),s.Fc(5,"Transform Output Columns"),s.Nb(),s.Nb(),s.Ob(6,"div",3),s.Ob(7,"dexih-button-close",4),s.Vb("click",(function(){return t.close()})),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Ob(8,"dexih-table",5),s.Vb("onSortChanged",(function(e){return t.columnSortChange(e)})),s.Dc(9,ai,1,0,"ng-template",6,7,s.Ec),s.Dc(11,ri,1,0,"ng-template",8,9,s.Ec),s.Dc(13,ii,1,0,"ng-template",10,11,s.Ec),s.Nb(),s.Nb()),2&e&&(s.yb(8),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("columns",t.columns)("dataObservable",t.columnData))},directives:[p.d,B.a,p.g,p.j,p.o],encapsulation:2}),oi),si=function(){return["new",1]};function ui(e,t){1&e&&(s.Ob(0,"li",6),s.Ob(1,"a",7),s.Ob(2,"div",8),s.Fc(3," Add Transform "),s.Nb(),s.Lb(4,"i",9),s.Nb(),s.Nb()),2&e&&(s.yb(1),s.hc("routerLink",s.lc(1,si)))}function ci(e,t){1&e&&s.Lb(0,"div",24)}var mi=function(e){return["new",e]},bi=function(e){return["transform",e]},di=function(e){return["transform",e,"preview-transform-data"]};function fi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",10),s.Ob(1,"li",11),s.Ob(2,"a",12),s.Lb(3,"i",13),s.Nb(),s.Ob(4,"a",14),s.Lb(5,"i",13),s.Nb(),s.Ob(6,"a",15),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb(2).deleteTransform(e.transform.value)})),s.Lb(7,"i",16),s.Nb(),s.Ob(8,"a",17),s.Ob(9,"div",8),s.Fc(10),s.Ob(11,"div"),s.Lb(12,"span",18),s.Lb(13,"dexih-invalid-form-icon",19),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Ob(14,"div",20),s.Ob(15,"a",21),s.Lb(16,"i",22),s.Nb(),s.Dc(17,ci,1,0,"div",23),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit,r=t.last;s.yb(2),s.hc("routerLink",s.mc(9,mi,a.transform.value.position-1)),s.yb(2),s.hc("routerLink",s.mc(11,mi,a.transform.value.position+1)),s.yb(4),s.hc("routerLink",s.mc(13,bi,a.transform.value.key))("title","Select the "+a.transform.value.name+" transform."),s.yb(2),s.Hc(" ",a.name," "),s.yb(2),s.hc("ngClass",a.icon),s.yb(1),s.hc("control",a.transform),s.yb(2),s.hc("routerLink",s.mc(15,di,a.transform.value.key)),s.yb(2),s.hc("ngIf",!r)}}function hi(e,t){if(1&e&&(s.Ob(0,"div",2),s.Ob(1,"ul",3),s.Dc(2,ui,5,2,"li",4),s.Dc(3,fi,18,17,"div",5),s.Nb(),s.Nb()),2&e){var n=s.Zb();s.yb(2),s.hc("ngIf",0===n.datalinkTransforms.length),s.yb(1),s.hc("ngForOf",n.datalinkTransforms)}}var pi,vi=((pi=function(){function e(t,n,a,r){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.route=a,this.router=r,this.pageTitle="Transform",this.datalinkTransforms=null,this.logger=new c.a("datalink-edit-transforms")}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.logger.LogC((function(){return"OnInit"}),c.b.Trace);try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.action=t[0].action,e.pageTitle=t[0].pageTitle;var n=t[1];if(e.hubCache=t[2],e.datalinkForm=t[3],e.hubCache.isLoaded()&&e.datalinkForm){var a=+n.datalinkTransformKey;e.logger.LogC((function(){return"loading transform with key "+a}),c.b.Trace),e.refreshTransforms(),e._transformsChange&&e._transformsChange.unsubscribe(),e._transformsChange=e.datalinkForm.controls.dexihDatalinkTransforms.valueChanges.subscribe((function(){return e.refreshTransforms()}))}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink Edit Transform")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._transformsChange&&this._transformsChange.unsubscribe()}},{key:"refreshTransforms",value:function(){var e=this;this.logger.LogC((function(){return"refreshing transforms list"}),c.b.Trace);var t=this.datalinkForm.controls.dexihDatalinkTransforms.controls.filter((function(e){return e.value.transformType!==l.lc.Validation&&e.value.transformType!==l.lc.Profile})).sort((function(e,t){return e.value.position-t.value.position})).map((function(t){var n=Un.e.find((function(e){return e.key===t.value.transformType})),a="";n&&(a=n.icon);var r=e.hubCache.getTransformName(t.value);return{transform:t,icon:a,name:r,invalid:t.invalid}}));this.datalinkTransforms=t}},{key:"deleteTransform",value:function(e){var t=this;this.logger.LogC((function(){return"deleteTransform"}),c.b.Trace),this.editDatalinkService.deleteDatalinkTransform(e).then((function(){t.refreshTransforms()}))}},{key:"previewData",value:function(e){this.router.navigate(["transform",e.key,"preview-transform-data"],{relativeTo:this.route})}}]),e}()).\u0275fac=function(e){return new(e||pi)(s.Kb(u.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e))},pi.\u0275cmp=s.Eb({type:pi,selectors:[["dexih-datalink-edit-transforms-form"]],decls:3,vars:2,consts:[["title","Transforms",3,"padding"],["class","bg-light pt-1 pb-1 d-flex \u2248",4,"ngIf"],[1,"bg-light","pt-1","pb-1","d-flex","\u2248"],[1,"transform-container"],["class","d-flex align-items-stretch p-0 m-3",4,"ngIf"],["class","d-flex m-3 ",4,"ngFor","ngForOf"],[1,"d-flex","align-items-stretch","p-0","m-3"],["title","Insert a transform before this",1,"btn","btn-outline-success",3,"routerLink"],[1,"d-block"],[1,"fa","fa-4x","fa-plus"],[1,"d-flex","m-3"],[1,"d-flex","align-items-stretch","p-0"],["title","Insert a transform before this",1,"insert-before","btn","btn-sm","btn-primary",3,"routerLink"],[1,"fa","fa-plus"],["title","Insert a transform after this",1,"insert-after","btn","btn-sm","btn-primary",3,"routerLink"],["href","javascript:void(0)","title","Delete this transform",1,"delete","btn","btn-sm","btn-danger","mr-1",3,"click"],[1,"fa","fa-remove"],["routerLinkActive","btn-outline-success",1,"btn","btn-outline-primary",2,"width","100%",3,"routerLink","title"],[1,"fa-4x",3,"ngClass"],[3,"control"],[1,"arrow","bg-primary"],["title","Preview transform data",1,"preview","btn","btn-sm","btn-primary","mr-1",3,"routerLink"],[1,"fa","fa-search"],["class","arrow-head",4,"ngIf"],[1,"arrow-head"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Dc(1,hi,4,2,"div",1),s.Nb(),s.Lb(2,"router-outlet")),2&e&&(s.hc("padding",!1),s.yb(1),s.hc("ngIf",t.datalinkTransforms))},directives:[p.T,r.t,i.j,r.s,i.h,i.g,r.q,V.a],styles:['.transform-container[_ngcontent-%COMP%]{overflow-x:auto;margin:auto;overflow-y:hidden}ul[_ngcontent-%COMP%]{display:flex;list-style:none;padding:0}li[_ngcontent-%COMP%]{margin:auto;position:relative;text-align:center;min-width:120px}a.active[_ngcontent-%COMP%]{color:#fff;background:#d3d3d3}.arrow[_ngcontent-%COMP%]{content:"";height:1px;min-width:120px;right:-13px;position:relative;top:50%}.arrow-head[_ngcontent-%COMP%]{width:0;height:0;border-color:transparent transparent transparent #3a5f8d;border-style:solid;border-width:7px 0 7px 20px;left:calc(100% - 15px)}.arrow-head[_ngcontent-%COMP%], .preview[_ngcontent-%COMP%]{content:"";position:absolute;top:50%;transform:translateY(-50%)}.preview[_ngcontent-%COMP%]{left:calc(50% - 19px)}.insert-before[_ngcontent-%COMP%]{left:-16px}.insert-after[_ngcontent-%COMP%], .insert-before[_ngcontent-%COMP%]{content:"";position:absolute;top:50%;transform:translateY(-50%)}.delete[_ngcontent-%COMP%], .insert-after[_ngcontent-%COMP%]{left:calc(100% - 16px)}.delete[_ngcontent-%COMP%]{content:"";position:absolute;top:-16px}']}),pi);function gi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"a",3),s.Vb("click",(function(){s.vc(n);var e=t.$implicit;return s.Zb().insert(e.transformReference)})),s.Ob(1,"div",4),s.Ob(2,"div",5),s.Ob(3,"div",6),s.Fc(4),s.Nb(),s.Lb(5,"i",7),s.Nb(),s.Ob(6,"div",8),s.Fc(7),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=t.$implicit;s.yb(4),s.Hc(" ",a.transformReference.name," "),s.yb(1),s.hc("ngClass",a.icon),s.yb(2),s.Hc(" ",a.transformReference.description," ")}}var ki,yi=((ki=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.hubService=t,this.editDatalinkService=n,this.authService=a,this.route=r,this.router=i}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){return n=e,r=regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.transforms=[],e.next=3,this.hubService.GetUserConfigTransformReference();case 3:e.sent.forEach((function(e){var t=Un.e.find((function(t){return t.key===e.transformType})),a="";t&&(a=t.icon),n.transforms.push({transformReference:e,icon:a})})),this.position=+t[1].position;case 5:case"end":return e.stop()}}),e,this)})),new((a=void 0)||(a=Promise))((function(e,t){function i(e){try{l(r.next(e))}catch(n){t(n)}}function o(e){try{l(r.throw(e))}catch(n){t(n)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(i,o)}l((r=r.apply(n,[])).next())}));var n,a,r}))}catch(t){this.hubService.addHubClientErrorMessage(t,"New Transform")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe()}},{key:"insert",value:function(e){var t=this.editDatalinkService.insertDatalinkTransform(this.position,e);this.router.navigate(["transform",t.value.key],{relativeTo:this.route.parent})}},{key:"close",value:function(){this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||ki)(s.Kb(u.a),s.Kb(h),s.Kb(d.a),s.Kb(i.a),s.Kb(i.e))},ki.\u0275cmp=s.Eb({type:ki,selectors:[["datalink-edit-new-transform"]],decls:3,vars:2,consts:[["title","Select a Transform",3,"padding"],[1,"d-flex","flex-wrap","justify-content-around"],["href","javascript:void(0)","class","btn btn-outline-primary p-0 m-3","style","width:400px",3,"click",4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"btn","btn-outline-primary","p-0","m-3",2,"width","400px",3,"click"],[1,"d-flex"],[1,"border-right","border-primary","p-3",2,"min-width","140px"],[1,"d-block"],[1,"fa","fa-4x",3,"ngClass"],[1,"p-3","text-left"]],template:function(e,t){1&e&&(s.Ob(0,"dexih-widget-section",0),s.Ob(1,"div",1),s.Dc(2,gi,8,3,"a",2),s.Nb(),s.Nb()),2&e&&(s.hc("padding",!0),s.yb(2),s.hc("ngForOf",t.transforms))},directives:[p.T,r.s,r.q],encapsulation:2}),ki),Ti=n("9nsk"),Ci=n("vDxl");function Fi(e,t){if(1&e&&s.Lb(0,"table-edit-columns",10),2&e){var n=s.Zb(2);s.hc("parentColumnForm",n.columnFormService.currentForm)}}function Di(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",1),s.Ob(2,"div",2),s.Ob(3,"h5"),s.Fc(4,"Edit Column "),s.Nb(),s.Ob(5,"div",3),s.Ob(6,"dexih-invalid-form-details",4),s.Vb("click",(function(){return s.vc(n),s.Zb().columnFormService.showErrors()})),s.Nb(),s.Ob(7,"dexih-button-apply",5),s.Vb("click",(function(){s.vc(n);var e=s.Zb();return!e.columnFormService.currentForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(8,"dexih-button-cancel",6),s.Vb("click",(function(){return s.vc(n),s.Zb().cancel()})),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Ob(9,"div",7),s.Lb(10,"column-edit-base",8),s.Nb(),s.Dc(11,Fi,1,1,"table-edit-columns",9),s.Nb()}if(2&e){var a=s.Zb();s.yb(6),s.hc("control",a.columnFormService.currentForm),s.yb(1),s.hc("disabled",a.columnFormService.currentForm.pristine),s.yb(3),s.hc("columnFormService",a.columnFormService)("detailedView",!0),s.yb(1),s.hc("ngIf",a.columnFormService.currentForm.controls.dataType.value===a.eTypeCode.Node)}}var wi,Si=((wi=function(){function e(t,n,a,r,i){_classCallCheck(this,e),this.authService=t,this.hubService=n,this.editDatalinkService=a,this.route=i,this.eTypeCode=l.pc,this.typeCodes=Un.a,this.deltaTypes=C.i,this.securityFlags=C.s,this.columnFormService=new f.a(r,n,t)}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.params,this.hubService.getHubCacheObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle,e.datalinkColumnKey=+t[0].datalinkColumnKey,e.hubCache=t[1],e.sourceDatalinkTableForm=e.editDatalinkService.hubFormsService.currentForm.controls.sourceDatalinkTable,e.initializeForm()})),this._saveSubscription&&this._saveSubscription.unsubscribe(),this._saveSubscription=this.editDatalinkService.savingDatalink.subscribe((function(t){t&&e.applyExit()}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Datalink column edit")}}},{key:"ngOnChanges",value:function(){this.hubCache&&this.initializeForm()}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe()}},{key:"findColumn",value:function(){var e=this,t=this.sourceDatalinkTableForm.controls.dexihDatalinkColumns,n=t.controls.find((function(t){return t.value.key===e.datalinkColumnKey}));return n||(this.editDatalinkService.hubFormsService.currentForm.controls.dexihDatalinkTransforms.controls.forEach((function(a){a.controls.dexihDatalinkTransformItems.controls.forEach((function(a){if(!n){var r=a;if(r.controls.targetDatalinkColumn.value&&r.controls.targetDatalinkColumn.value.key===e.datalinkColumnKey&&(n=r.controls.targetDatalinkColumn),!n){var i=(t=r.controls.dexihFunctionParameters).controls.find((function(t){return C.e.parameterIsOutput(t.value)&&t.value.datalinkColumn&&t.value.datalinkColumn.key===e.datalinkColumnKey}));i&&(n=i.controls.datalinkColumn),n||t.controls.forEach((function(t){var a=t.controls.arrayParameters;a&&(i=a.controls.find((function(t){return C.e.parameterIsOutput(t.value)&&t.value.datalinkColumn&&t.value.datalinkColumn.key===e.datalinkColumnKey})))&&(n=i.controls.datalinkColumn)}))}}}))})),n)}},{key:"initializeForm",value:function(){var e,t=this;if(this.datalinkColumnKey){if(this.originalColumnForm=this.findColumn(),!this.originalColumnForm)return void this.authService.informationDialog("Cannot Edit","The selected column could not be edited.").then((function(){t.authService.navigateUp()}));e=this.columnFormService.datalinkTableColumn(null,this.originalColumnForm.value)}else{var n=new l.m;n.key=this.hubCache.getNextSequence(),n.datalinkTableKey=this.sourceDatalinkTableForm.controls.key.value;var a=this.sourceDatalinkTableForm.controls.dexihDatalinkColumns.value,r=1;a.forEach((function(e){e.position>r&&(r=e.position)})),n.position=r+1,e=this.columnFormService.datalinkTableColumn(a,n)}this.columnFormService.startForm(e)}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"applyExit",value:function(){var e=this.columnFormService.currentForm;this.originalColumnForm?this.originalColumnForm.setValue(e.value):this.sourceDatalinkTableForm.controls.dexihDatalinkColumns.push(e),this.sourceDatalinkTableForm.markAsDirty(),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||wi)(s.Kb(d.a),s.Kb(u.a),s.Kb(h),s.Kb(g.g),s.Kb(i.a))},wi.\u0275cmp=s.Eb({type:wi,selectors:[["datalink-column-edit"]],features:[s.wb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"list-group-item","list-group-item-info","rounded-0"],[1,"d-flex","flex-row"],[1,"ml-auto"],[1,"mr-1",3,"control","click"],[1,"mr-1",3,"disabled","click"],[3,"click"],[1,"container","mt-3","mb-3"],[3,"columnFormService","detailedView"],[3,"parentColumnForm",4,"ngIf"],[3,"parentColumnForm"]],template:function(e,t){1&e&&s.Dc(0,Di,12,5,"div",0),2&e&&s.hc("ngIf",null==t.columnFormService?null:t.columnFormService.currentForm)},directives:[r.t,w.a,p.a,p.b,Ti.a,Ci.a],encapsulation:2}),wi),Ni=n("wTS4");function Oi(e,t){if(1&e&&(s.Ob(0,"div",12),s.Ob(1,"div",15),s.Ob(2,"div"),s.Fc(3),s.Nb(),s.Nb(),s.Nb()),2&e){var n=t.$implicit;s.yb(3),s.Gc(n.controls.name.value)}}function Ii(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div",7),s.Ob(1,"form",8),s.Ob(2,"fieldset"),s.Ob(3,"section",9),s.Ob(4,"form-select",10),s.Vb("textValueChange",(function(e){return s.vc(n),s.Zb(2).sourceValue=e})),s.Nb(),s.Nb(),s.Ob(5,"div",11),s.Ob(6,"div",12),s.Ob(7,"div",13),s.Fc(8,"UnGroup Column"),s.Nb(),s.Nb(),s.Dc(9,Oi,4,1,"div",14),s.Nb(),s.Nb(),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.yb(1),s.hc("formGroup",a.newDatalinkTransformItemForm),s.yb(3),s.hc("items",a.inputColumns)("textValue",a.sourceValue)("enableTextEntry",!0)("enableTextEntryMatch",!1)("enableKeySelect",!1)("errors",a.sourceErrors),s.yb(5),s.hc("ngForOf",a.newDatalinkTransformItemForm.controls.dexihFunctionParameters.controls)}}function xi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"div",1),s.Ob(2,"div",2),s.Ob(3,"h5"),s.Fc(4,"Un-Group Column Node"),s.Nb(),s.Ob(5,"div",3),s.Ob(6,"dexih-button-apply",4),s.Vb("click",(function(){s.vc(n);var e=s.Zb();return!e.newDatalinkTransformItemForm.pristine&&e.applyExit()})),s.Nb(),s.Ob(7,"dexih-button-cancel",5),s.Vb("click",(function(){return s.vc(n),s.Zb().cancel()})),s.Nb(),s.Nb(),s.Nb(),s.Nb(),s.Dc(8,Ii,10,8,"div",6),s.Nb()}if(2&e){var a=s.Zb();s.yb(6),s.hc("disabled",a.newDatalinkTransformItemForm.pristine),s.yb(2),s.hc("ngIf",a.datalinkTransformForm)}}var Pi,Vi=((Pi=function(){function e(t,n,a,r){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.eFunctionType=l.Cb,this.eParameterDirection=l.Vb,this.typeCodes=Un.a,this.variables=[],this.allowOutput=!1,this.allowReturn=!0,this.logger=new c.a("unGroup-edit")}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){e.pageTitle=t[0].pageTitle;var n=t[1];if(e.hubCache=t[2],e.datalinkForm=t[3],e.logger.LogC((function(){return"OnInit"}),c.b.Trace),e.hubCache&&e.hubCache.isLoaded()&&e.datalinkForm){e.datalinkTransformKey=+n.datalinkTransformKey,e.datalinkTransformItemKey=+n.datalinkTransformItemKey,e.datalinkTransformForm=e.editDatalinkService.getDatalinkTransform(e.datalinkTransformKey),e.variables=e.editDatalinkService.getVariables();var a=e.datalinkTransformForm.controls.nodeDatalinkColumn.value,r=a?a.key:null,i=new m.b;if(r?(e.inputColumns=i.getAvailableColumns(e.datalinkTransformForm.controls.runTime.value.inputColumns,r,0),e.outputColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns):(e.inputColumns=e.datalinkTransformForm.controls.runTime.value.inputColumns,e.outputColumns=e.datalinkTransformForm.controls.runTime.value.transformColumns),e.inputColumns=e.inputColumns.filter((function(e){return e.dataType===l.pc.Node})),e.datalinkTransformItemKey){if(e.datalinkTransformItemForm=e.editDatalinkService.getDatalinkTransformItem(e.datalinkTransformForm,e.datalinkTransformItemKey),!e.datalinkTransformItemForm)return void e.authService.navigateUp();e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,e.datalinkTransformItemForm.value),e.newDatalinkTransformItemForm.controls.dexihFunctionParameters.controls.forEach((function(e){var t={};t.functionParameter=new l.O,e.value.datalinkColumn&&(t.functionParameter.name=e.value.datalinkColumn.name),e.controls.runTime.setValue(t)}))}else{var o=new l.x;o.datalinkTransformKey=e.datalinkTransformKey,o.transformItemType=l.kc.UnGroup,e.datalinkTransformItemKey=0,e.newDatalinkTransformItemForm=e.editDatalinkService.hubFormsService.datalinkDatalinkTransformItemFormGroup(e.datalinkTransformForm,o)}e._nodeSubscription&&e._nodeSubscription.unsubscribe(),e._nodeSubscription=e.newDatalinkTransformItemForm.controls.sourceDatalinkColumn.valueChanges.subscribe((function(t){for(var n=e.newDatalinkTransformItemForm.controls.dexihFunctionParameters;n.length;)n.removeAt(0);t.childColumns&&t.childColumns.length>0&&t.childColumns.forEach((function(t,a){var r=i.copyDatalinkColumn(t,0,"un-group"),o=new l.A;o.datalinkTransformItemKey=e.datalinkTransformItemKey,o.name=t.name,o.rank=t.rank,o.direction=l.Vb.Output,o.dataType=t.dataType,o.position=a,o.key=e.hubCache.getNextSequence(),o.datalinkColumn=r,o.isValid=!0,o.runTime={},o.runTime.functionParameter=new l.O,o.runTime.functionParameter.name=t.name;var s=e.editDatalinkService.hubFormsService.datalinkFunctionParametersFormGroup(o);n.push(s)}))}))}}))}catch(t){this.hubService.addHubClientErrorMessage(t,"UnGroup Node Edit")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._nodeSubscription&&this._nodeSubscription.unsubscribe()}},{key:"canDeactivate",value:function(){var e=this;return new Promise((function(t){e.newDatalinkTransformItemForm&&!e.newDatalinkTransformItemForm.pristine?e.authService.confirmDialog("The function has changed","The function has changed.  Do you want to discard the changes and continue?").then((function(e){t(e)})).catch((function(){t(!1)})):t(!0)}))}},{key:"cancel",value:function(){this.authService.navigateUp()}},{key:"apply",value:function(){this.editDatalinkService.insertDatalinkTransformItem(this.datalinkTransformForm,this.newDatalinkTransformItemForm),this.newDatalinkTransformItemForm.markAsPristine()}},{key:"applyExit",value:function(){this.apply(),this.authService.navigateUp()}}]),e}()).\u0275fac=function(e){return new(e||Pi)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a))},Pi.\u0275cmp=s.Eb({type:Pi,selectors:[["dexih-unGroup-edit"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"list-group-item","list-group-item-info","rounded-0"],[1,"d-flex","flex-row"],[1,"ml-auto"],[1,"mr-1",3,"disabled","click"],[3,"click"],["class","container  mt-3 mb-3",4,"ngIf"],[1,"container","mt-3","mb-3"],[3,"formGroup"],[1,"col","col-xs-12"],["label","Column Node","formControlName","sourceDatalinkColumn","itemKey","key","itemName","logicalName",3,"items","textValue","enableTextEntry","enableTextEntryMatch","enableKeySelect","errors","textValueChange"],[1,"mt-1"],[1,"row"],[1,"col","border","bg-primary","text-white","font-weight-bold","text-truncate"],["class","row",4,"ngFor","ngForOf"],[1,"col","border","bg-secondary","text-white","text-truncate"]],template:function(e,t){1&e&&s.Dc(0,xi,9,2,"div",0),2&e&&s.hc("ngIf",t.newDatalinkTransformItemForm&&t.inputColumns&&t.outputColumns)},directives:[r.t,p.a,p.b,g.I,g.t,g.l,p.E,g.s,g.j,r.s],encapsulation:2}),Pi),Ei=n("Qrk8"),Ki=n("zal2"),Li=n("dn85");function Mi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-preview",6),s.Vb("click",(function(){return s.vc(n),s.Zb(2).previewData()})),s.Nb(),s.Ob(1,"dexih-button",7),s.Vb("click",(function(){return s.vc(n),s.Zb(2).importTable()})),s.Fc(2," Re-Import "),s.Nb(),s.Ob(3,"dexih-button",8),s.Vb("click",(function(){return s.vc(n),s.Zb(2).createTable()})),s.Fc(4," Drop & Create "),s.Nb(),s.Ob(5,"dexih-button-apply",9),s.Vb("click",(function(){return s.vc(n),s.Zb(2).apply()})),s.Nb(),s.Lb(6,"cancel-button",10)}if(2&e){var a=s.Zb(2);s.yb(5),s.hc("disabled",!(null!=a.targetTableForm&&a.targetTableForm.dirty)),s.yb(1),s.hc("formsService",a.tableFormService)}}function Zi(e,t){if(1&e&&(s.Ob(0,"section"),s.Lb(1,"form-select",13),s.Nb()),2&e){var n=s.Zb(3);s.yb(1),s.hc("items",n.connectionTables)}}function Ai(e,t){if(1&e&&(s.Ob(0,"section"),s.Lb(1,"form-select",14),s.Nb()),2&e){var n=s.Zb(3);s.yb(1),s.hc("items",n.nodes)("enableKeySelect",!1)("allowNullSelect",!0)}}var _i=function(){return{standalone:!0}};function Gi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"form",11),s.Ob(1,"fieldset"),s.Ob(2,"section"),s.Ob(3,"form-checkbox",12),s.Vb("ngModelChange",(function(e){return s.vc(n),s.Zb(2).newTable=e}))("ngModelChange",(function(e){return s.vc(n),s.Zb(2).toggleNewTable(e)})),s.Nb(),s.Nb(),s.Dc(4,Zi,2,1,"section",0),s.Dc(5,Ai,2,3,"section",0),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("formGroup",a.targetTableForm),s.yb(3),s.hc("ngModelOptions",s.lc(5,_i))("ngModel",a.newTable),s.yb(1),s.hc("ngIf",!a.newTable),s.yb(1),s.hc("ngIf",(null==a.nodes?null:a.nodes.length)>0)}}function Ri(e,t){if(1&e&&s.Lb(0,"dexih-table-edit-properties",15),2&e){var n=s.Zb(2);s.hc("formsService",n.tableFormService)("isExpanded",n.newTable)}}function ji(e,t){if(1&e){var n=s.Pb();s.Ob(0,"column-edit-bulk",32),s.Vb("updated",(function(){return s.vc(n),s.Zb(4).updateData()})),s.Nb()}if(2&e){var a=s.Zb().items,r=s.Zb(3);s.hc("columns",a)("columnsFormArray",r.targetTableForm.controls.table.controls.dexihTableColumns)}}function Hi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-splitdropdown",25),s.Vb("buttonClick",(function(){return s.vc(n),s.Zb(3).newColumn(null)})),s.Ob(1,"li"),s.Ob(2,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.AutoIncrement)})),s.Fc(3,"Add Auto Incrementing Key Column"),s.Nb(),s.Nb(),s.Ob(4,"li"),s.Ob(5,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.ValidFromDate)})),s.Fc(6,"Add Valid from Date"),s.Nb(),s.Nb(),s.Ob(7,"li"),s.Ob(8,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.ValidToDate)})),s.Fc(9,"Add Valid to Date"),s.Nb(),s.Nb(),s.Ob(10,"li"),s.Ob(11,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.IsCurrentField)})),s.Fc(12,"Add Is Current Column"),s.Nb(),s.Nb(),s.Ob(13,"li"),s.Ob(14,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.CreateAuditKey)})),s.Fc(15,"Add Create Audit Key"),s.Nb(),s.Nb(),s.Ob(16,"li"),s.Ob(17,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.UpdateAuditKey)})),s.Fc(18,"Add Update Audit Key"),s.Nb(),s.Nb(),s.Ob(19,"li"),s.Ob(20,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.CreateDate)})),s.Fc(21,"Add Create Date"),s.Nb(),s.Nb(),s.Ob(22,"li"),s.Ob(23,"a",26),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.newColumn(e.eDeltaType.UpdateDate)})),s.Fc(24,"Add Update Date"),s.Nb(),s.Nb(),s.Nb(),s.Dc(25,ji,1,2,"column-edit-bulk",27),s.Ob(26,"dexih-button",28),s.Vb("click",(function(){return s.vc(n),s.Zb(3).resetColumns()})),s.Fc(27,"Reset All Columns"),s.Nb(),s.Ob(28,"dexih-button-preview",29),s.Vb("click",(function(){return s.vc(n),s.Zb(3).previewData()})),s.Nb(),s.Ob(29,"dexih-button",30),s.Vb("click",(function(){return s.vc(n),s.Zb(3).importTable()})),s.Fc(30," Re-Import "),s.Nb(),s.Ob(31,"dexih-button",31),s.Vb("click",(function(){return s.vc(n),s.Zb(3).createTable()})),s.Fc(32," Drop & Create "),s.Nb()}if(2&e){var a=t.items,r=s.Zb(3);s.yb(25),s.hc("ngIf",r.showBulkEdit&&a.length>0)}}function Ji(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-edit",29),s.Vb("click",(function(){s.vc(n);var e=t.item;return s.Zb(3).editColumn(e)})),s.Nb()}}function Bi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button-delete",29),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb(3).deleteColumns(e)})),s.Nb(),s.Ob(1,"dexih-button",33),s.Vb("click",(function(){s.vc(n);var e=s.Zb(3);return e.showBulkEdit=!e.showBulkEdit})),s.Fc(2),s.Nb()}if(2&e){var a=s.Zb(3);s.yb(2),s.Hc("",a.showBulkEdit?"Hide Bulk Edit":"Show Bulk Edit"," ")}}function $i(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-button",34),s.Vb("click",(function(){s.vc(n);var e=t.items;return s.Zb(3).addMissing(e)})),s.Fc(1,"Add To Table"),s.Nb()}}function Ui(e,t){if(1&e){var n=s.Pb();s.Ob(0,"dexih-widget-section",16),s.Ob(1,"dexih-table",17),s.Vb("onSortChanged",(function(e){return s.vc(n),s.Zb(2).columnSortChange(e)}))("rowClick",(function(e){return s.vc(n),s.Zb(2).editColumn(e)})),s.Dc(2,Hi,33,1,"ng-template",null,18,s.Ec),s.Dc(4,Ji,1,0,"ng-template",19,20,s.Ec),s.Dc(6,Bi,3,1,"ng-template",21,22,s.Ec),s.Nb(),s.Nb(),s.Ob(8,"dexih-widget-section",23),s.Ob(9,"dexih-table",24),s.Dc(10,$i,2,0,"ng-template",21,22,s.Ec),s.Nb(),s.Nb()}if(2&e){var a=s.Zb(2);s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableManualSort",!0)("enableSort",!1)("enableFilter",!1)("columns",a.columns)("dataObservable",a.tableData)("enableStickyToolbar",!0)("toolbarZIndex",100),s.yb(7),s.hc("showExpandButton",!0)("padding",!1),s.yb(1),s.hc("enableMultiSelect",!0)("enableFilter",!1)("columns",a.columns)("dataObservable",a.missingColumnsData)("enableStickyToolbar",!0)("toolbarZIndex",100)}}function qi(e,t){if(1&e&&(s.Ob(0,"div"),s.Ob(1,"dexih-widget-section",1),s.Dc(2,Mi,7,2,"ng-template",null,2,s.Ec),s.Dc(4,Gi,6,6,"form",3),s.Nb(),s.Dc(5,Ri,1,2,"dexih-table-edit-properties",4),s.Dc(6,Ui,12,18,"ng-template",5),s.Nb()),2&e){var n=s.Zb();s.yb(1),s.hc("showExpandButton",!0),s.yb(3),s.hc("ngIf",n.targetTableForm),s.yb(1),s.hc("ngIf",n.tableFormService.currentForm.value),s.yb(1),s.hc("ngIf",null==n.targetTableForm?null:n.targetTableForm.controls.table.value)}}function zi(e,t){if(1&e){var n=s.Pb();s.Ob(0,"div"),s.Ob(1,"column-edit",35),s.Vb("isUpdated",(function(){return s.vc(n),s.Zb().columnUpdated()})),s.Nb(),s.Nb()}if(2&e){var a=s.Zb();s.yb(1),s.hc("columnKey",a.columnKey)("tableForm",a.targetTableForm.controls.table)("deltaType",a.deltaType)}}var Wi,Qi,Yi=((Wi=function(){function e(t,n,a,r,i,o){_classCallCheck(this,e),this.hubService=t,this.authService=n,this.editDatalinkService=a,this.route=r,this.router=i,this.fb=o,this.cancelToken=new D.a,this.eMappingStatus=C.k,this.eDeltaType=l.qb,this.eUpdateStrategy=l.qc,this.updateStrategies=C.y,this.eTransformWriterMethod=l.nc,this.loadStrategies=C.q,this.showTableProperties=!1,this.showColumn=!1,this.ignoreUpdateTable=!1,this.nodes=[],this.newTable=!1,this.showBulkEdit=!1,this.canExit=!1,this.logger=new c.a("datalink-edit-target-table"),this.columns=[{name:"position",title:"#",format:""},{name:"columnStatus",title:"Lineage",format:"Html"},{name:"name",title:"Name",format:""},{name:"logicalName",title:"Logical",format:""},{name:"dataType",title:"Data Type",format:""},{name:"deltaType",title:"Delta Type",format:""},{name:"allowDbNull",title:"Null?",format:"Boolean"},{name:"defaultValue",title:"Default Value",format:""},{name:"securityFlag",title:"Security Flag",format:"Enum",enum:l.Zb},{name:"columnValidation",title:"Validation",format:"",class:"columnValidationClass",tooltip:"columnValidationTooltip"}],this._tableData=new b.a(null),this.tableData=this._tableData.asObservable(),this._missingColumnsData=new b.a(null),this.missingColumnsData=this._missingColumnsData.asObservable(),this.tableFormService=new f.a(o,t,n)}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.logger.LogC((function(){return"ngOnInit"}),c.b.Trace);try{this._subscription=Object(o.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.editDatalinkService.hubFormsService.getCurrentFormObservable()).subscribe((function(t){var n=t[0],a=t[1];e.hubCache=t[2],e.datalinkForm=t[3],e.action=n.action,e.pageTitle=n.pageTitle;var r=new m.b;if(e.inputColumns=r.getDatalinkOutputColumns(e.datalinkForm.value),"edit"===e.action){e.targetKey=+a.targetKey;var i=e.datalinkForm.controls.dexihDatalinkTargets.controls.find((function(t){return t.value.key===e.targetKey}));if(i&&i.controls.key.value<=0&&(e.newTable=!0),void 0===i)return e.canExit=!0,void e.authService.navigateUp();e.targetTableForm=e.editDatalinkService.hubFormsService.datalinkTargetFormGroup(i.value,i.controls.table.value)}else if("new"===e.action){var o=new l.s;o.key=e.hubCache.getNextSequence(),e.targetTableForm=e.editDatalinkService.hubFormsService.datalinkTargetFormGroup(o)}else e.hubService.addHubErrorMessage("Invalid action "+e.action);e.hubCache.isLoaded()&&e.datalinkForm&&(e.connectionTables=e.hubCache.getConnectionTables(),e.managedConnections=e.hubCache.getManagedConnections(),e.updateData(),e.resetSubscription(),e.logger.LogC((function(){return"ngOnInit - completed"}),c.b.Trace)),e._saveSubscription&&e._saveSubscription.unsubscribe(),e._saveSubscription=e.editDatalinkService.savingDatalink.subscribe((function(t){t&&e.apply()}))}))}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Target Table")}}},{key:"ngOnDestroy",value:function(){this._subscription&&this._subscription.unsubscribe(),this._loadStrategySubscription&&this._loadStrategySubscription.unsubscribe(),this._tableFormSubscription&&this._tableFormSubscription.unsubscribe(),this._saveSubscription&&this._saveSubscription.unsubscribe()}},{key:"canDeactivate",value:function(){var e=this;return new Promise((function(t){var n;!e.canExit&&(null===(n=e.targetTableForm)||void 0===n?void 0:n.dirty)?e.authService.confirmDialog("Target Table Changed","The table has changed.  Would you like to discard the changes and return to the previous screen?  Otherwise, use the apply button to save the changes.").then((function(e){t(e)})).catch((function(e){t(!1)})):t(!0)}))}},{key:"resetSubscription",value:function(){var e=this;this._tableFormSubscription&&this._tableFormSubscription.unsubscribe(),this._tableFormSubscription=this.targetTableForm.controls.tableKey.valueChanges.subscribe((function(){e.updateData()}))}},{key:"previewData",value:function(){this.router.navigate(["preview-table-data",this.targetTableForm.controls.tableKey.value],{relativeTo:this.route})}},{key:"columnStatus",value:function(e,t){var n=new m.a(m.c.TargetTable,m.d.Target,this.datalinkForm.value,null,t,null,null,C.k.NotMapped,this.hubCache).createDatalinkLineage(!0),a=C.p.find((function(e){return e.key===n}));if(a)return'<i class="'.concat(a.statusClass,'"></i>&nbsp;').concat(a.name)}},{key:"datalinkColumnStatus",value:function(e,t){var n=new m.a(m.c.TargetTable,m.d.Target,this.datalinkForm.value,t,null,null,null,C.k.NotMapped,this.hubCache).createDatalinkLineage(!0),a=C.p.find((function(e){return e.key===n}));if(a)return'<i class="'.concat(a.statusClass,'"></i>&nbsp;').concat(a.name)}},{key:"addNodeColumns",value:function(e,t){var n=this;t||(this.nodes=[]),e&&e.filter((function(e){return e.dataType===l.pc.Node&&e.isValid})).forEach((function(e){var a=t?t+"."+e.logicalName:e.logicalName;n.nodes.push({key:e.key,name:a}),e.childColumns&&e.childColumns.length>0&&n.addNodeColumns(e.childColumns,a)}))}},{key:"updateData",value:function(){var e=this;if(!this.ignoreUpdateTable){this.logger.LogC((function(){return"updateData started"}),c.b.Trace),this.showBulkEdit=!1;var t=this.editDatalinkService.getValidationTransform();if(this.tableFormService.startForm(this.targetTableForm.controls.table),this.targetTableForm.controls.table)if(this.targetTableForm.controls.table.value){var n=this.targetTableForm.controls.table.value;this.logger.LogC((function(){return"updateData targetTable "+n.name}),c.b.Trace);var a=[];n.dexihTableColumns.filter((function(e){return e.isValid})).sort((function(e,t){return e.position-t.position})).forEach((function(r){var i=C.i.find((function(e){return e.key===r.deltaType})),o={key:r.key,position:r.position,columnStatus:e.columnStatus(n,r),name:r.name,dataType:e.hubCache.dataTypeToString(r),deltaType:i?i.name:"Not specified",allowDbNull:r.allowDbNull,logicalName:r.logicalName,isIncrementalUpdate:r.isIncrementalUpdate,securityFlag:r.securityFlag,defaultValue:r.defaultValue,columnValidation:e.hubCache.getColumnValidation(r.columnValidationKey).name,columnValidationClass:r.columnValidationKey&&!t?"dexih-error-icon":"",columnValidationTooltip:r.columnValidationKey&&!t?"Enabled the validation transform for this to function":""};a.push(o)})),this._tableData.next(a);var r=this.validColumns();if(r){this.addNodeColumns(r,"");var i=[],o=0;r.forEach((function(t){if(n.dexihTableColumns.findIndex((function(e){return e.name===t.name}))<0&&i.findIndex((function(e){return e.name===t.name}))<0){var a=C.i.find((function(e){return e.key===t.deltaType})),r={key:t.key,position:t.position+o,columnStatus:e.datalinkColumnStatus(n,t),name:t.name,dataType:e.hubCache.dataTypeToString(t),deltaType:a?a.name:"Not specified",allowDbNull:t.allowDbNull,logicalName:t.logicalName,isIncrementalUpdate:t.isIncrementalUpdate,securityFlag:t.securityFlag,defaultValue:t.defaultValue,columnValidation:""};i.push(r)}o+=1e3})),this._missingColumnsData.next(i)}this.logger.LogC((function(){return"updateData columns loaded"}),c.b.Trace)}else this.logger.LogC((function(){return"updateData no targetTable specified."}),c.b.Trace),this._tableData.next(null);else this._tableData.next(null)}}},{key:"validColumns",value:function(){var e=this.inputColumns;return this.targetTableForm.controls.nodeDatalinkColumn&&this.targetTableForm.controls.nodeDatalinkColumn.value&&(e=(new m.b).validColumns(this.targetTableForm.controls.nodeDatalinkColumn.value.key,this.inputColumns)),e}},{key:"addMissing",value:function(e){var t=this;this.logger.LogC((function(){return"addMissing started"}),c.b.Trace);var n=this.targetTableForm.controls.table,a=this.validColumns();if(n&&a){var r=n.controls.dexihTableColumns;e.forEach((function(e){var i=null;if(a.forEach((function(t){i||e.key!==t.key||(i=t)})),i){var o=new l.I;Object.assign(o,i),t.resetColumnKeys(o);var s=r.controls.map((function(e){return e.value.position})),u=0===s.length?0:Math.max.apply(Math,_toConsumableArray(s))+1;o.position=u;var c=t.editDatalinkService.hubFormsService.tableColumn(r.value,o);r.push(c),n.markAsDirty(),t.targetTableForm.markAsDirty()}})),this.updateData()}this.logger.LogC((function(){return"addMissing completed"}),c.b.Trace)}},{key:"resetColumnKeys",value:function(e){var t=this;e.key=this.hubCache.getNextSequence(),e.childColumns&&e.childColumns.forEach((function(e){return t.resetColumnKeys(e)}))}},{key:"toggleNewTable",value:function(){if(this.logger.LogC((function(){return"newTable started"}),c.b.Trace),this.newTable){var e=new l.H;this.targetTableForm.setControl("table",this.editDatalinkService.hubFormsService.tableForm(e)),this.targetTableForm.controls.tableKey.setValue(0),this.resetSubscription(),this.addMissing(this._missingColumnsData.value),this.showTableProperties=!0}this.logger.LogC((function(){return"newTable completed"}),c.b.Trace)}},{key:"editColumn",value:function(e){this.columnKey=e.key,this.showColumn=!0}},{key:"newColumn",value:function(e){if(null!==e){var t=this.targetTableForm.controls.table,n=t.controls.dexihTableColumns,a=this.hubCache.newColumn(t.value,e);if(null===a)return void this.authService.informationDialog("Invalid column.","The column ".concat(e," could not be added as it already exists."));var r=this.editDatalinkService.hubFormsService.tableColumn(n.value,a);n.push(r),t.markAsDirty(),this.targetTableForm.markAsDirty()}else this.columnKey=null,this.deltaType=e,this.showColumn=!0}},{key:"resetColumns",value:function(){return e=this,n=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.confirmDialog("Warning reset columns","This will remove and reload all the columns in this table using the last mapped outputs.  Continue?");case 2:if(!e.sent){e.next=5;break}for(t=this.targetTableForm.controls.table.controls.dexihTableColumns;0!==t.length;)t.removeAt(0);case 5:this.addMissing(this.validColumns());case 6:case"end":return e.stop()}}),e,this)})),new((t=void 0)||(t=Promise))((function(a,r){function i(e){try{l(n.next(e))}catch(t){r(t)}}function o(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,o)}l((n=n.apply(e,[])).next())}));var e,t,n}},{key:"deleteColumns",value:function(e){var t=this;e.forEach((function(e){var n=t.targetTableForm.controls.table,a=n.controls.dexihTableColumns,r=a.controls.findIndex((function(t){return t.value.key===e.key}));r>=0&&(a.removeAt(r),n.markAsDirty())})),this.updateData()}},{key:"importTable",value:function(){var e=this,t=this.targetTableForm.controls.table.value;this.hubCache.getConnection(t.connectionKey),this.hubService.importTables([t],!1,this.cancelToken).then((function(t){if(t&&0!==t.length){var n=t[0];n.useLogical=e.hubCache.defaultTableLogicalName(n.schema,n.name)!==n.logicalName;var a=e.editDatalinkService.hubFormsService.tableForm(n);e.targetTableForm.controls.tableKey.setValue(n.key),e.targetTableForm.setControl("table",a)}})).catch((function(e){}))}},{key:"createTable",value:function(){var e=this,t=this.targetTableForm.controls.table.value;this.hubCache.getConnection(t.connectionKey),this.hubService.createTables([t],this.cancelToken).then((function(t){e.hubService.addHubSuccessMessage("The table was created successfully.")})).catch((function(e){}))}},{key:"columnSortChange",value:function(e){this.logger.LogC((function(){return"columns sort change - started "}),c.b.Trace),this.tableFormService.IgnoreFormChange=!0,this.editDatalinkService.hubFormsService.IgnoreFormChange=!0,this.ignoreUpdateTable=!0;var t=this.targetTableForm.controls.table,n=t.controls.dexihTableColumns,a=1;e.forEach((function(e){n.controls.find((function(t){return t.value.key===e.key})).controls.position.setValue(a++)})),t.markAsDirty(),this.editDatalinkService.hubFormsService.IgnoreFormChange=!1,this.tableFormService.IgnoreFormChange=!1,this.ignoreUpdateTable=!1,this.updateData(),this.logger.LogC((function(){return"columns sort change - finished "}),c.b.Trace)}},{key:"columnUpdated",value:function(){this.showColumn=!1,this.updateData()}},{key:"saveTable",value:function(){var e=this;this.hubService.saveTables([this.targetTableForm.controls.table.value]).then((function(t){var n=t[0];e.targetTableForm.setControl("table",e.editDatalinkService.hubFormsService.tableForm(n)),e.targetTableForm.controls.tableKey.setValue(n.key),e.resetSubscription(),e.editDatalinkService.hubFormsService.save(!1)}))}},{key:"apply",value:function(){var e=this;if(this.targetTableForm.dirty){var t=this.datalinkForm.controls.dexihDatalinkTargets,n=t.length;"edit"===this.action&&(n=t.controls.findIndex((function(t){return t.value.key===e.targetKey})),t.removeAt(n)),t.insert(n,this.targetTableForm),t.markAsDirty(),this.canExit=!0,this.authService.navigateUp()}}}]),e}()).\u0275fac=function(e){return new(e||Wi)(s.Kb(u.a),s.Kb(d.a),s.Kb(h),s.Kb(i.a),s.Kb(i.e),s.Kb(g.g))},Wi.\u0275cmp=s.Eb({type:Wi,selectors:[["dexih-datalink-edit-target-table"]],decls:2,vars:2,consts:[[4,"ngIf"],["title","Edit Target Table",3,"showExpandButton"],["header",""],[3,"formGroup",4,"ngIf"],[3,"formsService","isExpanded",4,"ngIf"],[3,"ngIf"],[1,"mr-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-refresh","title","Re-import table from connection.",1,"mr-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-bullseye","title","Drop & re-create the table on the connection.  Warning: This remove all data from the table!",1,"mr-1",3,"click"],[1,"mr-1",3,"disabled","click"],[3,"formsService"],[3,"formGroup"],["label","Create a new table",3,"ngModelOptions","ngModel","ngModelChange"],["label","Target Table","formControlName","tableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the target table",3,"items"],["label","Node level","formControlName","nodeDatalinkColumn","itemKey","key","itemName","name","node","Specify the node where the transform should be applied to.","selectNullMessage","Use top level",3,"items","enableKeySelect","allowNullSelect"],[3,"formsService","isExpanded"],["title","Columns",3,"showExpandButton","padding"],[3,"enableMultiSelect","enableManualSort","enableSort","enableFilter","columns","dataObservable","enableStickyToolbar","toolbarZIndex","onSortChanged","rowClick"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["title","Unused Columns",3,"showExpandButton","padding"],["sortColumn","position",3,"enableMultiSelect","enableFilter","columns","dataObservable","enableStickyToolbar","toolbarZIndex"],["text","Add Column","title","Create a new column","iconClass","fa fa-plus-square","buttonClass","btn-primary",3,"buttonClick"],[1,"dropdown-item",3,"click"],[3,"columns","columnsFormArray","updated",4,"ngIf"],["iconClass","fa fa-retweet",1,"ml-1",3,"click"],[1,"ml-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-refresh","title","Re-import table from connection.",1,"ml-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-bullseye","title","Drop & re-create the table on the connection.  Warning: This remove all data from the table!",1,"ml-1",3,"click"],[3,"columns","columnsFormArray","updated"],["iconClass","fa fa-th-list",1,"ml-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-plus-square","title","Add selected outputs to the target table",3,"click"],[3,"columnKey","tableForm","deltaType","isUpdated"]],template:function(e,t){1&e&&(s.Dc(0,qi,7,4,"div",0),s.Dc(1,zi,2,3,"div",0)),2&e&&(s.hc("ngIf",!t.showColumn),s.yb(1),s.hc("ngIf",t.showColumn))},directives:[r.t,p.T,p.q,p.f,p.a,S.a,g.I,g.t,g.l,p.A,g.s,g.v,p.E,g.j,Ei.a,B.a,p.w,Ki.a,p.j,p.g,Li.a],encapsulation:2}),Wi),Xi=[{path:"",redirectTo:"properties"},{path:"properties",component:T,data:{pageTitle:"Properties",help:"datalink.md"}},{path:"source-table",data:{pageTitle:"Source Table"},children:[{path:"",pathMatch:"full",component:be},{path:"preview-table-data/table/:tableKey",component:ni,data:{pageTitle:"Preview Table",action:"preview"}},{path:"preview-table-data/datalink/:datalinkKey",component:ni,data:{pageTitle:"Preview Datalink",action:"preview"}},{path:"column/:datalinkColumnKey",component:Si,data:{pageTitle:"Edit Column",action:"edit"}},{path:"newcolumn",component:Si,data:{pageTitle:"New Column",action:"new"}},{path:"table-edit/:tableKey",data:{pageTitle:"Edit Table",action:"edit"},loadChildren:function(){return n.e(0).then(n.bind(null,"gQFH")).then((function(e){return e.TableEditModule}))}}]},{path:"target",data:{breadCrumb:!0,pageTitle:"Targets"},children:[{path:"",pathMatch:"full",component:Te},{path:"table-edit/:targetKey",data:{pageTitle:"Edit Target Table",action:"edit"},children:[{path:"",pathMatch:"full",canDeactivate:[Ur],component:Yi},{path:"preview-table-data/:tableKey",component:ni,data:{pageTitle:"Preview Table",action:"preview"}}]},{path:"table-new",data:{pageTitle:"New Target Table",action:"new"},children:[{path:"",pathMatch:"full",canDeactivate:[Ur],component:Yi},{path:"preview-table-data/:tableKey",component:ni,data:{pageTitle:"Preview Table",action:"preview"}}]}]},{path:"transforms",component:vi,data:{pageTitle:"Transforms"},children:[{path:"new/:position",component:yi,data:{pageTitle:"New Transform"}},{path:"transform/:datalinkTransformKey",data:{pageTitle:"Transform"},children:[{path:"",pathMatch:"full",component:En},{path:"table-edit/:tableKey",data:{pageTitle:"Edit Table",action:"edit"},loadChildren:function(){return n.e(0).then(n.bind(null,"gQFH")).then((function(e){return e.TableEditModule}))}},{path:"standard-function-edit",data:{pageTitle:"Standard Function"},canDeactivate:[Ur],component:sr},{path:"standard-function-edit/:functionType",data:{pageTitle:"Standard Function"},canDeactivate:[Ur],component:sr},{path:"standard-function-edit/:functionType/:datalinkTransformItemKey",data:{pageTitle:"Standard Function"},canDeactivate:[Ur],component:sr},{path:"custom-function-edit",data:{pageTitle:"Custom Function",help:"function.md"},canDeactivate:[Ur],component:Kr},{path:"custom-function-edit/:functionType",data:{pageTitle:"Custom Function",help:"function.md"},canDeactivate:[Ur],component:Kr},{path:"custom-function-edit/:functionType/:datalinkTransformItemKey",data:{pageTitle:"Custom Function",help:"function.md"},canDeactivate:[Ur],component:Kr},{path:"mapping-edit/:type",data:{pageTitle:"Mapping Edit"},component:$r},{path:"mapping-edit/:type/:datalinkTransformItemKey",data:{pageTitle:"Mapping Edit"},component:$r},{path:"unGroup-edit",data:{pageTitle:"Un-Group Edit"},component:Vi},{path:"unGroup-edit/:datalinkTransformItemKey",data:{pageTitle:"Un-Group Edit"},component:Vi},{path:"preview-transform-data",data:{pageTitle:"Preview Data"},component:Qr},{path:"transform-table-edit",data:{pageTitle:"Transform Table Edit"},component:li},{path:"column/:datalinkColumnKey",component:Si,data:{pageTitle:"Edit Column",action:"edit"}}]}]},{path:"validation",data:{pageTitle:"Validation"},children:[{path:"",pathMatch:"full",component:Bn,data:{pageTitle:"Validation"}},{path:"standard-function-edit",data:{pageTitle:"Standard Function"},canDeactivate:[Ur],component:sr},{path:"standard-function-edit/:functionType",data:{pageTitle:"Standard Function"},canDeactivate:[Ur],component:sr},{path:"standard-function-edit/:functionType/:datalinkTransformItemKey",data:{pageTitle:"Standard Function"},canDeactivate:[Ur],component:sr},{path:"custom-function-edit",data:{pageTitle:"Custom Function"},canDeactivate:[Ur],component:Kr},{path:"custom-function-edit/:functionType",data:{pageTitle:"Custom Function"},canDeactivate:[Ur],component:Kr},{path:"column/:datalinkColumnKey",component:Si,data:{pageTitle:"Edit Column",action:"edit"}}]},{path:"profile-rules",component:Zn,data:{pageTitle:"Profile Rules"}},{path:"run-plan",component:$n,data:{pageTitle:"Run Plan"}},{path:"result-view/:auditConnectionKey/:auditKey",component:Ni.b,data:{pageTitle:"Detailed Result"}}],eo=i.i.forChild([{path:"new",component:J,canDeactivate:[Ur],data:{action:"new",navigateSkip:!0,pageTitle:"New Datalink"},children:Xi},{path:"edit/:datalinkKey",component:J,canDeactivate:[Ur],data:{action:"edit",navigateSkip:!0,pageTitle:"Edit Datalink"},children:Xi},{path:"copy/:datalinkKey",component:J,canDeactivate:[Ur],data:{action:"copy",navigateSkip:!0,pageTitle:"Copy Datalink"},children:Xi},{path:"sourceTable/:sourceTableKey",component:J,canDeactivate:[Ur],data:{action:"sourceTable",navigateSkip:!0,pageTitle:"Edit Datalink"},children:Xi}]),to=n("PCNd"),no=n("RRRx"),ao=n("vSNy"),ro=n("mCXf"),io=((Qi=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(){return{ngModule:e,providers:[h,f.a]}}}]),e}()).\u0275mod=s.Ib({type:Qi}),Qi.\u0275inj=s.Hb({factory:function(e){return new(e||Qi)},providers:[h,f.a,Ur],imports:[[to.a,r.c,g.n,g.C,eo,no.a,ao.a,ro.a]]}),Qi)}}]);
//# sourceMappingURL=14-es5.79fc01d828f369459841.js.map