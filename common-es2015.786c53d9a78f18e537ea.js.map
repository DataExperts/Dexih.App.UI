{"version":3,"sources":["webpack:///src/app/shared/index.ts","webpack:///src/app/shared/forms/forms.service.ts","webpack:///src/app/+hub/table/table-edit/table-edit.component.html","webpack:///src/app/+hub/table/table-edit/table-edit.component.ts","webpack:///src/app/+hub/table/table-edit/table-column-edit/table-column-edit.component.ts","webpack:///src/app/+hub/table/table-edit/table-column-edit/table-column-edit.component.html","webpack:///src/app/+hub/table/table-edit/table-edit-main.component.ts","webpack:///src/app/+hub/table/table-edit/table-edit-main.component.html","webpack:///src/app/+hub/table/table-edit/table-edit.routing.ts","webpack:///src/app/+hub/table/table-edit/table-edit.module.ts","webpack:///src/app/+hub/table/table-edit/table-edit-preview-data/table-edit-preview-data.component.html","webpack:///src/app/+hub/table/table-edit/table-edit-preview-data/table-edit-preview-data.component.ts"],"names":["FormsService","fb","_currentFormObservable","formErrors","hasChanged","formSaving","showAllErrors","validationMessages","validationFieldMessages","this","clearFormSubscriptions","_valueChangesSubscription","unsubscribe","_changesSubscription1","_changesSubscription2","_changesSubscription3","_changesSubscription4","_changesSubscription5","item","template","newForm","group","addMissing","startForm","form","itemTemplate","keys","Object","existingKeys","controls","forEach","key","findIndex","c","control","setValue","addControl","currentForm","next","valueChanges","pipe","subscribe","data","onValueChanged","asObservable","field","get","dirty","valid","messages","errors","message","minlength","actualLength","requiredLength","maxlength","value","maxvalue","requiredValue","minvalue","formsService","TableEditComponent","hubService","authService","route","router","eConnectionCategory","cancelToken","isLoaded","_subscription","combineLatest","params","getHubCacheObservable","result","hubCache","action","pageTitle","status","Loaded","confirmDialog","then","confirm","load","catch","reason","e","addHubClientErrorMessage","_hubCacheChangeSubscription","_formChangeSubscription","cancel","ngOnDestroy","tableKey","hub","dexihDatajobs","table","getTable","connection","getConnection","connectionKey","addHubErrorMessage","newTable","getCurrentFormObservable","tableForm","history","pushState","newUrl","window","location","pathname","replace","navigateByUrl","navigateUp","tables","createPaths","addHubSuccessMessage","Promise","resolve","$event","returnValue","close","TableColumnEditComponent","formService","detailedView","queryParams","columnKey","navigate","relativeTo","parent","isUpdated","changeColumn","TableEditMainComponent","Routing","forChild","path","component","canDeactivate","children","redirectTo","navigateSkip","TableEditModule","ngModule","providers","TableEditPreviewDataComponent","eDataObjectType"],"mappings":"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","file":"x","sourcesContent":["export {SharedModule} from './shared.module';\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { FormBuilder, FormGroup, FormArray, FormControl, Validators, ValidatorFn, AbstractControl } from '@angular/forms';\nimport { Subscription, BehaviorSubject, Observable, combineLatest} from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\n@Injectable()\nexport class FormsService implements OnDestroy {\n  private _valueChangesSubscription: Subscription;\n\n  private _changesSubscription1: Subscription;\n  private _changesSubscription2: Subscription;\n  private _changesSubscription3: Subscription;\n  private _changesSubscription4: Subscription;\n  private _changesSubscription5: Subscription;\n\n  public currentForm: FormGroup;\n  private _currentFormObservable = new BehaviorSubject<FormGroup>(null);\n  public formErrors = {};\n  public hasChanged = false;\n  public formSaving = false;\n  public showAllErrors = false;\n\n  private saveMethod: string;\n\n  validationMessages = {\n    'required': 'A value is required.',\n    'duplicateName': 'The value is already being used.'\n  };\n\n  validationFieldMessages = {\n\n  };\n\n  constructor(\n    private fb: FormBuilder,\n  ) {\n  }\n\n  ngOnDestroy() {\n    this.clearFormSubscriptions();\n  }\n\n  public clearFormSubscriptions() {\n    if (this._valueChangesSubscription) { this._valueChangesSubscription.unsubscribe(); }\n    if (this._changesSubscription1) { this._changesSubscription1.unsubscribe(); }\n    if (this._changesSubscription2) { this._changesSubscription2.unsubscribe(); }\n    if (this._changesSubscription3) { this._changesSubscription3.unsubscribe(); }\n    if (this._changesSubscription4) { this._changesSubscription4.unsubscribe(); }\n    if (this._changesSubscription5) { this._changesSubscription5.unsubscribe(); }\n  }\n\n  public createDefault(item: any, template: any) {\n    const newForm = this.fb.group({ });\n    this.addMissing(item, newForm, template);\n    this.startForm(newForm);\n  }\n\n  public addMissing(item: any, form: FormGroup, itemTemplate: any) {\n    let keys = Object.keys(itemTemplate);\n    let existingKeys = Object.keys(form.controls);\n    keys.forEach(key => {\n      if (existingKeys.findIndex(c => c === key) >= 0) {\n        // skip items already added.\n      } else {\n        let control = new FormControl(key);\n        control.setValue(item[key]);\n        form.addControl(key, control);\n      }\n    });\n  }\n\n  public startForm(form: FormGroup) {\n    this.currentForm = form;\n    this._currentFormObservable.next(form);\n\n    if (this._valueChangesSubscription) { this._valueChangesSubscription.unsubscribe(); }\n\n    // when a value changes, update the errors.\n    this._valueChangesSubscription = this.currentForm.valueChanges\n        .pipe(debounceTime(500))\n        .subscribe(data => {\n          this.onValueChanged(data);\n        });\n\n    this.onValueChanged(); // (re)set validation messages now\n\n    this.hasChanged = false;\n  }\n\n  public getCurrentFormObservable(): Observable<FormGroup> {\n    return this._currentFormObservable.asObservable();\n  }\n\n  private onValueChanged(data?: any) {\n    if (!this.currentForm) { return; }\n    const form = this.currentForm;\n\n    this.hasChanged = true;\n\n      for (const field of Object.keys(this.currentForm.controls)) {\n        // clear previous error message (if any)\n        this.formErrors[field] = '';\n        const control = form.get(field);\n\n        // if the control is dirty or flag is set to show all errors.\n        if (control && (control.dirty || this.showAllErrors)) {\n          if (!control.valid) {\n            const messages = this.validationFieldMessages[field];\n            if (control.errors) {\n            for (const key of Object.keys(control.errors)) {\n              if (messages && messages[key]) {\n                this.formErrors[field] += messages[key] + ' ';\n              } else if (this.validationMessages[key]) {\n                this.formErrors[field] += this.validationMessages[key] + ' ';\n              } else {\n                let message: string;\n\n                switch (key) {\n                  case 'minlength':\n                    message = 'Value is ' +\n                      control.errors.minlength.actualLength +\n                      ' charaters long, required minimum length is '\n                      + control.errors.minlength.requiredLength + ' characters.';\n                    break;\n                  case 'maxlength':\n                    message = 'Value is ' +\n                      control.errors.maxlength.actualLength +\n                      ' charaters long, required maximum length is '\n                      + control.errors.maxlength.requiredLength + ' characters.';\n                    break;\n                  case 'maxvalue':\n                    message = 'Value is ' +\n                      control.value +\n                      ' required maximum is '\n                      + control.errors.maxvalue.requiredValue + '.';\n                    break;\n                  case 'minvalue':\n                    message = 'Value is ' +\n                      control.value +\n                      ' required minimum is '\n                      + control.errors.minvalue.requiredValue + '.';\n                    break;\n                  case 'email':\n                    message = 'Value is not a valid email address.';\n                    break;\n                  case 'passwordMatch':\n                    message = 'The passwords do not match.';\n                    break;\n                  case 'pattern':\n                    message = 'Passwords must have one upper, lower, number, and symbol.';\n                    break;\n                  default:\n                    message = 'Field error: ' + key;\n                }\n                this.formErrors[field] += message + ' ';\n              }\n            }\n          } else {\n            // this.formErrors[field] = 'Invalid value';\n          }\n          }\n        }\n      }\n  }\n\n  public showErrors() {\n    this.showAllErrors = true;\n    this.onValueChanged();\n  }\n\n}\n","\n<div class=\"container-fluid\">\n    <dexih-widget \n    [title]=\"'Edit Table ('  + formsService.currentForm?.controls?.name?.value +')'\" \n    iconClass=\"fa fa-lg fa-fw fa-table\" \n    [showCloseButton]=\"true\"\n    (close)=\"close()\"\n    >\n        <ng-template #header>\n            <dexih-invalid-form-details class=\"mr-1\" [control]=\"formsService.currentForm\" (click)=\"formsService.showErrors()\"></dexih-invalid-form-details>\n            <actions-table-button class=\"mr-1\" [showEdit]=\"false\" [tables]=\"this.formsService?.currentForm?.value ? [this.formsService?.currentForm?.value] : []\" (changedTables)=\"changedTables($event)\"></actions-table-button>\n            <dexih-button class=\"mr-1\" *ngIf=\"hubCache?.canWrite && connectionReference?.connectionCategory == eConnectionCategory.File\" \n            (click)=\"createPaths()\" title=\"Create the file paths (or folders).\" iconClass=\"fa fa-folder-open\" buttonClass='btn-primary'>\n                Create Paths\n            </dexih-button>\n            <save-button class=\"mr-1\" *ngIf=\"hubCache?.canWrite\" [formsService]=\"formsService\"></save-button>\n            <cancel-button [formsService]=\"formsService\"></cancel-button>\n        </ng-template>\n\n        <div>\n        <router-outlet></router-outlet>\n    </div>\n    </dexih-widget>\n</div>\n\n\n","import { HostListener, Component, OnInit, OnDestroy } from '@angular/core';\nimport { ActivatedRoute, Router, Params } from '@angular/router';\nimport { HubService } from '../../hub.service';\nimport { AuthService } from '../../../+auth/auth.service';\nimport { Subscription, combineLatest} from 'rxjs';\nimport { HubFormsService } from '../../hub.forms.service';\nimport { DexihConnection, eConnectionCategory, DexihTable } from '../../../shared/shared.models';\nimport { HubCache, eCacheStatus } from '../../hub.models';\nimport { CancelToken } from '../../../+auth/auth.models';\n\n@Component({\n  selector: 'dexih-table-edit-form',\n  templateUrl: './table-edit.component.html'\n})\nexport class TableEditComponent implements OnInit, OnDestroy {\n  public tableKey: number;\n  public connectionKey: number;\n  public connection: DexihConnection;\n\n  eConnectionCategory = eConnectionCategory;\n\n  private hubCache: HubCache;\n  public action: string; // new or edit\n  public pageTitle: string;\n  public params: Params;\n\n  public cancelToken: CancelToken = new CancelToken();\n\n  private _subscription: Subscription;\n  private _hubCacheChangeSubscription: Subscription;\n  private _formChangeSubscription: Subscription;\n  private isLoaded = false;\n\n\n  constructor(private hubService: HubService,\n    public formsService: HubFormsService,\n    private authService: AuthService,\n    private route: ActivatedRoute,\n    private router: Router) {\n  }\n\n  ngOnInit() {\n    try {\n      this._subscription = combineLatest(\n        this.route.data,\n        this.route.params,\n        this.hubService.getHubCacheObservable(),\n      ).subscribe(result => {\n        let data = result[0];\n        this.params = result[1];\n        this.hubCache = result[2];\n\n        this.action = data['action'];\n        this.pageTitle = data['pageTitle'];\n\n        if (!this.hubCache || this.hubCache.status !== eCacheStatus.Loaded ) { return; }\n\n        if (this.isLoaded && this.action === 'new') { return; }\n\n        if (this.isLoaded && this.formsService.hasChanged) {\n            this.authService.confirmDialog('Synchronization warning',\n            'The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?')\n            .then(confirm => {\n                if (confirm) {\n                    this.load();\n                }\n            }).catch(reason => {\n                return;\n            });\n        } else {\n            this.load();\n        }\n\n      });\n    } catch (e) {\n      this.hubService.addHubClientErrorMessage(e, 'Table Edit');\n    }\n  }\n\n  ngOnDestroy() {\n    if (this._hubCacheChangeSubscription) { this._hubCacheChangeSubscription.unsubscribe(); }\n    if (this._formChangeSubscription) { this._formChangeSubscription.unsubscribe(); }\n    if (this._subscription) { this._subscription.unsubscribe(); }\n    this.cancelToken.cancel();\n\n    // shut down service\n    this.formsService.ngOnDestroy();\n  }\n\n  load() {\n    this.isLoaded = true;\n\n    if (this.action === 'edit') {\n      // get the hub key from the route data, and update the service.\n      this.tableKey = + this.params['tableKey'];\n\n      if (!this.tableKey) {\n        this.hubService.addHubErrorMessage('There was no table specified to edit.');\n      } else {\n        if (!this.hubCache.hub || !this.hubCache.hub.dexihDatajobs) {\n          this.hubService.addHubErrorMessage('The hub cache is not loaded.');\n        } else {\n\n          let table = this.hubCache.getTable(this.tableKey);\n          if (!table) {\n            this.hubService.addHubErrorMessage('The specified table could not be found.');\n          } else {\n            this.connection = this.hubCache.getConnection(table.connectionKey);\n            this.formsService.table(table);\n          }\n        }\n      }\n    }\n\n    if (this.action === 'new') {\n      let table: DexihTable;\n      if (this.hubService.newTable) {\n        table = this.hubService.newTable;\n        this.hubService.newTable = null;\n      } else {\n        this.connectionKey = + this.params['connectionKey'];\n\n        table = new DexihTable();\n        table.key = 0;\n        table.connectionKey = this.connectionKey;\n      }\n      this.formsService.table(table);\n\n      // update the url with the saved key\n      this._formChangeSubscription = this.formsService.getCurrentFormObservable().subscribe(tableForm => {\n        let key = tableForm.controls.key.value;\n        if (key) {\n          if (history.pushState) {\n            let newUrl = window.location.pathname.replace('/table-new', `/table-edit/${key}`)\n            this.router.navigateByUrl(newUrl);\n            this._formChangeSubscription.unsubscribe();\n          }\n        }\n      });\n    }\n  }\n\n  close() {\n    this.authService.navigateUp();\n  }\n\n  changedTables(tables) {\n    this.formsService.table(tables[0]);\n  }\n\n  createPaths() {\n    this.hubService.createPaths(this.formsService.currentForm.value, this.cancelToken).then(() => {\n      this.hubService.addHubSuccessMessage('The paths have been created.');\n    }).catch();\n  }\n\n\n  public canDeactivate(): Promise<boolean> {\n    return new Promise<boolean>((resolve) => {\n      if (this.formsService.hasChanged) {\n        this.authService.confirmDialog('The table has not been saved',\n          'The table changes have not been saved.  Do you want to discard the changes and exit?')\n          .then((confirm) => {\n              resolve(confirm);\n            }).catch(() => {\n              resolve(false);\n            });\n      } else {\n        resolve(true);\n      }\n    });\n  }\n\n  // @HostListener allows is to guard against browser refresh, close, etc.\n  @HostListener('window:beforeunload', ['$event'])\n  unloadNotification($event: any) {\n    if (this.formsService.hasChanged) {\n      $event.returnValue = 'The table changes have not been saved.  Do you want to discard the changes and exit?';\n    }\n  }\n}\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { AuthService } from '../../../../+auth/auth.service';\nimport { HubService } from '../../../hub.service';\nimport { Location } from '@angular/common';\nimport { FormGroup } from '@angular/forms';\nimport { Subscription, combineLatest} from 'rxjs';\nimport { HubFormsService } from '../../../hub.forms.service';\n\n@Component({\n    selector: 'dexih-table-column-edit',\n    templateUrl: './table-column-edit.component.html',\n})\nexport class TableColumnEditComponent implements OnInit, OnDestroy {\n    private _subscription: Subscription;\n\n    public tableForm: FormGroup;\n    public columnKey: number;\n    public detailedView = true;\n\n    public pageTitle: string;\n    public action: string;\n\n\n    constructor(\n        private authService: AuthService,\n        private hubService: HubService,\n        public formService: HubFormsService,\n        private route: ActivatedRoute,\n        private router: Router        ) {\n    }\n\n    ngOnInit() {\n\n        try {\n            this._subscription = combineLatest(\n                this.route.data,\n                this.route.params,\n                this.route.queryParams,\n                this.formService.getCurrentFormObservable()\n            ).subscribe(result => {\n                let data = result[0];\n                let params = result[1];\n                let queryParams = result[2];\n                this.tableForm = result[3];\n\n                this.pageTitle = data['pageTitle'];\n                this.action = data['action'];\n\n                this.columnKey = +params['columnKey'];\n                this.detailedView = queryParams['detailed'] === 'false' ? false : true;\n            });\n        } catch (e) {\n            this.hubService.addHubClientErrorMessage(e, 'Table Column Edit');\n        }\n\n    }\n\n    ngOnDestroy() {\n        if (this._subscription) { this._subscription.unsubscribe(); }\n    }\n\n    isUpdated() {\n        this.authService.navigateUp();\n    }\n\n    changeColumn(columnKey: number) {\n        this.router.navigate(['column', columnKey], {relativeTo: this.route.parent});\n    }\n\n}\n","<column-edit [tableForm]=\"tableForm\" [columnKey]=\"columnKey\" [detailedView]=\"detailedView\" (isUpdated)=\"isUpdated()\" (changeColumn)=\"changeColumn($event)\"></column-edit>\n\n ","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { HubFormsService } from '../../hub.forms.service';\n\n@Component({\n  selector: 'dexih-table-edit-form',\n  templateUrl: './table-edit-main.component.html'\n})\nexport class TableEditMainComponent implements OnInit, OnDestroy {\n\n  constructor(\n    public formsService: HubFormsService,\n  ) { }\n\n  ngOnInit() {\n  }\n\n  ngOnDestroy() {\n  }\n}\n","<dexih-table-edit-properties [formsService]='formsService'></dexih-table-edit-properties>\n<table-edit-columns [tableForm]='formsService.currentForm'></table-edit-columns>\n","import { Routes, RouterModule } from '@angular/router';\nimport { TableEditComponent } from './table-edit.component';\nimport { TableColumnEditComponent } from './table-column-edit/table-column-edit.component';\nimport { ItemEditGuard } from '../../item-edit.guard';\nimport { TableEditPreviewDataComponent } from './table-edit-preview-data';\nimport { TableEditMainComponent } from './table-edit-main.component';\nimport { FileFormatEditComponent } from '../../fileFormat';\n\nexport const tableEditRoutes = [\n        { path: '', redirectTo: 'properties'},\n        { path: 'properties', component: TableEditMainComponent,  data: { navigateSkip: true} },\n        { path: 'column', component: TableColumnEditComponent, data: { pageTitle: 'Edit Column' } },\n        { path: 'column/:columnKey', component: TableColumnEditComponent, data: { pageTitle: 'Edit Column' } },\n        { path: 'table-preview/:tableKey', component: TableEditPreviewDataComponent, data: { pageTitle: 'Preview' } },\n        { path: 'fileFormat-new', component: FileFormatEditComponent, data: { action: 'new', pageTitle: 'New File Format'}},\n];\n\nexport const routes: Routes = [\n        { path: '', component: TableEditComponent, canDeactivate: [ItemEditGuard], children: tableEditRoutes},\n];\n\nexport const Routing = RouterModule.forChild(routes);\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SharedModule } from '../../../shared/shared.module';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { Routing } from './table-edit.routing';\nimport { TableEditComponent } from './table-edit.component';\nimport { TableEditMainComponent } from './table-edit-main.component';\nimport { HubSharedModule } from '../../hub.shared.module';\nimport { ItemEditGuard } from '../../item-edit.guard';\nimport { HubFormsService } from '../../hub.forms.service';\nimport { TableColumnEditComponent } from './table-column-edit/table-column-edit.component';\nimport { TableSharedModule } from '../table.shared.module';\n\n@NgModule({\n    imports: [\n        SharedModule,\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        Routing,\n        HubSharedModule,\n        TableSharedModule\n    ],\n    declarations: [\n      TableEditComponent,\n      TableEditMainComponent,\n      TableColumnEditComponent,\n    ],\n    providers: [\n        HubFormsService,\n        ItemEditGuard\n        ],\n    exports: [\n    ]\n})\nexport class TableEditModule {\n    static forRoot(): ModuleWithProviders<TableEditModule> {\n        return {\n            ngModule: TableEditModule,\n            providers: [ HubFormsService ]\n        };\n    }\n}\n","<dexih-widget-section title=\"Preview Table\" [showExpandButton]=\"false\" [padding]=\"false\">\n    <ng-template #header>\n        <dexih-button-close (click)=\"close()\"></dexih-button-close>\n    </ng-template>\n        <preview-data [table]='table' [viewSource]='eDataObjectType.Table'></preview-data>\n</dexih-widget-section>","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { HubService } from '../../../hub.service';\nimport { AuthService } from '../../../../+auth/auth.service';\nimport { Subscription, combineLatest} from 'rxjs';\nimport { ActivatedRoute } from '@angular/router';\nimport { HubFormsService } from '../../../hub.forms.service';\nimport { DexihTable, eDataObjectType } from '../../../../shared/shared.models';\n\n@Component({\n\n    selector: 'table-edit-preview-data',\n    templateUrl: './table-edit-preview-data.component.html'\n})\nexport class TableEditPreviewDataComponent implements OnInit, OnDestroy {\n    private _subscription: Subscription;\n\n    public table: DexihTable;\n    public action: string; // new or edit\n    public pageTitle: string;\n    public message: string;\n\n    public eDataObjectType = eDataObjectType;\n\n    constructor(\n        public formsService: HubFormsService,\n        private hubService: HubService,\n        private authService: AuthService,\n        private route: ActivatedRoute) {\n\n    }\n\n    ngOnInit() {\n        try {\n            this._subscription = combineLatest(\n                this.route.data,\n                this.hubService.getHubCacheObservable(),\n                this.formsService.getCurrentFormObservable(),\n            ).subscribe(result => {\n                let data = result[0];\n                let tableForm = result[2];\n\n                this.action = data['action'];\n                this.pageTitle = data['pageTitle'];\n\n                if (tableForm) {\n                    this.table = tableForm.value;\n                }\n            });\n        } catch (e) {\n            this.hubService.addHubClientErrorMessage(e, 'Table Edit Preview');\n        }\n    }\n\n    ngOnDestroy() {\n        if (this._subscription) { this._subscription.unsubscribe(); }\n    }\n\n    close() {\n        this.authService.navigateUp();\n    }\n}\n"]}