{"version":3,"sources":["webpack:///src/app/+hub/datajob/datajob-edit/datajob-edit.component.html","webpack:///src/app/+hub/datajob/datajob-edit/datajob-edit.component.ts","webpack:///src/app/+hub/datajob/datajob-edit/properties/datajob-edit-properties.component.html","webpack:///src/app/+hub/datajob/datajob-edit/properties/datajob-edit-properties.component.ts","webpack:///src/app/+hub/datajob/datajob-edit/trigger-edit/dexih-form-daysofweek.component.html","webpack:///src/app/+hub/datajob/datajob-edit/trigger-edit/dexih-form-daysofweek.component.ts","webpack:///src/app/+hub/datajob/datajob-edit/trigger-edit/datajob-edit-trigger.component.html","webpack:///src/app/+hub/datajob/datajob-edit/trigger-edit/datajob-edit-trigger.component.ts","webpack:///src/app/+hub/datajob/datajob-edit/step-edit/datajob-edit-step.component.html","webpack:///src/app/+hub/datajob/datajob-edit/step-edit/datajob-edit-step.component.ts","webpack:///src/app/+hub/datajob/datajob-edit/steps-add/datajob-add-steps.component.html","webpack:///src/app/+hub/datajob/datajob-edit/steps-add/datajob-add-steps.component.ts","webpack:///src/app/+hub/datajob/datajob-edit/datajob-edit-guard.ts","webpack:///src/app/+hub/datajob/datajob-edit/datajob-edit.routing.ts","webpack:///src/app/+hub/datajob/datajob-edit/datajob-edit.module.ts"],"names":["formsService","DatajobEditComponent","hubService","authService","route","router","isLoaded","this","_subscription","combineLatest","data","params","getHubCacheObservable","subscribe","result","hubCache","action","pageTitle","status","Loaded","hasChanged","confirmDialog","then","confirm","load","catch","reason","e","addHubClientErrorMessage","_hubCacheChangeSubscription","unsubscribe","_formChangeSubscription","ngOnDestroy","datajobKey","hub","dexihDatajobs","datajob","find","c","key","addHubErrorMessage","newDatajob","createDefaultDatajob","getCurrentFormObservable","form","controls","value","history","pushState","newUrl","window","location","pathname","replace","navigateByUrl","Promise","resolve","$event","returnValue","DatajobEditPropertiesComponent","formService","showAllErrors","failActions","Continue","name","ContinueNonDependent","Abend","datajobChanged","triggerColumns","title","format","_triggerTableData","BehaviorSubject","triggerTableData","asObservable","stepColumns","tags","_stepTableData","stepTableData","eAlertLevelItems","eAlertLevel","isFirst","mainForm","managedConnections","getManagedConnections","updateTriggers","updateSteps","updateDependencies","triggerData","forEach","triggerControl","trigger","push","details","getTriggerDetails","updateDate","errors","valid","next","stepData","sort","a","b","position","stepControl","step","datalink","dexihDatalinks","datalinkKey","getObjectTags","Datalink","dependencies","getDependencies","dexihDatalinkDependencies","inputs","getInputs","dexihDatalinkStepColumns","items","steps","item","index","setValue","depString","dep","dexihDatalinkSteps","dependentDatalinkStepKey","columns","column","defaultValue","navigate","relativeTo","parent","triggers","triggersArray","dexihTriggers","findIndex","removeAt","stepsArray","clear","stepTargets","minKey","tables","getDatalinkTargetTables","sourceTables","getDatalinkSourceTables","stepTarget","t","indexOf","datalinkStepKey","datalinkDependencyFormGroup","dexihDatalinkTargets","map","tableKey","getDatalinkTable","sourceDatalinkTable","dexihDatalinkTransforms","transform","joinDatalinkTable","datalinkTable","sourceType","Table","sourceTableKey","sourceDatalinkKey","editTrigger","stepSortChanged","editDatalinkStep","sharedFunctions","DexihFormDaysOfWeekComponent","_changeDetectionRef","eDayOfWeek","daysOfWeek","Array","id","Math","random","toString","substr","onChange","onTouched","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","detectChanges","fn","provide","useExisting","multi","selectAllDays","selectNoDays","selectWeekend","selectWeekDays","DatajobEditTriggerComponent","fb","triggerFormService","triggerForm","triggerKey","originalTrigger","navigateUp","triggerFormGroup","startForm","currentForm","DatajobEditStepComponent","stepFormService","datajobForm","stepForm","datalinkStepFormGroup","_datalinkSubscription","valueChanges","updateDatalinkStepColumns","stepParameters","parameters","currentParameters","parameter","currentParameter","newParameter","newFormParameter","stepColumnsForm","length","dexihDatalinkColumns","filter","isInput","col","stepColumn","dataType","logicalName","columnGroup","rank","maxLength","deltaType","allowDbNull","isUnicode","isValid","stepColumnForm","datalinkStepColumnFormGroup","datalinkDependencies","newDep","oldDep","insert","DatajobAddStepsComponent","enum","_tableData","tableData","updateDatalinks","datalinks","d","sourceTable","getTable","datalinkType","sourceTableName","targetTableName","target","table","join","getHubCacheChangeObservable","hubCacheChange","changeClass","existingDatalinks","formDexihDatalinkSteps","names","addSelectedConfirmed","newDatalinkStep","i","stepFormGroup","DatajobEditGuard","component","canDeactivate","Routing","forChild","path","children","redirectTo","navigateSkip","DatajobEditModule","ngModule","providers"],"mappings":"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","file":"x","sourcesContent":["<div class=\"container\">\n    <dexih-widget title=\"Edit Job\" iconClass=\"fa fa-lg fa-fw fa-cog\">\n\n        <ng-template #header>\n            <dexih-invalid-form-details class=\"mr-1\" [control]=\"formsService.currentForm\"\n                (click)=\"formsService.showErrors()\"></dexih-invalid-form-details>\n            <save-button *ngIf=\"hubCache?.canWrite\" class=\"mr-1\" [formsService]=\"formsService\"></save-button>\n            <cancel-button class=\"mr-1\" [formsService]=\"formsService\"></cancel-button>\n        </ng-template>\n\n        <div>\n            <router-outlet></router-outlet>\n        </div>\n    </dexih-widget>\n</div>\n","import { HostListener, Component, OnInit, OnDestroy } from '@angular/core';\nimport { ActivatedRoute, Route, Router, Params } from '@angular/router';\nimport { HubCache, eCacheStatus } from '../../hub.models';\nimport { HubService } from '../../hub.service';\nimport { AuthService } from '../../../+auth/auth.service';\nimport { Subscription, combineLatest} from 'rxjs';\nimport { HubFormsService } from '../../hub.forms.service';\nimport { DexihDatajob } from '../../../shared/shared.models';\n\n@Component({\n  selector: 'dexih-datajob-edit-form',\n  templateUrl: './datajob-edit.component.html'\n})\nexport class DatajobEditComponent implements OnInit, OnDestroy {\n  public datajobKey: number;\n\n  public hubCache: HubCache;\n  public action: string; // new or edit\n  public pageTitle: string;\n  public params: Params;\n\n  private _subscription: Subscription;\n  private _formChangeSubscription: Subscription;\n  private _hubCacheChangeSubscription: Subscription;\n  private isLoaded = false;\n\n\n  constructor(private hubService: HubService,\n    public formsService: HubFormsService,\n    private authService: AuthService,\n    private route: ActivatedRoute,\n    private router: Router) {\n  }\n\n  ngOnInit() {\n    try {\n      this._subscription = combineLatest(\n        this.route.data,\n        this.route.params,\n        this.hubService.getHubCacheObservable(true),\n      ).subscribe(result => {\n        let data = result[0];\n        this.params = result[1];\n        this.hubCache = result[2];\n\n        this.action = data['action'];\n        this.pageTitle = data['pageTitle'];\n\n        if (!this.hubCache || this.hubCache.status !== eCacheStatus.Loaded ) { return; }\n\n        if (this.isLoaded && this.action === 'new') { return; }\n\n        if (this.isLoaded && this.formsService.hasChanged) {\n            this.authService.confirmDialog('Synchronization warning',\n            'The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?')\n            .then(confirm => {\n                if (confirm) {\n                    this.load();\n                }\n            }).catch(reason => {\n                return;\n            });\n        } else {\n            this.load();\n        }\n\n\n      });\n    } catch (e) {\n      this.hubService.addHubClientErrorMessage(e, 'Datajob Edit');\n    }\n\n\n  }\n\n  ngOnDestroy() {\n    if (this._hubCacheChangeSubscription) { this._hubCacheChangeSubscription.unsubscribe(); }\n    if (this._subscription) { this._subscription.unsubscribe(); }\n    if (this._formChangeSubscription) { this._formChangeSubscription.unsubscribe(); }\n\n    this.formsService.ngOnDestroy();\n  }\n\n  load() {\n    this.isLoaded = true;\n\n    if (this.action === 'edit') {\n      // get the hub key from the route data, and update the service.\n      this.datajobKey = + this.params['datajobKey'];\n\n      if (!this.datajobKey) {\n        this.hubService.addHubErrorMessage('There was no datajob specified to edit.');\n      } else {\n        if (!this.hubCache.hub || !this.hubCache.hub.dexihDatajobs) {\n          this.hubService.addHubErrorMessage('The hub cache is not loaded.');\n        } else {\n\n          let datajob = this.hubCache.hub.dexihDatajobs.find(c => c.key === this.datajobKey);\n          if (!datajob) {\n            this.hubService.addHubErrorMessage('The specified datajob could not be found.');\n          } else {\n            this.formsService.datajob(datajob);\n          }\n        }\n      }\n    }\n\n    if (this.action === 'new') {\n      let datajob: DexihDatajob;\n      if (this.hubService.newDatajob) {\n        datajob = this.hubService.newDatajob;\n        this.hubService.newDatajob = null;\n      } else {\n        datajob = this.hubService.createDefaultDatajob();\n        datajob.key = 0;\n      }\n\n      this.formsService.datajob(datajob);\n\n      // update the url with the saved key\n      this._formChangeSubscription = this.formsService.getCurrentFormObservable().subscribe(form => {\n        let key = form.controls.key.value;\n        if (key) {\n          if (history.pushState) {\n            let newUrl = window.location.pathname.replace('/datajob-new', `/datajob-edit/${key}`)\n            this.router.navigateByUrl(newUrl);\n            this._formChangeSubscription.unsubscribe();\n          }\n        }\n      });\n    }\n  }\n\n  public canDeactivate(): Promise<boolean> {\n    return new Promise<boolean>((resolve) => {\n      if (this.formsService.hasChanged) {\n        this.authService.confirmDialog('The data job has not been saved',\n          'The datajob changes have not been saved.  Do you want to discard the changes and exit?')\n          .then((confirm) => {\n              resolve(confirm);\n            }).catch(() => {\n              resolve(false);\n            });\n      } else {\n        resolve(true);\n      }\n    });\n  }\n\n  // @HostListener allows is to guard against browser refresh, close, etc.\n  @HostListener('window:beforeunload', ['$event'])\n  unloadNotification($event: any) {\n    if (this.formsService.hasChanged) {\n      $event.returnValue = 'The datajob changes have not been saved.  Do you want to discard the changes and exit?';\n    }\n  }\n}\n","<dexih-widget-section title=\"Properties\" [showExpandButton]=\"true\">\n    <form *ngIf=\"mainForm\" [formGroup]=\"mainForm\">\n        <fieldset>\n            <section>\n                <form-input label=\"Data Job Name\" formControlName=\"name\" placeholder=\"Enter the job name.\"\n                    [autocapitalize]=\"true\" iconClass=\"fa fa-list\" [errors]=\"formService.formErrors.name\">\n                </form-input>\n            </section>\n\n            <section>\n                <form-textarea label=\"Description\" [showMarkdown]=\"true\" formControlName=\"description\"\n                    placeholder=\"Enter the description.\" [errors]=\"formService.formErrors.description\">\n                </form-textarea>\n            </section>\n\n            <section>\n                <form-select label=\"Datalink Fail Action\" formControlName=\"failAction\" [items]=\"failActions\"\n                    itemKey=\"key\" itemName=\"name\" iconClass=\"fa fa-database\"\n                    [errors]=\"formService.formErrors.failAction\" note=\"Action to take when a datalink execution fails.\"\n                    [enableFilter]=\"false\">\n                </form-select>\n            </section>\n\n            <section>\n                <form-select label=\"Alerting Level\" formControlName=\"alertLevel\" [items]=\"eAlertLevelItems\"\n                    itemKey=\"key\" itemName=\"description\" iconClass=\"fa fa-bell\"\n                    [errors]=\"formService.formErrors.alertLevel\" note=\"When alerts should be sent.\"\n                    [enableFilter]=\"false\">\n                </form-select>\n            </section>\n\n            <section>\n                <form-select label=\"Audit Connection\" formControlName=\"auditConnectionKey\" [items]=\"managedConnections\"\n                    itemKey=\"key\" itemName=\"name\" iconClass=\"fa fa-database\"\n                    [errors]=\"formService.formErrors.auditConnectionKey\"\n                    note='Specify the connection where audit data (such as job results) should be written to.'\n                    [errors]=\"formService.formErrors.auditConnectionKey\">\n                    <connection-edit-button [key]=\"mainForm.controls.auditConnectionKey.value\"></connection-edit-button>\n                </form-select>\n            </section>\n\n            <section class=\"col col-12\">\n                <form-checkbox label=\"Trigger datajob when new files arrive\" formControlName=\"fileWatch\">\n                </form-checkbox>\n            </section>\n\n            <section class=\"col col-12\">\n                <form-checkbox label=\"Auto Start\" formControlName=\"autoStart\"\n                    note=\"Re-activate the datajob when the remote agent is restarted.\">\n                </form-checkbox>\n            </section>\n        </fieldset>\n    </form>\n</dexih-widget-section>\n\n<dexih-widget-section title=\"Parameters\" [showExpandButton]=\"true\" [padding]=\"true\" [padding]=\"true\">\n    <input-parameters *ngIf=\"mainForm\" [showEdit]=\"true\" [parameters]=\"mainForm?.controls.parameters\" [formsService]=\"formService\">\n    </input-parameters>\n</dexih-widget-section>\n\n<dexih-widget-section title=\"Triggers\" [showExpandButton]=\"true\" [padding]=\"false\">\n    <dexih-table [enableMultiSelect]=\"true\" [enableStickyToolbar]=\"true\"  [toolbarZIndex]=\"100\" [enableManualSort]=\"true\" sortColumn=\"position\" [columns]=\"triggerColumns\"\n        [dataObservable]=\"triggerTableData\" (rowClick)='editTrigger($event)'>\n        <ng-template #selectedItemsAction select=\"selectedItemsAction\" let-items=\"items\">\n            <dexih-button-delete (click)=\"deleteTriggers(items)\"></dexih-button-delete>\n        </ng-template>\n\n        <ng-template #selectedItemAction select=\"selectedItemAction\" let-trigger=\"item\">\n            <dexih-button-edit (click)=\"editTrigger(trigger)\"></dexih-button-edit>\n        </ng-template>\n\n        <ng-template #actions select=\"actionsTemplate\" let-items=\"items\">\n            <dexih-button-new (click)=\"newTrigger()\" title=\"New Trigger\"></dexih-button-new>\n        </ng-template>\n\n    </dexih-table>\n</dexih-widget-section>\n\n<dexih-widget-section title=\"Steps\" [showExpandButton]=\"true\" [padding]=\"false\">\n    <dexih-table [enableMultiSelect]=\"true\" [enableStickyToolbar]=\"true\"  [toolbarZIndex]=\"100\" [enableManualSort]=\"true\" (onSortChanged)=\"stepSortChanged($event)\" sortColumn=\"position\" [columns]=\"stepColumns\" [tags]=\"this.hubCache.hub.dexihTags\"\n        [dataObservable]=\"stepTableData\" (rowClick)='editDatalinkStep($event)'>\n        <ng-template #selectedItemsAction select=\"selectedItemsAction\" let-items=\"items\">\n            <dexih-button  iconClass=\"fa fa-magic\" (click)=\"updateDependencies(items)\" text=\"AutoSet Dependencies\"></dexih-button>\n            <dexih-button class=\"ml-1\" iconClass=\"fa fa-eraser\" (click)=\"clearDependencies(items)\" text=\"Clear Dependencies\"></dexih-button>\n            <dexih-button-delete class=\"ml-1\" (click)=\"deleteDatalinkSteps(items)\"></dexih-button-delete>\n        </ng-template>\n\n        <ng-template #selectedItemAction select=\"selectedItemAction\" let-item=\"item\">\n            <dexih-button-edit class=\"mr-1\" (click)=\"editDatalinkStep(item)\"></dexih-button-edit>\n        </ng-template>\n\n        <ng-template #actions select=\"actionsTemplate\" let-items=\"items\">\n            <dexih-button-new class=\"mr-1\" (click)=\"newDatalinkStep()\" title=\"Create a new step\"></dexih-button-new>\n            <dexih-button class=\"mr-1\" (click)=\"addDatalinkSteps()\" iconClass=\"fa fa-plus-square\" buttonClass=\"btn-primary\"\n                title=\"Select multiple datalinks to add as steps\">Add</dexih-button>\n        </ng-template>\n    </dexih-table>\n</dexih-widget-section>\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { HubService } from '../../../hub.service';\nimport { HubFormsService } from '../../../hub.forms.service';\nimport { Subscription, Observable, BehaviorSubject, combineLatest} from 'rxjs';\nimport { FormGroup, FormArray } from '@angular/forms';\nimport { HubCache } from '../../../hub.models';\nimport { DexihConnection, eFailAction, DexihDatalinkStep, DexihDatalinkDependency, DexihDatalinkStepColumn, DexihTrigger,\n  DexihDatalinkTable, eSourceType, eSharedObjectType, eAlertLevelItems, eAlertLevel } from '../../../../shared/shared.models';\n\n@Component({\n\n  selector: 'dexih-datajob-edit-form',\n  templateUrl: './datajob-edit-properties.component.html'\n})\nexport class DatajobEditPropertiesComponent implements OnInit, OnDestroy {\n  public hubCache: HubCache;\n\n  private _subscription: Subscription;\n\n  hasChangedObserve: Observable<boolean>;\n\n  public managedConnections: DexihConnection[];\n\n  hasChanged = false;\n  showAllErrors = false;\n\n  failActions = [\n    { key: eFailAction.Continue, name: 'Continue Execution' },\n    { key: eFailAction.ContinueNonDependent, name: 'Continue execution (non dependent datalinks only)' },\n    { key: eFailAction.Abend, name: 'Abend' },\n  ];\n\n  public datajobChanged = false;\n  public mainForm: FormGroup;\n\n  triggerColumns = [\n    { name: 'details', title: 'Details', format: 'Html' },\n    { name: 'updateDate', title: 'Last Modified', format: 'Calendar' },\n    { name: 'errors', title: 'Errors', format: '' },\n  ];\n\n  private _triggerTableData = new BehaviorSubject<Array<any>>(null);\n  triggerTableData: Observable<Array<any>> = this._triggerTableData.asObservable();\n\n  stepColumns = [\n    { name: 'name', title: 'Name', format: '' },\n    { name: 'datalink', title: 'Datalink', format: '', tags: 'tags' },\n    { name: 'dependencies', title: 'Dependencies', format: 'Html' },\n    { name: 'inputs', title: 'Inputs', format: 'Html'},\n    { name: 'updateDate', title: 'Last Modified', format: 'Calendar' },\n    { name: 'errors', title: 'Errors', format: '' },\n  ];\n\n  private _stepTableData = new BehaviorSubject<Array<any>>(null);\n  stepTableData: Observable<Array<any>> = this._stepTableData.asObservable();\n\n  eAlertLevelItems = eAlertLevelItems;\n  eAlertLevel = eAlertLevel;\n\n  constructor(private hubService: HubService,\n    public formService: HubFormsService,\n    private route: ActivatedRoute,\n    private router: Router) {\n  }\n\n  ngOnInit() {\n    let isFirst = true;\n\n    try {\n      this._subscription = combineLatest(\n        this.hubService.getHubCacheObservable(),\n        this.formService.getCurrentFormObservable(),\n      ).subscribe(result => {\n        this.hubCache = result[0];\n        this.mainForm = result[1];\n\n        if (!this.hubCache.isLoaded()) { return; }\n\n        this.managedConnections = this.hubCache.getManagedConnections();\n        this.updateTriggers();\n        this.updateSteps();\n\n        \n        // if this is first load of new form, then reset the dependencies.\n        if (this.mainForm.controls['key'].value <= 0 && isFirst) {\n          isFirst = false;\n          let steps = this.mainForm.controls['dexihDatalinkSteps'].value;\n          this.updateDependencies(steps);\n        }\n\n      });\n    } catch (e) {\n      this.hubService.addHubClientErrorMessage(e, 'Data Job Edit Properties');\n    }\n\n  }\n\n  ngOnDestroy() {\n    if (this._subscription) { this._subscription.unsubscribe(); }\n  }\n\n  updateTriggers() {\n    let triggerData = [];\n    if (this.mainForm) {\n      let triggers = (<FormArray>this.mainForm.controls['dexihTriggers']);\n      triggers.controls.forEach(triggerControl => {\n        let trigger = triggerControl.value;\n        triggerData.push({\n          key: trigger.key,\n          details: this.hubCache.getTriggerDetails(trigger),\n          updateDate: trigger.updateDate,\n          errors: triggerControl.valid ? 'No errors' : 'Errors'\n        });\n      });\n    }\n\n    this._triggerTableData.next(triggerData);\n  }\n\n  updateSteps() {\n    let stepData = [];\n    if (this.mainForm) {\n      let steps = (<FormArray>this.mainForm.controls['dexihDatalinkSteps']);\n      steps.controls.sort((a: FormGroup, b: FormGroup) => a.controls.position.value - b.controls.position.value)\n        .forEach(stepControl => {\n        let step = <DexihDatalinkStep> stepControl.value;\n        let datalink = this.hubCache.hub.dexihDatalinks.find(c => c.key === step.datalinkKey);\n        stepData.push({\n          key: step.key,\n          name: step.name,\n          datalinkKey: datalink.key,\n          datalink: datalink ? datalink.name : 'Not specified',\n          tags: this.hubCache.getObjectTags(eSharedObjectType.Datalink, datalink.key),\n          dependencies: this.getDependencies(step.dexihDatalinkDependencies),\n          inputs: this.getInputs(step.dexihDatalinkStepColumns),\n          updateDate: step.updateDate,\n          errors: stepControl.valid ? 'No errors' : 'Errors'\n        });\n      });\n    }\n\n    this._stepTableData.next(stepData);\n  }\n\n  stepSortChanged(items: Array<DexihDatalinkStep>) {\n    let steps = (<FormArray>this.mainForm.controls['dexihDatalinkSteps']);\n    items.forEach((item, index) => {\n        let step = <FormGroup>steps.controls\n            .find(c => c.value.key === item.key);\n        if (step) {\n          step.controls.position.setValue(index);\n        }\n    });\n}\n\n  getDependencies(dependencies: Array<DexihDatalinkDependency>) {\n    let depString = '';\n\n    if (dependencies) {\n      dependencies.forEach(dep => {\n        let step = this.mainForm.value.dexihDatalinkSteps.find(c => c.key === dep.dependentDatalinkStepKey);\n        if (step) {\n          depString = depString + step.name + '<br>';\n        } else {\n          depString = depString + 'Error: step not found.<br>';\n        }\n      });\n    }\n    return depString;\n\n  }\n\n  getInputs(columns: Array<DexihDatalinkStepColumn>) {\n    let depString = '';\n\n    if (columns) {\n      columns.forEach(column => {\n        depString = depString + column.name + ' = ' + column.defaultValue + '<br>';\n      });\n    }\n    return depString;\n\n  }\n\n  newTrigger() {\n    this.router.navigate(['trigger'], { relativeTo: this.route.parent });\n  }\n\n  addDatalinkSteps() {\n    this.router.navigate(['add-steps'], { relativeTo: this.route.parent });\n  }\n\n  editTrigger(trigger: DexihTrigger) {\n    this.router.navigate(['trigger', trigger.key], { relativeTo: this.route.parent });\n  }\n\n  deleteTriggers(triggers: Array<DexihTrigger>) {\n    let triggersArray = <FormArray>this.mainForm.controls.dexihTriggers;\n\n    triggers.forEach(trigger => {\n      let index = triggersArray.controls.findIndex(c => c.value.key === trigger.key);\n      triggersArray.removeAt(index);\n    });\n    this.updateTriggers();\n  }\n\n  newDatalinkStep() {\n    this.router.navigate(['step'], { relativeTo: this.route.parent });\n  }\n\n  editDatalinkStep(step: DexihDatalinkStep) {\n    this.router.navigate(['step', step.key], { relativeTo: this.route.parent });\n  }\n\n  deleteDatalinkSteps(steps: Array<DexihDatalinkStep>) {\n    let stepsArray = <FormArray>this.mainForm.controls.dexihDatalinkSteps;\n\n    steps.forEach(step => {\n      let index = stepsArray.controls.findIndex(c => c.value.key === step.key);\n      stepsArray.removeAt(index);\n    });\n    this.updateSteps();\n  }\n\n  clearDependencies(steps: Array<DexihDatalinkStep>) {\n    let stepsArray = <FormArray>this.mainForm.controls.dexihDatalinkSteps;\n    steps.forEach(step => {\n      let stepControl = <FormGroup> stepsArray.controls.find(c => c.value.key === step.key);\n      let dependencies = <FormArray> stepControl.controls['dexihDatalinkDependencies'];\n      dependencies.clear();\n    });\n\n    this.updateSteps();\n  }\n\n  updateDependencies(steps: Array<DexihDatalinkStep>) {\n    let stepsArray = <FormArray>this.mainForm.controls.dexihDatalinkSteps;\n    let allSteps = stepsArray.value;\n\n    let stepTargets: Array<{key: number, tables: Array<number>}> = [];\n    let minKey = -1;\n\n    allSteps.forEach(step => {\n      stepTargets.push( {key: step.key, tables:this.getDatalinkTargetTables(step.datalinkKey)});\n    });\n\n    steps.forEach(step => {\n      let stepControl = <FormGroup> stepsArray.controls.find(c => c.value.key === step.key);\n      let dependencies = <FormArray> stepControl.controls['dexihDatalinkDependencies'];\n      dependencies.clear();\n\n      let sourceTables = this.getDatalinkSourceTables(step.datalinkKey);\n\n      stepTargets.forEach(stepTarget => {\n        for( let t of stepTarget.tables) {\n          if (sourceTables.indexOf(t) >= 0) {\n            let dep = new DexihDatalinkDependency();\n            dep.key = minKey;\n            dep.datalinkStepKey =step.key;\n            dep.dependentDatalinkStepKey = stepTarget.key;\n            dependencies.push(this.formService.datalinkDependencyFormGroup(dep));\n            minKey--;\n            break;\n          }\n        }\n      });\n\n    });\n\n    this.updateSteps();\n  }\n\n  getDatalinkTargetTables(datalinkKey: number): Array<number> {\n    let datalink = this.hubCache.hub.dexihDatalinks.find(c => c.key === datalinkKey);\n    if (!datalink) { return []; }\n\n    return datalink.dexihDatalinkTargets.map(c => c.tableKey);\n  }\n\n  // gets any dependent source tables from the given datalink key.\n  getDatalinkSourceTables(datalinkKey: number): Array<number> {\n    let datalink = this.hubCache.hub.dexihDatalinks.find(c => c.key === datalinkKey);\n    if (!datalink) { return []; }\n\n    let tables = this.getDatalinkTable(datalink.sourceDatalinkTable);\n\n    datalink.dexihDatalinkTransforms.forEach(transform => {\n      if (transform.joinDatalinkTable) {\n        let joinTables = this.getDatalinkTable(transform.joinDatalinkTable);\n        joinTables.forEach(t => {\n          if (tables.indexOf(t) < 0) {\n            tables.push(t);\n          }\n        });\n      }\n    });\n    \n    return tables;\n  }\n\n  getDatalinkTable(datalinkTable: DexihDatalinkTable) : Array<number> {\n    if (!datalinkTable) {\n      return [];\n    }\n\n    switch(datalinkTable.sourceType) {\n      case eSourceType.Table: {\n        return [datalinkTable.sourceTableKey];\n      }\n      case eSourceType.Datalink: {\n        return this.getDatalinkSourceTables(datalinkTable.sourceDatalinkKey);\n      }\n    }\n\n    return [];\n  }\n\n}\n","<div class=\"form-group\">\n    <label [for]=\"id\" class=\"mt-1\">{{label}}\n        <div class=\"input-group\">\n            <div class=\"input-group-prepend\">\n                <a class=\"btn btn-outline-primary btn-sm\" (click)=\"selectAllDays()\">All</a>\n                <a class=\"btn btn-outline-primary btn-sm\" (click)=\"selectNoDays()\">None</a>\n                <a class=\"btn btn-outline-primary btn-sm\" (click)=\"selectWeekend()\">Weekend</a>\n            </div>\n            <div class=\"input-group-append\">\n                <a class=\"btn btn-outline-primary btn-sm\" (click)=\"selectWeekDays()\">Weekdays</a>\n            </div>\n        </div>\n        <ng-content></ng-content>\n    </label>\n\n    <div class=\"input-group\">\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '1'\" [(ngModel)]=\"daysOfWeek[0]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '1'\">Sunday</label>\n        </div>\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '2'\" [(ngModel)]=\"daysOfWeek[1]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '2'\">Monday</label>\n        </div>\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '3'\" [(ngModel)]=\"daysOfWeek[2]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '3'\">Tuesday</label>\n        </div>\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '4'\" [(ngModel)]=\"daysOfWeek[3]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '4'\">Wednesday</label>\n        </div>\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '5'\" [(ngModel)]=\"daysOfWeek[4]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '5'\">Thursday</label>\n        </div>\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '6'\" [(ngModel)]=\"daysOfWeek[5]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '6'\">Friday</label>\n        </div>\n        <div class=\"form-check form-check-inline\">\n            <input class=\"form-check-input\" type=\"checkbox\" [id]=\"id + '7'\" [(ngModel)]=\"daysOfWeek[6]\"\n                (ngModelChange)=\"hasChanged($event)\">\n            <label class=\"form-check-label\" [for]=\"id + '7'\">Saturday</label>\n        </div>\n\n    </div>\n    <div *ngIf=\"errors\" class=\"invalid-feedback d-block\">\n        {{ errors }}\n    </div>\n\n\n    <small *ngIf=\"note\" class=\"form-text text-muted\">\n        <markdown (click)=\"sharedFunctions.getRoute($event)\" [data]=\"note\"></markdown>\n    </small>\n</div>","import { Component, forwardRef, Input, AfterViewInit, ChangeDetectorRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { eDayOfWeek } from '../../../../shared/shared.models';\n\n@Component({\n    selector: 'daysofweek',\n    templateUrl: './dexih-form-daysofweek.component.html',\n    providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => DexihFormDaysOfWeekComponent), multi: true }]\n})\nexport class DexihFormDaysOfWeekComponent implements ControlValueAccessor, AfterViewInit {\n    @Input() label: string;\n    @Input() labelLeft: string;\n    @Input() note: string;\n    @Input() errors: string;\n    @Input() value: eDayOfWeek[];\n\n    eDayOfWeek = eDayOfWeek;\n    daysOfWeek = new Array<Boolean>(7);\n    id = 'input_' + Math.random().toString(36).substr(2, 9);\n\n    onChange: any = () => { };\n    onTouched: any = () => { };\n\n    constructor(private _changeDetectionRef: ChangeDetectorRef) {\n\n    }\n\n    ngAfterViewInit()  {\n        if (this.value) {\n            this.value.forEach(value => {\n                switch (value) {\n                    case eDayOfWeek.Sunday: this.daysOfWeek[0] = true; break;\n                    case eDayOfWeek.Monday: this.daysOfWeek[1] = true; break;\n                    case eDayOfWeek.Tuesday: this.daysOfWeek[2] = true; break;\n                    case eDayOfWeek.Wednesday: this.daysOfWeek[3] = true; break;\n                    case eDayOfWeek.Thursday: this.daysOfWeek[4] = true; break;\n                    case eDayOfWeek.Friday: this.daysOfWeek[5] = true; break;\n                    case eDayOfWeek.Saturday: this.daysOfWeek[6] = true; break;\n                }\n            });\n        }\n\n        // workaround for change detection required when using Afterview Init https://github.com/angular/angular/issues/6005\n        this._changeDetectionRef.detectChanges();\n    }\n\n    hasChanged($event: any) {\n        let daysOfWeek = new Array<eDayOfWeek>();\n        if (this.daysOfWeek[0]) { daysOfWeek.push(eDayOfWeek.Sunday); }\n        if (this.daysOfWeek[1]) { daysOfWeek.push(eDayOfWeek.Monday); }\n        if (this.daysOfWeek[2]) { daysOfWeek.push(eDayOfWeek.Tuesday); }\n        if (this.daysOfWeek[3]) { daysOfWeek.push(eDayOfWeek.Wednesday); }\n        if (this.daysOfWeek[4]) { daysOfWeek.push(eDayOfWeek.Thursday); }\n        if (this.daysOfWeek[5]) { daysOfWeek.push(eDayOfWeek.Friday); }\n        if (this.daysOfWeek[6]) { daysOfWeek.push(eDayOfWeek.Saturday); }\n\n        this.value = daysOfWeek;\n\n        this.onChange(this.value);\n        this.onTouched();\n    }\n\n    registerOnChange(fn: any) {\n        this.onChange = fn;\n    }\n\n    registerOnTouched(fn: any) {\n        this.onTouched = fn;\n    }\n\n    writeValue(value: any) {\n        if (value) {\n            this.value = value;\n        }\n    }\n\n    selectWeekend() {\n      this.daysOfWeek[0] = true;\n      this.daysOfWeek[1] = false;\n      this.daysOfWeek[2] = false;\n      this.daysOfWeek[3] = false;\n      this.daysOfWeek[4] = false;\n      this.daysOfWeek[5] = false;\n      this.daysOfWeek[6] = true;\n      this.hasChanged(null);\n  }\n\n  selectWeekDays() {\n      this.daysOfWeek[0] = false;\n      this.daysOfWeek[1] = true;\n      this.daysOfWeek[2] = true;\n      this.daysOfWeek[3] = true;\n      this.daysOfWeek[4] = true;\n      this.daysOfWeek[5] = true;\n      this.daysOfWeek[6] = false;\n      this.hasChanged(null);\n  }\n\n    selectAllDays() {\n      this.daysOfWeek[0] = true;\n      this.daysOfWeek[1] = true;\n      this.daysOfWeek[2] = true;\n      this.daysOfWeek[3] = true;\n      this.daysOfWeek[4] = true;\n      this.daysOfWeek[5] = true;\n      this.daysOfWeek[6] = true;\n      this.hasChanged(null);\n  }\n\n    selectNoDays() {\n      this.daysOfWeek[0] = false;\n      this.daysOfWeek[1] = false;\n      this.daysOfWeek[2] = false;\n      this.daysOfWeek[3] = false;\n      this.daysOfWeek[4] = false;\n      this.daysOfWeek[5] = false;\n      this.daysOfWeek[6] = false;\n      this.hasChanged(null);\n    }\n}\n","<dexih-widget-section *ngIf=\"triggerFormService.currentForm\" title=\"Edit Trigger\" [showExpandButton]=\"false\" >\n\t<ng-template #header>\n\t\t\t<dexih-button-apply [disabled]=\"!triggerFormService.hasChanged\" class=\"mr-1\" (click)=\"applyExit()\"></dexih-button-apply>\n\t\t\t<dexih-button-cancel (click)=\"cancel()\"></dexih-button-cancel>\n\t</ng-template>\n\t<form  [formGroup]=\"triggerFormService.currentForm\">\n\t\t<fieldset>\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<section class=\"form-group col-md-6\">\n\t\t\t\t\t<form-date label=\"Start Date\" formControlName=\"startDate\" [errors]=\"triggerFormService.formErrors.startDate\" note=\"This is the date that the trigger will start.  Leave blank for immediate start.\">\n\t\t\t\t\t</form-date>\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t\t<div class=\"form-row\">\n\t\t\t\t<section class=\"form-group col-md-3\">\n\t\t\t\t\t<form-time label=\"Interval\" formControlName=\"intervalTime\" [errors]=\"triggerFormService.formErrors.intervalTime\"\n\t\t\t\t\t note=\"The intra-day interval which the trigger restarts.  Leave blank for once a day jobs.\">\n\t\t\t\t\t</form-time>\n\t\t\t\t</section>\n\t\t\t\t<section class=\"form-group col-md-3\">\n\t\t\t\t\t<form-input type=\"number\" label=\"Max Recurrences\" formControlName=\"maxRecurs\" placeholder=\"Enter the max recurrences\"\n\t\t\t\t\t iconClass=\"fa fa-refresh\" [errors]=\"triggerFormService.formErrors.maxRecurs\" note=\" The maximum number of times job can recur in one day.\">\n\t\t\t\t\t</form-input>\n\t\t\t\t</section>\n\t\t\t\t<section class=\"form-group col-md-3\">\n\t\t\t\t\t<form-time label=\"Start Time\" formControlName=\"startTime\" [errors]=\"triggerFormService.formErrors.startTime\" note=\"Time of the day the job will activate.\">\n\t\t\t\t\t</form-time>\n\t\t\t\t</section>\n\t\t\t\t<section class=\"form-group col-md-3\">\n\t\t\t\t\t<form-time label=\"End Time\" formControlName=\"endTime\" [errors]=\"triggerFormService.formErrors.endTime\" note=\"Time of the day the triggers will deactivate.\">\n\t\t\t\t\t</form-time>\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t\t<section>\n\t\t\t\t<daysofweek label=\"Days of the week\" formControlName=\"daysOfWeek\" note=\" The days of the week the trigger is valid.\">\n\t\t\t\t</daysofweek>\n\t\t\t</section>\n\t\t\t<div class=\"form-row\">\n\n\t\t</div>\n\t\t</fieldset>\n\t</form>\n</dexih-widget-section>","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { Observable ,  Subscription, combineLatest} from 'rxjs';\nimport { Location } from '@angular/common';\nimport { FormBuilder, FormGroup, FormArray } from '@angular/forms';\nimport { AuthService } from '../../../../+auth/auth.service';\nimport { HubFormsService } from '../../../hub.forms.service';\nimport { HubService } from '../../../hub.service';\nimport { DexihTrigger } from '../../../../shared/shared.models';\n\n@Component({\n  selector: 'datajob-edit-trigger',\n  templateUrl: './datajob-edit-trigger.component.html'\n})\nexport class DatajobEditTriggerComponent implements OnInit, OnDestroy {\n  public pageTitle: string;\n  public action: string;\n\n  private _subscription: Subscription;\n\n  triggerFormService: HubFormsService;\n  triggerKey: number;\n  datajobKey: number;\n\n  originalTrigger: DexihTrigger;\n\n  mainForm: FormGroup;\n\n  constructor(\n    private authService: AuthService,\n    private hubService: HubService,\n    private formService: HubFormsService,\n    private route: ActivatedRoute,\n    private router: Router,\n    private location: Location,\n    private fb: FormBuilder) {\n\n    // create a seperate formService instance to manage the copied form\n    this.triggerFormService = new HubFormsService(fb, hubService, authService);\n  }\n\n\n  ngOnInit() {\n    try {\n      this._subscription = combineLatest(\n        this.route.data,\n        this.route.params,\n        this.formService.getCurrentFormObservable(),\n      ).subscribe(result => {\n        let data = result[0];\n        let params = result[1];\n        this.mainForm = result[2];\n\n        if (!this.mainForm) { return; }\n\n        this.pageTitle = data['pageTitle'];\n        this.action = data['action'];\n\n        this.triggerKey = +params['triggerKey'];\n\n        let triggerForm: FormGroup;\n\n        if (this.triggerKey) {\n          this.originalTrigger = this.mainForm.value.dexihTriggers.find(c => c.key === this.triggerKey);\n          if (!this.originalTrigger) {\n            this.authService.navigateUp();\n            return;\n          }\n          triggerForm = this.triggerFormService.triggerFormGroup(this.originalTrigger);\n        } else {\n          let trigger = new DexihTrigger();\n          // if new trigger, then set a temporary key of -1 or lower.\n          let minKey = -1;\n          this.mainForm.value.dexihTriggers.forEach(t => {\n            if (t.key <= minKey) {\n              minKey = t.key - 1;\n            }\n          });\n          trigger.key = minKey;\n          triggerForm = this.triggerFormService.triggerFormGroup(trigger);\n        }\n        this.triggerFormService.startForm(triggerForm);\n      });\n    } catch (e) {\n      this.hubService.addHubClientErrorMessage(e, 'Datajob Edit Trigger');\n    }\n  }\n\n  ngOnDestroy() {\n    if (this._subscription) { this._subscription.unsubscribe(); }\n  }\n\n  cancel() {\n    this.authService.navigateUp();\n  }\n\n  applyExit() {\n    const triggerForm = this.triggerFormService.currentForm;\n    const triggersArray = <FormArray>this.mainForm.controls.dexihTriggers;\n\n    if (!this.originalTrigger) {\n      triggersArray.push(triggerForm);\n    } else {\n      const originalTrigger = triggersArray.controls.find(c => c.value.key === triggerForm.value.key);\n      originalTrigger.setValue(triggerForm.value);\n    }\n\n    this.authService.navigateUp();\n  }\n}\n\n","<dexih-widget-section *ngIf=\"stepFormService.currentForm\" title=\"Add Datalink Step\" [showExpandButton]=\"false\">\n\t<ng-template #header>\n\t\t<dexih-button-apply class=\"mr-1\" [disabled]=\"!stepFormService.hasChanged\" (click)=\"applyExit()\">\n\t\t</dexih-button-apply>\n\t\t<dexih-button-cancel (click)=\"cancel()\"></dexih-button-cancel>\n\t</ng-template>\n\t<form [formGroup]=\"stepFormService.currentForm\">\n\t\t<fieldset>\n\t\t\t<section>\n\t\t\t\t<form-input label=\"Data Step Name\" formControlName=\"name\" placeholder=\"Enter the step name.\"\n\t\t\t\t\t[autocapitalize]=\"true\" iconClass=\"fa fa-list\" [errors]=\"stepFormService.formErrors.name\"\n\t\t\t\t\tnote=\"Enter a name for the data step, blank will use datalink name.\">\n\t\t\t\t</form-input>\n\t\t\t</section>\n\t\t\t<section>\n\t\t\t\t<form-select label=\"Data Link\" formControlName=\"datalinkKey\" [items]=\"hubCache.hub.dexihDatalinks\"\n\t\t\t\t\titemKey=\"key\" itemName=\"name\" [errors]=\"stepFormService.formErrors.datalinkKey\"\n\t\t\t\t\ticonClass=\"fa fa-database\">\n\t\t\t\t\t<datalink-edit-button [key]=\"stepFormService.currentForm.controls.datalinkKey.value\"></datalink-edit-button>\n\t\t\t\t</form-select>\n\t\t\t</section>\n\t\t</fieldset>\n\n\t\t<div class=\"d-flex flex-wrap pt-1\"\n\t\t\t*ngIf=\"stepFormService.currentForm.controls.dexihDatalinkStepColumns.controls.length > 0\">\n\t\t\t<div>\n\t\t\t\tInput Values\n\t\t\t</div>\n\n\t\t\t<span\n\t\t\t\t*ngFor=\"let column of stepFormService.currentForm.controls.dexihDatalinkStepColumns.controls; let i = index\"\n\t\t\t\tclass=\"input-group\">\n\t\t\t\t<div class=\"input-group-prepend\">\n\t\t\t\t\t<div class=\"input-group-text\">\n\t\t\t\t\t\t{{column.value.logicalName}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<form-input class=\"form-control p-0\" [placeholder]=\"column.value.logicalName\" [autocapitalize]=\"true\"\n\t\t\t\t\t[formControl]=\"column.controls.defaultValue\"></form-input>\n\t\t\t</span>\n\t\t</div>\n\t</form>\n</dexih-widget-section>\n\n<dexih-widget-section *ngIf=\"stepFormService.currentForm\" title=\"Parameters\" [showExpandButton]=\"true\" [padding]=\"false\" [padding]=\"true\">\n\t<input-parameters [showEdit]=\"true\" [parameters]=\"stepFormService.currentForm.controls.parameters\" [formsService]=\"formService\" [parentParameters]=\"formService.currentForm.controls.parameters.value\">\n\t</input-parameters>\n</dexih-widget-section>\n\n<dexih-widget-section *ngIf=\"stepFormService.currentForm\" title=\"Dependent Steps\" [showExpandButton]=\"false\"\n\t[padding]=\"false\">\n\t<dexih-table *ngIf=\"stepFormService.currentForm\" [enableMultiSelect]=\"true\" [columns]=\"stepColumns\"\n\t\t[dataObservable]=\"stepTableData\" [(selectedItems)]=\"stepFormService.currentForm.value.dexihDatalinkDependencies\"\n\t\t(onSelectedChange)=\"dependentStepsChange($event)\" keyColumn=\"key\" selectedKeyColumn=\"dependentDatalinkStepKey\" [tags]=\"this.hubCache.hub.dexihTags\">\n\t</dexih-table>\n</dexih-widget-section>","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { HubService } from '../../../hub.service';\nimport { Observable, BehaviorSubject, Subscription, combineLatest} from 'rxjs';\nimport { FormGroup, FormArray, FormBuilder } from '@angular/forms';\nimport { AuthService } from '../../../../+auth/auth.service';\nimport { HubFormsService } from '../../../hub.forms.service';\nimport { HubCache, DexihInputParameter } from '../../../hub.models';\nimport { InputColumn, DexihDatalinkStep, DexihDatalinkStepColumn, DexihDatalinkDependency, InputParameterBase, eSharedObjectType } from '../../../../shared/shared.models';\n\n@Component({\n    selector: 'datajob-edit-step',\n    templateUrl: './datajob-edit-step.component.html'\n})\nexport class DatajobEditStepComponent implements OnInit, OnDestroy {\n    private _subscription: Subscription;\n    private _datalinkSubscription: Subscription;\n\n    public hubCache: HubCache;\n\n    private datalinkStepKey: number;\n    datajobKey: number;\n\n    datajobForm: FormGroup;\n\n    stepFormService: HubFormsService;\n    showAllErrors = false;\n\n    public inputColumns: InputColumn[];\n\n    stepColumns = [\n        { name: 'name', title: 'Name', format: '', tags: 'tags' },\n        { name: 'datalink', title: 'Datalink', format: '' },\n        { name: 'dependencies', title: 'Dependencies', format: '' },\n        { name: 'updateDate', title: 'Last Modified', format: 'Calendar' },\n    ];\n\n    private _stepTableData = new BehaviorSubject<Array<any>>(null);\n    stepTableData: Observable<Array<any>> = this._stepTableData.asObservable();\n\n    constructor(\n        private hubService: HubService,\n        private authService: AuthService,\n        private formService: HubFormsService,\n        private route: ActivatedRoute,\n        fb: FormBuilder) {\n        // create a separate formService instance to manage the copied form\n        this.stepFormService = new HubFormsService(fb, hubService, authService);\n    }\n\n    ngOnInit() {\n        try {\n            this._subscription = combineLatest(\n                this.route.data,\n                this.route.params,\n                this.hubService.getHubCacheObservable(),\n                this.formService.getCurrentFormObservable(),\n            ).subscribe(result => {\n                let params = result[1];\n                this.hubCache = result[2];\n                let mainForm = result[3];\n\n                this.datalinkStepKey = +params['datalinkStepKey'];\n\n                if (mainForm) {\n                    this.datajobForm = mainForm;\n                    let step: DexihDatalinkStep;\n\n                    if (this.datalinkStepKey) {\n                        step = mainForm.value.dexihDatalinkSteps\n                            .find(c => c.key === this.datalinkStepKey);\n\n                        if (!step) {\n                            this.authService.navigateUp();\n                            return;\n                        }\n                    } else {\n                        step = new DexihDatalinkStep();\n                        // if new step, then set a temporary key of -1 or lower.\n                        let minKey = -1;\n                        this.datajobForm.value.dexihDatalinkSteps.forEach(t => {\n                            if (t.key <= minKey) {\n                                minKey = t.key - 1;\n                            }\n                        });\n                        step.key = minKey;\n                        this.datalinkStepKey = minKey;\n                    }\n\n                    const stepForm = this.stepFormService.datalinkStepFormGroup(mainForm, step);\n                    this.stepFormService.startForm(stepForm);\n                    this.updateSteps();\n\n                    this._datalinkSubscription = stepForm.controls.datalinkKey.valueChanges.subscribe(datalinkKey => {\n                        this.updateDatalinkStepColumns(datalinkKey);\n                    });\n                }\n            });\n        } catch (e) {\n            this.hubService.addHubClientErrorMessage(e, 'Datajob Edit Step');\n        }\n\n    }\n\n    ngOnDestroy() {\n        if (this._subscription) { this._subscription.unsubscribe(); }\n        if (this._datalinkSubscription) { this._datalinkSubscription.unsubscribe(); }\n    }\n\n    updateSteps() {\n        let stepData = [];\n        if (this.datajobForm.value.dexihDatalinkSteps) {\n            this.datajobForm.value.dexihDatalinkSteps.forEach(step => {\n                if (step.key !== this.stepFormService.currentForm.value.key) {\n                    let datalink = this.hubCache.hub.dexihDatalinks.find(c => c.key === step.datalinkKey);\n                    stepData.push({\n                        key: step.key,\n                        name: step.name,\n                        datalink: datalink ? datalink.name : 'Not specified',\n                        tags: this.hubCache.getObjectTags(eSharedObjectType.Datalink, datalink.key),\n                        dependencies: '',\n                        updateDate: step.updateDate\n                    });\n                }\n            });\n        }\n\n        this._stepTableData.next(stepData);\n    }\n\n    updateDatalinkStepColumns(datalinkKey: number) {\n\n        let datalink = this.hubCache.hub.dexihDatalinks.find(c => c.key === datalinkKey);\n        let stepForm = <FormGroup>this.stepFormService.currentForm;\n        let stepParameters = <FormArray>stepForm.controls.parameters;\n\n        let currentParameters = <DexihInputParameter[]> stepParameters.value;\n        stepParameters.clear();\n\n        datalink.parameters.forEach(parameter => {\n            let currentParameter = currentParameters.find( c => c.name === parameter.name);\n            let newParameter = new InputParameterBase();\n            if (currentParameter) {\n                newParameter.name = currentParameter.name;\n                newParameter.value = currentParameter.value;\n            } else {\n                newParameter.name = parameter.name;\n                newParameter.value = parameter.value;\n            }\n            let newFormParameter = this.formService.parameter(newParameter);\n            stepParameters.push(newFormParameter);\n        });\n\n\n\n        let stepColumnsForm = <FormArray>stepForm.controls.dexihDatalinkStepColumns;\n        let stepColumns = <DexihDatalinkStepColumn[]> stepColumnsForm.value;\n\n        while (stepColumnsForm.length !== 0) {\n            stepColumnsForm.removeAt(0)\n        }\n\n        let inputColumns = datalink.sourceDatalinkTable.dexihDatalinkColumns.filter(c => c.isInput);\n\n        inputColumns.forEach(col => {\n            let stepColumn = stepColumns.find(c => c.name === col.name);\n            if (!stepColumn) {\n                stepColumn = new DexihDatalinkStepColumn();\n                stepColumn.defaultValue = col.defaultValue;\n            }\n            stepColumn.dataType = col.dataType;\n            stepColumn.name = col.name;\n            stepColumn.logicalName = col.logicalName;\n            stepColumn.columnGroup = col.columnGroup;\n            stepColumn.rank = col.rank;\n            stepColumn.maxLength = col.maxLength;\n            stepColumn.deltaType = col.deltaType;\n            stepColumn.allowDbNull = col.allowDbNull;\n            stepColumn.isUnicode = col.isUnicode;\n            stepColumn.isValid = true;\n\n            let stepColumnForm = this.formService.datalinkStepColumnFormGroup(stepColumn);\n            stepColumnsForm.push(stepColumnForm);\n        });\n\n        if (!stepForm.controls.name.value) {\n            stepForm.controls.name.setValue(datalink.name);\n        }\n    }\n\n    dependentStepsChange(items) {\n        let datalinkDependencies = <FormArray>this.stepFormService.currentForm.controls.dexihDatalinkDependencies;\n        let minKey = -1;\n        if (datalinkDependencies) {\n            datalinkDependencies.controls.forEach(dep => {\n                if (dep.valid['key'] <= minKey) {\n                    minKey = dep['key'] - 1;\n                }\n            });\n        }\n\n        while (datalinkDependencies.length > 0) {\n            datalinkDependencies.removeAt(0);\n        }\n\n        items.forEach(newDep => {\n            let oldDep = datalinkDependencies ?\n                datalinkDependencies.controls.find(c => c.value.datalinkStepKey === newDep.datalinkStepKey)\n                : null;\n            if (oldDep) {\n                datalinkDependencies.push(oldDep);\n            } else {\n                let dep = new DexihDatalinkDependency();\n                dep.key = minKey;\n                dep.datalinkStepKey = this.datalinkStepKey;\n                dep.dependentDatalinkStepKey = newDep.key;\n                datalinkDependencies.push(this.stepFormService.datalinkDependencyFormGroup(dep));\n                minKey--;\n            }\n        });\n\n        this.stepFormService.hasChanged = true;\n    }\n\n    cancel() {\n        this.authService.navigateUp();\n    }\n\n    applyExit() {\n        const stepForm = this.stepFormService.currentForm;\n        const stepsArray = <FormArray>this.datajobForm.controls.dexihDatalinkSteps;\n\n        const index = stepsArray.controls\n            .findIndex(c => c.value.key === stepForm.value.key && c.value.isValid);\n\n        if (index < 0) {\n            stepsArray.push(stepForm);\n        } else {\n            stepsArray.removeAt(index);\n            stepsArray.insert(index, stepForm);\n        }\n\n        this.authService.navigateUp();\n    }\n}\n","<dexih-widget-section title=\"Add Datalinks to Job\" [showExpandButton]=\"false\" [padding]=\"false\">\n\t<ng-template #header>\n\t\t<dexih-button-close (click)=\"close()\"></dexih-button-close>\n\t</ng-template>\n\t<dexih-table [enableMultiSelect]=\"true\" [columns]=\"columns\" [dataObservable]=\"tableData\" [tags]=\"this.hubCache.hub.dexihTags\">\n\t\t<ng-template #selectedItemsAction select=\"selectedItemsAction\" let-items=\"items\">\n\t\t\t<dexih-button (click)=\"addSelected(items)\" iconClass=\"fa fa-plus\" buttonClass=\"btn-primary\"\n\t\t\t\ttitle=\"Add selected datalinks to the job\">Add</dexih-button>\n\t\t</ng-template>\n\n\t</dexih-table>\n</dexih-widget-section>","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { HubService } from '../../../hub.service';\nimport { Observable, BehaviorSubject, Subscription, combineLatest} from 'rxjs';\nimport { AuthService } from '../../../../+auth/auth.service';\nimport { HubFormsService } from '../../../hub.forms.service';\nimport { FormGroup, FormArray } from '@angular/forms';\nimport { HubCache } from '../../../hub.models';\nimport { DexihDatalink, eSharedObjectType, DexihDatalinkStep, eDatalinkType } from '../../../../shared/shared.models';\n\n@Component({\n    selector: 'datajob-add-steps',\n    templateUrl: './datajob-add-steps.component.html'\n})\nexport class DatajobAddStepsComponent implements OnInit, OnDestroy {\n    private _subscription: Subscription;\n    private _hubCacheChangeSubscription: Subscription;\n\n    public hubCache: HubCache;\n\n    hasChanged = false;\n\n    columns = [\n        { name: 'name', title: 'Name', format: '', tags: 'tags' },\n        { name: 'datalinkType', title: 'Datalink Type', enum: eDatalinkType, format: 'Enum' },\n        { name: 'sourceTableName', title: 'Source Table', format: '' },\n        { name: 'targetTableName', title: 'Target Table', format: '' },\n        { name: 'updateDate', title: 'Last Modified', format: 'Calendar' },\n    ];\n\n    private _tableData = new BehaviorSubject<Array<any>>(null);\n    tableData: Observable<Array<any>> = this._tableData.asObservable();\n\n  public mainForm: FormGroup;\n\n    constructor(\n        private hubService: HubService,\n        private authService: AuthService,\n        private formService: HubFormsService,\n        private route: ActivatedRoute,\n        private router: Router) { }\n\n    ngOnInit() {\n        try {\n            this._subscription = combineLatest(\n                this.route.data,\n                this.route.params,\n                this.hubService.getHubCacheObservable(),\n                this.formService.getCurrentFormObservable()\n            ).subscribe(result => {\n                let data = result[0];\n                let params = result[1];\n                this.hubCache = result[2];\n                this.mainForm = result[3];\n\n                this.updateDatalinks();\n            });\n        } catch (e) {\n            this.hubService.addHubClientErrorMessage(e, 'Datalink Index');\n        }\n\n    }\n\n    ngOnDestroy() {\n        if (this._subscription) { this._subscription.unsubscribe(); }\n        if (this._hubCacheChangeSubscription) { this._hubCacheChangeSubscription.unsubscribe(); }\n    }\n\n    changeEvent($event) {\n        this.hasChanged = true;\n    }\n\n    private updateDatalinks() {\n        let newDatalinks: Array<DexihDatalink>;\n        if (this.hubCache) {\n            if (!this.hubCache.hub.dexihDatalinks) {\n                this._tableData.next(new Array<DexihDatalink>());\n            } else {\n                let datalinks = this.hubCache.hub.dexihDatalinks.map(d => {\n                    let sourceTable = this.hubCache.getTable(d.sourceDatalinkTable.sourceTableKey);\n                    return {\n                        key: d.key,\n                        name: d.name,\n                        datalinkType: d.datalinkType,\n                        sourceTableName: sourceTable ? sourceTable.name : 'No source table',\n                        targetTableName:  d.dexihDatalinkTargets.map(target => {\n                            let table = this.hubCache.getTable(target.tableKey);\n                            if (table) {\n                                return table.name;\n                            }\n                        }).join(', '),\n                        updateDate: d.updateDate,\n                        tags: this.hubCache.getObjectTags(eSharedObjectType.Datalink, d.key),\n                    };\n                });\n\n                this._tableData.next(datalinks);\n            }\n        }\n\n    }\n\n    watchChanges() {\n        // watch the current connection in case it is changed in another session.\n        this._hubCacheChangeSubscription = this.hubService.getHubCacheChangeObservable().subscribe(hubCacheChange => {\n            if (hubCacheChange.changeClass === eSharedObjectType.Datalink) {\n                this.updateDatalinks();\n            }\n        });\n    }\n\n    close() {\n        this.authService.navigateUp();\n    }\n\n    addSelected(items: Array<DexihDatalink>) {\n        let existingDatalinks = new Array<string>();\n        let formDexihDatalinkSteps = this.mainForm.value.dexihDatalinkSteps;\n        items.forEach(item => {\n            let exists = formDexihDatalinkSteps.find(c => c.datalinkKey === item.key);\n            if (exists) {\n                existingDatalinks.push(item.name);\n            }\n        });\n\n        if (existingDatalinks.length > 0) {\n            let names = existingDatalinks.join(', ');\n            this.authService.confirmDialog('Warning duplicate datalinks',\n            'The following datalinks already exist as steps within the job.  ' + names +\n            '.<br />Are you sure you want these datalinks added to the job').then( confirm => {\n                if (confirm) {\n                this.addSelectedConfirmed(items);\n                }\n            }).catch(reason => {});\n        } else {\n            this.addSelectedConfirmed(items);\n        }\n\n    }\n\n    addSelectedConfirmed(items: Array<DexihDatalink>) {\n        let formDexihDatalinkSteps = <Array<DexihDatalinkStep>> this.mainForm.value.dexihDatalinkSteps;\n\n        let minKey = -1;\n        formDexihDatalinkSteps.forEach(t => {\n            if (t.key <= minKey) {\n                minKey = t.key - 1;\n            }\n        });\n\n        let stepsArray = (<FormArray>this.mainForm.controls['dexihDatalinkSteps']);\n\n        items.forEach(datalink => {\n            let newDatalinkStep = new DexihDatalinkStep();\n            newDatalinkStep.name = datalink.name;\n            // ensure the name is unique by appending a count to the end.\n            let i = 0;\n            while (true) {\n                if (!formDexihDatalinkSteps.find(c => c.name === newDatalinkStep.name)) {\n                    break;\n                }\n                newDatalinkStep.name = datalink.name + '_' + i.toString();\n                i++;\n            }\n            newDatalinkStep.key = minKey;\n            newDatalinkStep.datalinkKey = datalink.key;\n            newDatalinkStep.datajobKey = this.mainForm.value.key;\n            newDatalinkStep.isValid = true;\n\n            let stepFormGroup = this.formService.datalinkStepFormGroup(this.mainForm, newDatalinkStep);\n            stepsArray.push(stepFormGroup);\n\n            minKey--;\n        });\n\n        this.authService.navigateUp();\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { CanDeactivate } from '@angular/router';\nimport { Observable, combineLatest} from 'rxjs';\n\nexport interface CanComponentDeactivate {\n  canDeactivate: () => Observable<boolean> | Promise<boolean> | boolean;\n}\n\n@Injectable()\nexport class DatajobEditGuard implements CanDeactivate<CanComponentDeactivate> {\n\n  canDeactivate(component: CanComponentDeactivate) {\n    return component && component.canDeactivate ? component.canDeactivate() : true;\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\nimport { DatajobEditComponent } from './datajob-edit.component';\nimport { DatajobEditPropertiesComponent } from './properties/datajob-edit-properties.component';\nimport { DatajobEditTriggerComponent } from './trigger-edit/datajob-edit-trigger.component';\nimport { DatajobEditStepComponent } from './step-edit/datajob-edit-step.component';\nimport { DatajobAddStepsComponent } from './steps-add/datajob-add-steps.component';\nimport { DatajobEditGuard} from './datajob-edit-guard';\n\nexport const datajobEditRoutes = [\n        { path: '', redirectTo: 'properties',  data: { navigateSkip: true}},\n        { path: 'properties', component: DatajobEditPropertiesComponent, data: { navigateSkip: true, pageTitle: 'Properties' } },\n        { path: 'trigger', component: DatajobEditTriggerComponent, data: { pageTitle: 'New Trigger' } },\n        { path: 'trigger/:triggerKey', component: DatajobEditTriggerComponent, data: { pageTitle: 'Edit Trigger' }  },\n        { path: 'step', component: DatajobEditStepComponent, data: { pageTitle: 'New Step' }  },\n        { path: 'step/:datalinkStepKey', component: DatajobEditStepComponent, data: { pageTitle: 'Edit Step' }  },\n        { path: 'add-steps', component: DatajobAddStepsComponent, data: { pageTitle: 'Add Multiple Steps' }  }\n];\n\nexport const routes: Routes = [\n        { path: '', component: DatajobEditComponent, canDeactivate: [DatajobEditGuard], children: datajobEditRoutes},\n];\n\n\nexport const Routing = RouterModule.forChild(routes);\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Routing } from './datajob-edit.routing';\nimport { SharedModule } from '../../../shared/shared.module';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { DatajobEditComponent } from './datajob-edit.component';\nimport { DatajobEditPropertiesComponent } from './properties/datajob-edit-properties.component';\nimport { DatajobEditTriggerComponent } from './trigger-edit/datajob-edit-trigger.component';\nimport { DatajobEditStepComponent } from './step-edit/datajob-edit-step.component';\nimport { DatajobAddStepsComponent } from './steps-add/datajob-add-steps.component';\n\nimport { DexihFormDaysOfWeekComponent } from './trigger-edit/dexih-form-daysofweek.component';\nimport { HubFormsService } from '../../hub.forms.service';\nimport { DatajobEditGuard } from './datajob-edit-guard';\nimport { HubSharedModule } from '../../hub.shared.module';\n\n@NgModule({\n    imports: [\n        SharedModule,\n        CommonModule,\n        FormsModule,\n        Routing,\n        ReactiveFormsModule,\n        HubSharedModule\n    ],\n    declarations: [\n        DatajobEditComponent,\n        DatajobEditPropertiesComponent,\n        DatajobEditTriggerComponent,\n        DatajobEditStepComponent,\n        DatajobAddStepsComponent,\n        DexihFormDaysOfWeekComponent\n    ],\n    providers: [ HubFormsService, DatajobEditGuard ],\n    exports: []\n})\nexport class DatajobEditModule {\n\n    static forRoot(): ModuleWithProviders<DatajobEditModule> {\n        return {\n            ngModule: DatajobEditModule,\n            providers: [ HubFormsService ]\n        };\n    }\n}\n"]}