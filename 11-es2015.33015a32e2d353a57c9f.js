(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"/fhR":function(e,t,i){"use strict";i.d(t,"a",(function(){return E}));var a=i("3WyZ"),n=i("itXk"),s=i("2v7R"),o=i("soiQ"),r=i("fXoL"),c=i("ElCs"),l=i("Xjf6"),u=i("tyNb"),h=i("cvPx"),b=i("3Pt+"),d=i("ofXK"),m=i("Wumg"),f=i("obiC"),p=i("H3K+"),g=function(e,t,i,a){return new(i||(i=Promise))((function(n,s){function o(e){try{c(a.next(e))}catch(t){s(t)}}function r(e){try{c(a.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function v(e,t){if(1&e&&(r.Ob(0,"section"),r.Ob(1,"div",2),r.Fc(2," There are no files configured. Create a file based connection, and add at least one file definition. "),r.Lb(3,"hr"),r.Ob(4,"div"),r.Ob(5,"a",3),r.Fc(6,"New Connection"),r.Nb(),r.Nb(),r.Nb(),r.Nb()),2&e){const e=r.Zb();r.yb(5),r.jc("routerLink","/hub/",e.hubCache.hub.hubKey,"/connections/connection-new/Source")}}function y(e,t){if(1&e&&(r.Ob(0,"section",16),r.Ob(1,"form-select",22),r.Ob(2,"a",13),r.Fc(3,"("),r.Lb(4,"i",14),r.Fc(5," New )"),r.Nb(),r.Nb(),r.Nb()),2&e){const e=r.Zb(4);r.yb(1),r.hc("items",e.hubCache.hub.dexihFileFormats)("enableFilter",!1)("allowNullSelect",!0),r.yb(1),r.jc("routerLink","/hub/",e.hubCache.hub.hubKey,"/fileFormats/fileFormat-new")}}function C(e,t){if(1&e&&(r.Ob(0,"form",10),r.Ob(1,"div",11),r.Ob(2,"section"),r.Ob(3,"form-select",12),r.Ob(4,"a",13),r.Fc(5,"("),r.Lb(6,"i",14),r.Fc(7," New )"),r.Nb(),r.Nb(),r.Nb(),r.Ob(8,"div",15),r.Ob(9,"section",16),r.Lb(10,"form-select",17),r.Nb(),r.Dc(11,y,6,4,"section",18),r.Nb(),r.Ob(12,"section"),r.Lb(13,"form-checkbox",19),r.Lb(14,"form-checkbox",20),r.Lb(15,"form-checkbox",21),r.Nb(),r.Nb(),r.Nb()),2&e){const e=r.Zb(3);r.hc("formGroup",e.bulkLoadForm),r.yb(3),r.hc("items",e.fileConnections),r.yb(1),r.jc("routerLink","//hub/",e.hubCache.hub.hubKey,"/connections/connection-new/Source"),r.yb(6),r.hc("items",e.formatTypes),r.yb(1),r.hc("ngIf",e.bulkLoadForm.controls.formatType.value==e.eTypeCode.Text)}}function w(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-button",38),r.Vb("click",(function(){r.vc(e);const i=t.items;return r.Zb(4).uploadSelected(i)})),r.Fc(1,"Upload"),r.Nb(),r.Ob(2,"dexih-button-cancel",39),r.Vb("click",(function(){r.vc(e);const i=t.items;return r.Zb(4).cancelSelected(i)})),r.Nb(),r.Ob(3,"dexih-button-delete",40),r.Vb("click",(function(){r.vc(e);const i=t.items;return r.Zb(4).removeSelected(i)})),r.Nb()}}function S(e,t){if(1&e){const e=r.Pb();r.Ob(0,"div",41),r.Ob(1,"form-checkbox",42),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb(4).automaticUpload=t})),r.Nb(),r.Nb()}if(2&e){const e=r.Zb(4);r.yb(1),r.hc("ngModel",e.automaticUpload)}}const k=function(e){return{width:e}};function O(e,t){if(1&e&&(r.Ob(0,"div",45),r.Lb(1,"div",46),r.Nb()),2&e){const e=r.Zb().item;r.yb(1),r.hc("ngStyle",r.mc(1,k,e.progress+"%"))}}const T=function(e,t,i){return{"fa-check":e,"fa-exclamation-circle":t,"fa-ban":i}};function N(e,t){if(1&e&&(r.Dc(0,O,2,3,"div",43),r.Ob(1,"span"),r.Lb(2,"i",44),r.Fc(3),r.Nb()),2&e){const e=t.item,i=r.Zb(4);r.hc("ngIf",e.isRunning()),r.yb(2),r.hc("ngClass",r.oc(3,T,e.status===i.eFileStatus.Complete,e.status===i.eFileStatus.Error,e.status===i.eFileStatus.Cancelled)),r.yb(1),r.Gc(e.status)}}function D(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-button",47),r.Vb("click",(function(){r.vc(e);const i=t.items;return r.Zb(4).saveTables(i)})),r.Fc(1,"Create Tables"),r.Nb(),r.Ob(2,"dexih-button",48),r.Vb("click",(function(){r.vc(e);const i=t.items;return r.Zb(4).createDatalinks(i)})),r.Fc(3,"Create Datalinks"),r.Nb(),r.Ob(4,"dexih-button-delete",49),r.Vb("click",(function(){r.vc(e);const i=t.items;return r.Zb(4).discardTables(i)})),r.Nb()}}function x(e,t){if(1&e){const e=r.Pb();r.Ob(0,"ul",23),r.Ob(1,"dexih-widget-section",24),r.Ob(2,"div",25),r.Vb("dropFiles",(function(t){return r.vc(e),r.Zb(3).filesDrop(t)})),r.Fc(3," Drop Files to Load Here "),r.Ob(4,"div",26),r.Ob(5,"input",27),r.Vb("change",(function(t){return r.vc(e),r.Zb(3).uploadFile(t)})),r.Nb(),r.Ob(6,"label",28),r.Fc(7,"Choose files"),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Ob(8,"dexih-widget-section",29),r.Ob(9,"dexih-table",30),r.Dc(10,w,4,0,"ng-template",31,32,r.Ec),r.Dc(12,S,2,1,"ng-template",null,33,r.Ec),r.Dc(14,N,4,7,"ng-template",34,35,r.Ec),r.Nb(),r.Nb(),r.Ob(16,"dexih-widget-section",36),r.Ob(17,"dexih-table",37),r.Vb("rowClick",(function(t){return r.vc(e),r.Zb(3).editTable(t)})),r.Dc(18,D,5,0,"ng-template",31,32,r.Ec),r.Nb(),r.Nb(),r.Nb()}if(2&e){const e=r.Zb(3);r.yb(1),r.hc("showExpandButton",!0),r.yb(1),r.hc("requireFiles",!0),r.yb(6),r.hc("showExpandButton",!0)("padding",!1),r.yb(1),r.hc("enableMultiSelect",!0)("columns",e.uploadColumns)("data",e.uploadedFiles),r.yb(7),r.hc("showExpandButton",!0)("padding",!1),r.yb(1),r.hc("enableMultiSelect",!0)("columns",e.tableColumns)("data",e.tables)}}function F(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-widget",7),r.Vb("close",(function(){return r.vc(e),r.Zb(2).close()})),r.Dc(1,C,16,5,"form",8),r.Dc(2,x,20,12,"ul",9),r.Nb()}if(2&e){const e=r.Zb(2);r.hc("title","Bulk Load: "+(null==e.connection?null:e.connection.name))("showCloseButton",!0),r.yb(1),r.hc("ngIf",e.bulkLoadForm),r.yb(1),r.hc("ngIf",e.connection)}}function V(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-button-apply",52),r.Vb("click",(function(){return r.vc(e),r.Zb(3).applyChanges()})),r.Nb(),r.Ob(1,"dexih-button-cancel",53),r.Vb("click",(function(){return r.vc(e),r.Zb(3).cancel()})),r.Nb()}}function I(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-widget",50),r.Vb("close",(function(){return r.vc(e),r.Zb(2).closeTable()})),r.Dc(1,V,2,0,"ng-template",null,51,r.Ec),r.Lb(3,"router-outlet"),r.Nb()}if(2&e){const e=r.Zb(2);r.hc("title","Edit table: "+e.formsService.currentForm.controls.name.value)("showCloseButton",!0)}}function K(e,t){if(1&e&&(r.Ob(0,"div",4),r.Dc(1,F,3,4,"dexih-widget",5),r.Dc(2,I,4,2,"dexih-widget",6),r.Nb()),2&e){const e=r.Zb();r.yb(1),r.hc("ngIf",!e.currentTable),r.yb(1),r.hc("ngIf",e.currentTable)}}let E=(()=>{class e{constructor(e,t,i,n,r,c){this.authService=e,this.hubService=t,this.route=i,this.router=n,this.formsService=r,this.fb=c,this.entityType="Table",this.canEdit=!1,this.formatTypes=s.m,this.eTypeCode=o.pc,this.eFileStatus=a.h,this.automaticUpload=!0,this.uploadedFiles=[],this.reference=null,this.tables=[],this.currentTable=null,this.cancelToken=new a.a,this.pageTitle="Manage Files",this.showPage=!1,this.showPageMessage="Loading...",this.tableColumns=[{name:"logicalName",title:"Logical Name",format:"Md",footer:"description"},{name:"name",title:"Table Name"}],this.uploadColumns=[{name:"file.name",title:"File Name",format:""},{name:"file.size",title:"Size",format:""}]}ngOnInit(){try{this._subscription=Object(n.a)(this.route.queryParams,this.hubService.getHubCacheObservable(!0),this.hubService.getRemoteLibrariesObservable()).subscribe(e=>{let t=e[0];this.hubCache=e[1];let i=e[2];this.fileConnections=this.hubCache.hub.dexihConnections.filter(e=>{let t=i.connections.find(t=>e.connectionAssemblyName===t.connectionAssemblyName&&e.connectionClassName===t.connectionClassName);return!!t&&(t.connectionCategory===o.ib.File||e.purpose!==o.jb.Source)});let a=+t.connectionKey;a||this.fileConnections.length>0&&(a=this.fileConnections[0].key),this.bulkLoadForm=this.fb.group({connectionKey:[a],formatType:[o.pc.Text],fileFormatKey:[],includeFileName:[!1],includeFileDate:[!1],includeFileRowNumber:[!1]}),this.updateConnection(a),this._connectionKeySubscription&&this._connectionKeySubscription.unsubscribe(),this._connectionKeySubscription=this.bulkLoadForm.controls.connectionKey.valueChanges.subscribe(e=>{this.updateConnection(e)})}),this._flatFilesSubscription&&this._flatFilesSubscription.unsubscribe(),this._flatFilesSubscription=this.hubService.getFlatFilesObservable().subscribe(e=>{e.reference===this.reference&&(this.tables=e.tables)})}catch(e){this.hubService.addHubClientErrorMessage(e,"Files Manage")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._flatFilesSubscription&&this._flatFilesSubscription.unsubscribe(),this._connectionKeySubscription&&this._connectionKeySubscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}updateConnection(e){this.connection=this.hubCache.getConnection(e),!this.connection&&e?this.hubService.addHubErrorMessage(`The connection with the key ${e} could not be found.`):this.connection&&(this.pageTitle="Load files for "+this.connection.name,this.showPage=!0)}uploadFile(e){return this.doUpload(e.srcElement.files),!1}filesDrop(e){this.doUpload(e)}doUpload(e){Array.prototype.forEach.call(e,e=>{let t=this.bulkLoadForm.value;this.hubService.bulkUploadFiles(t.connectionKey,t.fileFormatKey,t.formatType,t.includeFileName,t.includeFileDate,t.includeFileRowNumber,e.name,this.cancelToken).then(t=>{let i=t.url;this.reference=t.reference;let n=new a.d(e,i);this.uploadedFiles=this.uploadedFiles.concat(n),this.automaticUpload&&this.authService.upload(n).then(t=>{t.success?this.hubService.addHubSuccessMessage(e.name+" uploaded."):this.hubService.addHubMessage(t)}).catch(e=>{this.hubService.addHubMessage(e)})}).catch(e=>{this.hubService.addHubMessage(e)})})}editTable(e){this.currentTable=e,this.formsService.table(e),this.router.navigate(["table-edit"],{relativeTo:this.route})}applyChanges(){this.formsService.hasChanged&&Object.assign(this.currentTable,this.formsService.currentForm.value),this.currentTable=null,this.authService.navigateUp()}cancel(){this.currentTable=null,this.authService.navigateUp()}saveTables(e){return g(this,void 0,void 0,(function*(){let t=Object.assign([],this.tables),i=[];for(let a=0;a<e.length;a++){let n=e[a],s=yield this.hubService.saveTables([n]);i.push(s[0].key);let o=this.tables.findIndex(e=>n.key===e.key);t.splice(o,1)}return this.tables=t,i}))}createDatalinks(e){return g(this,void 0,void 0,(function*(){let t=(yield this.saveTables(e)).join("|");this.router.navigate(["/hub",this.hubCache.hub.hubKey,"tables","datalink-new",t,0],{relativeTo:this.route.root})}))}discardTables(e){let t=Object.assign([],this.tables);for(let i=0;i<e.length;i++){let a=e[i],n=this.tables.findIndex(e=>a.key===e.key);t.splice(n,1)}this.tables=t}uploadSelected(e){e.forEach(e=>{this.authService.upload(e).then(e=>{this.hubService.addHubMessage(e)}).catch(e=>{this.hubService.addHubMessage(e)})})}removeSelected(e){e.forEach(e=>{let t=this.uploadedFiles.findIndex(t=>t.id===e.id);t>=0&&this.uploadedFiles.splice(t,1)})}cancelSelected(e){e.forEach(e=>e.cancel())}canDeactivate(){return new Promise(e=>{this.tables.length>0?this.authService.confirmDialog("Unsaved tables!","Table(s) have not been saved, this action will discard unsaved tables.  Do you want to discard the changes and exit?").then(t=>{e(t)}).catch(()=>{e(!1)}):e(!0)})}unloadNotification(e){this.tables.length>0&&(e.returnValue="Table(s) have not been saved, this action will discard unsaved tables.  Do you want to discard the changes and exit?")}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(c.a),r.Kb(l.a),r.Kb(u.a),r.Kb(u.e),r.Kb(h.a),r.Kb(b.g))},e.\u0275cmp=r.Eb({type:e,selectors:[["files-bulk-load"]],hostBindings:function(e,t){1&e&&r.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,r.uc)},decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"alert","alert-danger","m-3"],[1,"btn","btn-sm","btn-primary","text-white",3,"routerLink","title"],[1,"container"],["iconClass","fa fa-lg fa-fw fa-files-o",3,"title","showCloseButton","close",4,"ngIf"],[3,"title","showCloseButton","close",4,"ngIf"],["iconClass","fa fa-lg fa-fw fa-files-o",3,"title","showCloseButton","close"],[3,"formGroup",4,"ngIf"],["class","list-group",4,"ngIf"],[3,"formGroup"],[1,"m-3"],["label","Connection","formControlName","connectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","The connection where the files will be uploaded to.",3,"items"],[3,"routerLink"],[1,"fa","fa-sticky-note-o"],[1,"form-row"],[1,"col-md-6"],["label","Format Type","formControlName","formatType","itemKey","key","itemName","name","iconClass","fa fa-text","note","The format of data.",3,"items"],["class","col-md-6",4,"ngIf"],["label","Include file name field","formControlName","includeFileName"],["label","Include file date field","formControlName","includeFileDate"],["label","Include file row field","formControlName","includeFileRowNumber"],["label","File Format","formControlName","fileFormatKey","placeholder","File Format","itemKey","key","itemName","name","note","Specify the file format to use, if not specified, a csv (command separated) format will be used.","selectNullMessage","Use default (csv) format",3,"items","enableFilter","allowNullSelect"],[1,"list-group"],["title","Drop Files to Load",3,"showExpandButton"],["dropZone","","dropAllowedClass","nv-file-over",1,"well","my-drop-zone",3,"requireFiles","dropFiles"],[1,"custom-file","w-25","float-right"],["type","file","onclick","this.value=null",1,"custom-file-input",3,"change"],["for","inputGroupFile01",1,"custom-file-label"],["title","Upload Queues",3,"showExpandButton","padding"],[3,"enableMultiSelect","columns","data"],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["select","rowStatus"],["rowStatus",""],["title","Tables Created",3,"showExpandButton","padding"],[3,"enableMultiSelect","columns","data","rowClick"],["iconClass","fa fa-upload","buttonClass","btn-primary",1,"mr-1",3,"click"],[1,"mr-1",3,"click"],["text","Remove",3,"click"],[1,"d-flex","align-items-center","h-100"],["label","Automatically upload files when added to the queue.",3,"ngModel","ngModelChange"],["class","progress","style","margin-bottom: 0;",4,"ngIf"],[1,"fa",3,"ngClass"],[1,"progress",2,"margin-bottom","0"],["role","progressbar",1,"progress-bar",3,"ngStyle"],["iconClass","fa fa-table","title","Save the selected tables.",1,"ml-1",3,"click"],["iconClass","fa fa-exchange","title","Save the selected tables, and create datalinks to load them into a staging area.",1,"ml-1",3,"click"],["title","Discard the selected tables.","text","Discard",1,"ml-1",3,"click"],[3,"title","showCloseButton","close"],["header",""],[3,"click"],[1,"ml-1",3,"click"]],template:function(e,t){1&e&&(r.Dc(0,v,7,1,"section",0),r.Dc(1,K,3,2,"div",1)),2&e&&(r.hc("ngIf",(null==t.hubCache?null:t.hubCache.hub)&&(!t.fileConnections||0===t.fileConnections.length)),r.yb(1),r.hc("ngIf",t.fileConnections&&t.fileConnections.length>0))},directives:[d.t,u.h,m.P,b.I,b.t,b.l,m.E,b.s,b.j,m.A,m.T,f.a,p.a,m.f,m.b,m.g,b.v,d.q,d.w,u.j,m.a],encapsulation:2}),e})()},LyCD:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var a=i("itXk"),n=i("cvPx"),s=i("3WyZ"),o=i("2v7R"),r=i("soiQ"),c=i("fXoL"),l=i("4Y1E"),u=i("ElCs"),h=i("tyNb"),b=i("Wumg"),d=i("iFLP"),m=i("ofXK"),f=i("79jk"),p=i("64E1"),g=i("oLr2");const v=["dashboardItem"];function y(e,t){if(1&e){const e=c.Pb();c.Ob(0,"li"),c.Ob(1,"a",8),c.Vb("click",(function(){c.vc(e);const i=t.$implicit;return c.Zb(2).add(i.key)})),c.Fc(2),c.Nb(),c.Nb()}if(2&e){const e=t.$implicit;c.yb(2),c.Gc(e.name)}}function C(e,t){if(1&e&&c.Lb(0,"save-button",13),2&e){const e=c.Zb(2);c.hc("formsService",e.formsService)}}function w(e,t){if(1&e){const e=c.Pb();c.Ob(0,"dexih-invalid-form-details",3),c.Vb("click",(function(){return c.vc(e),c.Zb().formsService.showErrors()})),c.Nb(),c.Ob(1,"dexih-button-edit",4),c.Vb("click",(function(){return c.vc(e),c.Zb().toggleEdit()})),c.Nb(),c.Ob(2,"dexih-button",5),c.Vb("click",(function(){return c.vc(e),c.Zb().toggleLock()})),c.Nb(),c.Ob(3,"dexih-button-refresh",6),c.Vb("click",(function(){return c.vc(e),c.Zb().refresh()})),c.Nb(),c.Ob(4,"dexih-button-dropdown",7),c.Ob(5,"a",8),c.Vb("click",(function(){return c.vc(e),c.Zb().newView()})),c.Fc(6,"(New View)"),c.Nb(),c.Dc(7,y,3,1,"li",9),c.Nb(),c.Ob(8,"download-button",10),c.Vb("download",(function(t){return c.vc(e),c.Zb().download(t)})),c.Nb(),c.Dc(9,C,1,1,"save-button",11),c.Lb(10,"cancel-button",12)}if(2&e){const e=c.Zb();c.hc("control",e.formsService.currentForm),c.yb(1),c.hc("text",null!=e.formsService.currentForm&&e.formsService.currentForm.controls.runTime.value.showEdit?"Hide Edit":"Edit"),c.yb(1),c.hc("iconClass",null!=e.formsService.currentForm&&e.formsService.currentForm.controls.runTime.value.lock?"fa fa-lock":"fa fa-unlock")("text",null!=e.formsService.currentForm&&e.formsService.currentForm.controls.runTime.value.lock?"Unlock":"Lock"),c.yb(5),c.hc("ngForOf",e.views),c.yb(2),c.hc("ngIf",e.hubCache.canWrite),c.yb(1),c.hc("formsService",e.formsService)}}let S=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.isLoaded=!1,this.isRefreshing=!1,this.refreshComplete=!1,this.cancelToken=new s.a}ngOnInit(){try{this._subscription=Object(a.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.remoteAgent=e[3],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.status===o.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.views=this.hubCache.hub.dexihViews,this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"Dashboard Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}load(){if(this.isLoaded=!0,"edit"===this.action)if(this.dashboardKey=+this.params.dashboardKey,this.dashboardKey)if(this.hubCache.hub&&this.hubCache.hub.dexihColumnValidations){let e=this.hubCache.hub.dexihDashboards.find(e=>e.key===this.dashboardKey);e=JSON.parse(JSON.stringify(e)),this.formsService.dashboard(e)}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no dashboard specified to edit.");if("new"===this.action){this.refreshComplete=!0;let e=new r.i;e.minCols=4,e.maxCols=100,e.minRows=4,e.maxRows=100,e.autoRefresh=!0,this.formsService.dashboard(e),this.formsService.currentForm.controls.runTime.value.showEdit=!0,this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/dashboard-new","/dashboard-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}this.formsService.currentForm.controls.autoRefresh.value&&this.remoteAgent&&!this.refreshComplete&&(this.refreshComplete=!0,this.refresh())}refresh(){this.hubService.previewDashboard(this.formsService.currentForm.value,this.formsService.currentForm.value.parameters,this.cancelToken).then(e=>{let t=this.formsService.currentForm.controls.dexihDashboardItems;e.forEach(e=>{let i=t.controls.find(t=>t.controls.key.value===e.dashboardItemKey);if(i){let t=i.controls.runTime.value.data;t.isRefreshing=!0,this.hubService.getRemoteResponse(e.dataKey,this.cancelToken).then(e=>{e.columns=this.authService.constructDataTableColumns(e.columns),t.data.next(e),t.isRefreshing=!1}).catch()}})})}toggleEdit(){let e=this.formsService.currentForm.controls.runTime.value;e.showEdit=!e.showEdit,this.formsService.currentForm.controls.runTime.setValue(e)}toggleLock(){let e=this.formsService.currentForm.controls.runTime.value;e.lock=!e.lock,this.formsService.currentForm.controls.runTime.setValue(e)}add(e){let t=this.hubCache.hub.dexihViews.find(t=>t.key===e);if(!t)return;let i=this.formsService.currentForm,a=i.controls.dexihDashboardItems,n=new r.j;n.key=this.hubCache.getNextSequence(),n.cols=1,n.rows=1,n.x=-1,n.y=-1;e:for(let o=0;o<i.controls.maxRows.value;o++)for(let e=0;e<i.controls.maxCols.value;e++){let t=!1;for(let i=0;i<a.controls.length;i++){let n=a.controls[i].value;if(n.x<=e&&n.x+n.cols>e&&n.y<=o&&n.y+n.rows>o){t=!0;break}}if(!t){n.x=e,n.y=o;break e}}n.viewKey=e,n.name=t.name;let s=this.formsService.dashboardItem(n);this.formsService.updateDashboardItemView(s),a.push(s)}newView(){this.router.navigate(["view-new"],{relativeTo:this.route})}download(e){let t=this.formsService.currentForm.controls.dexihDashboardItems.value.filter(e=>e.viewKey).map(e=>{let t=this.hubCache.hub.dexihViews.find(t=>t.key===e.viewKey),i=new r.M;return t.sourceType===r.lb.Datalink&&(i.objectKey=t.sourceDatalinkKey,i.objectType=r.lb.Datalink),t.sourceType===r.lb.Table&&(i.objectKey=t.sourceTableKey,i.objectType=r.lb.Table),i.query=t.selectQuery,i});this.hubService.downloadData(t,!1,e,this.cancelToken)}canDeactivate(){return new Promise(e=>{this.formsService.hasChanged?this.authService.confirmDialog("The dashboard has not been saved","The dashboard changes have not been saved.  Do you want to discard the changes and exit?").then(t=>{e(t)}).catch(()=>{e(!1)}):e(!0)})}unloadNotification(e){this.formsService.hasChanged&&(e.returnValue="The dashboard changes have not been saved.  Do you want to discard the changes and exit?")}}return e.\u0275fac=function(t){return new(t||e)(c.Kb(l.a),c.Kb(u.a),c.Kb(n.a),c.Kb(h.a),c.Kb(h.e))},e.\u0275cmp=c.Eb({type:e,selectors:[["dexih-dashboard-edit-form"]],viewQuery:function(e,t){var i;1&e&&c.Kc(v,!0),2&e&&c.rc(i=c.Wb())&&(t.dashboardItems=i)},hostBindings:function(e,t){1&e&&c.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,c.uc)},features:[c.xb([n.a])],decls:5,vars:3,consts:[[1,"container-fluid"],["iconClass","fa fa-lg fa-fw fa-pie-chart",3,"title","showCloseButton","padding","close"],["header",""],[1,"mr-1",3,"control","click"],[1,"mr-1",3,"text","click"],[1,"mr-1",3,"iconClass","text","click"],[1,"mr-1",3,"click"],["iconClass","fa fa-plus","text","Add",1,"mr-1"],[1,"dropdown-item",3,"click"],[4,"ngFor","ngForOf"],[1,"mr-1",3,"download"],["class","mr-1",3,"formsService",4,"ngIf"],[3,"formsService"],[1,"mr-1",3,"formsService"]],template:function(e,t){1&e&&(c.Ob(0,"div",0),c.Ob(1,"dexih-widget",1),c.Vb("close",(function(){return t.close()})),c.Dc(2,w,11,7,"ng-template",null,2,c.Ec),c.Lb(4,"router-outlet"),c.Nb(),c.Nb()),2&e&&(c.yb(1),c.jc("title","Dashboard - ",null==t.formsService||null==t.formsService.currentForm?null:t.formsService.currentForm.controls.name.value,""),c.hc("showCloseButton",!0)("padding",!1))},directives:[b.P,h.j,d.a,b.j,b.f,b.s,b.i,m.s,f.a,m.t,p.a,g.a],encapsulation:2}),e})()},MbvK:function(e,t,i){"use strict";i.d(t,"a",(function(){return U}));var a=i("XNiG"),n=i("itXk"),s=i("VRyK"),o=i("cvPx"),r=i("Z+eP"),c=i("3WyZ"),l=i("2v7R"),u=i("soiQ"),h=i("fXoL"),b=i("4Y1E"),d=i("ElCs"),m=i("tyNb"),f=i("ofXK"),p=i("Wumg"),g=i("PMKX"),v=i("/pur"),y=i("iFLP"),C=i("79jk"),w=i("64E1"),S=i("oLr2"),k=i("YcGA"),O=i("3Pt+"),T=i("+F4M"),N=i("hJJo"),D=i("RXlv"),x=i("H3K+"),F=i("kzgk");function V(e,t){if(1&e&&h.Lb(0,"save-button",23),2&e){const e=h.Zb(3);h.hc("formsService",e.formsService)}}const I=function(e){return{active:e}};function K(e,t){if(1&e){const e=h.Pb();h.Ob(0,"dexih-invalid-form-details",10),h.Vb("click",(function(){return h.vc(e),h.Zb(2).formsService.showErrors()})),h.Nb(),h.Ob(1,"dexih-button-refresh",11),h.Vb("click",(function(){return h.vc(e),h.Zb(2).refresh()})),h.Nb(),h.Ob(2,"download-button",12),h.Vb("download",(function(t){return h.vc(e),h.Zb(2).download(t)})),h.Nb(),h.Ob(3,"div",13),h.Ob(4,"label",14),h.Ob(5,"input",15),h.Vb("click",(function(){return h.vc(e),h.Zb(2).toggleChart()})),h.Nb(),h.Lb(6,"i",16),h.Nb(),h.Ob(7,"label",17),h.Ob(8,"input",18),h.Vb("click",(function(){return h.vc(e),h.Zb(2).toggleChart()})),h.Nb(),h.Lb(9,"i",19),h.Nb(),h.Nb(),h.Dc(10,V,1,1,"save-button",20),h.Ob(11,"dexih-button-edit",21),h.Vb("click",(function(){return h.vc(e),h.Zb(2).toggleEdit()})),h.Nb(),h.Lb(12,"cancel-button",22)}if(2&e){const e=h.Zb(2);h.hc("control",e.formsService.currentForm),h.yb(4),h.hc("ngClass",h.mc(6,I,!1===e.showChart)),h.yb(3),h.hc("ngClass",h.mc(8,I,!0===e.showChart)),h.yb(3),h.hc("ngIf",e.hubCache.canWrite),h.yb(1),h.hc("text",e.showEdit?"Hide Edit":"Edit"),h.yb(1),h.hc("formsService",e.formsService)}}function E(e,t){if(1&e&&(h.Ob(0,"section",32),h.Ob(1,"form-select",37),h.Lb(2,"table-edit-button",38),h.Nb(),h.Nb()),2&e){const e=h.Zb(4);h.yb(1),h.hc("errors",null==e.errors?null:e.errors.sourceTableKey)("items",e.connectionTables),h.yb(1),h.hc("key",e.formsService.currentForm.controls.sourceTableKey.value)}}function L(e,t){if(1&e){const e=h.Pb();h.Ob(0,"section",32),h.Ob(1,"form-select",39),h.Lb(2,"datalink-edit-button",38),h.Nb(),h.Ob(3,"dexih-button-refresh",40),h.Vb("click",(function(){return h.vc(e),h.Zb(4).refreshDatalink()})),h.Nb(),h.Nb()}if(2&e){const e=h.Zb(4);h.yb(1),h.hc("errors",null==e.errors?null:e.errors.sourceDatalinkKey)("items",e.datalinks),h.yb(1),h.hc("key",e.formsService.currentForm.controls.sourceDatalinkKey.value)}}function P(e,t){if(1&e&&(h.Ob(0,"form",28),h.Ob(1,"fieldset"),h.Ob(2,"section"),h.Lb(3,"form-input",29),h.Nb(),h.Ob(4,"section"),h.Lb(5,"form-textarea",30),h.Nb(),h.Ob(6,"section"),h.Ob(7,"div",31),h.Ob(8,"section",32),h.Lb(9,"form-select",33),h.Nb(),h.Dc(10,E,3,3,"section",34),h.Dc(11,L,4,3,"section",34),h.Nb(),h.Lb(12,"form-checkbox",35),h.Lb(13,"form-checkbox",36),h.Nb(),h.Nb(),h.Nb()),2&e){const e=h.Zb(3);h.hc("formGroup",e.formsService.currentForm),h.yb(3),h.hc("autocapitalize",e.on)("errors",e.formsService.formErrors.name),h.yb(2),h.hc("showMarkdown",!0),h.yb(4),h.hc("items",e.sourceTypes)("enableFilter",!1),h.yb(1),h.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eDataObjectType.Table),h.yb(1),h.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eDataObjectType.Datalink)}}function M(e,t){if(1&e){const e=h.Pb();h.Ob(0,"div",41),h.Ob(1,"dexih-button-refresh",42),h.Vb("click",(function(){return h.vc(e),h.Zb(3).refresh()})),h.Nb(),h.Nb()}2&e&&(h.yb(1),h.hc("autoCompact",!1))}function j(e,t){if(1&e){const e=h.Pb();h.Ob(0,"dexih-widget-section",24),h.Dc(1,P,14,8,"form",25),h.Ob(2,"input-parameters",26),h.Vb("onRefreshData",(function(){return h.vc(e),h.Zb(2).refresh()}))("onChange",(function(){return h.vc(e),h.Zb(2).parameterChange()})),h.Nb(),h.Dc(3,M,2,1,"div",27),h.Nb()}if(2&e){const e=h.Zb(2);h.hc("showExpandButton",!0),h.yb(1),h.hc("ngIf",e.showEdit),h.yb(1),h.hc("showEdit",e.showEdit)("parameters",null==e.formsService.currentForm?null:e.formsService.currentForm.controls.parameters)("formsService",e.formsService)("refreshEvent",e.refreshDataSubject.asObservable()),h.yb(1),h.hc("ngIf",!e.data||0===e.data.length)}}function A(e,t){if(1&e){const e=h.Pb();h.Ob(0,"span",45),h.Ob(1,"div",46),h.Ob(2,"div",47),h.Fc(3),h.Nb(),h.Nb(),h.Ob(4,"form-input",48),h.Vb("ngModelChange",(function(i){return h.vc(e),t.$implicit.value=i})),h.Nb(),h.Nb()}if(2&e){const e=t.$implicit,i=t.index;h.yb(3),h.Hc(" ",e.logicalName," "),h.yb(1),h.jc("name","column",i,""),h.hc("placeholder","Enter "+e.logicalName)("ngModel",e.value)}}function R(e,t){if(1&e&&(h.Ob(0,"dexih-widget-section",43),h.Dc(1,A,5,4,"span",44),h.Nb()),2&e){const e=h.Zb(2);h.hc("showExpandButton",!0),h.yb(1),h.hc("ngForOf",e.inputColumns)}}function _(e,t){if(1&e){const e=h.Pb();h.Ob(0,"dexih-widget-section",49),h.Ob(1,"query-builder",50),h.Vb("hasChanged",(function(){return h.vc(e),h.Zb(2).hasChanged()}))("onRefreshData",(function(){return h.vc(e),h.Zb(2).refresh()})),h.Nb(),h.Nb()}if(2&e){const e=h.Zb(2);h.hc("showExpandButton",!0),h.yb(1),h.hc("selectQuery",e.formsService.currentForm.controls.selectQuery.value)("columns",e.tableColumns)("inputColumns",e.inputColumns)("parameters",e.formsService.currentForm.controls.parameters.value)("refreshEvent",e.refreshDataSubject.asObservable())}}function Z(e,t){if(1&e){const e=h.Pb();h.Ob(0,"dexih-button-refresh",11),h.Vb("click",(function(){return h.vc(e),h.Zb(4).refresh()})),h.Nb()}}function H(e,t){if(1&e&&(h.Ob(0,"dexih-table",53),h.Dc(1,Z,1,0,"ng-template",null,54,h.Ec),h.Nb()),2&e){const e=h.Zb(3);h.hc("enableMultiSelect",!1)("enableSaveCsv",!0)("columns",e.columns)("data",e.data)("hideTable",e.showChart)}}function G(e,t){if(1&e){const e=h.Pb();h.Ob(0,"div"),h.Ob(1,"chart-builder",55),h.Vb("hasChanged",(function(){return h.vc(e),h.Zb(3).hasChanged()})),h.Nb(),h.Nb()}if(2&e){const e=h.Zb(3);h.yb(1),h.hc("title",e.formsService.currentForm.controls.name.value)("columns",e.columns)("data",e.data)("config",e.formsService.currentForm.controls.chartConfig.value)("showEdit",e.showEdit)}}function q(e,t){if(1&e&&(h.Dc(0,H,3,5,"dexih-table",51),h.Dc(1,G,2,5,"div",52)),2&e){const e=h.Zb(2);h.hc("ngIf",!e.showChart),h.yb(1),h.hc("ngIf",e.showChart)}}function B(e,t){if(1&e){const e=h.Pb();h.Ob(0,"div",1),h.Ob(1,"dexih-widget",2),h.Vb("close",(function(){return h.vc(e),h.Zb().close()})),h.Dc(2,K,13,10,"ng-template",null,3,h.Ec),h.Dc(4,j,4,7,"dexih-widget-section",4),h.Dc(5,R,2,2,"dexih-widget-section",5),h.Ob(6,"series-animate",6),h.Vb("hasChanged",(function(){return h.vc(e),h.Zb().hasChanged()}))("dataChange",(function(t){return h.vc(e),h.Zb().data=t})),h.Nb(),h.Dc(7,_,2,6,"dexih-widget-section",7),h.Dc(8,q,2,2,"ng-template",8),h.Nb(),h.Lb(9,"dexih-help",9),h.Nb()}if(2&e){const e=h.Zb();h.yb(1),h.hc("showCloseButton",!0)("padding",!1),h.yb(3),h.hc("ngIf",e.formsService.currentForm&&(e.showEdit||(null==e.formsService.currentForm?null:e.formsService.currentForm.controls.parameters.length)>0||(null==e.datalinkParameters?null:e.datalinkParameters.length)>0)),h.yb(1),h.hc("ngIf",e.inputColumns&&e.inputColumns.length>0),h.yb(1),h.hc("showEdit",e.showEdit)("animateConfig",e.animateConfig)("columns",e.columns)("baseData",e.baseData)("data",e.data),h.yb(1),h.hc("ngIf",e.showEdit),h.yb(1),h.hc("ngIf",(null==e.columns?null:e.columns.length)>0&&(null==e.data?null:e.data.length)>0)}}let U=(()=>{class e{constructor(e,t,i,n,s){this.hubService=e,this.authService=t,this.formsService=i,this.route=n,this.router=s,this.showEdit=!1,this.hasEdited=!1,this.refreshDataSubject=new a.a,this.sourceTypes=[{key:u.lb.Datalink,name:"Datalink"},{key:u.lb.Table,name:"Table"}],this.eViewType=u.rc,this.eDataObjectType=u.lb,this.connectionTables=[],this.datalinks=[],this.showChart=!1,this.isLoaded=!1,this.firstLoad=!0,this.dialogOpen=!1,this.animationValues=[],this.animationPaused=!1,this.cancelToken=new c.a}get animateConfig(){var e,t;return null===(t=null===(e=this.formsService)||void 0===e?void 0:e.currentForm)||void 0===t?void 0:t.controls.animateConfig.value}set animateConfig(e){var t,i;null===(i=null===(t=this.formsService)||void 0===t?void 0:t.currentForm)||void 0===i||i.controls.animateConfig.setValue(e)}get selectQuery(){var e,t;return null===(t=null===(e=this.formsService)||void 0===e?void 0:e.currentForm)||void 0===t?void 0:t.controls.selectQuery.value}set selectQuery(e){var t,i;null===(i=null===(t=this.formsService)||void 0===t?void 0:t.currentForm)||void 0===i||i.controls.selectQuery.setValue(e)}ngOnInit(){try{this._subscription=Object(n.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.remoteAgent=e[3],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.status===l.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(()=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"View Edit")}}load(){if(this.isLoaded=!0,this.hubCache&&this.hubCache.isLoaded()&&(this.connectionTables=this.hubCache.getConnectionTables(),this.datalinks=this.hubCache.hub.dexihDatalinks),"edit"===this.action)if(this.viewKey=+this.params.viewKey,this.viewKey)if(this.hubCache.hub&&this.hubCache.hub.dexihColumnValidations){let e=this.hubCache.hub.dexihViews.find(e=>e.key===this.viewKey);e=JSON.parse(JSON.stringify(e)),null==e.selectQuery&&(e.selectQuery=new u.V),null==e.animateConfig&&(e.animateConfig=new u.a),this.inputColumns=e.inputValues,this.showChart=e.viewType===u.rc.Chart,this.formsService.view(e),this.watchChanges(),this.getColumns()}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no view specified to edit.");if("new"===this.action){let e=new u.L;e.selectQuery=new u.V,e.animateConfig=new u.a,this.formsService.view(e),this.watchChanges(),this.showEdit=!0,this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/view-new","/view-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}this.remoteAgent&&(this.firstLoad?this.formsService.currentForm.controls.autoRefresh.value&&this.refresh():this.dialogOpen||(this.dialogOpen=!0,this.authService.confirmDialog("Remote Agent Available","A remote agent is available, would you like to refresh the data?").then(e=>{e&&this.refresh(),this.dialogOpen=!1})))}watchChanges(){this._changesSubscription&&this._changesSubscription.unsubscribe(),this._changesSubscription=Object(s.a)(this.formsService.currentForm.controls.sourceDatalinkKey.valueChanges,this.formsService.currentForm.controls.sourceTableKey.valueChanges).subscribe(()=>{this.reset(),this.selectQuery=new u.V,this.animateConfig=new u.a,this.getColumns(),this.refreshDatalink(),this.refresh()})}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._changesSubscription&&this._changesSubscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}toggleChart(){this.showChart?(this.showChart=!1,this.formsService.currentForm.controls.viewType.setValue(u.rc.Table)):(this.showChart=!0,null==this.formsService.currentForm.controls.chartConfig.value&&this.formsService.currentForm.controls.chartConfig.setValue(new u.b),this.formsService.currentForm.controls.viewType.setValue(u.rc.Chart))}getColumns(){let e=this.formsService.currentForm,t=e.controls.inputValues.value;if(e.controls.sourceType.value===u.lb.Table&&e.controls.sourceTableKey.value>0){let i=this.hubCache.getTable(e.controls.sourceTableKey.value);if(i)return this.inputColumns=i.dexihTableColumns.filter(e=>e.isInput).map(e=>(t.find(t=>t.name===e.name),{datalinkKey:0,datalinkName:"",name:e.name,logicalName:e.logicalName,dataType:e.dataType,rank:e.rank,value:e.defaultValue,defaultValue:e.defaultValue})),void(this.tableColumns=i.dexihTableColumns);this.reset()}else this.reset();if(e.controls.sourceType.value===u.lb.Datalink&&e.controls.sourceDatalinkKey.value>0){let i=this.datalinks.find(t=>t.key===e.controls.sourceDatalinkKey.value);if(i){const e=new r.b;e.buildInputOutput(this.hubCache,i),this.tableColumns=e.getDatalinkOutputColumns(i),this.inputColumns=i.sourceDatalinkTable.dexihDatalinkColumns.filter(e=>e.isInput).map(e=>{let a=t.find(t=>t.name===e.name),n=null;return n=a?a.value:e.defaultValue,{datalinkKey:i.key,datalinkName:i.name,name:e.name,logicalName:e.logicalName,dataType:e.dataType,rank:e.rank,value:n,defaultValue:e.defaultValue}})}else this.reset()}else this.reset()}reset(){this.tableColumns=[],this.inputColumns=[],this.columns=null,this.data=null,this.baseData=null}refreshDatalink(){let e=this.formsService.currentForm,t=this.formsService.currentForm.controls.parameters;for(let i=t.controls.length-1;i>=0;i--)t.controls[i].value.datalinkParameterKey&&t.removeAt(i);if(e.controls.sourceType.value===u.lb.Datalink&&e.controls.sourceDatalinkKey.value>0){let i=this.datalinks.find(t=>t.key===e.controls.sourceDatalinkKey.value);if(i){let e=i.parameters;for(let i of e){let e=Object.assign({},i);e.datalinkParameterKey=i.key,e.key=this.hubCache.getNextSequence();let a=this.formsService.parameter(e);t.push(a)}}}}refresh(){let e=this.formsService.currentForm,t=[],i=this.formsService.currentForm.controls.parameters.getRawValue();i&&(t=t.concat(i));let a=e.value;a.selectQuery=e.controls.selectQuery.value,a.animateConfig=e.controls.animateConfig.value,(a.sourceType===u.lb.Table&&a.sourceTableKey>0||a.sourceType===u.lb.Datalink&&a.sourceDatalinkKey>0)&&this.hubService.previewView(a,this.inputColumns,t,this.cancelToken).then(e=>{this.refreshDataSubject.next(),this.columns=e.columns,this.baseData=e.data,this.animateConfig.seriesColumn||(this.data=this.baseData)}).catch(()=>{})}download(e){let t=this.formsService.currentForm.value,i=new u.M;t.sourceType===u.lb.Datalink&&(i.objectKey=t.sourceDatalinkKey,i.objectType=u.lb.Datalink),t.sourceType===u.lb.Table&&(i.objectKey=t.sourceTableKey,i.objectType=u.lb.Table),i.query=this.selectQuery,this.hubService.downloadData([i],!1,e,this.cancelToken)}hasChanged(){this.formsService.markAsChanged()}parameterChange(){this.formsService.currentForm.controls.autoRefresh.value&&this.refresh()}toggleEdit(){this.showEdit=!this.showEdit,this.hasEdited=!0}canDeactivate(){return new Promise(e=>{this.hasEdited&&this.formsService.hasChanged?this.authService.confirmDialog("The view has not been saved","The view changes have not been saved.  Do you want to discard the changes and exit?").then(t=>{e(t)}).catch(()=>{e(!1)}):e(!0)})}unloadNotification(e){this.hasEdited&&this.formsService.hasChanged&&(e.returnValue="The view changes have not been saved.  Do you want to discard the changes and exit?")}}return e.\u0275fac=function(t){return new(t||e)(h.Kb(b.a),h.Kb(d.a),h.Kb(o.a),h.Kb(m.a),h.Kb(m.e))},e.\u0275cmp=h.Eb({type:e,selectors:[["dexih-view-edit-form"]],hostBindings:function(e,t){1&e&&h.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,h.uc)},features:[h.xb([o.a])],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["title","Edit View","iconClass","fa fa-lg fa-fw fa-bar-chart",3,"showCloseButton","padding","close"],["header",""],["title","Properties",3,"showExpandButton",4,"ngIf"],["title","InputColumns",3,"showExpandButton",4,"ngIf"],[3,"showEdit","animateConfig","columns","baseData","data","hasChanged","dataChange"],["title","Query Configuration",3,"showExpandButton",4,"ngIf"],[3,"ngIf"],["title","Views","path","/assets/help/reference/view.md",1,"m-3"],[1,"mr-1",3,"control","click"],["text","Reload",1,"mr-1",3,"click"],[1,"mr-1",3,"download"],["data-toggle","buttons","title","Table",1,"btn-group","btn-group-toggle","mr-1"],[1,"btn","btn-primary",3,"ngClass"],["type","radio","name","options","value","table","autocomplete","off",3,"click"],[1,"fa","fa-table"],["title","Chart",1,"btn","btn-primary",3,"ngClass"],["type","radio","name","options","value","chart","autocomplete","off",3,"click"],[1,"fa","fa-bar-chart"],["class","mr-1",3,"formsService",4,"ngIf"],[1,"mr-1",3,"text","click"],[3,"formsService"],[1,"mr-1",3,"formsService"],["title","Properties",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],[3,"showEdit","parameters","formsService","refreshEvent","onRefreshData","onChange"],["class","mt-3",4,"ngIf"],[3,"formGroup"],["label","View Name","formControlName","name","placeholder","Enter the view name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Data Source Type","formControlName","sourceType","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the source type for this view",3,"items","enableFilter"],["class","form-group col-md-6",4,"ngIf"],["formControlName","autoRefresh","label","Automatically refresh data when view is opened"],["label","View is shared in the catalog to users with read access.","formControlName","isShared"],["label","Source Table","formControlName","sourceTableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the source table",3,"errors","items"],[3,"key"],["label","Source Datalink","formControlName","sourceDatalinkKey","itemKey","key","itemName","name","note","Select the source datalink",3,"errors","items"],["text","Refresh Parameters",3,"click"],[1,"mt-3"],["text","Reload",1,"mr-1",3,"autoCompact","click"],["title","InputColumns",3,"showExpandButton"],["class","input-group",4,"ngFor","ngForOf"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0",3,"name","placeholder","ngModel","ngModelChange"],["title","Query Configuration",3,"showExpandButton"],[3,"selectQuery","columns","inputColumns","parameters","refreshEvent","hasChanged","onRefreshData"],[3,"enableMultiSelect","enableSaveCsv","columns","data","hideTable",4,"ngIf"],[4,"ngIf"],[3,"enableMultiSelect","enableSaveCsv","columns","data","hideTable"],["actions",""],[3,"title","columns","data","config","showEdit","hasChanged"]],template:function(e,t){1&e&&h.Dc(0,B,10,11,"div",0),2&e&&h.hc("ngIf",t.formsService)},directives:[f.t,p.P,g.a,v.a,y.a,p.s,C.a,f.q,p.j,w.a,S.a,p.T,k.a,O.I,O.t,O.l,p.D,O.s,O.j,p.H,p.E,p.A,T.a,N.a,f.s,O.v,D.a,x.a,F.a],encapsulation:2}),e})()},NUI7:function(e,t,i){"use strict";i.d(t,"b",(function(){return S})),i.d(t,"a",(function(){return L}));var a=i("2Vo4"),n=i("itXk"),s=i("soiQ"),o=i("fXoL"),r=i("4Y1E"),c=i("ElCs"),l=i("tyNb"),u=i("Wumg"),h=i("H3K+"),b=i("/pur"),d=i("ofXK"),m=i("EjXd"),f=i("mWX8");const p=function(){return["fileFormat-new"]};function g(e,t){1&e&&o.Lb(0,"dexih-button-new",10),2&e&&o.hc("routerLink",o.lc(1,p))}function v(e,t){if(1&e&&o.Dc(0,g,1,2,"dexih-button-new",9),2&e){const e=o.Zb();o.hc("ngIf",e.hubCache.canWrite)}}function y(e,t){1&e&&o.Lb(0,"actions-fileFormat-button",11),2&e&&o.hc("fileFormat",t.item)}function C(e,t){if(1&e){const e=o.Pb();o.Ob(0,"dexih-button-delete",15),o.Vb("click",(function(){o.vc(e);const t=o.Zb().items;return o.Zb().deleteFileFormats(t)})),o.Nb()}}function w(e,t){if(1&e){const e=o.Pb();o.Ob(0,"dexih-button-save-local",12),o.Vb("click",(function(){o.vc(e);const i=t.items;return o.Zb().export(i)})),o.Nb(),o.Dc(1,C,1,0,"dexih-button-delete",13),o.Lb(2,"tags-update-button",14)}if(2&e){const e=t.items,i=o.Zb();o.yb(1),o.hc("ngIf",i.hubCache.canWrite),o.yb(1),o.hc("objectType",i.eSharedObjectType.FileFormat)("objects",e)}}let S=(()=>{class e{constructor(e,t,i,n){this.hubService=e,this.authService=t,this.router=i,this.route=n,this.eSharedObjectType=s.dc,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new a.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(n.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[2],this.updateFileFormats()})}catch(e){this.hubService.addHubClientErrorMessage(e,"File Format Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}deleteFileFormats(e){this.hubService.deleteFileFormats(e)}updateFileFormats(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihFileFormats.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,tags:this.hubCache.getObjectTags(s.dc.FileFormat,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}editFileFormat(e){this.router.navigate(["fileFormat-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubService.createHub(this.hubCache.hub.hubKey,"");e.forEach(e=>{this.hubCache.cacheAddFileFormat(e.key,t)}),this.hubService.exportHub(t,1===e.length?"FileFormat - "+e[0].name+".json":"fileFormats.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==s.dc.FileFormat&&e.changeClass!==s.dc.TagObjects||this.updateFileFormats()})}}return e.\u0275fac=function(t){return new(t||e)(o.Kb(r.a),o.Kb(c.a),o.Kb(l.e),o.Kb(l.a))},e.\u0275cmp=o.Eb({type:e,selectors:[["fileFormats"]],inputs:{hubKey:"hubKey"},decls:10,vars:7,consts:[[1,"container-fluid"],["title","File Formats","iconClass","fa fa-lg fa-fw fa-file-text-o",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["actions",""],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["title","File Formats","path","/assets/help/reference/fileFormat.md",1,"m-3"],["class","mr-1","title","Create a new file format",3,"routerLink",4,"ngIf"],["title","Create a new file format",1,"mr-1",3,"routerLink"],[1,"mr-1",3,"fileFormat"],[1,"mr-1",3,"click"],["title","Delete selected file formats",3,"click",4,"ngIf"],[1,"ml-1",3,"objectType","objects"],["title","Delete selected file formats",3,"click"]],template:function(e,t){1&e&&(o.Ob(0,"div",0),o.Ob(1,"dexih-widget",1),o.Vb("close",(function(){return t.close()})),o.Ob(2,"dexih-table",2),o.Vb("rowClick",(function(e){return t.editFileFormat(e)})),o.Dc(3,v,1,1,"ng-template",null,3,o.Ec),o.Dc(5,y,1,1,"ng-template",4,5,o.Ec),o.Dc(7,w,3,3,"ng-template",6,7,o.Ec),o.Nb(),o.Nb(),o.Lb(9,"dexih-help",8),o.Nb()),2&e&&(o.yb(1),o.hc("showCloseButton",!0),o.yb(1),o.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[u.P,h.a,b.a,d.t,u.o,l.f,m.a,u.u,f.a,u.g],encapsulation:2}),e})();var k=i("cvPx"),O=i("2v7R"),T=i("iFLP"),N=i("64E1"),D=i("oLr2"),x=i("3Pt+");function F(e,t){if(1&e&&o.Lb(0,"save-button",8),2&e){const e=o.Zb(2);o.hc("formsService",e.formsService)}}function V(e,t){if(1&e){const e=o.Pb();o.Ob(0,"dexih-invalid-form-details",5),o.Vb("click",(function(){return o.vc(e),o.Zb().formsService.showErrors()})),o.Nb(),o.Dc(1,F,1,1,"save-button",6),o.Lb(2,"cancel-button",7)}if(2&e){const e=o.Zb();o.hc("control",e.formsService.currentForm),o.yb(1),o.hc("ngIf",e.hubCache.canWrite),o.yb(1),o.hc("formsService",e.formsService)}}function I(e,t){if(1&e&&(o.Ob(0,"div"),o.Lb(1,"form-input",32),o.Nb()),2&e){const e=o.Zb(2);o.yb(1),o.hc("errors",e.formsService.formErrors.comment)}}function K(e,t){if(1&e&&(o.Ob(0,"div"),o.Lb(1,"form-input",33),o.Nb()),2&e){const e=o.Zb(2);o.yb(1),o.hc("maxlength",1)("errors",e.formsService.formErrors.quote)}}function E(e,t){if(1&e&&(o.Ob(0,"form",9),o.Ob(1,"fieldset"),o.Ob(2,"section"),o.Lb(3,"form-input",10),o.Nb(),o.Ob(4,"section"),o.Lb(5,"form-textarea",11),o.Nb(),o.Ob(6,"div",12),o.Ob(7,"section",13),o.Lb(8,"form-input",14),o.Nb(),o.Lb(9,"section",13),o.Nb(),o.Ob(10,"div",12),o.Ob(11,"section",13),o.Lb(12,"form-input",15),o.Nb(),o.Ob(13,"section",13),o.Lb(14,"form-input",16),o.Nb(),o.Nb(),o.Ob(15,"div",12),o.Ob(16,"section",13),o.Lb(17,"form-checkbox",17),o.Nb(),o.Ob(18,"section",13),o.Lb(19,"form-checkbox",18),o.Nb(),o.Nb(),o.Ob(20,"div",12),o.Ob(21,"section",13),o.Lb(22,"form-checkbox",19),o.Nb(),o.Ob(23,"section",13),o.Lb(24,"form-checkbox",20),o.Nb(),o.Nb(),o.Ob(25,"div",12),o.Ob(26,"section",13),o.Lb(27,"form-checkbox",21),o.Dc(28,I,2,1,"div",22),o.Nb(),o.Ob(29,"section",13),o.Lb(30,"form-checkbox",23),o.Dc(31,K,2,2,"div",22),o.Nb(),o.Nb(),o.Ob(32,"div",12),o.Ob(33,"section",13),o.Lb(34,"form-checkbox",24),o.Nb(),o.Ob(35,"section",13),o.Lb(36,"form-checkbox",25),o.Nb(),o.Nb(),o.Ob(37,"div",12),o.Ob(38,"section",13),o.Lb(39,"form-checkbox",26),o.Nb(),o.Ob(40,"section",13),o.Lb(41,"form-checkbox",27),o.Nb(),o.Nb(),o.Ob(42,"div",12),o.Ob(43,"section",13),o.Lb(44,"form-checkbox",28),o.Nb(),o.Ob(45,"section",13),o.Lb(46,"form-checkbox",29),o.Nb(),o.Nb(),o.Ob(47,"div",12),o.Ob(48,"section",13),o.Lb(49,"form-checkbox",30),o.Nb(),o.Ob(50,"section",13),o.Lb(51,"form-checkbox",31),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&e){const e=o.Zb();o.hc("formGroup",e.formsService.currentForm),o.yb(3),o.hc("errors",e.formsService.formErrors.name)("autocapitalize",!0),o.yb(2),o.hc("showMarkdown",!0),o.yb(3),o.hc("errors",e.formsService.formErrors.delimiter),o.yb(4),o.hc("errors",e.formsService.formErrors.bufferSize),o.yb(2),o.hc("errors",e.formsService.formErrors.skipHeaderRows),o.yb(14),o.hc("ngIf",e.formsService.currentForm.controls.allowComments.value),o.yb(3),o.hc("ngIf",!e.formsService.currentForm.controls.ignoreQuotes.value)}}let L=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.isLoaded=!1}ngOnInit(){try{this._subscription=Object(n.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.status===O.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"File Format Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe()}load(){if(this.hubCache.isLoaded()){if(!this.hubCache||this.hubCache.status!==O.j.Loaded||this.isLoaded)return;if(this.isLoaded=!0,"edit"===this.action)if(this.fileFormatKey=+this.params.fileFormatKey,this.fileFormatKey)if(this.hubCache.hub&&this.hubCache.hub.dexihColumnValidations){let e=this.hubCache.hub.dexihFileFormats.find(e=>e.key===this.fileFormatKey);this.formsService.fileFormat(e)}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no file format specified to edit.");if("new"===this.action){let e=new s.y;this.formsService.fileFormat(e),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/fileFormat-new","/fileFormat-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}}}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(o.Kb(r.a),o.Kb(c.a),o.Kb(k.a),o.Kb(l.a),o.Kb(l.e))},e.\u0275cmp=o.Eb({type:e,selectors:[["dexih-fileFormat-edit-form"]],features:[o.xb([k.a])],decls:6,vars:3,consts:[[1,"container"],["title","Edit Format","iconClass","fa fa-lg fa-fw fa-file-text-o",3,"showCloseButton","padding","close"],["header",""],[3,"formGroup",4,"ngIf"],["title","File Formats","path","/assets/help/reference/fileFormat.md",1,"m-3"],[1,"mr-1",3,"control","click"],["class","mr-1",3,"formsService",4,"ngIf"],[3,"formsService"],[1,"mr-1",3,"formsService"],[3,"formGroup"],["label","File Format Name","formControlName","name","placeholder","Enter the file format name.","iconClass","fa fa-list",3,"errors","autocapitalize"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Delimiter","formControlName","delimiter","placeholder","Enter the delimiter","iconClass","fa fa-list","note","The field delimiter (use \\t=tab, \\n=new line, \\r=carriage return).",3,"errors"],["type","number","label","Buffer Size","formControlName","bufferSize","placeholder","Enter buffer size","iconClass","fa fa-list","note","The size of the internal buffer that is used when reader or writing data.",3,"errors"],["type","number","label","Skip Header Rows Count","formControlName","skipHeaderRows","placeholder","Enter row count","iconClass","fa fa-list","note","The number of rows at the start of the file that will be ignored.",3,"errors"],["label","Has Header Record","formControlName","hasHeaderRecord","note","Tells the reader/writer if there is a header row in the CSV file."],["label","Ignore Header White Space","formControlName","ignoreHeaderWhiteSpace","note","Tells the reader to ignore white space in the headers when matching the columns to the properties by name."],["label","Match to Column to Header","formControlName","matchHeaderRecord","note","Tells the reader to use the column heading name to load the data.  If unchecked, columns will be read into fields in the order specified in the table columns."],["label","Set White Space Cells to Null ","formControlName","setWhiteSpaceCellsToNull","note","Set empty cells or cells containing only white spaces to null."],["label","Allow Comments","formControlName","allowComments"],[4,"ngIf"],["label","Ignore Quotes","formControlName","ignoreQuotes"],["label","Quote All Fields","formControlName","quoteAllFields","note","Tells the writer whether all fields written should have quotes around them; regardless if the field contains anything that should be escaped."],["label","Quote No Fields","formControlName","quoteNoFields","note","Tells the writer whether all fields written should not have quotes around them; regardless if the field contains anything that should be escaped."],["label","Trim Fields","formControlName","trimFields","note","Tells the reader to trim whitespace from the beginning and ending of the field value when reading."],["label","Trim Headers","formControlName","trimHeaders","note","Tells the reader to ignore white space from the beginning and ending of the headers when matching the columns to the properties by name."],["label","Detect Column Count Changes","formControlName","detectColumnCountChanges","note","Check for changes in the number of column from row to row.  If true, the job will abend."],["label","Ignore Reading Exceptions","formControlName","ignoreReadingExceptions","note","Tells the reader to ignore any issues when parsing the file.  Issues mean the file is bad in some way, and the parser isn't able to recover."],["label","Will Abend On Missing Field","formControlName","willThrowOnMissingField","note","Indicates if the job should be abended if reading and an expected field is missing."],["label","Skip Empty Records","formControlName","skipEmptyRecords","note","Tells the reader a record should be skipped when reading if it's empty. A record is considered empty if all fields are empty."],["label","Comment","formControlName","comment","placeholder","Enter comment character","iconClass","fa fa-list","note","The value used to denote a line that is commented out.",3,"errors"],["label","Quote","formControlName","quote","placeholder","Enter the quote","iconClass","fa fa-list","note","The value used to escape fields that contain a delimiter, quote, or line ending.",3,"maxlength","errors"]],template:function(e,t){1&e&&(o.Ob(0,"div",0),o.Ob(1,"dexih-widget",1),o.Vb("close",(function(){return t.close()})),o.Dc(2,V,3,3,"ng-template",null,2,o.Ec),o.Dc(4,E,52,9,"form",3),o.Nb(),o.Lb(5,"dexih-help",4),o.Nb()),2&e&&(o.yb(1),o.hc("showCloseButton",!0)("padding",!0),o.yb(3),o.hc("ngIf",t.formsService.currentForm))},directives:[u.P,d.t,b.a,T.a,N.a,D.a,x.I,x.t,x.l,u.D,x.s,x.j,u.H,u.A,x.o],encapsulation:2}),e})()},NbKI:function(e,t,i){"use strict";i.d(t,"a",(function(){return H}));var a=i("fXoL"),n=i("XNiG"),s=i("itXk"),o=i("3WyZ"),r=i("soiQ"),c=i("ElCs"),l=i("Xjf6"),u=i("cvPx"),h=i("Wumg"),b=i("ofXK"),d=i("3Pt+"),m=i("YcGA"),f=i("PMKX"),p=i("HjvC"),g=i("l2bN"),v=i("H3K+"),y=i("g8Ys");const C=["widget"];function w(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button-edit",10),a.Vb("click",(function(){return a.vc(e),a.Zb().toggleEdit()})),a.Nb()}2&e&&a.hc("compact",!0)}function S(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button-preview",10),a.Vb("click",(function(){return a.vc(e),a.Zb().toggleEdit()})),a.Nb()}2&e&&a.hc("compact",!0)}function k(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button",14),a.Vb("click",(function(){return a.vc(e),a.Zb().maximise()})),a.Nb()}}function O(e,t){if(1&e){const e=a.Pb();a.Ob(0,"dexih-button",15),a.Vb("click",(function(){return a.vc(e),a.Zb().maximise()})),a.Nb()}}function T(e,t){if(1&e){const e=a.Pb();a.Ob(0,"span",20),a.Ob(1,"div",21),a.Ob(2,"div",22),a.Fc(3),a.Nb(),a.Nb(),a.Ob(4,"form-input",23),a.Vb("ngModelChange",(function(i){return a.vc(e),t.$implicit.value=i})),a.Nb(),a.Nb()}if(2&e){const e=t.$implicit,i=t.index;a.yb(3),a.Hc(" ",e.logicalName," "),a.yb(1),a.jc("name","column",i,""),a.hc("placeholder","Enter "+e.logicalName)("ngModel",e.value)}}function N(e,t){if(1&e&&(a.Ob(0,"div",18),a.Dc(1,T,5,4,"span",19),a.Nb()),2&e){const e=a.Zb(2);a.yb(1),a.hc("ngForOf",e.inputColumns)}}function D(e,t){if(1&e){const e=a.Pb();a.Ob(0,"div",18),a.Ob(1,"input-parameters",24),a.Vb("onRefreshData",(function(){return a.vc(e),a.Zb(2).refresh()})),a.Nb(),a.Nb()}if(2&e){const e=a.Zb(2);a.yb(1),a.hc("showEdit",!1)("parameters",e.item.controls.parameters)("formsService",e.formsService)("parentParameters",e.parentParameters)("refreshEvent",e.refreshDataSubject.asObservable())}}function x(e,t){if(1&e){const e=a.Pb();a.Ob(0,"div",25),a.Ob(1,"series-animate",26),a.Vb("hasChanged",(function(){return a.vc(e),a.Zb(2).hasChanged()}))("dataChange",(function(t){return a.vc(e),a.Zb(2).dataRows=t})),a.Nb(),a.Nb()}if(2&e){const e=a.Zb(2);a.yb(1),a.hc("showEdit",!1)("showFrame",!1)("animateConfig",null==e.dataResult?null:e.dataResult.viewConfig.animateConfig)("columns",null==e.dataResult?null:e.dataResult.columns)("baseData",null==e.dataResult?null:e.dataResult.data)("data",e.dataRows)}}function F(e,t){if(1&e&&(a.Ob(0,"div"),a.Dc(1,N,2,1,"div",16),a.Dc(2,D,2,5,"div",16),a.Dc(3,x,2,6,"div",17),a.Nb()),2&e){const e=a.Zb();a.yb(1),a.hc("ngIf",e.inputColumns&&e.inputColumns.length>0),a.yb(1),a.hc("ngIf",e.item.controls.parameters.length>0),a.yb(1),a.hc("ngIf",!(null!=e.data&&e.data.isRefreshing)&&(null==e.dataResult||null==e.dataResult.columns?null:e.dataResult.columns.length)>0&&(null==e.dataResult?null:e.dataResult.viewConfig)&&(null==e.dataResult?null:e.dataResult.data))}}function V(e,t){if(1&e){const e=a.Pb();a.Ob(0,"div",27),a.Ob(1,"form",28),a.Ob(2,"section"),a.Lb(3,"form-input",29),a.Nb(),a.Ob(4,"section"),a.Lb(5,"form-textarea",30),a.Nb(),a.Ob(6,"section"),a.Ob(7,"form-select",31),a.Lb(8,"view-edit-button",32),a.Nb(),a.Nb(),a.Ob(9,"section"),a.Lb(10,"form-checkbox",33),a.Lb(11,"form-checkbox",34),a.Nb(),a.Nb(),a.Ob(12,"input-parameters",35),a.Vb("onRefreshData",(function(){return a.vc(e),a.Zb().refresh()})),a.Nb(),a.Nb()}if(2&e){const e=a.Zb();a.yb(1),a.hc("formGroup",e.item),a.yb(2),a.hc("autocapitalize",e.on),a.yb(2),a.hc("showMarkdown",!0),a.yb(2),a.hc("items",e.views),a.yb(1),a.hc("key",e.item.controls.viewKey.value),a.yb(4),a.hc("showEdit",e.showEdit)("allowAddRemove",!1)("parameters",e.item.controls.parameters)("formsService",e.formsService)("parentParameters",e.parentParameters)("refreshEvent",e.refreshDataSubject.asObservable())}}function I(e,t){1&e&&(a.Ob(0,"div",40),a.Lb(1,"div",41),a.Fc(2," Refreshing, please wait... "),a.Nb())}function K(e,t){if(1&e&&(a.Ob(0,"div",46),a.Ob(1,"div",47),a.Ob(2,"b"),a.Fc(3),a.Nb(),a.Nb(),a.Nb()),2&e){const e=a.Zb(4);a.yb(3),a.Gc(e.item.controls.name.value)}}function E(e,t){if(1&e&&(a.Ob(0,"div",48),a.Ob(1,"div",18),a.Lb(2,"ngx-md",49),a.Nb(),a.Nb()),2&e){const e=a.Zb(4);a.yb(2),a.hc("data",e.item.controls.description.value)}}function L(e,t){if(1&e&&a.Lb(0,"dexih-table",54),2&e){const e=a.Zb(5);a.hc("enableMultiSelect",!1)("enableResponsive",!1)("enableSaveCsv",!1)("enableFilter",!1)("columns",e.dataResult.columns)("data",e.dataRows)}}function P(e,t){if(1&e&&a.Lb(0,"chart-view",55),2&e){const e=a.Zb(5);a.hc("responsive",!0)("columns",e.dataResult.columns)("data",e.dataRows)("config",e.view.chartConfig)}}function M(e,t){if(1&e&&(a.Ob(0,"div",50),a.Dc(1,L,1,6,"dexih-table",51),a.Ob(2,"div",52),a.Dc(3,P,1,4,"chart-view",53),a.Nb(),a.Nb()),2&e){const e=a.Zb(4);a.yb(1),a.hc("ngIf",e.view.viewType==e.eViewType.Table),a.yb(2),a.hc("ngIf",e.view.viewType==e.eViewType.Chart)}}function j(e,t){if(1&e){const e=a.Pb();a.Ob(0,"div",56),a.Vb("click",(function(){return a.vc(e),a.Zb(4).refresh()})),a.Lb(1,"i",57),a.Fc(2," Select to refresh the view. "),a.Nb()}}function A(e,t){if(1&e&&(a.Dc(0,K,4,1,"div",42),a.Dc(1,E,3,1,"div",43),a.Dc(2,M,4,2,"div",44),a.Dc(3,j,3,0,"ng-template",null,45,a.Ec)),2&e){const e=a.sc(4),t=a.Zb(3);a.hc("ngIf",t.item.controls.header.value),a.yb(1),a.hc("ngIf",t.item.controls.description.value),a.yb(1),a.hc("ngIf",!(null!=t.data&&t.data.isRefreshing)&&(null==t.dataResult||null==t.dataResult.columns?null:t.dataResult.columns.length)>0&&(null==t.dataResult||null==t.dataResult.data?null:t.dataResult.data.length)>0)("ngIfElse",e)}}const R=function(e){return{overflow:e}};function _(e,t){if(1&e&&(a.Ob(0,"div",37),a.Dc(1,I,3,0,"div",38),a.Dc(2,A,5,4,"ng-template",null,39,a.Ec),a.Nb()),2&e){const e=a.sc(3),t=a.Zb(2);a.hc("ngStyle",a.mc(3,R,t.item.controls.scrollable.value?"scroll":"hidden")),a.yb(1),a.hc("ngIf",null==t.data?null:t.data.isRefreshing)("ngIfElse",e)}}function Z(e,t){if(1&e&&a.Dc(0,_,4,5,"div",36),2&e){const e=a.Zb();a.hc("ngIf",!e.showPreview&&e.view)}}let H=(()=>{class e{constructor(e,t,i){this.authService=e,this.hubService=t,this.formsService=i,this.showEdit=!0,this.showPreview=!1,this.isMaximized=!1,this.onRemove=new a.n,this.onMaximize=new a.n,this.eViewType=r.rc,this.firstLoad=!0,this.dialogOpen=!1,this.dataRows=[],this.refreshDataSubject=new n.a,this.cancelToken=new o.a}ngOnInit(){try{this._subscription=Object(s.a)(this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{var t;this.hubCache=e[0],this.remoteAgent=e[1],this.hubService.isHubCacheLoaded&&(this.views=this.hubCache.hub.dexihViews,(null===(t=this.item)||void 0===t?void 0:t.controls.viewKey)&&(this.view=this.hubCache.hub.dexihViews.find(e=>e.key===this.item.controls.viewKey.value),this.data=this.item.controls.runTime.value.data,this.data?this._refreshDataSubscription=this.data.data.subscribe(e=>{e&&(this.dataResult=e,e.viewConfig.animateConfig||(this.dataRows=this.dataResult.data),e.status&&this.hubService.addHubMessage(e.status,!1,this.view.name))}):this.remoteAgent&&(this.firstLoad?this.refresh():this.dialogOpen||(this.dialogOpen=!0,this.authService.confirmDialog("Remote Agent Available","A remote agent is available, would you like to refresh the data?").then(e=>{e&&this.refresh(),this.dialogOpen=!1})),this.firstLoad=!1)),this.parentParameters=this.formsService.currentForm.controls.parameters.value,this._parametersSubscription&&this._parametersSubscription.unsubscribe(),this._parametersSubscription=this.formsService.currentForm.controls.parameters.valueChanges.subscribe(e=>{this.parentParameters=e}))})}catch(e){this.hubService.addHubClientErrorMessage(e,"View Index")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._viewKeySubscription&&this._viewKeySubscription.unsubscribe(),this._refreshDataSubscription&&this._refreshDataSubscription.unsubscribe(),this._parametersSubscription&&this._parametersSubscription.unsubscribe(),this.cancelToken.cancel()}ngOnChanges(e){let t=e.item;if(t){let e=t.currentValue;this.views&&e.value&&(this.view=this.hubCache.hub.dexihViews.find(t=>t.key===e.value)),this._viewKeySubscription&&this._viewKeySubscription.unsubscribe(),this._viewKeySubscription=e.controls.viewKey.valueChanges.subscribe(t=>{this.formsService.updateDashboardItemView(e)})}}refresh(){let e=this.hubService.previewViewKey(this.item.controls.viewKey.value,null,this.formsService.currentForm.controls.parameters.value,this.item.controls.parameters.value,this.cancelToken);this.data=this.item.controls.runTime.value.data,this.data.refresh(e),e.then(e=>{this.refreshDataSubject.next(),this.dataResult=e,this.dataResult.viewConfig.animateConfig||(this.dataRows=this.dataResult.data)}).catch(e=>{this.hubService.addHubMessage(e)})}parameterChange(){this.refresh()}toggleEdit(){this.showEdit=!this.showEdit}removeItem(e){e.preventDefault(),e.stopPropagation(),this.onRemove.emit()}maximise(){this.onMaximize.emit(this.item)}}return e.\u0275fac=function(t){return new(t||e)(a.Kb(c.a),a.Kb(l.a),a.Kb(u.a))},e.\u0275cmp=a.Eb({type:e,selectors:[["dashboard-item"]],viewQuery:function(e,t){var i;1&e&&a.Bc(C,!0),2&e&&a.rc(i=a.Wb())&&(t.widget=i.first)},inputs:{item:"item",showEdit:"showEdit",showPreview:"showPreview",refreshData:"refreshData",isMaximized:"isMaximized"},outputs:{onRemove:"onRemove",onMaximize:"onMaximize"},features:[a.wb],decls:16,vars:9,consts:[[1,"side-menu"],[1,"side-menu-content"],[1,"spin-icon"],[1,"fa","fa-cog","fa-spin"],[1,"side-menu-box"],[1,"bg-light","rounded","p-1"],[3,"compact","click"],["class","ml-1",3,"compact","click",4,"ngIf"],["class","ml-1","buttonClass","btn btn-primary","iconClass","fa fa-window-maximize text-white","tooltip","Maximize window",3,"click",4,"ngIf"],["class","ml-1","buttonClass","btn btn-primary","iconClass","fa fa-window-minimize text-white","tooltip","Minimize window",3,"click",4,"ngIf"],[1,"ml-1",3,"compact","click"],[4,"ngIf"],["class","p-3 gridster-item-content",4,"ngIf"],[3,"ngIf"],["buttonClass","btn btn-primary","iconClass","fa fa-window-maximize text-white","tooltip","Maximize window",1,"ml-1",3,"click"],["buttonClass","btn btn-primary","iconClass","fa fa-window-minimize text-white","tooltip","Minimize window",1,"ml-1",3,"click"],["class","m-1",4,"ngIf"],["class","m-1","style","z-index: 99999;",4,"ngIf"],[1,"m-1"],["class","input-group",4,"ngFor","ngForOf"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0",3,"name","placeholder","ngModel","ngModelChange"],[3,"showEdit","parameters","formsService","parentParameters","refreshEvent","onRefreshData"],[1,"m-1",2,"z-index","99999"],[3,"showEdit","showFrame","animateConfig","columns","baseData","data","hasChanged","dataChange"],[1,"p-3","gridster-item-content"],[3,"formGroup"],["label","Item Name","formControlName","name","placeholder","Enter the dashboard item name.","iconClass","fa fa-list",3,"autocapitalize"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],["label","Select View","formControlName","viewKey","itemKey","key","itemName","name",3,"items"],[3,"key"],["label","Show Header","formControlName","header"],["label","Allow Scrolling","formControlName","scrollable"],[3,"showEdit","allowAddRemove","parameters","formsService","parentParameters","refreshEvent","onRefreshData"],["class","box",3,"ngStyle",4,"ngIf"],[1,"box",3,"ngStyle"],["class","p-3",4,"ngIf","ngIfElse"],["notRefreshing",""],[1,"p-3"],[1,"dexih-loader"],["class","box-header bg-secondary text-white",4,"ngIf"],["class","box-header",4,"ngIf"],["class","box-content",4,"ngIf","ngIfElse"],["elseBlock",""],[1,"box-header","bg-secondary","text-white"],[1,"m-3"],[1,"box-header"],[3,"data"],[1,"box-content"],[3,"enableMultiSelect","enableResponsive","enableSaveCsv","enableFilter","columns","data",4,"ngIf"],[1,"h-100"],[3,"responsive","columns","data","config",4,"ngIf"],[3,"enableMultiSelect","enableResponsive","enableSaveCsv","enableFilter","columns","data"],[3,"responsive","columns","data","config"],[1,"alert","alert-info",3,"click"],[1,"fa","fa-warning"]],template:function(e,t){1&e&&(a.Ob(0,"div",0),a.Ob(1,"div",1),a.Ob(2,"div",2),a.Lb(3,"i",3),a.Nb(),a.Ob(4,"div",4),a.Ob(5,"div",5),a.Ob(6,"div"),a.Ob(7,"dexih-button-refresh",6),a.Vb("click",(function(){return t.refresh()})),a.Nb(),a.Dc(8,w,1,1,"dexih-button-edit",7),a.Dc(9,S,1,1,"dexih-button-preview",7),a.Dc(10,k,1,0,"dexih-button",8),a.Dc(11,O,1,0,"dexih-button",9),a.Ob(12,"dexih-button-delete",10),a.Vb("click",(function(e){return t.removeItem(e)})),a.Nb(),a.Nb(),a.Dc(13,F,4,3,"div",11),a.Nb(),a.Nb(),a.Nb(),a.Nb(),a.Dc(14,V,13,11,"div",12),a.Dc(15,Z,1,1,"ng-template",13)),2&e&&(a.yb(7),a.hc("compact",!0),a.yb(1),a.hc("ngIf",!t.showEdit),a.yb(1),a.hc("ngIf",t.showEdit),a.yb(1),a.hc("ngIf",!t.isMaximized),a.yb(1),a.hc("ngIf",t.isMaximized),a.yb(1),a.hc("compact",!0),a.yb(1),a.hc("ngIf",!t.showEdit&&!t.showPreview&&t.view),a.yb(1),a.hc("ngIf",t.showEdit),a.yb(1),a.hc("ngIf",!t.showEdit))},directives:[h.s,b.t,h.g,h.j,h.q,h.f,b.s,h.D,d.s,d.v,m.a,f.a,d.I,d.t,d.l,d.j,h.H,h.E,p.a,h.A,b.w,g.a,v.a,y.a],styles:[".dashboard-item[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;right:0;overflow:auto}"]}),e})()},cvPx:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var a=i("fXoL"),n=i("3Pt+"),s=i("2Vo4"),o=i("rgmq"),r=i("Z+eP"),c=i("2v7R"),l=i("soiQ"),u=i("4Y1E"),h=i("ElCs");let b=(()=>{class e{constructor(e,t,i){this.fb=e,this.hubService=t,this.authService=i,this._datalinkTargetChanges=[],this._parameterChanges=[],this._currentFormObservable=new s.a(null),this.formErrors={},this.hasChanged=!1,this.formSaving=!1,this.showAllErrors=!1,this.IgnoreFormChange=!1,this.ignoreHubCacheChange=!1,this.formChangeCount=0,this.logger=new o.a("hub.forms.service"),this.validationMessages={required:"A value is required.",duplicateName:"The value is already being used.",dataType:"The data types are inconsistent.",invalidClass:"The function method could not be found"},this.validationFieldMessages={},this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{this.hubCache=e})}ngOnDestroy(){this.clearFormSubscriptions(),this.currentForm=null,this.updateDate=null,this.formErrors={},this.hasChanged=!1,this.formSaving=!1,this.showAllErrors=!1,this.IgnoreFormChange=!1,this.formChangeCount=0}clearFormSubscriptions(){this.logger.LogC(()=>"clearFormSubscriptions started",o.b.Trace),this._valueChangesSubscription&&this._valueChangesSubscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._connectionChangesSubscription1&&this._connectionChangesSubscription1.unsubscribe(),this._connectionChangesSubscription2&&this._connectionChangesSubscription2.unsubscribe(),this._connectionChangesSubscription3&&this._connectionChangesSubscription3.unsubscribe(),this._tableChangesSubscription1&&this._tableChangesSubscription1.unsubscribe(),this._tableChangesSubscription2&&this._tableChangesSubscription2.unsubscribe(),this._tableColumnChangesSubscription1&&this._tableColumnChangesSubscription1.unsubscribe(),this._tableColumnChangesSubscription2&&this._tableColumnChangesSubscription2.unsubscribe(),this._tableColumnChangesSubscription3&&this._tableColumnChangesSubscription3.unsubscribe(),this._datalinkChangesSubscription1&&this._datalinkChangesSubscription1.unsubscribe(),this._datalinkChangesSubscription2&&this._datalinkChangesSubscription2.unsubscribe(),this._datalinkChangesSubscription3&&this._datalinkChangesSubscription3.unsubscribe(),this._datalinkTestChangesSubscription&&this._datalinkTestChangesSubscription.unsubscribe(),this._genericParameterSubscription&&this._genericParameterSubscription.unsubscribe(),this._datalinkTargetChanges.forEach(e=>e.unsubscribe()),this._parameterChanges.forEach(e=>e.unsubscribe())}addMissing(e,t,i,a=[]){if(!e)return;let s=Object.keys(i),o=Object.keys(t.controls);s.forEach(i=>{if(-1===a.findIndex(e=>e===i)&&-1===o.findIndex(e=>e===i)){let a=new n.h(i),s=e[i];void 0===s&&(s=null),a.setValue(s),t.addControl(i,a)}}),this.updateDate=e.updateDate}startForm(e){this.logger.LogC(()=>"startForm started",o.b.Trace),e&&(this._valueChangesSubscription&&this._valueChangesSubscription.unsubscribe(),this._valueChangesSubscription=e.valueChanges.subscribe(e=>{this.onValueChanged(e)}),this.onValueChanged()),this.currentForm=e,this._currentFormObservable.next(e),this.hasChanged=!1,this.logger.LogC(()=>"startForm finished",o.b.Trace)}getCurrentFormObservable(){return this._currentFormObservable.asObservable()}onValueChanged(e){if(!1===this.IgnoreFormChange){if(this.logger.LogC(()=>"onValueChanged started.  Counter = "+this.formChangeCount++,o.b.Trace),!this.currentForm||!this.currentForm.value)return;const e=this.currentForm;this.hasChanged=!0,this.formErrors=this.getFormErrorMessages(e,this.showAllErrors),this.logger.LogC(()=>"onValueChanged completed",o.b.Trace)}}markAsChanged(){this.currentForm&&this.currentForm.value&&(this.hasChanged=!0,this.currentForm.markAsDirty())}showErrors(){this.showAllErrors=!0,this.onValueChanged()}getFormErrorMessages(e,t){let i={};if(!e.controls)return"";for(const a of Object.keys(e.controls)){i[a]="";const s=e.get(a);if(s&&(s.dirty||t)&&!s.valid)if(s instanceof n.e);else{const e=this.validationFieldMessages[a];if(s&&s.errors)for(const t of Object.keys(s.errors))if(e&&e[t])i[a]+=e[t]+" ";else if(this.validationMessages[t])i[a]+=this.validationMessages[t]+" ";else{let e=this.createErrorMessage(t,s);i[a]+=e+" "}}}return i}getErrorMessage(e){if(e&&e.errors){let t="";for(const i of Object.keys(e.errors))this.validationMessages[i]?t+=this.validationMessages[i]+" ":t=this.createErrorMessage(i,e);return t}return""}createErrorMessage(e,t){let i="";switch(e){case"minlength":i="Value is "+t.errors.minlength.actualLength+" characters long, required minimum length is "+t.errors.minlength.requiredLength+" characters.";break;case"maxlength":i="Value is "+t.errors.maxlength.actualLength+" characters long, required maximum length is "+t.errors.maxlength.requiredLength+" characters.";break;case"maxvalue":i="Value is "+t.value+" required maximum is "+t.errors.maxvalue.required+".";break;case"minvalue":i="Value is "+t.value+" required minimum is "+t.errors.minvalue.required+".";break;default:i="Field error: "+e}return i}watchChanges(e,t,i,a){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this.formSaving||(this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(n=>{if(!this.ignoreHubCacheChange){if(this.ignoreHubCacheChange=!0,n.changeClass===e&&n.data&&n.data[t]===this.currentForm.value[t])switch(n.changeType){case l.Eb.Replace:if(this.currentForm.pristine){let e=Object.assign({},n.data);a.call(this,e)}else this.authService.confirmDialog("The "+i+" has changed","Another session has updated this "+i+", would you like to discard any changes in this session and update with the new version?").then(e=>{if(e){let e=Object.assign({},n.data);this.ngOnDestroy(),a.call(this,e)}}).catch(e=>{});break;case l.Eb.Delete:this.authService.confirmDialog("The "+i+" has been deleted","Another session has deleted this "+i+", would you like to discard current changes?").then(e=>{e&&this.authService.navigateUp()}).catch(e=>{})}this.ignoreHubCacheChange=!1}}))}save(e=!1,t=!1){return i=this,void 0,n=function*(){try{if(!t&&(this.formSaving||!this.hasChanged))return;let i;if(this.formSaving=!0,i=this.valueMethod?this[this.valueMethod]():this.currentForm.getRawValue(),t){let e=i.name;for(;this.hubCache.hub[this.property.cacheProperty].find(t=>t.name===e);)if(e=yield this.authService.promptDialog("Specify a new name",`The name ${e} already exists.  Specify a new name for the ${this.property.displayName} and then select ok to save this as a copy.`,"",e+" 2"),!e)return;i.name=e,i.key=0}this.ignoreHubCacheChange=!0;const a=i.currentStatus,n=i.entityStatus,s=i.previousStatus,o=i.runTime;i.currentStatus=null,i.entityStatus=null,i.previousStatus=null,i.runTime=null;let r=yield this.authService.post("/api/Hub/"+this.saveMethod,{hubKey:this.hubCache.hub.hubKey,value:i},"Saving..."),c=new l.P;c[this.property.property]=[{importAction:l.Eb.New,item:r}],this.hubService.updateHubChange(c),this.formGroupFunc&&(this.formGroupFunc(r),this.currentForm.controls.currentStatus&&this.currentForm.controls.currentStatus.setValue(a),this.currentForm.controls.entityStatus&&this.currentForm.controls.entityStatus.setValue(n),this.currentForm.controls.previousStatus&&this.currentForm.controls.previousStatus.setValue(s),this.currentForm.controls.runTime&&this.currentForm.controls.runTime.setValue(o),this.ignoreHubCacheChange=!1),this.formSaving=!1,this.hasChanged=!1,e?this.authService.navigateUp():this.hubService.addHubSuccessMessage("The save operation completed.")}catch(i){i&&(this.hubService.addHubMessage(i),this.currentForm.markAsDirty())}finally{this.formSaving=!1}},new((a=void 0)||(a=Promise))((function(e,t){function s(e){try{r(n.next(e))}catch(i){t(i)}}function o(e){try{r(n.throw(e))}catch(i){t(i)}}function r(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(s,o)}r((n=n.apply(i,[])).next())}));var i,a,n}saveLocal(){let e;e=this.valueMethod?this[this.valueMethod]():this.currentForm.getRawValue();const t=this.hubCache,i=this.hubService.createHub(this.hubCache.hub.hubKey,"");this.property.cacheGetMethod&&t[this.property.cacheGetMethod](e,i),i[this.property.cacheProperty].push(e),this.hubService.exportHub(i,this.property.displayName+"-"+e.name+".json")}cancel(){this.formSaving||this.authService.navigateUp()}getFormErrors(){return this.getFormErrorsRecursive(this.currentForm,0,0)}getFormErrorsRecursive(e,t,i){let a="";for(const s of Object.keys(e.controls)){const o=e.get(s);if(o&&!o.valid)if(a+=" ".repeat(3*t)+`The control ${s} at position ${i} has the following error(s):<p></p>`,o instanceof n.e)o.controls.forEach((e,i)=>{a+=this.getFormErrorsRecursive(e,t+1,i)});else if(o instanceof n.k)a+=this.getFormErrorsRecursive(o,t+1,0);else for(const e of Object.keys(o.errors))a+=" ".repeat(3*t+1)+e+":"+this.createErrorMessage(e,o)+"<p></p>"}return a}stringCompare(e,t){return!e&&!t||!(!e||!t)&&e.trim().toLowerCase()===t.trim().toLowerCase()}parameter(e){let t={showRefresh:e.listOfValuesKey>0,isRefreshing:!1,items:[]};e.value&&0===e.rank&&(t.items=[{key:e.value,name:e.valueDesc}]);const i=this.fb.group({name:[{value:e.name,disabled:e.datalinkParameterKey>0},[n.G.required,n.G.minLength(1),n.G.maxLength(50)]],runTime:[t],datalinkParameterKey:e.datalinkParameterKey});this.addMissing(e,i,new l.Q);let a=i.controls.listOfValuesKey.valueChanges.subscribe(e=>{i.controls.runTime.setValue({showRefresh:i.controls.listOfValuesKey.value>0,isRefreshing:!1,items:[]})});this._parameterChanges.push(a);let s=i.controls.rank.valueChanges.subscribe(e=>{let t=i.controls.value.value;0===e&&t&&Array.isArray(t)&&(0===t.length?(i.controls.value.setValue(null),i.controls.valueDesc.setValue(t[0])):(i.controls.value.setValue(t[0]),i.controls.valueDesc.setValue(t[0]))),1===e&&t&&!Array.isArray(t)&&i.controls.value.setValue(null)});return this._parameterChanges.push(s),i}connection(e){this.logger.LogC(()=>"connection",o.b.Trace);const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateConnectionNameValidator()]],connectionStringDisplay:[e.connectionString?"(Connection string hidden)":"",[]],passwordDisplay:[e.password?"**************************":"",[]],connectionStringRaw:["",[]],passwordRaw:["",[]]},{validators:[this.requiredConnectionFields()]});this.property=c.u.find(e=>e.type===l.dc.Connection),this.saveMethod="SaveConnection",this.formGroupFunc=this.connection,this.addMissing(e,t,new l.f),this.clearFormSubscriptions(),this._connectionChangesSubscription1&&this._connectionChangesSubscription1.unsubscribe(),this._connectionChangesSubscription1=t.controls.passwordDisplay.valueChanges.subscribe(e=>{t.controls.passwordRaw.setValue(e)}),this._connectionChangesSubscription2&&this._connectionChangesSubscription2.unsubscribe(),this._connectionChangesSubscription2=t.controls.connectionStringDisplay.valueChanges.subscribe(e=>{t.controls.connectionStringRaw.setValue(e)}),this.startForm(t),this.watchChanges(l.dc.Connection,"key","Connection",this.connection),this.logger.LogC(()=>"connection finished",o.b.Trace)}duplicateConnectionNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihConnections.findIndex(e=>e.key!==this.currentForm.value.key&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}requiredConnectionFields(){return e=>{if(this.currentForm){const t=e.controls.useConnectionString,i=e.controls.connectionStringDisplay,a=e.controls.server;if(!t||!i||!a)return;return i.setErrors(null),a.setErrors(null),t.value&&!i.value&&i.setErrors({required:!0}),void(t.value||a.value||a.setErrors({required:!0}))}}}table(e){this.clearFormSubscriptions();const t=this.tableForm(e);this.formGroupFunc=this.table,this.property=c.u.find(e=>e.type===l.dc.Table),this.saveMethod="SaveTable",this.watchChanges(l.dc.Table,"tableKey","table",this.table),this.startForm(t)}tableForm(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.maxLength(250),this.duplicateTableNameValidator()]],connectionKey:[e.connectionKey,[n.G.required]],logicalName:[e.logicalName,[n.G.required,n.G.maxLength(250)]],useLogical:[this.hubCache.defaultTableLogicalName(e.schema,e.name)!==e.logicalName,[]],dexihTableColumns:this.fb.array([])},{validator:this.requiredTableFields()});let i=t.controls.dexihTableColumns;return e.dexihTableColumns.filter(e=>e.isValid).forEach(e=>{i.push(this.tableColumn(i.value,e))}),this._tableChangesSubscription1&&this._tableChangesSubscription1.unsubscribe(),this._tableChangesSubscription1=t.controls.useLogical.valueChanges.subscribe(e=>{t.controls.useLogical.value||t.controls.logicalName.setValue(this.hubCache.defaultTableLogicalName(t.controls.schema.value,t.controls.name.value))}),this._tableChangesSubscription2&&this._tableChangesSubscription2.unsubscribe(),this._tableChangesSubscription2=t.controls.name.valueChanges.subscribe(e=>{t.controls.useLogical.value||t.controls.logicalName.setValue(this.hubCache.defaultTableLogicalName(t.controls.schema.value,t.controls.name.value))}),this.addMissing(e,t,new l.H),t}duplicateTableNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihTables.find(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t)&&e.connectionKey===this.currentForm.value.connectionKey)?{duplicateName:{name:t}}:null}}}requiredTableFields(){return e=>{if(this.currentForm){const t=e.controls.useConnectionString,i=e.controls.connectionStringDisplay,a=e.controls.server;if(!t||!i||!a)return;return i.setErrors(null),a.setErrors(null),t.value&&!i.value&&i.setErrors({required:!0}),void(t.value||a.value||a.setErrors({required:!0}))}}}tableColumn(e,t){let i=t.childColumns?t.childColumns:[],a=this.fb.group({name:[t.name,[n.G.required,n.G.maxLength(250),this.duplicateTableColumnNameValidator(e)]],logicalName:[t.logicalName,[n.G.required,n.G.maxLength(250)]],precision:[t.precision,[this.columnMinRangeValidator(0),this.columnMaxRangeValidator(30)]],scale:[t.scale,[this.columnMinRangeValidator(0),this.columnMaxRangeValidator(30)]],useLogical:[t.name!==t.logicalName,[]],isString:[t.dataType===l.pc.String||t.dataType===l.pc.CharArray,[]],isNumber:[t.dataType===l.pc.Double||t.dataType===l.pc.Decimal||t.dataType===l.pc.Single,[]],childColumns:this.fb.array(i.filter(e=>e.isValid).map(e=>this.tableColumn(i,e))),runTime:{impact:c.k,lineage:c.k}});this.addMissing(t,a,new l.I),this._tableColumnChangesSubscription1&&this._tableColumnChangesSubscription1.unsubscribe(),this._tableColumnChangesSubscription1=a.controls.dataType.valueChanges.subscribe(e=>{a.controls.isString.setValue(e===l.pc.String||e===l.pc.CharArray),a.controls.isNumber.setValue(e===l.pc.Double||e===l.pc.Decimal||e===l.pc.Single)}),this._tableColumnChangesSubscription2&&this._tableColumnChangesSubscription2.unsubscribe(),this._tableColumnChangesSubscription2=a.controls.useLogical.valueChanges.subscribe(e=>{a.controls.useLogical.value||a.controls.logicalName.setValue(a.controls.name.value)}),this._tableColumnChangesSubscription3&&this._tableColumnChangesSubscription3.unsubscribe(),this._tableColumnChangesSubscription3=a.controls.name.valueChanges.subscribe(e=>{a.controls.useLogical.value||a.controls.logicalName.setValue(a.controls.name.value)});for(const n of Object.keys(a.controls))a.controls[n].validator&&a.controls[n].updateValueAndValidity();return a}duplicateTableColumnNameValidator(e){return e?t=>{if(this.currentForm){const i=t.value;if(t.parent){const a=t.parent.value.key,n=t.parent.value.columnGroup;if(e)return e.findIndex(e=>e.key!==a&&e.columnGroup===n&&e.isValid&&this.stringCompare(e.name,i))>=0?{duplicateName:{name:i}}:null}}}:null}requiredNotZero(){return e=>{const t=e.value;return t&&0!==t?null:{required:{name:e.value}}}}columnMinRangeValidator(e){return t=>{const i=t.value,a=t.parent;if(a&&a.controls.isNumber.value)return Number(t.value)>=e?null:{minvalue:{name:i,required:e}}}}columnMaxRangeValidator(e){return t=>{const i=t.value,a=t.parent;if(a&&a.controls.isNumber.value)return Number(t.value)<=e?null:{maxvalue:{name:i,required:e}}}}fileFormat(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateFileFormatNameValidator()]],quote:[e.quote,[n.G.maxLength(1)]]});this.formGroupFunc=this.fileFormat,this.property=c.u.find(e=>e.type===l.dc.FileFormat),this.saveMethod="SaveFileFormat",this.addMissing(e,t,new l.y),this.clearFormSubscriptions(),this.watchChanges(l.dc.FileFormat,"fileFormatKey","file format",this.fileFormat),this.startForm(t)}duplicateFileFormatNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihFileFormats.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}view(e){this.clearFormSubscriptions();let t=e.parameters.filter(e=>e.isValid).map(e=>this.parameter(e));const i=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateViewNameValidator()]],sourceType:[e.sourceType,[n.G.required]],sourceDatalinkKey:[e.sourceDatalinkKey],sourceTableKey:[e.sourceTableKey],parameters:this.fb.array(t)},{validator:this.validateViewSource()});this.formGroupFunc=this.view,this.property=c.u.find(e=>e.type===l.dc.View),this.saveMethod="SaveView",this.addMissing(e,i,new l.L),this.watchChanges(l.dc.View,"viewKey","view",this.view),this.startForm(i)}duplicateViewNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihViews.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}validateViewSource(){return e=>{let t=e.get("sourceType").value,i=e.get("sourceTableKey"),a=e.get("sourceDatalinkKey");if(i.setErrors(null),a.setErrors(null),t===l.lb.Table){if(!i.value)return i.setErrors({required:!0})}else if(t===l.lb.Datalink&&!a.value)return a.setErrors({required:!0})}}dashboard(e){this.clearFormSubscriptions();let t=e.parameters.filter(e=>e.isValid).map(e=>this.parameter(e));const i=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateDashboardNameValidator()]],dexihDashboardItems:this.fb.array([]),parameters:this.fb.array(t),runTime:{showEdit:!1,lock:!0}},{});let a=i.controls.dexihDashboardItems;e.dexihDashboardItems.filter(e=>e.isValid).forEach(e=>{a.push(this.dashboardItem(e))}),this.formGroupFunc=this.dashboard,this.property=c.u.find(e=>e.type===l.dc.Dashboard),this.saveMethod="SaveDashboard",this.addMissing(e,i,new l.i),this.watchChanges(l.dc.Dashboard,"dashboardKey","dashboard",this.dashboard),this.startForm(i)}duplicateDashboardNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihDashboards.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}dashboardItem(e){let t=e.parameters.filter(e=>e.isValid).map(e=>this.parameter(e));const i=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50)]],parameters:this.fb.array(t),runTime:{resizeEvent:new a.n,data:new c.b}});return this.addMissing(e,i,new l.j),i}updateDashboardItemView(e){if(this.hubCache.hub.dexihViews&&e.controls.viewKey.value){let t=this.hubCache.hub.dexihViews.find(t=>t.key===e.controls.viewKey.value);if(this.view){e.controls.name.setValue(this.view.name),e.controls.runTime.value.data=new c.b;let i=e.controls.parameters,a=i.value;i.clear();let n=t.parameters;if(t.sourceType===l.lb.Datalink){let e=this.hubCache.hub.dexihDatalinks.find(e=>e.key===t.sourceDatalinkKey);e&&e.parameters&&(n=n.concat(e.parameters))}n.forEach(e=>{let t=a.find(t=>t.name===e.name),n=new l.Q;t?(n.name=t.name,n.value=t.value):(n.name=e.name,n.value=e.value,n.listOfValuesKey=e.listOfValuesKey);let s=this.parameter(n);i.push(s)})}}}listOfValuesItem(e){const t=this.fb.group({key:[e.key,[n.G.required,n.G.minLength(1),n.G.maxLength(50)]]});return this.addMissing(e,t,new l.R),t}listOfValues(e){let t;t=e.staticData?e.staticData.map(e=>this.listOfValuesItem(e)):[];const i=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateLovNameValidator()]],sourceType:[e.sourceType,[n.G.required]],sourceDatalinkKey:[e.sourceDatalinkKey],sourceTableKey:[e.sourceTableKey],staticData:this.fb.array(t)},{validator:this.validateViewSource()});this.formGroupFunc=this.listOfValues,this.property=c.u.find(e=>e.type===l.dc.ListOfValues),this.saveMethod="SaveListOfValues",this.addMissing(e,i,new l.E),this.clearFormSubscriptions(),this.watchChanges(l.dc.ListOfValues,"listOfValuesKey","listOfValues",this.listOfValues),this.startForm(i)}duplicateLovNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihListOfValues.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}api(e){this.clearFormSubscriptions();let t=e.parameters.filter(e=>e.isValid).map(e=>this.parameter(e));const i=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50)]],sourceType:[e.sourceType,[n.G.required]],sourceDatalinkKey:[e.sourceDatalinkKey],sourceTableKey:[e.sourceTableKey],parameters:this.fb.array(t)},{validator:this.validateDatalinkTable()});this.formGroupFunc=this.api,this.saveMethod="SaveApi",this.property=c.u.find(e=>e.type===l.dc.Api),this.addMissing(e,i,new l.d),this.watchChanges(l.dc.Api,"apiKey","api",this.api),this.startForm(i)}validation(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateValidationNameValidator()]]});this.formGroupFunc=this.validation,this.property=c.u.find(e=>e.type===l.dc.ColumnValidation),this.saveMethod="SaveColumnValidation",this.addMissing(e,t,new l.e),this.watchChanges(l.dc.ColumnValidation,"key","column validation",this.validation),this.startForm(t)}duplicateValidationNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihColumnValidations.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}customFunction(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateCustomFunctionNameValidator()]],dexihCustomFunctionParameters:this.fb.array(e.dexihCustomFunctionParameters.filter(e=>e.isValid).map(e=>this.customFunctionParametersFormGroup(e)))});this.formGroupFunc=this.customFunction,this.saveMethod="SaveCustomFunction",this.property=c.u.find(e=>e.type===l.dc.CustomFunction),this.addMissing(e,t,new l.g),this.watchChanges(l.dc.CustomFunction,"customFunctionKey","custom function",this.customFunction),this.startForm(t)}duplicateCustomFunctionNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihCustomFunctions.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}customFunctionParametersFormGroup(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(1),n.G.maxLength(50)]]});return this.addMissing(e,t,new l.h),t}hubVariable(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateHubVariableNameValidator()]],valueRaw:[e.isEncrypted?null:e.value]});this.formGroupFunc=this.hubVariable,this.saveMethod="SaveHubVariable",this.property=c.u.find(e=>e.type===l.dc.HubVariable),this.addMissing(e,t,new l.C),this.watchChanges(l.dc.HubVariable,"hubVariable","hub variable",this.hubVariable),this.startForm(t)}duplicateHubVariableNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihHubVariables.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}tag(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateTagNameValidator()]]});this.formGroupFunc=this.tag,this.saveMethod="SaveTag",this.property=c.u.find(e=>e.type===l.dc.Tags),this.addMissing(e,t,new l.J),this.watchChanges(l.dc.Tags,"tag","hub variable",this.tag),this.startForm(t)}duplicateTagNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihTags.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}datalinkTest(e){const t=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateDatalinkTestNameValidator()]],dexihDatalinkTestSteps:this.fb.array([])});let i=t.controls.dexihDatalinkTestSteps;e.dexihDatalinkTestSteps.filter(e=>e.isValid).forEach(e=>{i.push(this.datalinkTestStep(e))}),this.formGroupFunc=this.datalinkTest,this.saveMethod="SaveDatalinkTest",this.property=c.u.find(e=>e.type===l.dc.DatalinkTest),this.addMissing(e,t,new l.t),this.watchChanges(l.dc.DatalinkTest,"datalinkTest","datalink test",this.datalinkTest),this.startForm(t)}duplicateDatalinkTestNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihDatalinkTests.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}datalinkTestStep(e){const t=this.fb.group({dexihDatalinkTestTables:this.fb.array([])});let i=t.controls.dexihDatalinkTestTables;return e.dexihDatalinkTestTables.filter(e=>e.isValid).forEach(e=>{i.push(this.datalinkTestTable(e))}),this.addMissing(e,t,new l.u),this._datalinkTestChangesSubscription&&this._datalinkTestChangesSubscription.unsubscribe(),this._datalinkTestChangesSubscription=t.controls.datalinkKey.valueChanges.subscribe(e=>{let t=this.hubCache.hub.dexihDatalinks.find(t=>t.key===e);for(;i.length>0;)i.removeAt(0);if(t.sourceDatalinkTable.sourceTableKey){let e=new l.v;e.tableKey=t.sourceDatalinkTable.sourceTableKey,e.isValid=!0,i.push(this.datalinkTestTable(e))}t.dexihDatalinkTransforms.filter(e=>e.joinDatalinkTable&&e.joinDatalinkTable.sourceTableKey).forEach(e=>{let t=new l.v;t.tableKey=e.joinDatalinkTable.sourceTableKey,t.isValid=!0,i.push(this.datalinkTestTable(t))})}),t}datalinkTestTable(e){const t=this.fb.group({});return this.addMissing(e,t,new l.v),t}triggerFormGroup(e){let t=this.fb.group({});return this.addMissing(e,t,new l.K),t}datalinkStepFormGroup(e,t){let i=t.parameters.filter(e=>e.isValid).map(e=>this.parameter(e)),a=this.fb.group({key:[t.key,[]],name:[t.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateStepNameValidator(e)]],datalinkKey:[t.datalinkKey,[n.G.required]],dexihDatalinkDependencies:this.fb.array(t.dexihDatalinkDependencies.filter(e=>e.isValid).map(e=>this.datalinkDependencyFormGroup(e))),dexihDatalinkStepColumns:this.fb.array(t.dexihDatalinkStepColumns.filter(e=>e.isValid).map(e=>this.datalinkStepColumnFormGroup(e))),parameters:this.fb.array(i)});return this.addMissing(t,a,new l.p),a}datalinkDependencyFormGroup(e){let t=this.fb.group({});return this.addMissing(e,t,new l.n),t}datalinkStepColumnFormGroup(e){let t=this.fb.group({});return this.addMissing(e,t,new l.q),t}datajob(e){this.clearFormSubscriptions();const t=e.dexihTriggers.filter(e=>e.isValid).map(e=>this.triggerFormGroup(e));let i=e.parameters.filter(e=>e.isValid).map(e=>this.parameter(e));const a=this.fb.array([]),s=this.fb.group({key:[e.key,[]],name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateDatajobNameValidator()]],auditConnectionKey:[e.auditConnectionKey,[this.requiredNotZero()]],failAction:[e.failAction,[n.G.required]],dexihDatalinkSteps:a,dexihTriggers:this.fb.array(t),parameters:this.fb.array(i)});e.dexihDatalinkSteps.filter(e=>e.isValid).forEach(e=>{a.push(this.datalinkStepFormGroup(s,e))}),this.formGroupFunc=this.datajob,this.saveMethod="SaveDatajob",this.property=c.u.find(e=>e.type===l.dc.Datajob),this.addMissing(e,s,new l.k),this.watchChanges(l.dc.Datajob,"key","data job",this.datajob),this.startForm(s)}duplicateDatajobNameValidator(){return e=>{if(this.currentForm){const t=e.value;return this.hubCache.hub.dexihDatajobs.findIndex(e=>e.key!==this.currentForm.controls.key.value&&e.isValid&&this.stringCompare(e.name,t))>=0?{duplicateName:{name:t}}:null}}}duplicateStepNameValidator(e){return t=>{if(this.currentForm){const i=t.value;if(t&&t.parent){let a=t.parent.controls.key.value;return e.value.dexihDatalinkSteps.findIndex(e=>e.key!==a&&e.isValid&&e.name===i)>=0?{duplicateName:{name:i}}:null}}}}remoteAgent(e){const t=this.fb.group({});this.clearFormSubscriptions(),this.addMissing(e,t,new l.G),this.startForm(t)}getDatalinkValue(){return this.currentForm.value}datalinkTableColumn(e,t){let i=t.childColumns?t.childColumns:[],a=this.fb.group({name:[t.name,[n.G.required,n.G.maxLength(250),this.duplicateDatalinkColumnNameValidator(e)]],logicalName:[t.logicalName,[n.G.required,n.G.maxLength(250)]],precision:[t.precision,[this.columnMinRangeValidator(0),this.columnMaxRangeValidator(30)]],scale:[t.scale,[this.columnMinRangeValidator(0),this.columnMaxRangeValidator(30)]],useLogical:[t.name!==t.logicalName,[]],isString:[t.dataType===l.pc.String||t.dataType===l.pc.CharArray,[]],isNumber:[t.dataType===l.pc.Double||t.dataType===l.pc.Decimal||t.dataType===l.pc.Single,[]],childColumns:this.fb.array(i.filter(e=>e.isValid).map(e=>this.datalinkTableColumn(i,e))),runTime:{impact:c.k,lineage:c.k}});this.addMissing(t,a,new l.m),this._tableColumnChangesSubscription1&&this._tableColumnChangesSubscription1.unsubscribe(),this._tableColumnChangesSubscription1=a.controls.dataType.valueChanges.subscribe(e=>{a.controls.isString.setValue(e===l.pc.String||e===l.pc.CharArray),a.controls.isNumber.setValue(e===l.pc.Double||e===l.pc.Decimal||e===l.pc.Single)}),this._tableColumnChangesSubscription2&&this._tableColumnChangesSubscription2.unsubscribe(),this._tableColumnChangesSubscription2=a.controls.useLogical.valueChanges.subscribe(e=>{a.controls.useLogical.value||a.controls.logicalName.setValue(a.controls.name.value)}),this._tableColumnChangesSubscription3&&this._tableColumnChangesSubscription3.unsubscribe(),this._tableColumnChangesSubscription3=a.controls.name.valueChanges.subscribe(e=>{a.controls.useLogical.value||a.controls.logicalName.setValue(a.controls.name.value)});for(const n of Object.keys(a.controls))a.controls[n].validator&&a.controls[n].updateValueAndValidity();return a}duplicateDatalinkColumnNameValidator(e){return t=>{if(!e)return null;if(this.currentForm){const i=t.value;if(t.parent){const a=t.parent.value.key;if(e)return e.findIndex(e=>e.key!==a&&e.isValid&&this.stringCompare(e.name,i))>=0?{duplicateName:{name:i}}:null}}}}datalinkTransformFormGroup(e){const t=this.fb.group({datalinkTransformKey:[e.key,[]],name:[e.name,[]],datalinkKey:[e.datalinkKey,[n.G.required]],joinDatalinkTable:e.joinDatalinkTable?this.sourceDatalinkTableFormGroup(e.joinDatalinkTable):null,nodeDatalinkColumn:e.nodeDatalinkColumn?e.nodeDatalinkColumn:null,isValid:!0,runTime:{inputColumns:null,outputColumns:null,transformColumns:null}});return t.addControl("dexihDatalinkTransformItems",this.fb.array(e.dexihDatalinkTransformItems.filter(e=>e.isValid).map(e=>this.datalinkDatalinkTransformItemFormGroup(t,e)))),this.addMissing(e,t,new l.w),t}datalinkDatalinkTransformItemFormGroup(e,t){const i=this.fb.group({dexihFunctionParameters:this.fb.array(t.dexihFunctionParameters.filter(e=>e.isValid).map(e=>this.datalinkFunctionParametersFormGroup(e))),targetDatalinkColumn:[t.targetDatalinkColumn,[this.duplicateOutputColumn(e)]],functionClassName:[t.functionClassName],functionMethodName:[t.functionMethodName],isValid:!0},{asyncValidators:[this.invalidClassName()]});return this.addMissing(t,i,new l.x),this._genericParameterSubscription&&this._genericParameterSubscription.unsubscribe(),this._genericParameterSubscription=i.controls.genericTypeCode.valueChanges.subscribe(()=>{let e=i.controls.genericTypeCode.value;i.controls.dexihFunctionParameters.controls.filter(e=>e.value.isGeneric).forEach(t=>{let i=t;i.controls.dataType.setValue(e),i.controls.arrayParameters.controls.forEach(t=>{t.controls.dataType.setValue(e)})})}),i}duplicateOutputColumn(e){return t=>{if(this.currentForm){const i=t.value,a=e.controls.runTime.value.transformColumns;return a&&i&&a.filter(e=>e.name===i.name).length>1?{duplicateName:{name}}:null}}}invalidClassName(){return e=>{const t=e;return t.controls.functionMethodName.setErrors(null),this.currentForm&&t.controls.transformItemType&&t.controls.transformItemType.value===l.kc.BuiltInFunction?new Promise((e,i)=>{this.hubService.GetFunctionReference(t.value).then(i=>{if(i)e(null);else{const i=t.controls.functionClassName.value+"."+t.controls.functionMethodName.value;t.controls.functionMethodName.setErrors({invalidClass:{value:i}}),e({invalidClass:{value:i}})}}).catch(e=>{i(e)})}):Promise.resolve(null)}}datalinkFunctionParametersFormGroup(e){const t=this.fb.group({datalinkColumn:e.datalinkColumn,runTime:e.runTime,arrayParameters:this.fb.array(e.arrayParameters.filter(e=>e.isValid).map(e=>this.datalinkFunctionArrayParametersFormGroup(e)))},{validator:this.inconsistentDataType()});return this.addMissing(e,t,new l.A),t}datalinkFunctionArrayParametersFormGroup(e){const t=this.fb.group({datalinkColumn:e.datalinkColumn,runTime:e.runTime},{validator:this.inconsistentDataType()});return this.addMissing(e,t,new l.z),t}inconsistentDataType(){return e=>{var t;if(this.currentForm){const i=e.controls.datalinkColumn;if(i&&i.value){const a=i.value.dataType;if(a!==(null===(t=e.controls.dataType)||void 0===t?void 0:t.value))return i.setErrors({dataType:{dataType:a}}),{dataType:{dataType:a}};i.setErrors(null)}}return null}}datalinkProfileFormGroup(e){const t=this.fb.group({isValid:!0});return this.addMissing(e,t,new l.o),t}datalinkTargetFormGroup(e,t=null){!t&&e.tableKey&&(t=this.hubCache.getTable(e.tableKey));const i=this.fb.group({table:t?this.tableForm(t):null,runTime:{inputColumns:null},nodeDatalinkColumn:e.nodeDatalinkColumn?e.nodeDatalinkColumn:null,isValid:!0});this.addMissing(e,i,new l.s);let a=i.controls.tableKey.valueChanges.subscribe(e=>{if(e>0){const a=(t=this.hubCache.getTable(e))?this.tableForm(t):null;i.setControl("table",a)}});return this._datalinkTargetChanges.push(a),i}sourceDatalinkTableFormGroup(e){const t=this.fb.group({sourceType:[e.sourceType,[n.G.required]],sourceTableKey:[e.sourceTableKey,[]],sourceDatalinkKey:[e.sourceDatalinkKey,[]],isValid:!0,dexihDatalinkColumns:this.fb.array([])},{validator:this.validateDatalinkTable()});let i=t.controls.dexihDatalinkColumns;return e.dexihDatalinkColumns.filter(e=>e.isValid).forEach(e=>{i.push(this.datalinkTableColumn(i.value,e))}),this.addMissing(e,t,new l.r),t}validateDatalinkTable(){return e=>{let t=e.get("sourceType").value,i=e.get("sourceTableKey"),a=e.get("sourceDatalinkKey");if(i.setErrors(null),a.setErrors(null),t===l.gc.Table){if(!i.value)return i.setErrors({required:!0})}else if(t===l.gc.Datalink&&!a.value)return a.setErrors({required:!0})}}missingSourceDatalinkKey(e){return t=>e!==l.gc.Datalink||t.value?null:{required:"required"}}datalink(e){this.logger.LogC(()=>`datalink key:${e.key} datalink:${e.name}`,o.b.Debug),this.clearFormSubscriptions();let t=e.dexihDatalinkProfiles.filter(e=>e.isValid).map(e=>this.datalinkProfileFormGroup(e)),i=e.dexihDatalinkTargets.filter(e=>e.isValid).map(e=>this.datalinkTargetFormGroup(e)),a=e.dexihDatalinkTransforms.filter(e=>e.isValid).map(e=>this.datalinkTransformFormGroup(e)),s=e.parameters.filter(e=>e.isValid).map(e=>this.parameter(e));const r=this.fb.group({name:[e.name,[n.G.required,n.G.minLength(3),n.G.maxLength(50),this.duplicateDatalinkNameValidator(e.key)]],sourceDatalinkTable:this.sourceDatalinkTableFormGroup(e.sourceDatalinkTable),auditConnectionKey:[e.auditConnectionKey,[]],updateStrategy:[e.updateStrategy,[]],dexihDatalinkTransforms:this.fb.array(a),dexihDatalinkProfiles:this.fb.array(t),dexihDatalinkTargets:this.fb.array(i),parameters:this.fb.array(s),isValid:!0});let u=new l.l;u.sourceDatalinkTable=new l.r,this.addMissing(e,r,u),this.formGroupFunc=this.datalink,this.saveMethod="SaveDatalink",this.property=c.u.find(e=>e.type===l.dc.Datalink),this.valueMethod="getDatalinkValue",this._datalinkChangesSubscription1&&this._datalinkChangesSubscription1.unsubscribe(),this._datalinkChangesSubscription1=r.valueChanges.subscribe(()=>{this.updateTransformFormColumns(r)}),this.updateTransformFormColumns(r),this.watchChanges(l.dc.Datalink,"key","datalink",this.datalink),this.startForm(r)}duplicateDatalinkNameValidator(e){return t=>{if(this.currentForm){const i=t.value;return this.hubCache.hub.dexihDatalinks.findIndex(t=>t.key!==e&&t.isValid&&this.stringCompare(t.name,i))>=0?{duplicateName:{name:i}}:null}}}updateTransformFormColumns(e){if(!1===this.IgnoreFormChange){this.IgnoreFormChange=!0;const t=e.controls.dexihDatalinkTransforms,i=e.value;(new r.b).buildInputOutput(this.hubCache,i),t.controls.forEach(e=>{const t=e,a=t.value,n=i.dexihDatalinkTransforms.find(e=>e.key===a.datalinkTransformKey);t.controls.runTime.setValue(n.runTime),t.controls.dexihDatalinkTransformItems.controls.forEach(e=>{const t=e;t.controls.targetDatalinkColumn&&t.controls.targetDatalinkColumn.updateValueAndValidity(),t.controls.sourceDatalinkColumn&&t.controls.sourceDatalinkColumn.updateValueAndValidity(),t.controls.dexihFunctionParameters.controls.forEach(e=>{e.controls.datalinkColumn&&e.controls.datalinkColumn.updateValueAndValidity()})})}),e.controls.dexihDatalinkTargets.controls.forEach(e=>{let t=i.dexihDatalinkTargets.find(t=>t.key===e.controls.key.value);t&&e.controls.runTime.setValue(t.runTime)}),this.IgnoreFormChange=!1}}}return e.\u0275fac=function(t){return new(t||e)(a.Sb(n.g),a.Sb(u.a),a.Sb(h.a))},e.\u0275prov=a.Gb({token:e,factory:e.\u0275fac}),e})()},e1St:function(e,t,i){"use strict";i.r(t),i.d(t,"HubBaseModule",(function(){return Wo}));var a=i("3Pt+"),n=i("PCNd"),s=i("tyNb"),o=i("2Vo4"),r=i("itXk"),c=i("soiQ"),l=i("fXoL"),u=i("4Y1E"),h=i("ElCs"),b=i("Wumg"),d=i("H3K+"),m=i("MI/1"),f=i("VdXI"),p=i("ofXK"),g=i("mWX8");function v(e,t){if(1&e&&(l.Lb(0,"actions-columnValidation-button",8),l.Lb(1,"dependent-items-button",9)),2&e){const e=t.item,i=l.Zb();l.hc("columnValidation",e),l.yb(1),l.hc("key",e.key)("objectType",i.eSharedObjectType.ColumnValidation)}}function y(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",10),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().deleteValidations(t)})),l.Nb()}}function C(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",10),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().export(i)})),l.Nb(),l.Dc(1,y,1,0,"dexih-button-delete",11),l.Lb(2,"tags-update-button",12)}if(2&e){const e=t.items,i=l.Zb();l.yb(1),l.hc("ngIf",i.hubCache.canWrite),l.yb(1),l.hc("objectType",i.eSharedObjectType.ColumnValidation)("objects",e)}}const w=function(){return["columnValidation-new"]};function S(e,t){1&e&&l.Lb(0,"dexih-button-new",14),2&e&&l.hc("routerLink",l.lc(1,w))}function k(e,t){if(1&e&&l.Dc(0,S,1,2,"dexih-button-new",13),2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite)}}let O=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[0],this.updateValidations()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Column Validation Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}deleteValidations(e){this.hubService.deleteColumnValidations(e)}updateValidations(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihColumnValidations.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,tags:this.hubCache.getObjectTags(c.dc.ColumnValidation,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}edit(e){this.router.navigate(["columnValidation-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubService.createHub(this.hubCache.hub.hubKey,"");e.forEach(e=>{this.hubCache.cacheAddColumnValidation(e.key,t)}),this.hubService.exportHub(t,1===e.length?"ColumnValidation - "+e[0].name+".json":"columnValidations.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.ColumnValidation&&e.changeClass!==c.dc.TagObjects||this.updateValidations()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["columnValidations"]],inputs:{hubKey:"hubKey"},decls:9,vars:7,consts:[[1,"container-fluid"],["title","Validation Rules","iconClass","fa fa-lg fa-fw fa-check-square-o",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],[1,"mr-1",3,"columnValidation"],[1,"mr-1",3,"key","objectType"],[1,"mr-1",3,"click"],["class","mr-1",3,"click",4,"ngIf"],[1,"mr-1",3,"objectType","objects"],["class","mr-1",3,"routerLink",4,"ngIf"],[1,"mr-1",3,"routerLink"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,v,2,3,"ng-template",3,4,l.Ec),l.Dc(5,C,3,3,"ng-template",5,6,l.Ec),l.Dc(7,k,1,1,"ng-template",null,7,l.Ec),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,m.a,f.a,b.u,p.t,g.a,b.g,b.o,s.f],encapsulation:2}),e})();var T=i("2v7R"),N=i("cvPx"),D=i("1qMd"),x=i("3WyZ"),F=i("64E1"),V=i("iFLP"),I=i("oLr2");function K(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div"),l.Ob(1,"div",10),l.Ob(2,"div",11),l.Ob(3,"button",12),l.Vb("click",(function(){return l.vc(e),l.Zb(3).test()})),l.Lb(4,"i",13),l.Nb(),l.Nb(),l.Ob(5,"input",14),l.Vb("ngModelChange",(function(t){return l.vc(e),l.Zb(3).testValue=t})),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(3);l.yb(5),l.hc("ngModel",e.testValue)}}function E(e,t){if(1&e&&l.Lb(0,"save-button",6),2&e){const e=l.Zb(3);l.hc("formsService",e.formsService)}}function L(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-invalid-form-details",7),l.Vb("click",(function(){return l.vc(e),l.Zb(2).formsService.showErrors()})),l.Nb(),l.Dc(1,K,6,1,"div",8),l.Dc(2,E,1,1,"save-button",9)}if(2&e){const e=l.Zb(2);l.hc("control",e.formsService.currentForm),l.yb(1),l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("ngIf",e.hubCache.canWrite)}}function P(e,t){if(1&e&&(l.Ob(0,"div",4),l.Dc(1,L,3,3,"ng-template",5),l.Lb(2,"cancel-button",6),l.Nb()),2&e){const e=l.Zb();l.yb(1),l.hc("ngIf",e.hubCache&&e.hubCache.status===e.eCacheStatus.Loaded),l.yb(1),l.hc("formsService",e.formsService)}}function M(e,t){if(1&e&&(l.Ob(0,"div"),l.Fc(1),l.Nb()),2&e){const e=l.Zb(3);l.yb(1),l.Hc("Cleaned Value = ",e.testResult.cleanedValue," ")}}function j(e,t){if(1&e&&(l.Ob(0,"div"),l.Fc(1),l.Nb()),2&e){const e=l.Zb(3);l.yb(1),l.Hc("Reject Reason = ",e.testResult.rejectReason," ")}}function A(e,t){if(1&e&&(l.Ob(0,"section"),l.Ob(1,"div",30),l.Fc(2),l.Dc(3,M,2,1,"div",8),l.Dc(4,j,2,1,"div",8),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.Cb("alert-danger",0==e.testResult.success)("alert-success",1==e.testResult.success),l.yb(1),l.Hc(" Test Result = ",e.testResult.success," "),l.yb(1),l.hc("ngIf",e.testResult.cleanedValue),l.yb(1),l.hc("ngIf",e.testResult.rejectReason)}}function R(e,t){if(1&e&&(l.Ob(0,"section",17),l.Lb(1,"form-select",31),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("items",e.cleanActions)}}function _(e,t){1&e&&(l.Ob(0,"section"),l.Lb(1,"form-input",32),l.Nb())}function Z(e,t){1&e&&(l.Ob(0,"div",16),l.Ob(1,"section",17),l.Lb(2,"form-input",33),l.Nb(),l.Ob(3,"section",17),l.Lb(4,"form-input",34),l.Nb(),l.Nb())}function H(e,t){1&e&&(l.Ob(0,"section"),l.Lb(1,"form-input",35),l.Nb())}function G(e,t){1&e&&(l.Ob(0,"section"),l.Lb(1,"form-input",36),l.Nb())}function q(e,t){1&e&&(l.Ob(0,"div",16),l.Ob(1,"section",17),l.Lb(2,"form-input",37),l.Nb(),l.Ob(3,"section",17),l.Lb(4,"form-input",38),l.Nb(),l.Nb())}function B(e,t){if(1&e&&(l.Ob(0,"form",15),l.Ob(1,"fieldset"),l.Dc(2,A,5,7,"section",8),l.Ob(3,"div",16),l.Ob(4,"section",17),l.Lb(5,"form-input",18),l.Nb(),l.Ob(6,"section",17),l.Lb(7,"form-select",19),l.Nb(),l.Nb(),l.Ob(8,"section"),l.Lb(9,"form-textarea",20),l.Nb(),l.Ob(10,"div",16),l.Ob(11,"section",17),l.Lb(12,"form-select",21),l.Nb(),l.Dc(13,R,2,1,"section",22),l.Nb(),l.Dc(14,_,2,0,"section",8),l.Ob(15,"section"),l.Lb(16,"form-checkbox",23),l.Nb(),l.Dc(17,Z,5,0,"div",24),l.Dc(18,H,2,0,"section",8),l.Dc(19,G,2,0,"section",8),l.Dc(20,q,5,0,"div",24),l.Ob(21,"section"),l.Lb(22,"form-tags",25),l.Nb(),l.Ob(23,"section"),l.Lb(24,"form-tags",26),l.Nb(),l.Ob(25,"section"),l.Lb(26,"form-select",27),l.Nb(),l.Ob(27,"section"),l.Lb(28,"form-checkbox",28),l.Nb(),l.Ob(29,"section"),l.Lb(30,"form-checkbox",29),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.formsService.currentForm),l.yb(2),l.hc("ngIf",e.testResult),l.yb(3),l.hc("autocapitalize",!0)("errors",e.formsService.formErrors.name),l.yb(2),l.hc("items",e.typeCodes),l.yb(2),l.hc("showMarkdown",!0),l.yb(3),l.hc("items",e.InvalidActions),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.invalidAction==e.eInvalidAction.Clean||e.formsService.currentForm.value.invalidAction==e.eInvalidAction.RejectClean),l.yb(1),l.hc("ngIf",(e.formsService.currentForm.value.invalidAction==e.eInvalidAction.RejectClean||e.formsService.currentForm.value.invalidAction==e.eInvalidAction.Clean)&&e.formsService.currentForm.value.cleanAction==e.eCleanAction.CleanValue),l.yb(3),l.hc("ngIf",e.formsService.currentForm.value.dataType==e.eTypeCode.String||e.formsService.currentForm.value.dataType==e.eTypeCode.Char),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.dataType==e.eTypeCode.String||e.formsService.currentForm.value.dataType==e.eTypeCode.Char),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.dataType==e.eTypeCode.String||e.formsService.currentForm.value.dataType==e.eTypeCode.Char),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.dataType!=e.eTypeCode.String&&e.formsService.currentForm.value.dataType!=e.eTypeCode.Char),l.yb(6),l.hc("items",e.connections)("allowNullSelect",!0)}}let U=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.eInvalidAction=c.Fb,this.eCleanAction=c.fb,this.eTypeCode=c.pc,this.InvalidActions=T.g,this.CleanActions=T.a,this.typeCodes=D.a,this.invalidActions=T.g,this.cleanActions=T.a,this.lookupColumnValue="",this.isLoaded=!1,this.eCacheStatus=T.j,this.cancelToken=new x.a}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.status===T.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"Column Validation")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._lookupColumnSubscription&&this._lookupColumnSubscription.unsubscribe(),this.cancelToken.cancel()}load(){if(this.connections=this.hubCache.getConnectionTables(),"edit"===this.action)if(this.columnValidationKey=+this.params.validationKey,this.columnValidationKey)if(this.hubCache.hub&&this.hubCache.hub.dexihColumnValidations){let e=this.hubCache.hub.dexihColumnValidations.find(e=>e.key===this.columnValidationKey);this.formsService.validation(e)}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no validation specified to edit.");if("new"===this.action){let e=new c.e;this.formsService.validation(e),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/columnValidation-new","/columnValidation-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}this.isLoaded=!0,this.getValidationLookupColumn(),this._lookupColumnSubscription&&this._lookupColumnSubscription.unsubscribe(),this._lookupColumnSubscription=this.formsService.currentForm.controls.lookupColumnKey.valueChanges.subscribe(()=>{this.getValidationLookupColumn()})}getValidationLookupColumn(){let e=this.formsService.currentForm.controls.lookupColumnKey.value;if(e){let t=this.hubCache.getColumn(e);if(t){let e=this.hubCache.getTable(t.tableKey);this.lookupColumnValue="Exists in table:"+e.name+", column:"+t.name}else this.lookupColumnValue="Column not found.  Re-select a valid column."}else this.lookupColumnValue=""}test(){this.hubService.testColumnValidation(this.formsService.currentForm.value,this.testValue,this.cancelToken).then(e=>{this.testResult=e})}close(){this.authService.navigateUp()}canDeactivate(){return new Promise(e=>{this.formsService.hasChanged?this.authService.confirmDialog("The view has not been saved","The column validation changes have not been saved.  Do you want to discard the changes and exit?").then(t=>{e(t)}).catch(()=>{e(!1)}):e(!0)})}unloadNotification(e){this.formsService.hasChanged&&(e.returnValue="The column validation changes have not been saved.  Do you want to discard the changes and exit?")}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(N.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-columnValidation-edit-form"]],hostBindings:function(e,t){1&e&&l.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,l.uc)},features:[l.xb([N.a])],decls:5,vars:3,consts:[[1,"container"],["title","Edit Validation","iconClass","fa fa-lg fa-fw fa-check-square-o",3,"showCloseButton","padding","close"],["header",""],[3,"formGroup",4,"ngIf"],[1,"d-inline-flex"],[3,"ngIf"],[1,"mr-1",3,"formsService"],[1,"mr-1",3,"control","click"],[4,"ngIf"],["class","mr-1",3,"formsService",4,"ngIf"],[1,"input-group","mr-1"],[1,"input-group-prepend"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-check-circle-o"],["type","text","placeholder","Test value","aria-label","","aria-describedby","basic-addon1",1,"form-control",2,"max-width","100px",3,"ngModel","ngModelChange"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Column Validation Name","formControlName","name","placeholder","Enter the name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Data Type","formControlName","dataType","itemKey","key","itemName","name",3,"items"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],["label","Validation Fail Action","formControlName","invalidAction","itemKey","key","itemName","name","note","Action to take when the validation fails.",3,"items"],["class","form-group col-md-6",4,"ngIf"],["label","Ignore null values.","formControlName","allowDbNull"],["class","form-row",4,"ngIf"],["label","Restrict to list of values","formControlName","listOfValues","placeholder","Provide a list of values which are valid."],["label","Excluded list of values","formControlName","listOfNotValues","placeholder","Provide a list of values which are valid."],["label","Restrict to values that exist in a lookup table column","formControlName","lookupColumnKey","grandParentName","name","parentName","name","itemKey","key","itemName","name","childItems","dexihTables","grandChildItems","dexihTableColumns","note","Checks the selected table column, and ensures the value contains at least one match.",3,"items","allowNullSelect"],["label","Only lookup values where the 'is current' column is true.","formControlName","lookupIsValid"],["label","Allow valid when lookup returns multiple rows.","formControlName","lookupMultipleRecords"],[1,"alert"],["label","Clean Action","formControlName","cleanAction","itemKey","key","itemName","name","note","Clean Action to apply",3,"items"],["label","Clean Value","formControlName","cleanValue","placeholder","Enter the clean value.","iconClass","fa fa-list"],["label","Minimum String Length","formControlName","minLength","placeholder","Enter the minimum string length","type","number","iconClass","fa fa-list"],["label","Maximum String Length","formControlName","maxLength","placeholder","Enter the maximum string length","type","number","iconClass","fa fa-list"],["label","Simple Pattern Match","formControlName","patternMatch","placeholder","Provide a match string","iconClass","fa fa-list","note","Simple pattern match, use the format - A=Upper, a=Lower, Z=Any Character, 9=numeric.  (For example: AA999 matches AS123)"],["label","Regular Expression Match","formControlName","regexMatch","placeholder","Provide a regular expression","iconClass","fa fa-list","note","Use a standard regular expression to validate.  For example [A-Za-z0-9] will ensure string only contains characters and numbers."],["label","Minimum Value","formControlName","minValue","placeholder","Enter the minimum value","type","number","iconClass","fa fa-list"],["label","Maximum Value","formControlName","maxValue","placeholder","Enter the maximum value","type","number","iconClass","fa fa-list"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,P,3,2,"ng-template",null,2,l.Ec),l.Dc(4,B,31,15,"form",3),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(3),l.hc("ngIf",t.formsService.currentForm))},directives:[b.P,p.t,F.a,V.a,a.c,a.s,a.v,I.a,a.I,a.t,a.l,b.D,a.j,b.E,b.H,b.A,b.F],encapsulation:2}),e})();var z=i("rgmq"),W=i("/pur"),Q=i("l2bN"),$=function(e,t,i,a){return new(i||(i=Promise))((function(n,s){function o(e){try{c(a.next(e))}catch(t){s(t)}}function r(e){try{c(a.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function X(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button",10),l.Vb("click",(function(){l.vc(e);const t=l.Zb(2);return!t.refreshingConnection&&t.refreshConnection()})),l.Fc(1,"Test"),l.Nb()}if(2&e){const e=l.Zb(2);l.hc("busy",e.refreshingConnection)}}function Y(e,t){if(1&e&&l.Lb(0,"save-button",11),2&e){const e=l.Zb(2);l.hc("formsService",e.formsService)}}const J=function(e){return["../../connection-import",e]};function ee(e,t){if(1&e&&(l.Ob(0,"dexih-button",13),l.Fc(1,"Import Tables"),l.Nb()),2&e){const e=l.Zb(4);l.hc("routerLink",l.mc(1,J,e.formsService.currentForm.controls.key.value))}}function te(e,t){if(1&e&&l.Dc(0,ee,2,3,"dexih-button",12),2&e){const e=l.Zb(3);l.hc("ngIf",e.formsService.currentForm.controls.key.value)}}const ie=function(e){return["../../../tables","table-new",e]};function ae(e,t){if(1&e&&(l.Ob(0,"dexih-button",13),l.Fc(1,"New File"),l.Nb()),2&e){const e=l.Zb(4);l.hc("routerLink",l.mc(1,ie,e.formsService.currentForm.controls.key.value))}}function ne(e,t){if(1&e&&l.Dc(0,ae,2,3,"dexih-button",12),2&e){const e=l.Zb(3);l.hc("ngIf",e.formsService.currentForm.controls.key.value)}}function se(e,t){if(1&e&&(l.Ob(0,"dexih-button",13),l.Fc(1,"New WebService"),l.Nb()),2&e){const e=l.Zb(4);l.hc("routerLink",l.mc(1,ie,e.formsService.currentForm.controls.key.value))}}function oe(e,t){if(1&e&&l.Dc(0,se,2,3,"dexih-button",12),2&e){const e=l.Zb(3);l.hc("ngIf",e.formsService.currentForm.controls.key.value)}}function re(e,t){if(1&e&&(l.Dc(0,te,1,1,"ng-template",8),l.Dc(1,ne,1,1,"ng-template",8),l.Dc(2,oe,1,1,"ng-template",8)),2&e){const e=l.Zb(2);l.hc("ngIf",e.connectionReference.connectionCategory==e.eConnectionCategory.SqlDatabase||e.connectionReference.connectionCategory==e.eConnectionCategory.DatabaseFile||e.connectionReference.connectionCategory==e.eConnectionCategory.NoSqlDatabase||e.connectionReference.connectionCategory==e.eConnectionCategory.Hub),l.yb(1),l.hc("ngIf",e.connectionReference.connectionCategory==e.eConnectionCategory.File),l.yb(1),l.hc("ngIf",e.connectionReference.connectionCategory==e.eConnectionCategory.WebService)}}function ce(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-invalid-form-details",5),l.Vb("click",(function(){return l.vc(e),l.Zb().formsService.showErrors()})),l.Nb(),l.Dc(1,X,2,1,"dexih-button",6),l.Dc(2,Y,1,1,"save-button",7),l.Dc(3,re,3,3,"ng-template",8),l.Lb(4,"cancel-button",9)}if(2&e){const e=l.Zb();l.hc("control",e.formsService.currentForm),l.yb(1),l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("ngIf",e.hubCache.canWrite&&e.connectionReference),l.yb(1),l.hc("formsService",e.formsService)}}function le(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",33),l.Vb("click",(function(){return l.vc(e),l.Zb(7).revealConnectionString()})),l.Lb(1,"i",34),l.Fc(2," Reveal "),l.Nb()}}function ue(e,t){1&e&&(l.Ob(0,"span"),l.Lb(1,"i",35),l.Fc(2," Revealing... please wait "),l.Nb())}function he(e,t){if(1&e&&(l.Ob(0,"span"),l.Fc(1," ("),l.Dc(2,le,3,0,"a",32),l.Dc(3,ue,3,0,"span",23),l.Fc(4,")"),l.Nb()),2&e){const e=l.Zb(6);l.yb(2),l.hc("ngIf",0==e.revealingConnectionString),l.yb(1),l.hc("ngIf",1==e.revealingConnectionString)}}function be(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form-input",31),l.Vb("keydown",(function(){return l.vc(e),l.Zb(5).connectionStringChanged()})),l.Dc(1,he,5,2,"span",23),l.Nb()}if(2&e){const e=l.Zb(5);l.hc("errors",e.formsService.formErrors.connectionStringDisplay),l.yb(1),l.hc("ngIf",!e.formsService.formErrors.connectionStringRaw)}}function de(e,t){if(1&e&&l.Lb(0,"form-select",36),2&e){const e=l.Zb(5);l.hc("items",e.variables)("sortItems",!0)("enableTextEntry",!0)}}function me(e,t){if(1&e){const e=l.Pb();l.Ob(0,"section"),l.Dc(1,be,2,2,"form-input",28),l.Dc(2,de,1,3,"form-select",29),l.Ob(3,"form-checkbox",30),l.Vb("click",(function(){return l.vc(e),l.Zb(4).clearConnectionString()})),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(4);l.yb(1),l.hc("ngIf",!e.formsService.currentForm.controls.useConnectionStringVariable.value),l.yb(1),l.hc("ngIf",e.formsService.currentForm.controls.useConnectionStringVariable.value)}}function fe(e,t){if(1&e&&(l.Ob(0,"span"),l.Ob(1,"section"),l.Lb(2,"form-checkbox",27),l.Nb(),l.Dc(3,me,4,2,"section",23),l.Nb()),2&e){const e=l.Zb(3);l.yb(3),l.hc("ngIf",1==e.formsService.currentForm.controls.useConnectionString.value)}}function pe(e,t){1&e&&(l.Ob(0,"section"),l.Lb(1,"form-checkbox",40),l.Nb())}function ge(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form-input",45),l.Vb("keydown",(function(){return l.vc(e),l.Zb(5).passwordChanged()})),l.Nb()}if(2&e){const e=l.Zb(5);l.hc("errors",e.formsService.formErrors.password)}}function ve(e,t){if(1&e&&l.Lb(0,"form-select",46),2&e){const e=l.Zb(5);l.hc("items",e.variables)("sortItems",!0)("enableTextEntry",!0)}}function ye(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",18),l.Ob(1,"section",19),l.Lb(2,"form-select",41),l.Nb(),l.Ob(3,"section",19),l.Dc(4,ge,1,1,"form-input",42),l.Dc(5,ve,1,3,"form-select",43),l.Ob(6,"form-checkbox",44),l.Vb("click",(function(){return l.vc(e),l.Zb(4).clearPassword()})),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(4);l.yb(2),l.hc("enableTextEntry",!0)("errors",e.formsService.formErrors.username)("items",e.variables)("enableFilter",!0),l.yb(2),l.hc("ngIf",0==e.formsService.currentForm.controls.usePasswordVariable.value),l.yb(1),l.hc("ngIf",e.formsService.currentForm.controls.usePasswordVariable.value)}}function Ce(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form-input",50),l.Vb("keydown",(function(){return l.vc(e),l.Zb(5).passwordChanged()})),l.Nb()}if(2&e){const e=l.Zb(5);l.hc("errors",e.formsService.formErrors.password)}}function we(e,t){if(1&e&&l.Lb(0,"form-select",51),2&e){const e=l.Zb(5);l.hc("items",e.variables)("sortItems",!0)("enableTextEntry",!0)}}function Se(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",18),l.Ob(1,"section",19),l.Dc(2,Ce,1,1,"form-input",47),l.Dc(3,we,1,3,"form-select",48),l.Ob(4,"form-checkbox",49),l.Vb("click",(function(){return l.vc(e),l.Zb(4).clearPassword()})),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(4);l.yb(2),l.hc("ngIf",0==e.formsService.currentForm.controls.usePasswordVariable.value),l.yb(1),l.hc("ngIf",e.formsService.currentForm.controls.usePasswordVariable.value)}}function ke(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",33),l.Vb("click",(function(){return l.vc(e),l.Zb(5).refreshConnection()})),l.Lb(1,"i",34),l.Fc(2," Refresh "),l.Nb()}}function Oe(e,t){1&e&&(l.Ob(0,"span"),l.Lb(1,"i",35),l.Fc(2," Refreshing... please wait "),l.Nb())}function Te(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",33),l.Vb("click",(function(){return l.vc(e),l.Zb(5).createDatabase()})),l.Lb(1,"i",54),l.Fc(2," New Database "),l.Nb()}}function Ne(e,t){1&e&&(l.Ob(0,"span"),l.Lb(1,"i",35),l.Fc(2," Creating database... please wait "),l.Nb())}function De(e,t){if(1&e){const e=l.Pb();l.Ob(0,"section",52),l.Ob(1,"form-select",53),l.Vb("textValueChange",(function(t){return l.vc(e),l.Zb(4).newDatabaseName(t)})),l.Fc(2," ("),l.Dc(3,ke,3,0,"a",32),l.Dc(4,Oe,3,0,"span",23),l.Fc(5,") ( "),l.Dc(6,Te,3,0,"a",32),l.Dc(7,Ne,3,0,"span",23),l.Fc(8,") "),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(4);l.yb(1),l.hc("label",e.connectionReference.databaseDescription)("items",e.databases)("defaultItem",e.formsService.currentForm.value.defaultDatabase)("sortItems",!0)("enableTextEntry",!0),l.yb(2),l.hc("ngIf",0==e.refreshingConnection),l.yb(1),l.hc("ngIf",1==e.refreshingConnection),l.yb(2),l.hc("ngIf",0==e.creatingDatabase),l.yb(1),l.hc("ngIf",1==e.creatingDatabase)}}function xe(e,t){if(1&e&&(l.Ob(0,"span"),l.Ob(1,"section"),l.Lb(2,"form-select",37),l.Nb(),l.Dc(3,pe,2,0,"section",23),l.Dc(4,ye,7,6,"div",38),l.Dc(5,Se,5,2,"div",38),l.Dc(6,De,9,9,"section",39),l.Nb()),2&e){const e=l.Zb(3);l.yb(2),l.hc("enableTextEntry",!0)("label",e.connectionReference.serverDescription)("errors",e.formsService.formErrors.server)("items",e.variables)("enableFilter",!0)("note",e.connectionReference.serverHelp),l.yb(1),l.hc("ngIf",1==e.connectionReference.allowsWindowsAuth),l.yb(1),l.hc("ngIf",e.connectionReference.allowsUserPassword&&(0==e.formsService.currentForm.controls.useWindowsAuth.value||0==e.connectionReference.allowsWindowsAuth)),l.yb(1),l.hc("ngIf",e.connectionReference.allowsToken&&(0==e.formsService.currentForm.controls.useWindowsAuth.value||0==e.connectionReference.allowsWindowsAuth)),l.yb(1),l.hc("ngIf",e.connectionReference.requiresDatabase)}}function Fe(e,t){if(1&e&&(l.Ob(0,"section"),l.Lb(1,"form-checkbox",55),l.Nb()),2&e){const e=l.Zb(3);l.yb(1),l.hc("errors",e.formsService.formErrors.embedTableKey)}}function Ve(e,t){if(1&e){const e=l.Pb();l.Ob(0,"span"),l.Ob(1,"section"),l.Ob(2,"markdown",24),l.Vb("click",(function(t){return l.vc(e),l.Zb(2).getRoute(t)})),l.Nb(),l.Nb(),l.Dc(3,fe,4,1,"span",23),l.Dc(4,xe,7,10,"span",23),l.Ob(5,"div",18),l.Ob(6,"section",19),l.Lb(7,"form-input",25),l.Nb(),l.Ob(8,"section",19),l.Lb(9,"form-input",26),l.Nb(),l.Nb(),l.Dc(10,Fe,2,1,"section",23),l.Nb()}if(2&e){const e=l.Zb(2);l.yb(2),l.hc("data",e.connectionReference.description),l.yb(1),l.hc("ngIf",1==e.connectionReference.allowsConnectionString),l.yb(1),l.hc("ngIf",0==e.formsService.currentForm.controls.useConnectionString.value),l.yb(3),l.hc("errors",e.formsService.formErrors.connectionTimeout),l.yb(2),l.hc("errors",e.formsService.formErrors.commandTimeout),l.yb(1),l.hc("ngIf","Managed"==e.formsService.currentForm.controls.purpose.value)}}const Ie=function(){return{standalone:!0}};function Ke(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form",14),l.Lb(1,"input",15),l.Lb(2,"input",16),l.Ob(3,"fieldset"),l.Ob(4,"section"),l.Lb(5,"form-select",17),l.Nb(),l.Ob(6,"div",18),l.Ob(7,"section",19),l.Lb(8,"form-input",20),l.Nb(),l.Ob(9,"section",19),l.Ob(10,"form-select",21),l.Vb("ngModelChange",(function(t){return l.vc(e),l.Zb().connectionReference=t}))("ngModelChange",(function(t){return l.vc(e),l.Zb().selectDatabaseType(t)})),l.Nb(),l.Nb(),l.Nb(),l.Ob(11,"section"),l.Lb(12,"form-textarea",22),l.Nb(),l.Dc(13,Ve,11,6,"span",23),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.hc("formGroup",e.formsService.currentForm),l.yb(5),l.hc("items",e.eConnectionPurposeItems)("enableFilter",!1)("errors",e.formsService.formErrors.purpose),l.yb(3),l.hc("autocapitalize",!0)("errors",e.formsService.formErrors.name),l.yb(2),l.hc("ngModel",e.connectionReference)("ngModelOptions",l.lc(14,Ie))("items",e.connectionTypes)("enableKeySelect",!1)("sortItems",!0),l.yb(2),l.hc("showMarkdown",!0)("errors",e.formsService.formErrors.description),l.yb(1),l.hc("ngIf",e.connectionReference)}}let Ee=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.savingConnection=!1,this.refreshingConnection=!1,this.revealingConnectionString=!1,this.creatingDatabase=!1,this.databases=[],this.eConnectionPurposeItems=c.kb.filter(e=>e.key>0),this.eConnectionPurpose=c.jb,this.eConnectionCategory=c.ib,this.cancelToken=new x.a,this.isLoaded=!1,this.variables=[],this.logger=new z.a("connection-edit")}ngOnInit(){this.logger.LogC(()=>"OnInit",z.b.Trace);try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteLibrariesObservable()).subscribe(e=>$(this,void 0,void 0,(function*(){let t=e[0];this.params=e[1],this.hubCache=e[2],this.remoteLibraries=e[3],this.action=t.action,this.pageTitle=t.pageTitle,this.variables=this.hubCache.hub.dexihHubVariables.map(e=>"{"+e.name+"}"),this.hubCache&&this.hubCache.status===T.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>$(this,void 0,void 0,(function*(){e&&(yield this.load())}))).catch(e=>{}):yield this.load()))})))}catch(e){this.hubService.addHubClientErrorMessage(e,"Connection Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._purposeSubscription&&this._purposeSubscription.unsubscribe(),this.cancelToken.cancel()}load(){return $(this,void 0,void 0,(function*(){if(this.isLoaded=!0,"edit"===this.action)if(this.connectionKey=+this.params.connectionKey,this.logger.LogC(()=>`edit connection key ${this.connectionKey}.`,z.b.Trace),this.connectionKey)if(this.hubCache.hub&&this.hubCache.hub.dexihConnections){let e=this.hubCache.hub.dexihConnections.find(e=>e.key===this.connectionKey);e?(this.updateDatabaseTypes(e.purpose),this.connectionReference=yield this.hubService.GetConnectionReference(e),this.formsService.connection(e),e.defaultDatabase&&(this.databases=[e.defaultDatabase]),this.logger.LogC(()=>"edit connection, form loaded.",z.b.Trace)):(this.hubService.addHubErrorMessage("The specified connection could not be found."),this.logger.LogC(()=>`edit connection with key ${this.connectionKey} not found.`,z.b.Warning))}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no connection specified to edit.");if("new"===this.action){let e=new c.f;e.purpose=+this.params.purpose,this.logger.LogC(()=>`new connection, purpose ${e.purpose}.`,z.b.Trace),this.updateDatabaseTypes(e.purpose),this.formsService.connection(e),this.updateUrl(),this.logger.LogC(()=>"new connection, form loaded.",z.b.Trace)}if("copy"===this.action){let e=new c.f,t=+this.params.connectionKey,i=this.hubCache.hub.dexihConnections.find(e=>e.key===t);Object.assign(e,i),e.name+=" (copy)",e.key=null,this.connectionReference=yield this.hubService.GetConnectionReference(e),this.logger.LogC(()=>`copy connection, connectionKey ${t}.`,z.b.Trace),this.updateDatabaseTypes(e.purpose),this.formsService.connection(e),this.updateUrl(),this.logger.LogC(()=>"new connection, form loaded.",z.b.Trace)}this._purposeSubscription&&this._purposeSubscription.unsubscribe(),this._purposeSubscription=this.formsService.currentForm.controls.purpose.valueChanges.subscribe(e=>{this.updateDatabaseTypes(e)})}))}updateUrl(){this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname,i=e.indexOf("/connection-new");if(i>0){let a=e.substr(0,i)+"/connection-edit/"+t;this.router.navigateByUrl(a)}this._formChangeSubscription.unsubscribe()}})}updateDatabaseTypes(e){this.connectionTypes=this.remoteLibraries.connections.filter(t=>e===c.jb.Source&&t.allowsSourceConnection||e===c.jb.Managed&&t.allowsManagedConnection||e===c.jb.Target&&t.allowsTargetConnection)}selectDatabaseType(e){return $(this,void 0,void 0,(function*(){if(this.formsService.currentForm.controls.connectionClassName.setValue(e.connectionClassName),this.formsService.currentForm.controls.connectionAssemblyName.setValue(e.connectionAssemblyName),this.connectionReference.connectionCategory===c.ib.Hub){if(!this.formsService.currentForm.controls.server.value){const e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");this.formsService.currentForm.controls.server.setValue(e)}if(!this.formsService.currentForm.controls.username.value){const e=this.authService.getUser();e&&this.formsService.currentForm.controls.username.setValue(e.email)}}}))}connectionStringChanged(){this.logger.LogC(()=>"connectionStringChanged.",z.b.Trace),this.formsService.currentForm.controls.connectionString.value&&(this.formsService.currentForm.controls.connectionString.setValue(null),this.formsService.currentForm.controls.connectionStringDisplay.setValue(""))}clearConnectionString(){this.formsService.currentForm.controls.connectionString.setValue(null),this.formsService.currentForm.controls.connectionStringDisplay.setValue("")}revealConnectionString(){this.logger.LogC(()=>"revealConnectionString.",z.b.Trace),this.revealingConnectionString=!0,this.hubService.decrypt(this.formsService.currentForm.controls.connectionString.value,this.cancelToken).then(e=>{this.formsService.currentForm.controls.connectionStringDisplay.setValue(e),this.revealingConnectionString=!1}).catch(e=>{this.hubService.addHubMessage(e),this.revealingConnectionString=!1})}passwordChanged(){this.logger.LogC(()=>"passwordChanged.",z.b.Trace),this.formsService.currentForm.controls.password.value&&(this.formsService.currentForm.controls.password.setValue(null),this.formsService.currentForm.controls.passwordDisplay.setValue(""))}clearPassword(){this.formsService.currentForm.controls.password.setValue(null),this.formsService.currentForm.controls.passwordDisplay.setValue("")}refreshConnection(){return $(this,void 0,void 0,(function*(){this.logger.LogC(()=>"refreshConnection.",z.b.Trace),yield this.encryptConnection(),this.refreshingConnection=!0,this.hubService.refreshConnection(this.formsService.currentForm.value,this.cancelToken).then(e=>{this.hubService.addHubSuccessMessage("The connection was successful."),this.databases=e,this.refreshingConnection=!1}).catch(e=>{this.hubService.addHubMessage(e),this.refreshingConnection=!1})}))}newDatabaseName(e){this.formsService.currentForm.controls.defaultDatabase.setValue(e)}createDatabase(){this.creatingDatabase=!0,this.authService.promptDialog("Create Database","Enter the name for the new database?").then(e=>$(this,void 0,void 0,(function*(){if(e){yield this.encryptConnection();let t=Object.assign({},this.formsService.currentForm.value);t.defaultDatabase=e,this.hubService.createDatabase(t,this.cancelToken).then(()=>{this.hubService.addHubSuccessMessage("The database was created successfully."),this.databases=[e],this.formsService.currentForm.controls.defaultDatabase.setValue(e),this.creatingDatabase=!1}).catch(e=>{this.hubService.addHubMessage(e),this.creatingDatabase=!1})}else this.creatingDatabase=!1}))).catch(()=>{this.creatingDatabase=!1})}encryptConnection(){return $(this,void 0,void 0,(function*(){let e=this.formsService.currentForm,t=e.controls.passwordRaw.value;if(t){let i=yield this.hubService.encrypt(t,this.cancelToken);e.controls.password.setValue(i),e.controls.passwordRaw.setValue(null)}let i=e.controls.connectionStringRaw.value;if(i){let t=yield this.hubService.encrypt(i,this.cancelToken);e.controls.connectionString.setValue(t),e.controls.connectionStringRaw.setValue(null)}}))}save(){return $(this,void 0,void 0,(function*(){yield this.encryptConnection(),yield this.formsService.save()}))}close(){this.authService.navigateUp()}canDeactivate(){return new Promise(e=>{this.formsService.hasChanged?this.authService.confirmDialog("The connection has not been saved","The connection changes have not been saved.  Do you want to discard the changes and exit?").then(t=>{e(t)}).catch(()=>{e(!1)}):e(!0)})}getRoute(e){this.authService.getRoute(e)}unloadNotification(e){this.formsService.hasChanged&&(e.returnValue="The connection changes have not been saved.  Do you want to discard the changes and exit?")}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(N.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-connection-edit-form"]],hostBindings:function(e,t){1&e&&l.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,l.uc)},features:[l.xb([N.a])],decls:6,vars:3,consts:[[1,"container"],["title","Edit Connection","iconClass","fa fa-lg fa-fw fa-database",3,"showCloseButton","padding","close"],["header",""],[3,"formGroup",4,"ngIf"],["title","Connections","path","/assets/help/reference/connection.md",1,"m-3"],[1,"mr-1",3,"control","click"],["class","mr-1","buttonClass","btn btn-success","iconClass","fa fa-thumbs-o-up","title","Test the connection against the source.",3,"busy","click",4,"ngIf"],["class","mr-1",3,"formsService",4,"ngIf"],[3,"ngIf"],[3,"formsService"],["buttonClass","btn btn-success","iconClass","fa fa-thumbs-o-up","title","Test the connection against the source.",1,"mr-1",3,"busy","click"],[1,"mr-1",3,"formsService"],["class","mr-1","iconClass","fa fa-plus",3,"routerLink",4,"ngIf"],["iconClass","fa fa-plus",1,"mr-1",3,"routerLink"],[3,"formGroup"],["id","fake_user_name","name","fake_user[name]","type","text","value","Fake Auto-fill",2,"position","absolute","top","-5000px"],["id","fake_password","type","password","name","fake_password[password]","type","text","value","Fake Auto-fill",2,"position","absolute","top","-5000px"],["label","Purpose","formControlName","purpose","placeholder","Connection purpose","iconClass","fa fa-database","itemName","name","itemKey","key",3,"items","enableFilter","errors"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Name","formControlName","name","placeholder","Enter a name for the connection","iconClass","fa fa-database",3,"autocapitalize","errors"],["label","Database Type","itemName","name","itemKey","name","iconClass","fa fa-database",3,"ngModel","ngModelOptions","items","enableKeySelect","sortItems","ngModelChange"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown","errors"],[4,"ngIf"],[3,"data","click"],["type","number","label","Connection Timeout","formControlName","connectionTimeout","iconClass","fa fa-clock-o","note","The duration in seconds the remote agent will wait to establish a connection.",3,"errors"],["type","number","label","Command Timeout","formControlName","commandTimeout","iconClass","fa fa-clock-o","note","The duration in seconds the remote agent will for a command to start returning a result.",3,"errors"],["label","Use a connection string","formControlName","useConnectionString"],["label","Connection String","formControlName","connectionStringDisplay","placeholder","Enter a the connection string","iconClass","fa fa-database",3,"errors","keydown",4,"ngIf"],["label","Connection String","formControlName","connectionString","iconClass","fa fa-at","textEntryNote","Enter the variable name surrounded by {}",3,"items","sortItems","enableTextEntry",4,"ngIf"],["label","Use a variable for connection string","formControlName","useConnectionStringVariable",3,"click"],["label","Connection String","formControlName","connectionStringDisplay","placeholder","Enter a the connection string","iconClass","fa fa-database",3,"errors","keydown"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],[1,"fa","fa-refresh"],[1,"fa","fa-spin","fa-refresh"],["label","Connection String","formControlName","connectionString","iconClass","fa fa-at","textEntryNote","Enter the variable name surrounded by {}",3,"items","sortItems","enableTextEntry"],["formControlName","server","placeholder","Enter the details.","iconClass","fa fa-server",3,"enableTextEntry","label","errors","items","enableFilter","note"],["class","form-row",4,"ngIf"],["ng-disabled","refreshingConnection || creatingDatabase",4,"ngIf"],["label","Use windows authentication","formControlName","useWindowsAuth"],["label","User Name","formControlName","username","placeholder","Enter user name","iconClass","fa fa-user",3,"enableTextEntry","errors","items","enableFilter"],["label","Password","formControlName","passwordDisplay","type","password","placeholder","Enter a password","iconClass","fa fa-lock",3,"errors","keydown",4,"ngIf"],["label","Password","formControlName","password","iconClass","fa fa-at",3,"items","sortItems","enableTextEntry",4,"ngIf"],["label","Use a variable for password","formControlName","usePasswordVariable",3,"click"],["label","Password","formControlName","passwordDisplay","type","password","placeholder","Enter a password","iconClass","fa fa-lock",3,"errors","keydown"],["label","Password","formControlName","password","iconClass","fa fa-at",3,"items","sortItems","enableTextEntry"],["label","Secure Token","formControlName","passwordDisplay","type","password","placeholder","Enter secure token","iconClass","fa fa-lock",3,"errors","keydown",4,"ngIf"],["label","Secure Token","formControlName","password","iconClass","fa fa-at",3,"items","sortItems","enableTextEntry",4,"ngIf"],["label","Use a variable for token","formControlName","usePasswordVariable",3,"click"],["label","Secure Token","formControlName","passwordDisplay","type","password","placeholder","Enter secure token","iconClass","fa fa-lock",3,"errors","keydown"],["label","Secure Token","formControlName","password","iconClass","fa fa-at",3,"items","sortItems","enableTextEntry"],["ng-disabled","refreshingConnection || creatingDatabase"],["formControlName","defaultDatabase","iconClass","fa fa-database","textEntryNote","Enter the database name",3,"label","items","defaultItem","sortItems","enableTextEntry","textValueChange"],[1,"fa","fa-edit"],["label","Multi-use Managed Database (table keys will be added to table names to allow multiple hubs to use same database)","formControlName","embedTableKey",3,"errors"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,ce,5,5,"ng-template",null,2,l.Ec),l.Dc(4,Ke,14,15,"form",3),l.Nb(),l.Lb(5,"dexih-help",4),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(3),l.hc("ngIf",t.formsService.currentForm))},directives:[b.P,p.t,W.a,V.a,F.a,b.f,I.a,s.f,a.I,a.t,a.l,b.E,a.s,a.j,b.D,a.v,b.H,Q.a,b.A],encapsulation:2}),e})();function Le(e,t){}function Pe(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-splitdropdown",12),l.Vb("buttonClick",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().importSelected(t)})),l.Ob(1,"a",13),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().newDatalinks(t)})),l.Fc(2,"Import & Create Datalinks"),l.Nb(),l.Nb()}}function Me(e,t){if(1&e){const e=l.Pb();l.Dc(0,Pe,3,0,"dexih-button-splitdropdown",10),l.Ob(1,"dexih-button-delete",11),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().deleteSelected(i)})),l.Nb()}if(2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite)}}const je=function(e){return["table-edit",e]};function Ae(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-edit",15),l.Vb("click",(function(){l.vc(e);const t=l.Zb(2);return t.deleteSelected(t.items)})),l.Nb()}if(2&e){const e=l.Zb().item;l.hc("routerLink",l.mc(1,je,e.key))}}function Re(e,t){1&e&&l.Dc(0,Ae,1,3,"dexih-button-edit",14),2&e&&l.hc("ngIf",t.item.key)}function _e(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-dropdown",16),l.Ob(1,"a",17),l.Vb("click",(function(){return l.vc(e),l.Zb().setTableFilter("All")})),l.Fc(2,"All"),l.Nb(),l.Ob(3,"a",17),l.Vb("click",(function(){return l.vc(e),l.Zb().setTableFilter("Imported")})),l.Fc(4,"Imported"),l.Nb(),l.Ob(5,"a",17),l.Vb("click",(function(){return l.vc(e),l.Zb().setTableFilter("NonImported")})),l.Fc(6,"Non Imported"),l.Nb(),l.Nb(),l.Ob(7,"dexih-button-dropdown",18),l.Ob(8,"a",17),l.Vb("click",(function(){return l.vc(e),l.Zb().setViewFilter("All")})),l.Fc(9,"All"),l.Nb(),l.Ob(10,"a",17),l.Vb("click",(function(){return l.vc(e),l.Zb().setViewFilter("Tables")})),l.Fc(11,"Tables"),l.Nb(),l.Ob(12,"a",17),l.Vb("click",(function(){return l.vc(e),l.Zb().setViewFilter("Views")})),l.Fc(13,"Views"),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.hc("text",e.tableFilter)("pullRight",!0),l.yb(1),l.Cb("active","All"==e.tableFilter),l.yb(2),l.Cb("active","Imported"==e.tableFilter),l.yb(2),l.Cb("active","NonImported"==e.tableFilter),l.yb(2),l.hc("text",e.viewFilter)("pullRight",!0),l.yb(1),l.Cb("active","All"==e.viewFilter),l.yb(2),l.Cb("active","Imported"==e.viewFilter),l.yb(2),l.Cb("active","NonImported"==e.viewFilter)}}let Ze=(()=>{class e{constructor(e,t,i,a){this.authService=e,this.hubService=t,this.router=i,this.route=a,this.showPage=!1,this.showPageMessage="Loading...",this.cancelToken=new x.a,this.columns=[{name:"schema",title:"Schema",format:""},{name:"name",title:"Name",format:""},{name:"tableType",title:"Type",enum:c.ic,format:"Enum"},{name:"entityStatus.message",title:"Latest Status"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable(),this.tableFilter="All",this.viewFilter="Tables"}ngOnInit(){this.showPageMessage="Querying source database tables.  Please wait...";try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{return t=this,void 0,a=function*(){let t=e[1];this.hubCache=e[2];let i=e[3];this.connectionKey=+t.connectionKey,this.connectionKey?this.hubCache.isLoaded()&&(this.connection=this.hubCache.hub.dexihConnections.find(e=>e.key===this.connectionKey),this.connectionReference=yield this.hubService.GetConnectionReference(this.connection),this.showPage=!1,i?this.connection?this.getTables(this.connection):(this.hubService.addHubErrorMessage("The connection could not be found."),this.close()):this.showPageMessage="Waiting for an active remote agent..."):(this.hubService.addHubErrorMessage("There was no connection specified to import tables."),this.close())},new((i=void 0)||(i=Promise))((function(e,n){function s(e){try{r(a.next(e))}catch(t){n(t)}}function o(e){try{r(a.throw(e))}catch(t){n(t)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof i?a:new i((function(e){e(a)}))).then(s,o)}r((a=a.apply(t,[])).next())}));var t,i,a})}catch(e){this.hubService.addHubClientErrorMessage(e,"Connection Import")}this.watchChanges()}setTableFilter(e){this.tableFilter=e,this.updateFilter()}setViewFilter(e){this.viewFilter=e,this.updateFilter()}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this.cancelToken.cancel()}updateFilter(){let e;switch(this.tableFilter){case"Imported":e=this.tables.filter(e=>e.key>0);break;case"NonImported":e=this.tables.filter(e=>0===e.key||!e.key);break;default:e=this.tables}switch(this.viewFilter){case"Views":e=e.filter(e=>e.tableType===c.ic.View);break;case"Tables":e=e.filter(e=>e.tableType===c.ic.Table)}this._tableData.next(e)}getTables(e){this.showPage=!1,this.showPageMessage="Importing tables from remote database...",this.hubService.getDatabaseTableNames(e,this.cancelToken).then(t=>{this.tables=t;let i=this.hubCache.hub.dexihTables.filter(t=>t.connectionKey===e.key);for(let a=0;a<t.length;a++){let n=null,s=t[a];i&&(n=i.find(e=>e.name===s.name&&e.schema===s.schema),!n&&this.connectionReference&&this.connectionReference.defaultSchema===s.schema&&(n=i.find(e=>e.name===s.name&&!e.schema))),n?this.tables[a]=n:(s.connectionKey=e.key,s.tableType=s.tableType,s.entityStatus=new T.c)}this.showPage=!0,this.showPageMessage="",this.updateFilter()}).catch(e=>{this.hubService.addHubMessage(e)})}import(e){this.hubService.importTables([e],!0,this.cancelToken).then(e=>{this.mergeTables(e)}).catch(t=>{e.entityStatus.isBusy=!1,e.entityStatus.lastStatus=c.hc.Error,e.entityStatus.message=t.message})}deleteTable(e){this.hubService.deleteTables([e]).then(t=>{e.entityStatus.isBusy=!1}).catch(t=>{e.entityStatus.isBusy=!1,e.entityStatus.lastStatus=c.hc.Error,e.entityStatus.message=t.message})}importSelected(e){let t=e.filter(e=>!e.entityStatus.isBusy);t.forEach(e=>e.entityStatus.isBusy=!0),this.hubService.importTables(t,!0,this.cancelToken).then(e=>{this.mergeTables(e)}).catch(e=>{t.forEach(e=>e.entityStatus.isBusy=!1)})}mergeTables(e){e&&(e.forEach(e=>{let t=this.tables.findIndex(t=>t.name===e.name&&t.schema===e.schema);t>=0&&(this.tables[t]=e)}),this.updateFilter())}deleteSelected(e){let t=e.filter(e=>!e.entityStatus.isBusy&&e.key>0);0===t.length&&this.authService.informationDialog("Can not delete","None of the selected tables can be deleted, as they are either busy, or have not been imported."),t.forEach(e=>e.entityStatus.isBusy=!0),this.hubService.deleteTables(t).then(e=>{t.forEach(e=>e.entityStatus.isBusy=!1)}).catch(e=>{t.forEach(e=>e.entityStatus.isBusy=!1)})}editTable(e){e&&e.key&&this.router.navigate(["table-edit",e.key],{relativeTo:this.route.parent})}newDatalinks(e){let t=e.filter(e=>!e.entityStatus.isBusy);t.forEach(e=>e.entityStatus.isBusy=!0),this.hubService.importTables(t,!0,this.cancelToken).then(e=>{this.mergeTables(e);let t=e.map(e=>e.key).join("|");this.router.navigate(["datalink-new",t,0],{relativeTo:this.route.parent})}).catch(e=>{t.forEach(e=>e.entityStatus.isBusy=!1)})}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{if(e.changeClass===c.dc.Table){if(e.changeType===c.Eb.Replace||e.changeType===c.Eb.New){let t=e.data;if(t.connectionKey===this.connectionKey){let e=this.tables.findIndex(e=>e.name===t.name&&e.schema===t.schema);e>=0&&(this.tables[e]=t,this.updateFilter())}}if(e.changeType===c.Eb.Delete){let t=e.data;if(t.connectionKey===this.connectionKey){let e=this.tables.find(e=>e.key===t.key);e&&(e.key=null,e.entityStatus.isBusy=!1,e.updateDate=null,e.createDate=null,this.updateFilter())}}}})}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(h.a),l.Kb(u.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["connections"]],inputs:{hubKey:"hubKey"},decls:11,vars:10,consts:[[1,"container-fluid"],["iconClass","fa fa-lg fa-fw fa-database",3,"title","showIf","loadingMessage","showCloseButton","padding","close"],["header",""],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["select","filter"],["filter",""],["class","mr-1","text","Import","buttonClass","btn btn-success","iconClass","fa fa-cloud-download","title","Import selected tables",3,"buttonClick",4,"ngIf"],["title","Delete selected tables",3,"click"],["text","Import","buttonClass","btn btn-success","iconClass","fa fa-cloud-download","title","Import selected tables",1,"mr-1",3,"buttonClick"],["title","Import tables and create default staging datalinks",1,"dropdown-item",3,"click"],["class","mr-1","queryParamsHandling","","preserveFragment","","title","Edit this table",3,"routerLink","click",4,"ngIf"],["queryParamsHandling","","preserveFragment","","title","Edit this table",1,"mr-1",3,"routerLink","click"],["buttonClass","btn-primary","iconClass","fa fa-download","title","Filter by import status",1,"mr-1",3,"text","pullRight"],[1,"dropdown-item",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-table","title","Filter by tables/views",1,"mr-1",3,"text","pullRight"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,Le,0,0,"ng-template",null,2,l.Ec),l.Ob(4,"dexih-table",3),l.Vb("rowClick",(function(e){return t.editTable(e)})),l.Dc(5,Me,2,1,"ng-template",4,5,l.Ec),l.Dc(7,Re,1,1,"ng-template",6,7,l.Ec),l.Dc(9,_e,14,16,"ng-template",8,9,l.Ec),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("title","Import Tables for "+(null==t.connection?null:t.connection.name))("showIf",t.showPage)("loadingMessage",t.showPageMessage)("showCloseButton",!0)("padding",!1),l.yb(3),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData))},directives:[b.P,d.a,p.t,b.g,b.w,b.j,s.f,b.i],encapsulation:2}),e})();var He=i("Ifnz"),Ge=i("965U");function qe(e,t){1&e&&l.Lb(0,"actions-connection-button",9),2&e&&l.hc("connections",t.items)}function Be(e,t){if(1&e&&l.Lb(0,"tags-update-button",10),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.Connection)("objects",e)}}const Ue=function(e){return{purposeFilter:e}};function ze(e,t){if(1&e&&(l.Ob(0,"a",14),l.Fc(1),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(2);l.Cb("active",i.purposeFilter==e.key),l.hc("queryParams",l.mc(5,Ue,e.key))("title",e.name),l.yb(1),l.Gc(e.name)}}const We=function(){return{purposeFilter:"All"}};function Qe(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",11),l.Ob(1,"a",12),l.Fc(2,"All"),l.Nb(),l.Dc(3,ze,2,7,"a",13),l.ac(4,"gtFilter"),l.Nb()),2&e){const e=l.Zb();l.hc("autoCompact",!1)("text",e.eConnectionPurpose[e.purposeFilter])("pullRight",!0),l.yb(1),l.Cb("active","All"==e.purposeFilter),l.hc("queryParams",l.lc(11,We)),l.yb(2),l.hc("ngForOf",l.dc(4,7,e.eConnectionPurposeItems,"key",0))}}let $e=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eConnectionPurpose=c.jb,this.eConnectionPurposeItems=c.kb,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",format:"Md",footer:"description",tags:"tags"},{name:"purpose",title:"Purpose",format:""},{name:"type",title:"Type",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[2];this.hubCache=e[3],this.purposeFilter=+t.purposeFilter,this.purposeFilter||(this.purposeFilter=0),this.pageTitle=c.jb[this.purposeFilter]+" Connections",this.updateConnections()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Connection Index")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}close(){this.authService.navigateUp()}deleteConnection(e){this.hubService.deleteConnections([e]).catch(e=>{})}deleteConnections(e){this.hubService.deleteConnections(e)}editConnection(e){this.router.navigate(["connection-edit",e.key],{relativeTo:this.route})}updateConnections(){var e,t,i,a,n;return i=this,void 0,n=function*(){if(this.hubCache&&this.hubCache.isLoaded()){let s;s=0!==this.purposeFilter&&this.purposeFilter?this.hubCache.hub.dexihConnections.filter(e=>e.purpose===this.purposeFilter):this.hubCache.hub.dexihConnections;let o=[];try{for(var i,a=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(i){t[i]=e[i]&&function(t){return new Promise((function(a,n){!function(e,t,i,a){Promise.resolve(a).then((function(t){e({value:t,done:i})}),t)}(a,n,(t=e[i](t)).done,t.value)}))}}}(s);!(i=yield a.next()).done;){const e=i.value;let t=yield this.hubService.GetConnectionReference(e);o.push({key:e.key,connectionAssemblyName:e.connectionAssemblyName,connectionClassName:e.connectionClassName,purpose:c.jb[e.purpose],type:t?t.name:"Unknown ("+e.connectionClassName+")",name:e.name,tags:this.hubCache.getObjectTags(c.dc.Connection,e.key),description:e.description,updateDate:e.updateDate})}}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=a.return)&&(yield t.call(a))}finally{if(e)throw e.error}}this._tableData.next(o)}else this._tableData.next(null)},new((a=void 0)||(a=Promise))((function(e,t){function s(e){try{r(n.next(e))}catch(i){t(i)}}function o(e){try{r(n.throw(e))}catch(i){t(i)}}function r(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(s,o)}r((n=n.apply(i,[])).next())}))}export(e){const t=this.hubService.createHub(this.hubCache.hub.hubKey,"");e.forEach(e=>{this.hubCache.cacheAddConnection(e.key,t)}),this.hubService.exportHub(t,1===e.length?"Connection - "+e[0].name+".json":"connections.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Connection&&e.changeClass!==c.dc.TagObjects||this.updateConnections()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["connections"]],inputs:{hubKey:"hubKey"},decls:10,vars:7,consts:[[1,"container-fluid"],["title","Connections","iconClass","fa fa-lg fa-fw fa-database",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["actions",""],["select","selectedItemsAction"],["selectedItemsAction",""],["select","filter"],["filter",""],["title","Connections","path","/assets/help/reference/connection.md",1,"m-3"],[3,"connections"],[1,"ml-1",3,"objectType","objects"],["buttonClass","btn-primary","iconClass","fa fa-filter","title","Filter by a purpose",1,"mr-1",3,"autoCompact","text","pullRight"],["routerLink",".","title","All Connections",1,"dropdown-item",3,"queryParams"],["class","dropdown-item","routerLink",".",3,"active","queryParams","title",4,"ngFor","ngForOf"],["routerLink",".",1,"dropdown-item",3,"queryParams","title"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.editConnection(e)})),l.Dc(3,qe,1,1,"ng-template",null,3,l.Ec),l.Dc(5,Be,1,2,"ng-template",4,5,l.Ec),l.Dc(7,Qe,5,12,"ng-template",6,7,l.Ec),l.Nb(),l.Nb(),l.Lb(9,"dexih-help",8),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,He.a,g.a,b.i,s.h,p.s],pipes:[Ge.a],encapsulation:2}),e})();var Xe=i("obiC");const Ye=["fileInput"];function Je(e,t){if(1&e){const e=l.Pb();l.Ob(0,"section",9),l.Ob(1,"form-select",16),l.Vb("ngModelChange",(function(i){return l.vc(e),t.$implicit.action=i})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit,i=l.Zb(2);l.yb(1),l.jc("label","",i.eSharedObjectType[e.objectType]," Action"),l.jc("note","Action when importing ",i.eSharedObjectType[e.objectType],""),l.hc("ngModel",e.action)("items",i.importActions)}}function et(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-widget",3),l.Vb("close",(function(){return l.vc(e),l.Zb().close()})),l.Ob(1,"ul",4),l.Ob(2,"li",5),l.Ob(3,"h5"),l.Fc(4,"Drop Export Files"),l.Nb(),l.Nb(),l.Ob(5,"li",6),l.Ob(6,"div",7),l.Vb("dropFiles",(function(t){return l.vc(e),l.Zb().filesDrop(t)})),l.Ob(7,"div",8),l.Ob(8,"section",9),l.Fc(9," Drop import files "),l.Nb(),l.Ob(10,"section",9),l.Ob(11,"div",10),l.Ob(12,"input",11,12),l.Vb("change",(function(t){return l.vc(e),l.Zb().uploadFile(t)})),l.Nb(),l.Ob(14,"label",13),l.Fc(15,"Choose file"),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Ob(16,"li",14),l.Ob(17,"h5"),l.Fc(18,"Import Options"),l.Nb(),l.Nb(),l.Ob(19,"li",6),l.Ob(20,"fieldset"),l.Ob(21,"div",8),l.Dc(22,Je,2,4,"section",15),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.hc("showCloseButton",!0),l.yb(6),l.hc("requireFiles",!0),l.yb(16),l.hc("ngForOf",e.importOptions)}}function tt(e,t){if(1&e&&(l.Ob(0,"ul",25),l.Fc(1),l.Nb()),2&e){const e=t.$implicit;l.yb(1),l.Hc(" Warning: ",e," ")}}function it(e,t){if(1&e&&(l.Ob(0,"div",23),l.Dc(1,tt,2,1,"ul",24),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("ngForOf",e.import.warnings)}}function at(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button",26),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb(2).importSelected(i)})),l.Nb()}}function nt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button",27),l.Vb("click",(function(){return l.vc(e),l.Zb(2).importAll()})),l.Nb(),l.Ob(1,"dexih-button-close",28),l.Vb("click",(function(){return l.vc(e),l.Zb(2).reset()})),l.Nb()}}function st(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-widget",17),l.Vb("close",(function(){return l.vc(e),l.Zb().reset()})),l.Dc(1,it,2,1,"div",18),l.Ob(2,"dexih-table",19),l.Dc(3,at,1,0,"ng-template",20,21,l.Ec),l.Dc(5,nt,2,0,"ng-template",null,22,l.Ec),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.hc("showCloseButton",!0),l.yb(1),l.hc("ngIf",(null==e.import||null==e.import.warnings?null:e.import.warnings.length)>0),l.yb(1),l.hc("enableMultiSelect",!0)("columns",e.columns)("dataObservable",e.tableData)}}let ot=(()=>{class e{constructor(e,t,i){this.authService=e,this.hubService=t,this.hubFormsService=i,this.automaticUpload=!0,this.pageTitle="Import Objects",this.showPage=!1,this.showPageMessage="Loading...",this.importActions=T.o,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",format:"Md",description:"description"},{name:"objectType",title:"Type",format:""},{name:"importAction",title:"Action",format:"Enum",enum:c.Eb}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.importOptions=T.u.map(e=>({action:c.Eb.Replace,objectType:e.type})),this._hubCacheChangeSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{this.hubCache=e})}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}close(){this.authService.navigateUp()}doImport(e){const t=new FormData;t.append("file",e,e.name),t.append("hubKey",this.hubCache.hub.hubKey.toString());for(let i=0;i<this.importOptions.length;i++)t.append(`ImportActions[${i}].Action`,this.importOptions[i].action.toString()),t.append(`ImportActions[${i}].ObjectType`,this.importOptions[i].objectType.toString());this.authService.postForm("/api/Hub/ImportPlan",t).then(e=>{this.import=e,this.refreshImport()})}uploadFile(e){this.doImport(e.srcElement.files[0])}filesDrop(e){this.doImport(e[0])}refreshImport(){let e=[];T.u.forEach(t=>{this.import[t.property].forEach(i=>{e.push({objectType:t.property,name:i.item.name,importAction:i.importAction,item:i})})}),this._tableData.next(e)}reset(){this._tableData.next(null)}importSelected(e){let t=new c.P;e.forEach(e=>{t[e.objectType]||(t[e.objectType]=[]),t[e.objectType].push(e.item)}),this.hubService.importPackage(t).then(()=>{this.authService.navigateUp()})}importAll(){this.hubService.importPackage(this.import).then(()=>{this.authService.navigateUp()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(h.a),l.Kb(u.a),l.Kb(N.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["import"]],viewQuery:function(e,t){var i;1&e&&l.Bc(Ye,!0),2&e&&l.rc(i=l.Wb())&&(t.fileInput=i.first)},features:[l.xb([N.a])],decls:5,vars:6,consts:[[1,"container"],["title","Import Objects","iconClass","fa fa-lg fa-fw fa-level-down",3,"showCloseButton","close",4,"ngIf"],["title","Import Package","iconClass","fa fa-lg fa-fw fa-level-down",3,"showCloseButton","close",4,"ngIf"],["title","Import Objects","iconClass","fa fa-lg fa-fw fa-level-down",3,"showCloseButton","close"],[1,"list-group"],[1,"list-group-item","list-group-item-info","rounded-0"],[1,"list-group-item"],["dropZone","","dropAllowedClass","nv-file-over",1,"well","my-drop-zone",3,"requireFiles","dropFiles"],[1,"form-row"],[1,"form-group","col-md-6"],[1,"custom-file","w-auto","pull-right"],["type","file",1,"custom-file-input",3,"change"],["fileInput",""],["for","inputGroupFile01",1,"custom-file-label"],[1,"list-group-item","list-group-item-info"],["class","form-group col-md-6",4,"ngFor","ngForOf"],["itemKey","key","itemName","name",3,"label","ngModel","items","note","ngModelChange"],["title","Import Package","iconClass","fa fa-lg fa-fw fa-level-down",3,"showCloseButton","close"],["class","alert alert-warning",4,"ngIf"],[3,"enableMultiSelect","columns","dataObservable"],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],[1,"alert","alert-warning"],["class","list-item",4,"ngFor","ngForOf"],[1,"list-item"],["iconClass","fa fa-upload","buttonClass","btn-primary","text","Import Selected",1,"ml-1",3,"click"],["iconClass","fa fa-cloud-upload","buttonClass","btn-primary","text","Import All",3,"click"],[1,"ml-1",3,"click"]],template:function(e,t){if(1&e&&(l.Ob(0,"div",0),l.Dc(1,et,23,3,"dexih-widget",1),l.ac(2,"async"),l.Dc(3,st,7,5,"dexih-widget",2),l.ac(4,"async"),l.Nb()),2&e){var i;const e=!(null!=(i=l.bc(2,2,t.tableData))&&i.length);var a;const n=(null==(a=l.bc(4,4,t.tableData))?null:a.length)>0;l.yb(1),l.hc("ngIf",e),l.yb(2),l.hc("ngIf",n)}},directives:[p.t,b.P,Xe.a,p.s,b.E,a.s,a.v,d.a,b.f,b.d],pipes:[p.b],encapsulation:2}),e})();function rt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",8),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().export(i)})),l.Nb()}}function ct(e,t){}function lt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",9),l.Vb("click",(function(){return l.vc(e),l.Zb().exportAll()})),l.Nb()}}let ut=(()=>{class e{constructor(e,t){this.hubService=e,this.authService=t,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{name:"label",title:"Item Type"},{name:"updateDate",title:"Last Modified",format:"Calendar"}]}ngOnInit(){try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(e=>{if(this.hubCache=e[0],!this.hubCache.isLoaded())return;let t=this.hubCache.getSharedObjects();this.data=t})}catch(e){this.hubService.addHubClientErrorMessage(e,"View Index")}}exportAll(){this.export(this.data)}export(e){const t=this.hubService.createHub(this.hubCache.hub.hubKey,"");e.forEach(e=>{this.hubCache.cacheAddObject(e.type,e.item,t)}),this.hubService.exportHub(t,1===e.length?`${e[0].label}-${e[0].type}.json`:`hub-${this.hubCache.hub.name}.json`)}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["export"]],inputs:{hubKey:"hubKey"},decls:9,vars:7,consts:[[1,"container-fluid"],["title","Export","iconClass","fa fa-lg fa-fw fa-feed",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","data","tags"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["actions",""],["text","Export Selected",1,"mr-1",3,"click"],["text","Export All",1,"mr-1",3,"click"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Dc(3,rt,1,0,"ng-template",3,4,l.Ec),l.Dc(5,ct,0,0,"ng-template",5,6,l.Ec),l.Dc(7,lt,1,0,"ng-template",null,7,l.Ec),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("data",t.data)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,b.u],encapsulation:2}),e})();var ht=i("Npcx"),bt=i("mL+N");function dt(e,t){if(1&e&&l.Lb(0,"dependent-items-button",11),2&e){const e=t.item,i=l.Zb();l.hc("key",e.key)("objectType",i.eSharedObjectType.Datajob)}}function mt(e,t){if(1&e&&l.Lb(0,"datalink-status",12),2&e){const e=t.item;l.hc("datajobKey",null==e?null:e.key)}}function ft(e,t){if(1&e&&l.Lb(0,"tags-update-button",13),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.Datajob)("objects",e)}}function pt(e,t){1&e&&l.Lb(0,"actions-datajob-button",14),2&e&&l.hc("datajobs",t.items)}let gt=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[2],this.updateDatajobs()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datajob Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}updateDatajobs(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihDatajobs.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,tags:this.hubCache.getObjectTags(c.dc.Datajob,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}editDatajob(e){this.router.navigate(["datajob-edit",e.key],{relativeTo:this.route})}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Datajob&&e.changeClass!==c.dc.TagObjects||this.updateDatajobs()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["datajobs"]],inputs:{hubKey:"hubKey"},decls:12,vars:7,consts:[[1,"container-fluid"],["title","Data Jobs","iconClass","fa fa-lg fa-fw fa-calendar",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","rowStatus"],["rowStatus",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["title","Datalinks","path","/assets/help/reference/datajob.md",1,"m-3"],[1,"ml-1",3,"key","objectType"],[3,"datajobKey"],[1,"ml-1",3,"objectType","objects"],[3,"datajobs"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.editDatajob(e)})),l.Dc(3,dt,1,2,"ng-template",3,4,l.Ec),l.Dc(5,mt,1,1,"ng-template",5,6,l.Ec),l.Dc(7,ft,1,2,"ng-template",7,8,l.Ec),l.Dc(9,pt,1,1,"ng-template",null,9,l.Ec),l.Nb(),l.Nb(),l.Lb(11,"dexih-help",10),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,f.a,ht.a,g.a,bt.a],encapsulation:2}),e})();var vt=i("A4o/");function yt(e,t){1&e&&l.Lb(0,"actions-datalink-button",13),2&e&&l.hc("datalinks",t.items)}const Ct=function(e){return{typeFilter:e}};function wt(e,t){if(1&e&&(l.Ob(0,"a",17),l.Fc(1),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(2);l.Cb("active",i.typeFilter==e.key),l.hc("queryParams",l.mc(5,Ct,e.key))("title",e.name),l.yb(1),l.Gc(e.name)}}const St=function(){return{typeFilter:"All"}};function kt(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",14),l.Ob(1,"a",15),l.Fc(2,"All"),l.Nb(),l.Dc(3,wt,2,7,"a",16),l.ac(4,"gtFilter"),l.Nb()),2&e){const e=l.Zb();l.hc("autoCompact",!1)("text",e.eDatalinkType[e.typeFilter])("pullRight",!0),l.yb(1),l.Cb("active","All"==e.typeFilter),l.hc("queryParams",l.lc(11,St)),l.yb(2),l.hc("ngForOf",l.dc(4,7,e.eDatalinkTypeItems,"key",0))}}function Ot(e,t){if(1&e&&l.Lb(0,"tags-update-button",18),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.Datalink)("objects",e)}}function Tt(e,t){if(1&e&&l.Lb(0,"datalink-status",19),2&e){const e=t.item;l.hc("datalinkKey",null==e?null:e.key)}}function Nt(e,t){if(1&e&&l.Lb(0,"dependent-items-button",20),2&e){const e=t.item,i=l.Zb();l.hc("key",e.key)("objectType",i.eSharedObjectType.Datalink)}}let Dt=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.eDatalinkType=c.nb,this.eDatalinkTypeItems=c.ob,this.columns=[{name:"name",title:"Name",format:"Md",footer:"description",tags:"tags"},{iconClass:"sharedIcon",tooltip:"sharedToolTip",width:"1%",align:"center"},{name:"datalinkType",title:"Datalink Type",format:""},{name:"sourceName",title:"Source",format:""},{name:"targetName",title:"Target",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[2];this.hubCache=e[3],this.hubCache.isLoaded()&&(this.typeFilter=+t.typeFilter,this.typeFilter||(this.typeFilter=0),this.updateDatalinks())})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datalink Index")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}close(){this.authService.navigateUp()}updateDatalinks(){let e;if(this.hubCache.isLoaded())if(this.hubCache.hub.dexihDatalinks){e=0!==this.typeFilter&&this.typeFilter?this.hubCache.hub.dexihDatalinks.filter(e=>e.datalinkType===this.typeFilter):this.hubCache.hub.dexihDatalinks;let t=new Array;e.forEach(e=>{let i="",a="";switch(e.sourceDatalinkTable.sourceType){case c.gc.Table:let t=this.hubCache.getTable(e.sourceDatalinkTable.sourceTableKey);i=t?t.logicalName:"Error, not found";break;case c.gc.Datalink:let a=this.hubCache.hub.dexihDatalinks.find(t=>t.key===e.sourceDatalinkTable.sourceDatalinkKey);i=a?"Datalink: "+a.name:"Error, not found";break;case c.gc.Rows:i="Static Rows"}a=e.isQuery?"None specified.":e.dexihDatalinkTargets.filter(e=>e.isValid).map(e=>{let t=this.hubCache.getTable(e.tableKey);return t&&t.logicalName||"Error, not found"}).join(", "),t.push({key:e.key,datalinkType:this.eDatalinkType[e.datalinkType],name:e.name,tags:this.hubCache.getObjectTags(c.dc.Datalink,e.key),description:e.description,sourceName:i,targetName:a,updateDate:e.updateDate,sharedIcon:e.isShared?"fa fa-group":"fa fa-user-secret",sharedToolTip:e.isShared?"Table is shared":"Table is private"})}),this._tableData.next(t)}else this._tableData.next(new Array)}editDatalink(e){this.router.navigate(["datalink-edit","edit",e.key],{queryParamsHandling:"merge",relativeTo:this.route.parent})}watchChanges(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Datalink&&e.changeClass!==c.dc.TagObjects||this.updateDatalinks()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["datalink-index"]],decls:14,vars:7,consts:[[1,"container-fluid"],["title","Datalinks","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","close"],["tableClass","table table-striped table-hover m-0",3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["actions",""],["select","filter"],["filter",""],["select","selectedItemsAction"],["selectedItemsAction",""],["select","rowStatus"],["rowStatus",""],["select","selectedItemAction"],["selectedItemAction",""],["title","Datalinks","path","/assets/help/reference/datalink.md",1,"m-3"],[3,"datalinks"],["buttonClass","btn btn-primary","iconClass","fa fa-filter","title","Filter by a purpose",1,"mr-1",3,"autoCompact","text","pullRight"],["routerLink",".","title","All Datalinks",1,"dropdown-item",3,"queryParams"],["class","dropdown-item","routerLink",".",3,"active","queryParams","title",4,"ngFor","ngForOf"],["routerLink",".",1,"dropdown-item",3,"queryParams","title"],[1,"ml-1",3,"objectType","objects"],[3,"datalinkKey"],[1,"ml-1",3,"key","objectType"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.editDatalink(e)})),l.Dc(3,yt,1,1,"ng-template",null,3,l.Ec),l.Dc(5,kt,5,12,"ng-template",4,5,l.Ec),l.Dc(7,Ot,1,2,"ng-template",6,7,l.Ec),l.Dc(9,Tt,1,1,"ng-template",8,9,l.Ec),l.Dc(11,Nt,1,2,"ng-template",10,11,l.Ec),l.Nb(),l.Nb(),l.Lb(13,"dexih-help",12),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,vt.a,b.i,s.h,p.s,g.a,ht.a,f.a],pipes:[Ge.a],encapsulation:2}),e})();var xt=i("1mVc");function Ft(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save",6),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return!t.savingDatalink&&t.saveDatalink()})),l.Nb(),l.Ob(1,"dexih-button-cancel",7),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return!t.savingDatalink&&t.cancel()})),l.Nb()}if(2&e){const e=l.Zb();l.hc("busy",e.savingDatalink),l.yb(1),l.hc("busy",e.savingDatalink)}}function Vt(e,t){if(1&e&&(l.Ob(0,"span",11),l.Fc(1),l.Nb()),2&e){const e=t.$implicit;l.yb(1),l.Hc(" ",e.name," ")}}function It(e,t){if(1&e&&(l.Ob(0,"label",8),l.Fc(1,"Create datalinks for the following source table(s):"),l.Nb(),l.Ob(2,"div"),l.Ob(3,"div",9),l.Dc(4,Vt,2,1,"span",10),l.ac(5,"fieldSort"),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.yb(4),l.hc("ngForOf",l.cc(5,1,e.sourceTables,"name"))}}function Kt(e,t){if(1&e&&l.Lb(0,"form-input",20),2&e){const e=l.Zb(2);l.hc("autocapitalize",!0)("errors",e.formErrors.name)}}function Et(e,t){1&e&&l.Lb(0,"form-input",21)}function Lt(e,t){if(1&e&&(l.Ob(0,"form",12),l.Ob(1,"fieldset"),l.Ob(2,"div",13),l.Ob(3,"section",14),l.Dc(4,Kt,1,2,"form-input",15),l.Dc(5,Et,1,0,"form-input",16),l.Nb(),l.Ob(6,"section",14),l.Lb(7,"form-select",17),l.Nb(),l.Nb(),l.Ob(8,"div",13),l.Ob(9,"section",14),l.Lb(10,"form-select",18),l.Nb(),l.Ob(11,"section",14),l.Lb(12,"form-select",19),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.mainForm),l.yb(4),l.hc("ngIf",1==e.sourceTables.length),l.yb(1),l.hc("ngIf",e.sourceTables.length>1),l.yb(2),l.hc("items",e.eDatalinkTypeItems)("errors",e.formErrors.datalinkType),l.yb(3),l.hc("items",e.managedConnections)("errors",e.formErrors.targetConnectionKey)("allowNullSelect",!0),l.yb(2),l.hc("items",e.managedConnections)("errors",e.formErrors.auditConnectionKey)("allowNullSelect",!0)}}const Pt=function(){return{standalone:!0}};function Mt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"section",14),l.Ob(1,"form-checkbox",26),l.Vb("ngModelChange",(function(i){return l.vc(e),t.$implicit.value=i})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit;l.yb(1),l.hc("label",e.name)("ngModel",e.value)("ngModelOptions",l.lc(3,Pt))}}function jt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form"),l.Ob(1,"fieldset"),l.Ob(2,"section"),l.Ob(3,"div",13),l.Ob(4,"section",22),l.Lb(5,"form-checkbox",23),l.Nb(),l.Nb(),l.Ob(6,"div",13),l.Ob(7,"section",22),l.Ob(8,"label",8),l.Fc(9," Specify the audit columns (in addition to source columns) to be included in the target table. "),l.Nb(),l.Ob(10,"form-checkbox",24),l.Vb("ngModelChange",(function(){return l.vc(e),l.Zb().selectAllAuditColumns()})),l.Nb(),l.Nb(),l.Nb(),l.Ob(11,"div",13),l.Dc(12,Mt,2,4,"section",25),l.Nb(),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.yb(5),l.hc("ngModel",e.addSourceColumns),l.yb(5),l.hc("ngModel",e.allAuditColumns),l.yb(2),l.hc("ngForOf",e.auditColumnTypes)}}let At=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.route=t,this.router=i,this.location=a,this.fb=n,this.hasChanged=!1,this.showAllErrors=!1,this.addSourceColumns=!0,this.eConnectionPurpose=c.jb,this.auditColumnTypes=[{key:c.qb.AutoIncrement,name:"Auto Incrementing Key",value:!1},{key:c.qb.IsCurrentField,name:"Is Current Flag",value:!1},{key:c.qb.Version,name:"Record Version",value:!1},{key:c.qb.ValidFromDate,name:"Valid From Date",value:!1},{key:c.qb.ValidToDate,name:"Valid To Date",value:!1},{key:c.qb.CreateDate,name:"Created Date",value:!1},{key:c.qb.UpdateDate,name:"Updated Date",value:!1},{key:c.qb.CreateAuditKey,name:"Created by AuditKey Reference",value:!1},{key:c.qb.UpdateAuditKey,name:"Updated by AuditKey Reference",value:!1}],this.allAuditColumns=!1,this.eDatalinkTypeItems=c.ob,this.savingDatalink=!1,this.formErrors={name:"",targetConnectionKey:"",auditConnectionKey:"",datalinkType:""},this.validationMessages={name:{required:"Name is required.",minlength:"Name must be at least 4 characters long.",maxlength:"Name cannot be more than 50 characters long."},targetConnectionKey:{},auditConnectionKey:{},datalinkType:{required:"Datalink Type is required."}}}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[1];if(this.hubCache=e[2],this.managedTargetConnections=this.hubCache.hub.dexihConnections.filter(e=>e.purpose===c.jb.Managed||e.purpose===c.jb.Target),this.managedConnections=this.hubCache.hub.dexihConnections.filter(e=>e.purpose===c.jb.Managed),this.tableKeys=t.sourceTableKeys.split("|").map(e=>+e),this.hubCache.status===T.j.Loaded){if(this.updateTables(),this.targetConnectionKey=+t.targetConnectionKey,!this.targetConnectionKey){let e=this.hubCache.hub.dexihConnections.find(e=>e.purpose===c.jb.Managed);e&&(this.targetConnectionKey=e.key)}this.auditConnectionKey=this.targetConnectionKey,this.datalinkType=c.nb.General,this.buildForm(),this.watchChanges()}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datalink New")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._valueChangesSubscription&&this._valueChangesSubscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}updateTables(){this.sourceTableKeys=new Array,this.sourceTables=new Array,this.tableKeys&&this.hubCache.hub.dexihConnections&&this.hubCache.hub.dexihTables.forEach(e=>{this.tableKeys.findIndex(t=>t===e.key)>=0&&(this.sourceTableKeys.push(e.key),this.sourceTables.push(e))})}buildForm(){this.mainForm=this.fb.group({name:[this.name,[]],targetConnectionKey:[this.targetConnectionKey>0?this.targetConnectionKey:null,[]],auditConnectionKey:[this.auditConnectionKey>0?this.auditConnectionKey:null,[]],datalinkType:[this.datalinkType,[a.G.required]]}),this._valueChangesSubscription&&this._valueChangesSubscription.unsubscribe(),this._valueChangesSubscription=this.mainForm.valueChanges.subscribe(e=>this.onValueChanged()),this.onValueChanged(),this.hasChanged=!1}onValueChanged(){if(!this.mainForm)return;const e=this.mainForm;this.hasChanged=!0;for(const t of Object.keys(this.formErrors)){this.formErrors[t]="";const i=e.get(t);if(i&&(i.dirty||this.showAllErrors)&&!i.valid){const e=this.validationMessages[t];for(const a of Object.keys(i.errors))this.formErrors[t]+=e[a]+" "}}}selectAllAuditColumns(){this.allAuditColumns=!this.allAuditColumns,this.auditColumnTypes.forEach(e=>e.value=this.allAuditColumns)}saveDatalink(){if(this.mainForm.valid){let e=this.mainForm.value;this.savingDatalink=!0;let t=this.auditColumnTypes.filter(e=>e.value).map(e=>e.key);this.hubService.createDatalinks(this.sourceTableKeys,e.name,e.datalinkType,e.targetConnectionKey,null,null,e.auditConnectionKey,this.addSourceColumns,t).then(e=>{this.savingDatalink=!1,1===e.length?this.openDatalink(e[0].key):this.router.navigate(["/hub",this.hubCache.hub.hubKey,"datalinks"],{relativeTo:this.route.root})}).catch(()=>{this.savingDatalink=!1})}else this.showAllErrors=!0,this.onValueChanged()}cancel(){this.location.back()}openDatalink(e,t=0){t>=10&&this.router.navigate(["/hub",this.hubCache.hub.hubKey,"datalinks"],{relativeTo:this.route.root}),setTimeout(()=>{this.hubCache.hub.dexihDatalinks.findIndex(t=>t.key===e)>=0?this.router.navigate(["/hub",this.hubCache.hub.hubKey,"datalinks","datalink-edit","edit",e],{relativeTo:this.route.root}):this.openDatalink(e,t++)},500)}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass===c.dc.Table&&this.updateTables()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(s.a),l.Kb(s.e),l.Kb(p.n),l.Kb(a.g))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-datalink-new-form"]],decls:8,vars:4,consts:[[1,"container"],["title","New Datalink(s)","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","padding","close"],["header",""],["subHeader",""],[3,"formGroup",4,"ngIf"],[4,"ngIf"],[1,"mr-1",3,"busy","click"],[3,"busy","click"],[1,"label"],[1,"row"],["class","col alert alert-primary m-1",4,"ngFor","ngForOf"],[1,"col","alert","alert-primary","m-1"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Datalink Name","formControlName","name","placeholder","Datalink name (leave blank for auto naming)","iconClass","fa fa-comment",3,"autocapitalize","errors",4,"ngIf"],["disabled","","label","Datalink Name","placeholder","Datalink name can not be specified when creating multiple datalinks.","iconClass","fa fa-comment",4,"ngIf"],["formControlName","datalinkType","label","Type","itemKey","key","itemName","description",3,"items","errors"],["formControlName","targetConnectionKey","label","Target Connection","itemKey","key","itemName","name","note","Specify the connection for the target table.","selectNullMessage","No target table",3,"items","errors","allowNullSelect"],["formControlName","auditConnectionKey","label","Audit Connection","itemKey","key","itemName","name","note","Specify the connection to store execution results.","selectNullMessage","No datalink auditing",3,"items","errors","allowNullSelect"],["label","Datalink Name","formControlName","name","placeholder","Datalink name (leave blank for auto naming)","iconClass","fa fa-comment",3,"autocapitalize","errors"],["disabled","","label","Datalink Name","placeholder","Datalink name can not be specified when creating multiple datalinks.","iconClass","fa fa-comment"],[1,"col","col-11"],["label","Include source columns in target table","name","addSourceColumns",3,"ngModel"],["label","Select All/None","name","selectAllAuditColumns",3,"ngModel","ngModelChange"],["class","form-group col-md-6",4,"ngFor","ngForOf"],[3,"label","ngModel","ngModelOptions","ngModelChange"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return!t.savingDatalink&&t.cancel()})),l.Dc(2,Ft,2,2,"ng-template",null,2,l.Ec),l.Dc(4,It,6,4,"ng-template",null,3,l.Ec),l.Dc(6,Lt,13,11,"form",4),l.Dc(7,jt,13,3,"form",5),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(5),l.hc("ngIf",t.sourceTableKeys),l.yb(1),l.hc("ngIf",t.sourceTableKeys))},directives:[b.P,p.t,b.t,b.b,p.s,a.I,a.t,a.l,b.E,a.s,a.j,b.D,a.u,b.A,a.v],pipes:[xt.a],encapsulation:2}),e})();var Rt=i("NHAS");let _t=(()=>{class e{constructor(e,t,i){this.hubService=e,this.authService=t,this.route=i,this.eDataObjectType=c.lb}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params).subscribe(e=>{let t=e[0],i=e[1];this.action=t.action,this.pageTitle=t.pageTitle,this.key=+i.datalinkKey,this.previewUpdates="true"===i.previewUpdates})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datalink Preview")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["datalink-preview-data"]],decls:3,vars:4,consts:[[1,"container-fluid"],["title","Preview Datalink","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","close"],[3,"key","previewUpdates","viewSource"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Lb(2,"preview-data",2),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("key",t.key)("previewUpdates",t.previewUpdates)("viewSource",t.eDataObjectType.Datalink))},directives:[b.P,Rt.a],encapsulation:2}),e})();var Zt=i("NUI7");function Ht(e,t){if(1&e&&(l.Ob(0,"dexih-button",5),l.Fc(1),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(2);l.kc("routerLink","/hub/",null==i.hubCache?null:i.hubCache.hub.hubKey,"/connections/tables/table-new/",e.key,""),l.hc("autoCompact",!1),l.yb(1),l.Hc("New Table (",e.name,")")}}function Gt(e,t){if(1&e&&(l.Ob(0,"div",2),l.Fc(1," There are no files configured. Create a file based connection, and add at least one file definition. "),l.Lb(2,"hr"),l.Ob(3,"div"),l.Lb(4,"dexih-button-new",3),l.Dc(5,Ht,2,4,"dexih-button",4),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.yb(4),l.jc("routerLink","/hub/",null==e.hubCache?null:e.hubCache.hub.hubKey,"/connections/connection-new/Source"),l.hc("autoCompact",!1),l.yb(1),l.hc("ngForOf",e.fileConnections)}}function qt(e,t){if(1&e&&(l.Ob(0,"a",13),l.Fc(1),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(3);l.kc("routerLink","/hub/",null==i.hubCache?null:i.hubCache.hub.hubKey,"/connections/tables/table-new/",e.key,""),l.yb(1),l.Gc(e.name)}}const Bt=function(e,t){return{tableKey:e,path:t}};function Ut(e,t){if(1&e&&(l.Ob(0,"a",16),l.Lb(1,"i",17),l.Fc(2),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(4);l.Cb("active","item.name"==i.path),l.hc("queryParams",l.nc(4,Bt,i.tableKey,e.key)),l.yb(2),l.Gc(e.name)}}function zt(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",14),l.Dc(1,Ut,3,7,"a",15),l.Nb()),2&e){const e=l.Zb(3);l.hc("text",e.eFlatFilePath[e.path])("pullRight",!0),l.yb(1),l.hc("ngForOf",e.eFlatFilePathItems)}}function Wt(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",10),l.Dc(1,qt,2,3,"a",11),l.Nb(),l.Dc(2,zt,2,3,"dexih-button-dropdown",12)),2&e){const e=l.Zb(2);l.yb(1),l.hc("ngForOf",e.fileConnections),l.yb(1),l.hc("ngIf",(null==e.connectionReference?null:e.connectionReference.allowFlatFiles)&&(null==e.table?null:e.table.autoManageFiles))}}const Qt=function(){return{standalone:!0}};function $t(e,t){if(1&e){const e=l.Pb();l.Ob(0,"section"),l.Ob(1,"form-select",35),l.Vb("ngModelChange",(function(t){return l.vc(e),l.Zb(3).updateStrategy=t})),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(3);l.yb(1),l.hc("ngModel",e.updateStrategy)("ngModelOptions",l.lc(3,Qt))("items",e.updateStrategies)}}function Xt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button",36),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb(3).uploadSelected(i)})),l.Fc(1,"Upload"),l.Nb(),l.Ob(2,"dexih-button-cancel",37),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb(3).cancelSelected(i)})),l.Nb(),l.Ob(3,"dexih-button-delete",38),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb(3).removeSelected(i)})),l.Nb()}}function Yt(e,t){if(1&e){const e=l.Pb();l.Ob(0,"section"),l.Ob(1,"form-checkbox",39),l.Vb("ngModelChange",(function(t){return l.vc(e),l.Zb(3).automaticUpload=t})),l.Nb(),l.Nb()}if(2&e){const e=l.Zb(3);l.yb(1),l.hc("ngModel",e.automaticUpload)}}const Jt=function(e){return{width:e}};function ei(e,t){if(1&e&&(l.Ob(0,"div",42),l.Lb(1,"div",43),l.Nb()),2&e){const e=l.Zb().item;l.yb(1),l.hc("ngStyle",l.mc(1,Jt,e.progress+"%"))}}const ti=function(e,t,i){return{"fa-check":e,"fa-exclamation-circle":t,"fa-ban":i}};function ii(e,t){if(1&e&&(l.Dc(0,ei,2,3,"div",40),l.Ob(1,"span"),l.Lb(2,"i",41),l.Fc(3),l.Nb()),2&e){const e=t.item,i=l.Zb(3);l.hc("ngIf",e.isRunning()),l.yb(2),l.hc("ngClass",l.oc(3,ti,e.status===i.eFileStatus.Complete,e.status===i.eFileStatus.Error,e.status===i.eFileStatus.Cancelled)),l.yb(1),l.Gc(e.status)}}function ai(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",50),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items,i=l.Zb(4);return i.moveSelected(t,i.eFlatFilePath.Incoming)})),l.Fc(1,"To Incoming"),l.Nb()}}function ni(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",50),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items,i=l.Zb(4);return i.moveSelected(t,i.eFlatFilePath.Outgoing)})),l.Fc(1,"To Processed"),l.Nb()}}function si(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",50),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items,i=l.Zb(4);return i.moveSelected(t,i.eFlatFilePath.Processed)})),l.Fc(1,"To Processed"),l.Nb()}}function oi(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",50),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items,i=l.Zb(4);return i.moveSelected(t,i.eFlatFilePath.Rejected)})),l.Fc(1,"To Rejected"),l.Nb()}}function ri(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",37),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb(4).deleteSelected(i)})),l.Nb(),l.Ob(1,"dexih-button-download",37),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb(4).downloadSelected(i)})),l.Nb(),l.Ob(2,"dexih-button-dropdown",48),l.Dc(3,ai,2,0,"a",49),l.Dc(4,ni,2,0,"a",49),l.Dc(5,si,2,0,"a",49),l.Dc(6,oi,2,0,"a",49),l.Nb()}if(2&e){const e=l.Zb(4);l.yb(2),l.hc("pullRight",!0),l.yb(1),l.hc("ngIf",e.path!=e.eFlatFilePath.Incoming),l.yb(1),l.hc("ngIf",e.path!=e.eFlatFilePath.Outgoing),l.yb(1),l.hc("ngIf",e.path!=e.eFlatFilePath.Processed),l.yb(1),l.hc("ngIf",e.path!=e.eFlatFilePath.Rejected)}}const ci=function(e,t,i,a){return["/hub",e,"summary","files","manage",t,"file-preview",i,a]};function li(e,t){if(1&e&&l.Lb(0,"dexih-button-preview",51),2&e){const e=t.item,i=l.Zb(4);l.hc("routerLink",l.pc(1,ci,null==i.hubCache?null:i.hubCache.hub.hubKey,i.tableKey,i.path,e.fileName))}}function ui(e,t){if(1&e&&(l.Ob(0,"a",16),l.Lb(1,"i",17),l.Fc(2),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(6);l.Cb("active","item.name"==i.path),l.hc("queryParams",l.nc(4,Bt,i.tableKey,e.key)),l.yb(2),l.Gc(e.name)}}function hi(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",54),l.Dc(1,ui,3,7,"a",15),l.Nb()),2&e){const e=l.Zb(5);l.hc("text",e.eFlatFilePath[e.path])("pullRight",!0),l.yb(1),l.hc("ngForOf",e.eFlatFilePathItems)}}function bi(e,t){if(1&e){const e=l.Pb();l.Dc(0,hi,2,3,"dexih-button-dropdown",52),l.Ob(1,"dexih-button-refresh",53),l.Vb("click",(function(){return l.vc(e),l.Zb(4).refreshFiles()})),l.Nb()}if(2&e){const e=l.Zb(4);l.hc("ngIf",null==e.table?null:e.table.autoManageFiles)}}function di(e,t){if(1&e&&(l.Ob(0,"li",22),l.Ob(1,"h5"),l.Fc(2,"Files (Local directory: "),l.Ob(3,"a",44),l.Fc(4),l.Nb(),l.Fc(5,")"),l.Nb(),l.Nb(),l.Ob(6,"li",27),l.Ob(7,"dexih-table",45),l.Dc(8,ri,7,5,"ng-template",29,30,l.Ec),l.Dc(10,li,1,6,"ng-template",46,47,l.Ec),l.Dc(12,bi,2,1,"ng-template",null,31,l.Ec),l.Nb(),l.Nb()),2&e){const e=l.Zb(3);l.yb(3),l.jc("href","file://///",e.localPath,"",l.xc),l.yb(1),l.Gc(e.localPath),l.yb(3),l.hc("enableMultiSelect",!0)("columns",e.columns)("dataObservable",e.tableData)}}function mi(e,t){if(1&e){const e=l.Pb();l.Ob(0,"ul",18),l.Ob(1,"li",19),l.Ob(2,"section"),l.Ob(3,"form-select",20),l.Vb("ngModelChange",(function(t){return l.vc(e),l.Zb(2).tableKey=t}))("ngModelChange",(function(t){return l.vc(e),l.Zb(2).updateTable(t)})),l.Nb(),l.Nb(),l.Dc(4,$t,2,4,"section",21),l.Nb(),l.Ob(5,"li",22),l.Ob(6,"h5"),l.Fc(7,"Drop Files to Upload"),l.Nb(),l.Nb(),l.Ob(8,"li",19),l.Ob(9,"div",23),l.Vb("dropFiles",(function(t){return l.vc(e),l.Zb(2).filesDrop(t)})),l.Fc(10," Drop Files to Upload Here "),l.Ob(11,"div",24),l.Ob(12,"input",25),l.Vb("change",(function(t){return l.vc(e),l.Zb(2).uploadFile(t)})),l.Nb(),l.Ob(13,"label",26),l.Fc(14,"Choose files"),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Ob(15,"li",22),l.Ob(16,"h5"),l.Fc(17,"Upload Queue"),l.Nb(),l.Nb(),l.Ob(18,"li",27),l.Ob(19,"dexih-table",28),l.Dc(20,Xt,4,0,"ng-template",29,30,l.Ec),l.Dc(22,Yt,2,1,"ng-template",null,31,l.Ec),l.Dc(24,ii,4,7,"ng-template",32,33,l.Ec),l.Nb(),l.Nb(),l.Dc(26,di,14,5,"ng-template",34),l.Nb()}if(2&e){const e=l.Zb(2);l.yb(3),l.hc("ngModel",e.tableKey)("ngModelOptions",l.lc(9,Qt))("items",e.connectionTables),l.yb(1),l.hc("ngIf",!(null!=e.connectionReference&&e.connectionReference.allowFlatFiles)),l.yb(5),l.hc("requireFiles",!0),l.yb(10),l.hc("enableMultiSelect",!0)("columns",e.uploadColumns)("data",e.uploadedFiles),l.yb(7),l.hc("ngIf",null==e.connectionReference?null:e.connectionReference.allowFlatFiles)}}function fi(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",6),l.Ob(1,"dexih-widget",7),l.Vb("close",(function(){return l.vc(e),l.Zb().close()})),l.Dc(2,Wt,3,2,"ng-template",null,8,l.Ec),l.Dc(4,mi,27,10,"ul",9),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.yb(1),l.hc("title","Manage Files: "+(null==e.table?null:e.table.name))("showCloseButton",!0),l.yb(3),l.hc("ngIf",e.table)}}let pi=(()=>{class e{constructor(e,t,i,a){this.authService=e,this.hubService=t,this.route=i,this.router=a,this.entityType="Table",this.canEdit=!1,this.updateStrategy=c.qc.Reload,this.updateStrategies=T.y,this.path=c.zb.None,this.eFlatFilePath=c.zb,this.eFlatFilePathItems=c.Ab.filter(e=>e.key>0),this.eFileStatus=x.h,this.automaticUpload=!0,this.uploadedFiles=[],this.cancelToken=new x.a,this.pageTitle="Manage Files",this.showPage=!1,this.showPageMessage="Loading...",this.columns=[{name:"fileName",title:"File Name",format:""},{name:"length",title:"Size",format:""},{name:"lastModified",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable(),this.uploadColumns=[{name:"file.name",title:"File Name",format:""},{name:"file.size",title:"Size",format:""}]}ngOnInit(){try{this._subscription=Object(r.a)(this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable(!0),this.hubService.getRemoteLibrariesObservable()).subscribe(e=>{let t=e[1];this.hubCache=e[2],this.remoteLibraries=e[3],this.fileConnections=this.hubCache.hub.dexihConnections.filter(e=>{let t=this.remoteLibraries.connections.find(t=>e.connectionAssemblyName===t.connectionAssemblyName&&e.connectionClassName===t.connectionClassName);return!!t&&(t.connectionCategory===c.ib.File||e.purpose!==c.jb.Source)});let i=this.hubCache.getConnectionTables();this.connectionTables=i.filter(e=>{if(e.dexihTables.length>0)return null!=this.fileConnections.find(t=>e.key===t.key)});let a=!1;if(this.tableKey=+t.tableKey,this.tableKey||this.connectionTables.length>0&&this.connectionTables[0].dexihTables.length>0&&(this.tableKey=this.connectionTables[0].dexihTables[0].key,a=!0),this.path=+t.path,this.path||(this.path=c.zb.Incoming,a=!0),a)return void this.router.navigate([],{relativeTo:this.route,queryParams:{tableKey:this.tableKey,path:this.path},queryParamsHandling:"merge"});this.table=this.hubCache.getTable(this.tableKey);let n=this.hubCache.getConnection(this.table.connectionKey);this.connectionReference=this.remoteLibraries.connections.find(e=>n.connectionAssemblyName===e.connectionAssemblyName&&n.connectionClassName===e.connectionClassName),!this.table&&this.tableKey?this.hubService.addHubErrorMessage(`The table with the key ${this.tableKey} could not be found.`):this.table&&(this.pageTitle="Manage files for "+this.table.name,this.showPage=!0,this.refreshFiles())})}catch(e){this.hubService.addHubClientErrorMessage(e,"Files Manage")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}updateTable(e){this.router.navigate([],{relativeTo:this.route,queryParams:{tableKey:e,path:"incoming"},queryParamsHandling:"merge"})}refreshFiles(){this.connectionReference.allowsFlatFiles&&this.hubService.getFileList(this.table,this.path,this.cancelToken).then(e=>{this._tableData.next(e)}).catch(e=>{this._tableData.next([])})}uploadSelected(e){e.forEach(e=>{this.authService.upload(e).then(t=>{t.success?(this.hubService.addHubSuccessMessage(`File ${e.file.name} uploaded successfully.`),this.refreshFiles()):this.hubService.addHubMessage(t)}).catch(e=>{this.hubService.addHubMessage(e)})})}removeSelected(e){e.forEach(e=>{let t=this.uploadedFiles.findIndex(t=>t.id===e.id);t>=0&&this.uploadedFiles.splice(t,1)})}cancelSelected(e){e.forEach(e=>e.cancel())}deleteSelected(e){let t=e.map(e=>e.fileName);this.hubService.deleteFiles(this.table,this.path,t,this.cancelToken).then(e=>{e&&this.refreshFiles()}).catch()}moveSelected(e,t){let i=e.map(e=>e.fileName);this.hubService.moveFiles(this.table,this.path,t,i,this.cancelToken).then(e=>{e&&this.refreshFiles()}).catch(e=>{this.hubService.addHubMessage(status)})}downloadSelected(e){let t=e.map(e=>e.fileName);this.hubService.downloadFiles(this.table,this.path,t,this.cancelToken).then(e=>{e&&this.refreshFiles()}).catch()}preview(e){this.router.navigate(["hub",this.hubCache.hub.hubKey,"summary","files","manage",this.tableKey,this.path,e.fileName])}close(){this.authService.navigateUp()}uploadFile(e){return this.doUpload(e.srcElement.files),!1}doUpload(e){Array.prototype.forEach.call(e,e=>{this.hubService.uploadFile(this.table,this.path,this.updateStrategy,e.name,this.cancelToken).then(t=>{let i=new x.d(e,t);this.automaticUpload&&this.authService.upload(i).then(t=>{t.success?(this.hubService.addHubSuccessMessage(`File ${e.name} uploaded successfully.`),this.refreshFiles()):this.hubService.addHubMessage(t)}).catch(e=>{this.hubService.addHubMessage(e)}),this.uploadedFiles.push(i),this.uploadedFiles=[...this.uploadedFiles]}).catch(e=>{this.hubService.addHubMessage(e)})})}filesDrop(e){this.doUpload(e)}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(h.a),l.Kb(u.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["files-manage"]],decls:2,vars:2,consts:[["class","alert alert-danger m-3",4,"ngIf"],["class","container",4,"ngIf"],[1,"alert","alert-danger","m-3"],["text","New Connection",3,"routerLink","autoCompact"],[3,"routerLink","autoCompact","title",4,"ngFor","ngForOf"],[3,"routerLink","autoCompact","title"],[1,"container"],["iconClass","fa fa-lg fa-fw fa-table",3,"title","showCloseButton","close"],["header",""],["class","list-group",4,"ngIf"],["iconClass","fa fa-file-o","text","New File",1,"mr-1"],["class","dropdown-item",3,"routerLink","title",4,"ngFor","ngForOf"],["iconClass","fa fa-filter","title","Select the file location",3,"text","pullRight",4,"ngIf"],[1,"dropdown-item",3,"routerLink","title"],["iconClass","fa fa-filter","title","Select the file location",3,"text","pullRight"],["class","dropdown-item","routerLinkActive","active","data-toggle","tab","routerLink",".",3,"active","queryParams",4,"ngFor","ngForOf"],["routerLinkActive","active","data-toggle","tab","routerLink",".",1,"dropdown-item",3,"queryParams"],[1,"fa","fa-elipsis-h"],[1,"list-group"],[1,"list-group-item"],["label","Flat File","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the flat file to manage",3,"ngModel","ngModelOptions","items","ngModelChange"],[4,"ngIf"],[1,"list-group-item","list-group-item-info","rounded-0"],["dropZone","","dropAllowedClass","nv-file-over",1,"well","my-drop-zone",3,"requireFiles","dropFiles"],[1,"custom-file","w-25","float-right"],["type","file","onclick","this.value=null",1,"custom-file-input",3,"change"],["for","inputGroupFile01",1,"custom-file-label"],[1,"list-group-item","p-0"],[3,"enableMultiSelect","columns","data"],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["select","rowStatus"],["rowStatus",""],[3,"ngIf"],["label","Update Strategy","itemKey","key","itemName","description","iconClass","fa fa-database","note","Specify how records should be inserted/updated in the target table.",3,"ngModel","ngModelOptions","items","ngModelChange"],["iconClass","fa fa-upload","buttonClass","btn-primary",1,"mr-1",3,"click"],[1,"mr-1",3,"click"],["text","Remove",3,"click"],["label","Automatically upload files when added to the queue.",3,"ngModel","ngModelChange"],["class","progress","style","margin-bottom: 0;",4,"ngIf"],[1,"fa",3,"ngClass"],[1,"progress",2,"margin-bottom","0"],["role","progressbar",1,"progress-bar",3,"ngStyle"],[3,"href"],[3,"enableMultiSelect","columns","dataObservable"],["select","selectedItemAction"],["selectedItemAction",""],["iconClass","fa fa-mail-forward","text","Move",1,"mr-1",3,"pullRight"],["class","dropdown-item",3,"click",4,"ngIf"],[1,"dropdown-item",3,"click"],[3,"routerLink"],["class","mr-1","buttonClass","btn-primary","iconClass","fa fa-filter","title","Select the file location",3,"text","pullRight",4,"ngIf"],[3,"click"],["buttonClass","btn-primary","iconClass","fa fa-filter","title","Select the file location",1,"mr-1",3,"text","pullRight"]],template:function(e,t){1&e&&(l.Dc(0,Gt,6,3,"div",0),l.Dc(1,fi,5,3,"div",1)),2&e&&(l.hc("ngIf",!t.connectionTables||0===t.connectionTables.length),l.yb(1),l.hc("ngIf",t.connectionTables&&t.connectionTables.length>0))},directives:[p.t,b.o,s.f,p.s,b.f,b.P,b.i,s.h,s.g,b.E,a.s,a.v,Xe.a,d.a,b.b,b.g,b.A,p.q,p.w,b.h,b.q,b.s],encapsulation:2}),e})();i("/fhR");const gi=function(e){return["hubVariable-edit",e]};function vi(e,t){1&e&&l.Lb(0,"dexih-button-edit",9),2&e&&l.hc("routerLink",l.mc(1,gi,t.item.key))}function yi(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",10),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().deleteHubVariables(t)})),l.Nb()}}function Ci(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",10),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().export(i)})),l.Nb(),l.Dc(1,yi,1,0,"dexih-button-delete",11),l.Lb(2,"tags-update-button",12)}if(2&e){const e=t.items,i=l.Zb();l.yb(1),l.hc("ngIf",i.hubCache.canWrite),l.yb(1),l.hc("objectType",i.eSharedObjectType.HubVariable)("objects",e)}}const wi=function(){return["hubVariable-new"]};function Si(e,t){1&e&&l.Lb(0,"dexih-button-new",14),2&e&&l.hc("routerLink",l.lc(1,wi))}function ki(e,t){if(1&e&&l.Dc(0,Si,1,2,"dexih-button-new",13),2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite)}}let Oi=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",format:"",tags:"tags"},{name:"value",title:"Value",format:""},{name:"isEncrypted",title:"Encrypted?",format:"Boolean"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this.watchChanges(),this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[0],this.updateVariables()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Hub Variables Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}deleteHubVariables(e){this.hubService.deleteHubVariables(e)}updateVariables(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihHubVariables.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,value:e.isEncrypted?"(Encrypted)":e.value,isEncrypted:e.isEncrypted,tags:this.hubCache.getObjectTags(c.dc.HubVariable,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}edit(e){this.router.navigate(["hubVariable-edit",e.key],{relativeTo:this.route})}export(e){let t=this.hubCache.hub.dexihHubVariables.filter(t=>e.findIndex(e=>e.key===t.key)>=0);const i=this.hubService.createHub(this.hubCache.hub.hubKey,"");i.dexihHubVariables=t,this.hubService.exportHub(i,"hub_variables.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.HubVariable&&e.changeClass!==c.dc.TagObjects||this.updateVariables()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["hubVariable"]],decls:10,vars:7,consts:[[1,"container-fluid"],["title","Hub Variables","iconClass","fa fa-lg fa-fw fa-at",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["title","Hub Variables","path","/assets/help/reference/hubVariable.md",1,"m-3"],["queryParamsHandling","","preserveFragment","",1,"mr-1",3,"routerLink"],[1,"mr-1",3,"click"],["class","mr-1",3,"click",4,"ngIf"],[1,"mr-1",3,"objectType","objects"],["class","mr-1",3,"routerLink",4,"ngIf"],[1,"mr-1",3,"routerLink"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,vi,1,3,"ng-template",3,4,l.Ec),l.Dc(5,Ci,3,3,"ng-template",5,6,l.Ec),l.Dc(7,ki,1,1,"ng-template",null,7,l.Ec),l.Nb(),l.Nb(),l.Lb(9,"dexih-help",8),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,b.j,s.f,b.u,p.t,g.a,b.g,b.o],encapsulation:2}),e})();function Ti(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save",7),l.Vb("click",(function(){return l.vc(e),l.Zb(2).save()})),l.Nb()}}function Ni(e,t){if(1&e&&(l.Dc(0,Ti,1,0,"dexih-button-save",5),l.Lb(1,"cancel-button",6)),2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("formsService",e.formsService)}}function Di(e,t){if(1&e&&(l.Ob(0,"form",8),l.Lb(1,"input",9),l.Lb(2,"input",10),l.Ob(3,"fieldset"),l.Ob(4,"div",11),l.Ob(5,"section",12),l.Lb(6,"form-input",13),l.Nb(),l.Ob(7,"section",12),l.Lb(8,"form-input",14),l.Nb(),l.Nb(),l.Ob(9,"section"),l.Lb(10,"form-checkbox",15),l.Nb(),l.Ob(11,"section"),l.Lb(12,"form-checkbox",16),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.formsService.currentForm),l.yb(6),l.hc("autocapitalize",!0)("errors",e.formsService.formErrors.name),l.yb(2),l.hc("label",e.formsService.currentForm.controls.isEnvironmentVariable.value?"Environment Variable Name":"Hub Variable Value")("type",e.formsService.currentForm.controls.isEncrypted.value?"password":"text")("errors",e.formsService.formErrors.value)}}let xi=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.isLoaded=!1,this.cancelToken=new x.a}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.pageTitle=t.pageTitle,this.action=t.action,this.hubCache&&this.hubCache.status===T.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"Edit Variables")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._isEncryptedSubscription&&this._isEncryptedSubscription.unsubscribe(),this.cancelToken.cancel()}load(){if(this.isLoaded=!0,"edit"===this.action)if(this.hubVariableKey=+this.params.hubVariableKey,this.hubVariableKey)if(this.hubCache.hub&&this.hubCache.hub.dexihHubVariables){let e=this.hubCache.hub.dexihHubVariables.find(e=>e.key===this.hubVariableKey);this.formsService.hubVariable(e)}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no variable specified to edit.");if("new"===this.action){let e=new c.C;e.value="",e.name="",this.formsService.hubVariable(e),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/hubVariable-new","/hubVariable-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}this._isEncryptedSubscription=this.formsService.currentForm.controls.isEncrypted.valueChanges.subscribe(e=>{e||this.formsService.currentForm.controls.valueRaw.setValue("")})}save(){return e=this,void 0,i=function*(){let e=this.formsService.currentForm;if(e.controls.isEncrypted.value){let t=e.controls.valueRaw.value;if(t){let i=yield this.hubService.encrypt(t,this.cancelToken);e.controls.value.setValue(i),e.controls.valueRaw.setValue(null)}}else e.controls.value.setValue(e.controls.valueRaw.value);yield this.formsService.save()},new((t=void 0)||(t=Promise))((function(a,n){function s(e){try{r(i.next(e))}catch(t){n(t)}}function o(e){try{r(i.throw(e))}catch(t){n(t)}}function r(e){var i;e.done?a(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(s,o)}r((i=i.apply(e,[])).next())}));var e,t,i}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(N.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-hubVariable-edit-form"]],features:[l.xb([N.a])],decls:6,vars:3,consts:[[1,"container"],["title","Edit Variable","iconClass","fa fa-lg fa-fw fa-at",3,"showCloseButton","padding","close"],["header",""],[3,"formGroup",4,"ngIf"],["title","Hub Variables","path","/assets/help/reference/hubVariable.md",1,"m-3"],["class","mr-1",3,"click",4,"ngIf"],[3,"formsService"],[1,"mr-1",3,"click"],[3,"formGroup"],["id","fake_user_name","name","fake_user[name]","type","text","value","Fake Auto-fill",2,"position","absolute","top","-5000px"],["id","fake_password","type","password","name","fake_password[password]","type","text","value","Fake Auto-fill",2,"position","absolute","top","-5000px"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Hub Variable Name","formControlName","name","placeholder","Enter the name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["formControlName","valueRaw","placeholder","Enter the value.","iconClass","fa fa-list","autocomplete","off",3,"label","type","errors"],["label","Encrypt value","formControlName","isEncrypted"],["label","Use an environment variable on the remote agent","formControlName","isEnvironmentVariable"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,Ni,2,2,"ng-template",null,2,l.Ec),l.Dc(4,Di,13,6,"form",3),l.Nb(),l.Lb(5,"dexih-help",4),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(3),l.hc("ngIf",t.formsService.currentForm))},directives:[b.P,p.t,W.a,F.a,b.t,a.I,a.t,a.l,b.D,a.s,a.j,b.A],encapsulation:2}),e})();var Fi=i("24Dg");const Vi=["DexihMessage"];function Ii(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save",12),l.Vb("click",(function(){return l.vc(e),l.Zb().addUsers()})),l.Nb()}if(2&e){const e=l.Zb();l.hc("disabled",0==e.emails.length)}}function Ki(e,t){if(1&e){const e=l.Pb();l.Ob(0,"a",17),l.Vb("click",(function(){l.vc(e);const i=t.$implicit,a=l.Zb().items;return l.Zb().setPermission(i.key,a)})),l.Fc(1),l.Nb()}if(2&e){const e=t.$implicit;l.yb(1),l.Gc(e.name)}}function Ei(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",13),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().deleteUsers(i)})),l.Nb(),l.Ob(1,"dexih-button-dropdown",14),l.Dc(2,Ki,2,1,"a",15),l.Nb(),l.Ob(3,"dexih-button-dropdown",16),l.Ob(4,"a",17),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().setUserAlert(!0,i)})),l.Fc(5,"Receive alert emails"),l.Nb(),l.Ob(6,"a",17),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().setUserAlert(!1,i)})),l.Fc(7,"Do not receive alert emails."),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.yb(2),l.hc("ngForOf",e.ePermissionItems)}}let Li=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.columns=[{name:"userName",title:"User Name",format:""},{name:"firstName",title:"First Name",format:""},{name:"lastName",title:"Last Name",format:""},{name:"permission",title:"Permission",enum:c.Wb,format:"Enum"},{name:"receiveAlerts",title:"Receives Alert Emails",format:"Boolean"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable(),this.ePermission=c.Wb,this.ePermissionItems=c.Xb,this.permission=c.Wb.PublishReader,this.emails=[],this.sendInvites=!0}ngOnInit(){this.refreshUsers()}ngOnDestroy(){}refreshUsers(){this.hubService.getHubUsers().then(e=>{this._tableData.next(e)})}setPermission(e,t){const i=t.map(e=>e.userName);this.authService.confirmDialog("Confirm Permission Change",`This action will change the selected user(s) hub permission to ${c.Wb[this.permission]}.  Proceed?`).then(t=>{t&&this.hubService.setUserPermissions(i,e,!1).then(e=>{this.dexihMessage.addSuccessMessage("The specified user(s) permission have been updated."),this.refreshUsers()})})}setUserAlert(e,t){const i=t.map(e=>e.id);this.hubService.setUserAlerts(i,e,!1).then(e=>{this.dexihMessage.addSuccessMessage("The specified user(s) alert email status have been updated."),this.refreshUsers()})}deleteUsers(e){const t=e.map(e=>e.userName);this.authService.confirmDialog("Confirm Delete Users","This action will delete the selected user(s) from using this hub.  Proceed?").then(e=>{e&&this.hubService.removeUsers(t).then(e=>{this.dexihMessage.addSuccessMessage("The specified users have been removed from the hub."),this.refreshUsers()})})}addUsers(){this.emails.length>0&&this.permission&&this.authService.confirmDialog("Add Users",`This action will added users with the specified emails to this hub with permission ${c.Wb[this.permission]}.  Proceed?`).then(e=>{e&&this.hubService.setUserPermissions(this.emails,this.permission,this.sendInvites).then(e=>{this.emails=[],this.dexihMessage.addSuccessMessage("The specified users have been added to the hub."),this.refreshUsers()})})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["users"]],viewQuery:function(e,t){var i;1&e&&l.Bc(Vi,!0),2&e&&l.rc(i=l.Wb())&&(t.dexihMessage=i.first)},decls:19,vars:9,consts:[[1,"p-3"],["DexihMessage",""],[1,"container-fluid"],["title","Invite Users","iconClass","fa fa-lg fa-fw fa-birthday-cake",3,"padding"],["subHeader",""],["label","Permission","name","permission","itemKey","key","itemName","name","note","Permission level to grant to emails",3,"ngModel","items","enableFilter","ngModelChange"],["label","Email Addresses / User names","name","emails","note","Provide a list of user names or email addresses of users to join the hub.",3,"ngModel","ngModelChange"],["label","Send invites","name","sendInvites","note","Emails which are not registered to use the integration hub will be sent an invite to join.",3,"ngModel","ngModelChange"],["title","Current Users","iconClass","fa fa-lg fa-fw fa-group"],[3,"enableMultiSelect","columns","dataObservable"],["select","selectedItemsAction"],["selectedItemsAction",""],["text","Add User(s)",3,"disabled","click"],[1,"mr-1",3,"click"],["buttonClass","btn-primary","iconClass","fa fa-lock","text","Set Permission"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["buttonClass","btn-primary","iconClass","fa fa-bell","text","Set User Alert",1,"ml-1"],[1,"dropdown-item",3,"click"]],template:function(e,t){1&e&&(l.Lb(0,"dexih-message",0,1),l.Ob(2,"div",2),l.Ob(3,"dexih-widget-vertical"),l.Ob(4,"dexih-widget",3),l.Dc(5,Ii,1,1,"ng-template",null,4,l.Ec),l.Ob(7,"form"),l.Ob(8,"fieldset"),l.Ob(9,"section"),l.Ob(10,"form-select",5),l.Vb("ngModelChange",(function(e){return t.permission=e})),l.Nb(),l.Nb(),l.Ob(11,"section"),l.Ob(12,"form-tags",6),l.Vb("ngModelChange",(function(e){return t.emails=e})),l.Nb(),l.Nb(),l.Ob(13,"section"),l.Ob(14,"form-checkbox",7),l.Vb("ngModelChange",(function(e){return t.sendInvites=e})),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Ob(15,"dexih-widget",8),l.Ob(16,"dexih-table",9),l.Dc(17,Ei,8,1,"ng-template",10,11,l.Ec),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(4),l.hc("padding",!0),l.yb(6),l.hc("ngModel",t.permission)("items",t.ePermissionItems)("enableFilter",!1),l.yb(2),l.hc("ngModel",t.emails),l.yb(2),l.hc("ngModel",t.sendInvites),l.yb(2),l.hc("enableMultiSelect",!0)("columns",t.columns)("dataObservable",t.tableData))},directives:[Fi.a,b.S,b.P,a.I,a.t,a.u,b.E,a.s,a.v,b.F,b.A,d.a,b.t,b.g,b.i,p.s],encapsulation:2}),e})();const Pi=function(){return{statusFilter:"All"}},Mi=function(){return{statusFilter:"Ready"}},ji=function(){return{statusFilter:"Offline"}},Ai=function(){return{statusFilter:"Unauthorized"}};function Ri(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",9),l.Ob(1,"a",10),l.Fc(2,"All"),l.Nb(),l.Ob(3,"a",11),l.Fc(4,"Ready"),l.Nb(),l.Ob(5,"a",12),l.Fc(6,"Offline"),l.Nb(),l.Ob(7,"a",13),l.Fc(8,"Unauthorized"),l.Nb(),l.Nb(),l.Fc(9,"\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0")),2&e){const e=l.Zb();l.hc("text",e.statusFilter)("pullRight",!0),l.yb(1),l.Cb("active","All"==e.statusFilter),l.hc("queryParams",l.lc(14,Pi)),l.yb(2),l.Cb("active","Ready"==e.statusFilter),l.hc("queryParams",l.lc(15,Mi)),l.yb(2),l.Cb("active","Offline"==e.statusFilter),l.hc("queryParams",l.lc(16,ji)),l.yb(2),l.Cb("active","Unauthorized"==e.statusFilter),l.hc("queryParams",l.lc(17,Ai))}}function _i(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",14),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().deleteSelected(i)})),l.Nb(),l.Ob(1,"dexih-button",15),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().authorize(i)})),l.Fc(2,"Authorize"),l.Nb(),l.Ob(3,"dexih-button",16),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().deAuthorize(i)})),l.Fc(4,"De-Authorize"),l.Nb()}}const Zi=function(e,t){return["agent-edit",e,t]};function Hi(e,t){if(1&e&&l.Lb(0,"dexih-button-edit",17),2&e){const e=t.item;l.hc("routerLink",l.nc(1,Zi,e.remoteAgentKey,e.remoteAgentHubKey))}}const Gi=function(){return["/hubs/index/agents/download"]};function qi(e,t){1&e&&l.Lb(0,"dexih-button-download",18),2&e&&l.hc("routerLink",l.lc(1,Gi))}let Bi=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.columns=[{name:"name",title:"Name",format:""},{name:"connected",title:"Connected",format:"Boolean"},{name:"isAuthorized",title:"Authorized?",format:"Boolean"},{name:"user",title:"User",format:""},{name:"dataPrivacyStatus",title:"Data Privacy",format:"Enum",enum:c.mb},{name:"isEncrypted",title:"Encrypted?",format:"Boolean"},{name:"ipAddress",title:"Current IP Address",format:""},{name:"remoteAgentId",title:"Id",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"},{name:"lastLoginDateTime",title:"Last Login",format:"Calendar"},{name:"lastLoginIpAddress",title:"Last IP Address",format:""}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.queryParams,this.hubService.getHubCacheObservable(),this.authService.getRemoteAgentsObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{let t=e[0];this.hubCache=e[1],this.remoteAgents=e[2],this.hubCache.isLoaded()&&(this.statusFilter=t.statusFilter,this.statusFilter||(this.statusFilter="All"),this.updateRemoteAgents())})}catch(e){this.hubService.addHubClientErrorMessage(e,"Remote Agent index")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}close(){this.authService.navigateUp()}updateRemoteAgents(){if(!this.hubCache||!this.hubCache.hub)return;let e=this.hubCache.hub.dexihRemoteAgentHubs.map(e=>{let t=this.remoteAgents?this.remoteAgents.find(t=>t.remoteAgentKey===e.remoteAgentKey):null,i=t&&t.activeAgents&&t.activeAgents.length>0?t.activeAgents[0]:null;return{remoteAgentHubKey:e.remoteAgentHubKey,connected:null!==i,isAuthorized:e.isAuthorized,name:i?i.name:t?t.name:"Unknown",user:i?i.user:"",dataPrivacyStatus:i?i.dataPrivacyStatus:"",isEncrypted:i?i.isEncrypted:"",ipAddress:i?i.ipAddress:"",remoteAgentKey:e.remoteAgentKey,updateDate:e.updateDate,lastLoginDateTime:t?t.lastLoginDateTime:"",lastLoginIpAddress:t?t.lastLoginIpAddress:"",remoteAgentId:t?t.remoteAgentId:""}});this.remoteAgents&&this.remoteAgents.forEach(t=>{let i=t.activeAgents&&t.activeAgents.length>0?t.activeAgents[0]:null;i&&e.findIndex(e=>e.remoteAgentKey===t.remoteAgentKey)<0&&e.push({remoteAgentHubKey:0,connected:!0,isAuthorized:!1,name:i.name,user:i.user,dataPrivacyStatus:i.dataPrivacyStatus,isEncrypted:i.isEncrypted,ipAddress:i.ipAddress,remoteAgentKey:t.remoteAgentKey,remoteAgentId:t.remoteAgentId,updateDate:""})}),this._tableData.next(e)}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass===c.dc.RemoteAgent&&this.updateRemoteAgents()})}authorize(e){var t,i,a,n,s,o,r;return s=this,void 0,r=function*(){try{for(t=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(i){t[i]=e[i]&&function(t){return new Promise((function(a,n){!function(e,t,i,a){Promise.resolve(a).then((function(t){e({value:t,done:i})}),t)}(a,n,(t=e[i](t)).done,t.value)}))}}}(e);!(i=yield t.next()).done;){const e=i.value;if(!e.isAuthorized){let t;e.remoteAgentHubKey?(t=this.hubCache.hub.dexihRemoteAgentHubs.find(t=>t.remoteAgentHubKey===e.remoteAgentHubKey),t.isAuthorized=!0):(t={hubKey:this.hubCache.hub.hubKey,remoteAgentHubKey:0,remoteAgentKey:e.remoteAgentKey,isAuthorized:!0,isValid:!0,createDate:null,isDefault:!1,updateDate:null},t.allowExternalConnect=!0,t.isSelected=!1),yield this.hubService.saveRemoteAgent(t)}}}catch(s){a={error:s}}finally{try{i&&!i.done&&(n=t.return)&&(yield n.call(t))}finally{if(a)throw a.error}}},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{n(r.next(e))}catch(i){t(i)}}function a(e){try{n(r.throw(e))}catch(i){t(i)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,a)}n((r=r.apply(s,[])).next())}))}deAuthorize(e){e.forEach(e=>{if(e.isAuthorized&&e.remoteAgentHubKey){let t=this.hubCache.hub.dexihRemoteAgentHubs.find(t=>t.remoteAgentHubKey===e.remoteAgentHubKey);t&&(t.isAuthorized=!1,this.hubService.saveRemoteAgent(t))}})}deleteSelected(e){e.forEach(e=>{if(e.remoteAgentHubKey){let t=this.hubCache.hub.dexihRemoteAgentHubs.find(t=>t.remoteAgentHubKey===e.remoteAgentHubKey);t&&(t.isAuthorized=!1,this.hubService.deleteRemoteAgent(t))}})}edit(e){this.router.navigate(["agent-edit",e.remoteAgentKey,e.remoteAgentHubKey],{relativeTo:this.route})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["remoteagents"]],inputs:{hubKey:"hubKey"},decls:11,vars:6,consts:[[1,"container-fluid"],["title","Hub Remote Agents","iconClass","fa fa-lg fa-fw fa-wifi",3,"showCloseButton","close"],["header",""],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["actions",""],["buttonClass","btn btn-sm btn-outline-secondary","iconClass","fa fa-filter","title","Filter by a status",3,"text","pullRight"],["routerLink",".","title","All Items",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Ready",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Offline Items",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Unauthorized Items",1,"dropdown-item",3,"queryParams"],["title","Delete selected remote agents",1,"mr-1",3,"click"],["iconClass","fa fa-check","buttonClass","btn-primary","title","Authorize the selected agents for this hub",1,"mr-1",3,"click"],["iconClass","fa fa-times","buttonClass","btn-danger","title","De-Authorize the selected agents",1,"mr-1",3,"click"],[1,"mr-1",3,"routerLink"],["iconClass","fa fa-download","text","Download Agent",1,"mr-1",3,"routerLink"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,Ri,10,18,"ng-template",null,2,l.Ec),l.Ob(4,"dexih-table",3),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(5,_i,5,0,"ng-template",4,5,l.Ec),l.Dc(7,Hi,1,4,"ng-template",6,7,l.Ec),l.Dc(9,qi,1,2,"ng-template",null,8,l.Ec),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(3),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData))},directives:[b.P,d.a,b.i,s.h,b.g,b.f,b.j,s.f,b.h],encapsulation:2}),e})();const Ui=function(e){return["/hubs","index","agents","edit",e]};function zi(e,t){if(1&e){const e=l.Pb();l.Lb(0,"dexih-button-edit",6),l.Ob(1,"dexih-button-save",7),l.Vb("click",(function(){return l.vc(e),l.Zb().save()})),l.Nb(),l.Lb(2,"cancel-button",8)}if(2&e){const e=l.Zb();l.hc("routerLink",l.mc(3,Ui,e.remoteAgentKey)),l.yb(1),l.hc("disabled",!e.formsService.hasChanged),l.yb(1),l.hc("formsService",e.formsService)}}function Wi(e,t){1&e&&l.Fc(0," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0")}function Qi(e,t){1&e&&(l.Ob(0,"div",9),l.Fc(1," Creating a new hub -> remote agent authorization "),l.Nb())}const $i=function(){return{standalone:!0}};function Xi(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form",10),l.Ob(1,"fieldset"),l.Ob(2,"section"),l.Ob(3,"form-input",11),l.Vb("ngModelChange",(function(t){return l.vc(e),l.Zb().name=t})),l.Nb(),l.Nb(),l.Ob(4,"section"),l.Lb(5,"form-checkbox",12),l.Nb(),l.Ob(6,"section"),l.Lb(7,"form-checkbox",13),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.hc("formGroup",e.formsService.currentForm),l.yb(3),l.hc("disabled",!0)("ngModel",e.name)("ngModelOptions",l.lc(4,$i))}}let Yi=(()=>{class e{constructor(e,t,i,a,n){this.authService=e,this.hubService=t,this.formsService=i,this.router=a,this.route=n,this.isNew=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.authService.getRemoteAgentsObservable()).subscribe(e=>{let t=e[1];if(this.hubCache=e[2],this.remoteAgents=e[3],this.hubCache.isLoaded()&&this.remoteAgents)if(this.remoteAgentKey=+t.remoteAgentKey,this.remoteAgentHubKey=+t.remoteAgentHubKey,this.remoteAgentKey){let e=this.remoteAgents.find(e=>e.remoteAgentKey===this.remoteAgentKey),t=e.activeAgents&&e.activeAgents.length>0?e.activeAgents[0]:null;this.name=t?t.name:"",this.ipAddress=t?t.ipAddress:null,this.remoteAgentHub=this.hubCache.hub.dexihRemoteAgentHubs.find(e=>e.remoteAgentHubKey===this.remoteAgentHubKey),this.remoteAgentHub||(this.remoteAgentHub={hubKey:this.hubCache.hub.hubKey,remoteAgentHubKey:0,remoteAgentKey:e.remoteAgentKey,isAuthorized:!0,isValid:!0,createDate:null,isDefault:!1,updateDate:null},this.remoteAgentHub.allowExternalConnect=!0,this.remoteAgentHub.isSelected=!1,this.isNew=!0),this.formsService.remoteAgent(this.remoteAgentHub),0===this.remoteAgentHub.remoteAgentHubKey&&(this.formsService.hasChanged=!0)}else this.hubService.addHubErrorMessage("There was no remote agent specified to edit.")})}catch(e){this.hubService.addHubClientErrorMessage(e,"Remote Agent Edit")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}addCurrentIp(){if(this.ipAddress){let e=this.formsService.currentForm.controls.ipAddresses,t=e.value;t.findIndex(e=>e===this.ipAddress)<0&&(t.push(this.ipAddress),e.setValue(t))}}save(){this.hubService.saveRemoteAgent(this.formsService.currentForm.value).then(e=>{e&&(this.hubService.addHubSuccessMessage("The remote agent updated successfully."),this.authService.navigateUp())})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(h.a),l.Kb(u.a),l.Kb(N.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["remote-agents"]],inputs:{hubKey:"hubKey"},features:[l.xb([N.a])],decls:11,vars:4,consts:[["DexihMessage",""],[1,"container"],["title","Edit Hub Remote Agent","iconClass","fa fa-lg fa-fw fa-database",3,"padding","showCloseButton","close"],["header",""],["class","alert alert-primary",4,"ngIf"],[3,"formGroup",4,"ngIf"],[3,"routerLink"],[1,"pl-1",3,"disabled","click"],[1,"pl-1",3,"formsService"],[1,"alert","alert-primary"],[3,"formGroup"],["label","Agent name","note","This can be changed in the agents appsettings.json config file.","iconClass","fa fa-comment",3,"disabled","ngModel","ngModelOptions","ngModelChange"],["label","Is default agent for this Hub","formControlName","isDefault"],["label","Is Authorized for this Hub.","formControlName","isAuthorized"]],template:function(e,t){1&e&&(l.Lb(0,"dexih-message",null,0),l.Ob(2,"div",1),l.Ob(3,"dexih-widget",2),l.Vb("close",(function(){return t.close()})),l.Dc(4,zi,3,5,"ng-template",null,3,l.Ec),l.Fc(6," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"),l.Dc(7,Wi,1,0,"ng-template",null,3,l.Ec),l.Dc(9,Qi,2,0,"div",4),l.Dc(10,Xi,8,5,"form",5),l.Nb(),l.Nb()),2&e&&(l.yb(3),l.hc("padding",!0)("showCloseButton",!0),l.yb(6),l.hc("ngIf",t.isNew),l.yb(1),l.hc("ngIf",t.formsService.currentForm))},directives:[Fi.a,b.P,p.t,b.j,s.f,b.t,F.a,a.I,a.t,a.l,b.D,a.s,a.v,b.A,a.j],encapsulation:2}),e})();var Ji=i("wTS4");function ea(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-preview",11),l.Vb("click",(function(){l.vc(e);const i=t.item;return l.Zb().preview(i)})),l.Nb()}}function ta(e,t){}function ia(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-private",11),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().unshareSelectedTables(t)})),l.Nb()}}function aa(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-download",12),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().downloadData(i)})),l.Nb(),l.Dc(1,ia,1,0,"dexih-button-private",13)}if(2&e){const e=l.Zb();l.yb(1),l.hc("ngIf",e.hubCache.canWrite)}}const na=function(){return{typeFilter:"All"}},sa=function(){return{typeFilter:"Datalink"}},oa=function(){return{typeFilter:"Table"}},ra=function(){return{typeFilter:"View"}},ca=function(){return{typeFilter:"Dashboard"}},la=function(){return{typeFilter:"Api"}};function ua(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",14),l.Ob(1,"a",15),l.Fc(2,"All"),l.Nb(),l.Ob(3,"a",16),l.Fc(4,"Datalinks"),l.Nb(),l.Ob(5,"a",17),l.Fc(6,"Tables"),l.Nb(),l.Ob(7,"a",18),l.Fc(8,"Views"),l.Nb(),l.Ob(9,"a",19),l.Fc(10,"Dashboards"),l.Nb(),l.Ob(11,"a",20),l.Fc(12,"Apis"),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("text",e.typeFilter)("pullRight",!0),l.yb(1),l.Cb("active","All"==e.typeFilter),l.hc("queryParams",l.lc(20,na)),l.yb(2),l.Cb("active","Datalink"==e.typeFilter),l.hc("queryParams",l.lc(21,sa)),l.yb(2),l.Cb("active","Table"==e.typeFilter),l.hc("queryParams",l.lc(22,oa)),l.yb(2),l.Cb("active","View"==e.typeFilter),l.hc("queryParams",l.lc(23,ra)),l.yb(2),l.Cb("active","Dashboard"==e.typeFilter),l.hc("queryParams",l.lc(24,ca)),l.yb(2),l.Cb("active","Api"==e.typeFilter),l.hc("queryParams",l.lc(25,la))}}let ha=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.cancelToken=new x.a,this.eSharedObjectType=c.dc,this.columns=[{name:"objectTypeName",title:"Type",format:""},{name:"name",title:"Name",format:"",tags:"tags"},{name:"description",title:"Description",format:"Md"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[2];this.hubCache=e[3],this.watchChanges(),this.typeFilter=t.typeFilter,this.typeFilter||(this.typeFilter="All"),this.route.snapshot.data.pageTitle=this.typeFilter,this.updateSharedData()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Shared Data Index")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}updateSharedData(){let e=new Array;this.hubCache&&this.hubCache.isLoaded()&&(this.hubCache.hub.dexihDatalinks||this.hubCache.hub.dexihConnections?("All"!==this.typeFilter&&"Datalink"!==this.typeFilter||this.hubCache.hub.dexihDatalinks.filter(e=>e.isShared).forEach(t=>{e.push({objectKey:t.key,objectTypeName:c.lb[c.lb.Datalink],objectType:c.lb.Datalink,name:t.name,description:t.description,updateDate:t.updateDate,tags:this.hubCache.getObjectTags(c.dc.Datalink,t.key)})}),"All"!==this.typeFilter&&"Table"!==this.typeFilter||this.hubCache.hub.dexihTables.filter(e=>e.isShared).forEach(t=>{e.push({objectKey:t.key,objectTypeName:c.lb[c.lb.Table],objectType:c.lb.Table,name:t.logicalName+" ("+t.name+")",description:t.description,updateDate:t.updateDate,tags:this.hubCache.getObjectTags(c.dc.TagObjects,t.key)})}),"All"!==this.typeFilter&&"View"!==this.typeFilter||this.hubCache.hub.dexihViews.filter(e=>e.isShared).forEach(t=>{e.push({objectKey:t.key,objectTypeName:c.lb[c.lb.View],objectType:c.lb.View,name:t.name,description:t.description,updateDate:t.updateDate,tags:this.hubCache.getObjectTags(c.dc.View,t.key)})}),"All"!==this.typeFilter&&"Dashboard"!==this.typeFilter||this.hubCache.hub.dexihDashboards.filter(e=>e.isShared).forEach(t=>{e.push({objectKey:t.key,objectTypeName:c.lb[c.lb.Dashboard],objectType:c.lb.Dashboard,name:t.name,description:t.description,updateDate:t.updateDate,tags:this.hubCache.getObjectTags(c.dc.Dashboard,t.key)})}),"All"!==this.typeFilter&&"Api"!==this.typeFilter||this.hubCache.hub.dexihApis.filter(e=>e.isShared).forEach(t=>{e.push({objectKey:t.key,objectTypeName:c.lb[c.lb.Api],objectType:c.lb.Api,name:t.name,description:t.description,updateDate:t.updateDate,tags:this.hubCache.getObjectTags(c.dc.Api,t.key)})}),this._tableData.next(e)):this._tableData.next(new Array))}downloadData(e){this.hubService.downloadData(e,!0,c.rb.Csv,this.cancelToken).then(()=>{this.hubService.addHubSuccessMessage("The specified data is being downloaded.")}).catch(()=>{})}preview(e){e.objectType===c.lb.Table&&this.router.navigate(["table-preview",e.objectKey],{relativeTo:this.route}),e.objectType===c.lb.Datalink&&this.router.navigate(["datalink-preview",e.objectKey],{relativeTo:this.route}),e.objectType===c.lb.View&&this.router.navigate(["view-preview",e.objectKey],{relativeTo:this.route}),e.objectType===c.lb.Dashboard&&this.router.navigate(["dashboard-preview",e.objectKey],{relativeTo:this.route}),e.objectType===c.lb.Api&&this.router.navigate(["api-preview",e.objectKey],{relativeTo:this.route})}unshareSelectedTables(e){let t=e.filter(e=>e.objectType===c.lb.Datalink).map(e=>e.objectKey);t.length>0&&this.hubService.shareItems(t,c.lb.Datalink,!1);let i=e.filter(e=>e.objectType===c.lb.Table).map(e=>e.objectKey);i.length>0&&this.hubService.shareItems(i,c.lb.Table,!1)}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Datalink&&e.changeClass!==c.dc.Table||this.updateSharedData()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["sharedData-index"]],decls:11,vars:8,consts:[[1,"container-fluid"],["title","Shared Data","iconClass","fa fa-lg fa-fw fa-newspaper-o",3,"showCloseButton","padding","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","rowStatus"],["rowStatus",""],["select","selectedItemsAction"],["selectedItemsAction",""],["select","filter"],["filter",""],[3,"click"],[1,"mr-1",3,"click"],[3,"click",4,"ngIf"],["buttonClass","btn-primary mr-1","iconClass","fa fa-filter","title","Filter by a purpose",3,"text","pullRight"],["routerLink",".","title","All Items",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Datalinks",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Tables",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Views",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Dashboards",1,"dropdown-item",3,"queryParams"],["routerLink",".","title","Apis",1,"dropdown-item",3,"queryParams"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.preview(e)})),l.Dc(3,ea,1,0,"ng-template",3,4,l.Ec),l.Dc(5,ta,0,0,"ng-template",5,6,l.Ec),l.Dc(7,aa,2,1,"ng-template",7,8,l.Ec),l.Dc(9,ua,13,26,"ng-template",9,10,l.Ec),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!1),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,b.q,b.h,p.t,b.r,b.i,s.h],encapsulation:2}),e})();var ba=i("Wz3H"),da=i("47Fv"),ma=function(e,t,i,a){return new(i||(i=Promise))((function(n,s){function o(e){try{c(a.next(e))}catch(t){s(t)}}function r(e){try{c(a.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fa(e,t){}function pa(e,t){1&e&&l.Lb(0,"actions-table-button",14),2&e&&l.hc("tables",t.items)("refreshTables",!0)}function ga(e,t){if(1&e&&l.Lb(0,"datalink-status",15),2&e){const e=t.item;l.hc("tableKey",null==e?null:e.key)}}const va=function(e){return{connectionKey:e}};function ya(e,t){if(1&e&&(l.Ob(0,"a",22),l.Fc(1),l.Nb()),2&e){const e=t.$implicit;l.hc("queryParams",l.mc(2,va,e.key)),l.yb(1),l.Gc(e.name)}}function Ca(e,t){if(1&e&&(l.Ob(0,"dexih-button-dropdown",20),l.Dc(1,ya,2,4,"a",21),l.ac(2,"equalFilter"),l.Nb()),2&e){const e=l.Zb(2);l.hc("autoCompact",!1)("text",e.connectionName)("pullRight",!0),l.yb(1),l.hc("ngForOf",l.dc(2,4,e.hubCache.hub.dexihConnections,"isValid",!0))}}const wa=function(e){return{purposeFilter:e}};function Sa(e,t){if(1&e&&(l.Ob(0,"a",23),l.Fc(1),l.Nb()),2&e){const e=t.$implicit,i=l.Zb(2);l.Cb("active",i.purposeFilter==e.key),l.hc("queryParams",l.mc(5,wa,e.key))("title",e.name),l.yb(1),l.Gc(e.name)}}const ka=function(){return{purposeFilter:"All"}};function Oa(e,t){if(1&e&&(l.Dc(0,Ca,3,8,"dexih-button-dropdown",16),l.Ob(1,"dexih-button-dropdown",17),l.Ob(2,"a",18),l.Fc(3,"All"),l.Nb(),l.Dc(4,Sa,2,7,"a",19),l.ac(5,"gtFilter"),l.Nb()),2&e){const e=l.Zb();l.hc("ngIf",null==e.hubCache?null:e.hubCache.hub),l.yb(1),l.hc("autoCompact",!1)("text",e.eConnectionPurpose[e.purposeFilter])("pullRight",!0),l.yb(1),l.Cb("active","0"==e.purposeFilter),l.hc("queryParams",l.lc(12,ka)),l.yb(2),l.hc("ngForOf",l.dc(5,8,e.eConnectionPurposeItems,"key",0))}}function Ta(e,t){if(1&e&&l.Lb(0,"tags-update-button",24),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.Table)("objects",e)}}function Na(e,t){if(1&e&&l.Lb(0,"dependent-items-button",25),2&e){const e=t.item,i=l.Zb();l.hc("key",e.key)("objectType",i.eSharedObjectType.Table)}}let Da=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eConnectionPurposeItems=c.kb,this.eConnectionPurpose=c.jb,this.eSharedObjectType=c.dc,this.columns=[{name:"logicalName",title:"Logical Name",format:"Md",footer:"description",tags:"tags"},{iconClass:"sharedIcon",tooltip:"sharedToolTip",width:"1%",align:"center"},{name:"tableType",title:"Table Type",format:"Enum",enum:c.ic},{name:"connectionName",title:"Connection",footer:"connectionType",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable()).subscribe(e=>ma(this,void 0,void 0,(function*(){let t=e[2];if(this.hubCache=e[3],this.hubCache.isLoaded()){if(this.purposeFilter=t.purposeFilter,this.purposeFilter||(this.purposeFilter="All"),this.connectionKey=+t.connectionKey,this.connectionKey){let e=this.hubCache.hub.dexihConnections.find(e=>e.key===this.connectionKey);e&&(this.connectionName=e.name)}else this.connectionName="All";yield this.updateTableData()}})))}catch(e){this.hubService.addHubClientErrorMessage(e,"Table Index")}this.watchChanges()}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe()}close(){this.authService.navigateUp()}updateTableData(){var e,t;return ma(this,void 0,void 0,(function*(){if(this.title="Tables ",this.connectionName="All",this.purposeFilter&&"All"!==this.purposeFilter&&(this.title+=": "+c.jb[this.purposeFilter]),this.hubCache&&this.hubCache.isLoaded()){let s=[];try{for(var i,a=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(i){t[i]=e[i]&&function(t){return new Promise((function(a,n){!function(e,t,i,a){Promise.resolve(a).then((function(t){e({value:t,done:i})}),t)}(a,n,(t=e[i](t)).done,t.value)}))}}}(this.hubCache.hub.dexihTables);!(i=yield a.next()).done;){const e=i.value;let t=this.hubCache.hub.dexihConnections.find(t=>t.key===e.connectionKey),a=yield this.hubService.GetConnectionReference(t);if(("All"===this.purposeFilter||!this.purposeFilter||t&&t.purpose.toString()===this.purposeFilter)&&(!this.connectionKey||e.connectionKey===this.connectionKey)){let i,n;i=e.tableType===c.ic.Query?"(Sql Query)":e.schema?e.schema+"."+e.name:e.name,n=this.hubCache.defaultTableLogicalName(e.schema,e.name)===e.logicalName?e.logicalName:`${e.logicalName} (${e.name})`;let o="";e.logicalName!==e.name&&(o="Name: "+e.name),o&&(o+="<br>"),e.description&&(o+=e.description),s.push({key:e.key,connectionType:t?c.jb[t.purpose]:"undefined",connectionName:t?t.name:"undefined",description:o,tableType:e.tableType,name:i,logicalName:e.logicalName,tags:this.hubCache.getObjectTags(c.dc.Table,e.key),updateDate:e.updateDate,connectionKey:t?t.key:"",isFile:!!a&&a.connectionCategory===c.ib.File,sharedIcon:e.isShared?"fa fa-group":"fa fa-user-secret",sharedToolTip:e.isShared?"Table is shared":"Table is private"})}}}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=a.return)&&(yield t.call(a))}finally{if(e)throw e.error}}if(this.connectionKey){let e=this.hubCache.hub.dexihConnections.find(e=>e.key===this.connectionKey);e&&(this.connectionName=e.name,this.title+=" for connection - "+e.name)}this._tableData.next(s)}else this._tableData.next(null)}))}routeSibling(e){this.router.navigate(["..",e])}editTable(e){this.router.navigate(["table-edit",e.key],{queryParamsHandling:"merge",relativeTo:this.route.parent})}getConnection(e){return this.hubCache.hub.dexihConnections.find(t=>t.key===e)}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Table&&e.changeClass!==c.dc.TagObjects||this.updateTableData()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["table-index"]],decls:16,vars:9,consts:[[1,"container-fluid"],["iconClass","fa fa-lg fa-fw fa-table",3,"title","showCloseButton","showIf","close"],["header",""],[3,"enableMultiSelect","columns","dataObservable","tags","enableStickyToolbar","toolbarZIndex","rowClick"],["actions",""],["select","rowStatus"],["rowStatus",""],["select","filter"],["filter",""],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["title","Datalinks","path","/assets/help/reference/table.md",1,"m-3"],[3,"tables","refreshTables"],[3,"tableKey"],["class","mr-1","buttonClass","btn btn-primary","iconClass","fa fa-database","title","Filter by a connection",3,"autoCompact","text","pullRight",4,"ngIf"],["buttonClass","btn btn-primary","iconClass","fa fa-filter","title","Filter by a purpose",1,"mr-1",3,"autoCompact","text","pullRight"],["routerLink",".","title","All Connections",1,"dropdown-item",3,"queryParams"],["class","dropdown-item","routerLink",".",3,"active","queryParams","title",4,"ngFor","ngForOf"],["buttonClass","btn btn-primary","iconClass","fa fa-database","title","Filter by a connection",1,"mr-1",3,"autoCompact","text","pullRight"],["class","dropdown-item","routerLink",".",3,"queryParams",4,"ngFor","ngForOf"],["routerLink",".",1,"dropdown-item",3,"queryParams"],["routerLink",".",1,"dropdown-item",3,"queryParams","title"],[1,"ml-1",3,"objectType","objects"],[1,"ml-1",3,"key","objectType"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,fa,0,0,"ng-template",null,2,l.Ec),l.Ob(4,"dexih-table",3),l.Vb("rowClick",(function(e){return t.editTable(e)})),l.Dc(5,pa,1,2,"ng-template",null,4,l.Ec),l.Dc(7,ga,1,1,"ng-template",5,6,l.Ec),l.Dc(9,Oa,6,13,"ng-template",7,8,l.Ec),l.Dc(11,Ta,1,2,"ng-template",9,10,l.Ec),l.Dc(13,Na,1,2,"ng-template",11,12,l.Ec),l.Nb(),l.Nb(),l.Lb(15,"dexih-help",13),l.Nb()),2&e&&(l.yb(1),l.hc("title",t.title)("showCloseButton",!0)("showIf",null==t.hubCache?null:t.hubCache.hub),l.yb(3),l.hc("enableMultiSelect",!0)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags)("enableStickyToolbar",!0)("toolbarZIndex",100))},directives:[b.P,d.a,W.a,ba.a,ht.a,p.t,b.i,s.h,p.s,g.a,f.a],pipes:[Ge.a,da.a],encapsulation:2}),e})(),xa=(()=>{class e{constructor(e,t,i){this.hubService=e,this.authService=t,this.route=i,this.eDataObjectType=c.lb,this.title="Preview Table"}ngOnInit(){try{this._subscription=Object(r.a)(this.route.params,this.hubService.getHubCacheObservable(!0)).subscribe(e=>{let t=e[1];this.key=+e[0].tableKey;let i=t.getTable(this.key);i&&(this.title="Preview Table - "+i.logicalName)})}catch(e){this.hubService.addHubClientErrorMessage(e,"Table Preview Data")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["table-preview-data"]],decls:3,vars:4,consts:[[1,"container-fluid"],["iconClass","fa fa-lg fa-fw fa-exchange",3,"title","showCloseButton","close"],[3,"key","viewSource"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Lb(2,"preview-data",2),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("title",t.title)("showCloseButton",!0),l.yb(1),l.hc("key",t.key)("viewSource",t.eDataObjectType.Table))},directives:[b.P,Rt.a],encapsulation:2}),e})();function Fa(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",7),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().deleteCustomFunctions(t)})),l.Nb()}}function Va(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",7),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().export(i)})),l.Nb(),l.Dc(1,Fa,1,0,"dexih-button-delete",8),l.Lb(2,"tags-update-button",9)}if(2&e){const e=t.items,i=l.Zb();l.yb(1),l.hc("ngIf",i.hubCache.canWrite),l.yb(1),l.hc("objectType",i.eSharedObjectType.CustomFunction)("objects",e)}}const Ia=function(){return["customFunction-new"]};function Ka(e,t){1&e&&l.Lb(0,"dexih-button-new",11),2&e&&l.hc("routerLink",l.lc(1,Ia))}function Ea(e,t){if(1&e&&l.Dc(0,Ka,1,2,"dexih-button-new",10),2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite)}}let La=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[0],this.updateCustomFunctions()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Column Validation Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}deleteCustomFunctions(e){this.hubService.deleteCustomFunctions(e)}updateCustomFunctions(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihCustomFunctions.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,tags:this.hubCache.getObjectTags(c.dc.CustomFunction,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}edit(e){this.router.navigate(["customFunction-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubService.createHub(this.hubCache.hub.hubKey,"");e.forEach(e=>{this.hubCache.cacheAddCustomFunction(e.key,t)}),this.hubService.exportHub(t,1===e.length?"CustomFunction - "+e[0].name+".json":"customFunctions.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.CustomFunction&&e.changeClass!==c.dc.TagObjects||this.updateCustomFunctions()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["customFunction"]],inputs:{hubKey:"hubKey"},decls:8,vars:8,consts:[[1,"container-fluid"],["title","Custom Functions","iconClass","fa fa-lg fa-fw fa-code",3,"showCloseButton","padding","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["title","Custom Functions","path","/assets/help/reference/function.md",1,"m-3"],[1,"mr-1",3,"click"],["class","mr-1",3,"click",4,"ngIf"],[1,"ml-1",3,"objectType","objects"],["class","mr-1",3,"routerLink",4,"ngIf"],[1,"mr-1",3,"routerLink"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,Va,3,3,"ng-template",3,4,l.Ec),l.Dc(5,Ea,1,1,"ng-template",null,5,l.Ec),l.Nb(),l.Nb(),l.Lb(7,"dexih-help",6),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!1),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,b.u,p.t,g.a,b.g,b.o,s.f],encapsulation:2}),e})(),Pa=(()=>{class e{constructor(){this.customFunctionParameterForm=null,this.addParameter=new l.n,this.removeParameter=new l.n,this.eBasicType=D.c,this.typeCodes=D.a,this.ignoreChanges=!1}ngOnInit(){}ngOnDestroy(){}add(){this.addParameter.emit(this.customFunctionParameterForm)}remove(){this.removeParameter.emit(this.customFunctionParameterForm)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Eb({type:e,selectors:[["customFunction-parameter"]],inputs:{customFunctionParameterForm:"customFunctionParameterForm"},outputs:{addParameter:"addParameter",removeParameter:"removeParameter"},decls:15,vars:3,consts:[[1,"mb-1",3,"formGroup"],[1,"input-group"],["type","text","formControlName","name","placeholder","Enter a name for the parameter",1,"form-control"],["formControlName","dataType","itemKey","key","itemName","name",1,"form-control","p-0",3,"border","items"],[1,"input-group-append"],[1,"input-group-text","p-0"],[1,"p-1"],["type","number","formControlName","rank",1,"mx-1"],["type","button","value","Add",1,"btn","btn-sm","border-0","bg-transparent",3,"click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-sm","border-0","bg-transparent",3,"click"],[1,"fa","fa-minus-square-o"]],template:function(e,t){1&e&&(l.Ob(0,"form",0),l.Ob(1,"div",1),l.Lb(2,"input",2),l.Lb(3,"form-select",3),l.Ob(4,"div",4),l.Ob(5,"div",5),l.Ob(6,"span",6),l.Fc(7,"Array Dimensions (0-non array)"),l.Nb(),l.Lb(8,"input",7),l.Nb(),l.Ob(9,"div",5),l.Ob(10,"button",8),l.Vb("click",(function(){return t.add()})),l.Lb(11,"i",9),l.Nb(),l.Nb(),l.Ob(12,"div",5),l.Ob(13,"button",10),l.Vb("click",(function(){return t.remove()})),l.Lb(14,"i",11),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.hc("formGroup",t.customFunctionParameterForm),l.yb(3),l.hc("border",!1)("items",t.typeCodes))},directives:[a.I,a.t,a.l,a.c,a.s,a.j,b.E,a.y],encapsulation:2}),e})();function Ma(e,t){if(1&e&&l.Lb(0,"save-button",13),2&e){const e=l.Zb(2);l.hc("formsService",e.formsService)}}function ja(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-invalid-form-details",10),l.Vb("click",(function(){return l.vc(e),l.Zb().formsService.showErrors()})),l.Nb(),l.Dc(1,Ma,1,1,"save-button",11),l.Lb(2,"cancel-button",12)}if(2&e){const e=l.Zb();l.hc("control",e.formsService.currentForm),l.yb(1),l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("formsService",e.formsService)}}function Aa(e,t){if(1&e&&(l.Ob(0,"div"),l.Fc(1),l.Nb()),2&e){const e=l.Zb(3);l.yb(1),l.Hc("Cleaned Value = ",e.testResult.cleanedValue," ")}}function Ra(e,t){if(1&e&&(l.Ob(0,"div"),l.Fc(1),l.Nb()),2&e){const e=l.Zb(3);l.yb(1),l.Hc("Reject Reason = ",e.testResult.rejectReason," ")}}function _a(e,t){if(1&e&&(l.Ob(0,"section"),l.Ob(1,"div",20),l.Fc(2),l.Dc(3,Aa,2,1,"div",15),l.Dc(4,Ra,2,1,"div",15),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.Cb("alert-danger",0==e.testResult.success)("alert-success",1==e.testResult.success),l.yb(1),l.Hc(" Test Result = ",e.testResult.success," "),l.yb(1),l.hc("ngIf",e.testResult.cleanedValue),l.yb(1),l.hc("ngIf",e.testResult.rejectReason)}}function Za(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",24),l.Ob(1,"dexih-button",25),l.Vb("click",(function(){l.vc(e);const t=l.Zb(3);return t.addParameter(null,t.eParameterDirection.Input)})),l.Fc(2,"Add Parameter "),l.Nb(),l.Nb()}}const Ha=function(e){return{"z-index":e,position:"relative"}};function Ga(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",26),l.Ob(1,"customFunction-parameter",27),l.Vb("addParameter",(function(t){l.vc(e);const i=l.Zb(3);return i.addParameter(t,i.eParameterDirection.Input)}))("removeParameter",(function(t){return l.vc(e),l.Zb(3).removeParameter(t)})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit;l.hc("ngStyle",l.mc(2,Ha,200-t.index)),l.yb(1),l.hc("customFunctionParameterForm",e)}}function qa(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div"),l.Ob(1,"dexih-button",25),l.Vb("click",(function(){l.vc(e);const t=l.Zb(4);return t.addParameter(null,t.eParameterDirection.Output)})),l.Fc(2,"Add Parameter"),l.Nb(),l.Nb()}}function Ba(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",26),l.Ob(1,"customFunction-parameter",27),l.Vb("addParameter",(function(t){l.vc(e);const i=l.Zb(4);return i.addParameter(t,i.eParameterDirection.Output)}))("removeParameter",(function(t){return l.vc(e),l.Zb(4).removeParameter(t)})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit;l.hc("ngStyle",l.mc(2,Ha,100-t.index)),l.yb(1),l.hc("customFunctionParameterForm",e)}}const Ua=function(){return{"z-index":101,position:"relative"}};function za(e,t){if(1&e&&(l.Ob(0,"div"),l.Ob(1,"div",21),l.Fc(2," Output Parameters "),l.Nb(),l.Ob(3,"div",26),l.Ob(4,"section"),l.Ob(5,"div",28),l.Lb(6,"input",29),l.Lb(7,"form-select",30),l.Nb(),l.Nb(),l.Dc(8,qa,3,0,"div",15),l.Dc(9,Ba,2,4,"div",7),l.Nb(),l.Lb(10,"br"),l.Nb()),2&e){const e=l.Zb(3);l.yb(3),l.hc("ngStyle",l.lc(5,Ua)),l.yb(4),l.hc("border",!1)("items",e.typeCodes),l.yb(1),l.hc("ngIf",0===e.outputParameters.length),l.yb(1),l.hc("ngForOf",e.outputParameters)}}function Wa(e,t){if(1&e&&(l.Ob(0,"div"),l.Ob(1,"div",21),l.Fc(2," Input Parameters "),l.Nb(),l.Dc(3,Za,3,0,"div",22),l.Dc(4,Ga,2,4,"div",7),l.Nb(),l.Dc(5,za,11,6,"div",15),l.Fc(6," Function Code "),l.Lb(7,"textarea",23)),2&e){const e=l.Zb(2);l.yb(3),l.hc("ngIf",0===e.inputParameters.length),l.yb(1),l.hc("ngForOf",e.inputParameters),l.yb(1),l.hc("ngIf",e.functionType!=e.eFunctionType.Condition)}}function Qa(e,t){if(1&e&&(l.Ob(0,"form",14),l.Ob(1,"fieldset"),l.Dc(2,_a,5,7,"section",15),l.Ob(3,"section"),l.Lb(4,"form-select",16),l.Nb(),l.Ob(5,"section"),l.Lb(6,"form-input",17),l.Nb(),l.Ob(7,"section"),l.Lb(8,"form-textarea",18),l.Nb(),l.Dc(9,Wa,8,3,"ng-template",19),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.formsService.currentForm),l.yb(2),l.hc("ngIf",e.testResult),l.yb(2),l.hc("items",e.functionTypes),l.yb(2),l.hc("autocapitalize",!0)("errors",e.formsService.formErrors.name),l.yb(2),l.hc("showMarkdown",!0),l.yb(1),l.hc("ngIf",e.functionType)}}function $a(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button",31),l.Vb("click",(function(){return l.vc(e),l.Zb().test()})),l.Fc(1,"Syntax Check"),l.Nb(),l.Ob(2,"dexih-button",31),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return t.test(t.inputParameterValues)})),l.Fc(3,"Run"),l.Nb(),l.Ob(4,"dexih-button-save-local",32),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return t.downloadCode(t.inputParameterValues)})),l.Nb()}}function Xa(e,t){1&e&&(l.Ob(0,"div",33),l.Fc(1," Input Parameters "),l.Nb())}function Ya(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div"),l.Ob(1,"div",37),l.Ob(2,"div",38),l.Fc(3),l.Nb(),l.Ob(4,"form-input",39),l.Vb("ngModelChange",(function(i){l.vc(e);const a=t.index,n=l.Zb(2).index;return l.Zb().inputParameterValues[n][a]=i})),l.Nb(),l.Ob(5,"div",40),l.Ob(6,"button",41),l.Vb("click",(function(){l.vc(e);const i=t.index,a=l.Zb(2).index;return l.Zb().addParameterValue(a,i)})),l.Lb(7,"i",42),l.Nb(),l.Nb(),l.Ob(8,"div",40),l.Ob(9,"button",43),l.Vb("click",(function(){l.vc(e);const i=t.index,a=l.Zb(2).index;return l.Zb().removeParameterValue(a,i)})),l.Lb(10,"i",44),l.Nb(),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=t.index,i=l.Zb(2),a=i.$implicit,n=i.index,s=l.Zb();l.yb(3),l.Hc(" ",a.controls.name.value+"["+e+"]"," "),l.yb(1),l.hc("border",!1)("ngModel",s.inputParameterValues[n][e])("name","inputParameterValues-"+n+"-"+e)}}function Ja(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div"),l.Ob(1,"div"),l.Ob(2,"dexih-button",25),l.Vb("click",(function(){l.vc(e);const t=l.Zb().index;return l.Zb().addParameterValue(t)})),l.Fc(3),l.Nb(),l.Nb(),l.Dc(4,Ya,11,4,"div",36),l.Nb()}if(2&e){const e=l.Zb(),t=e.$implicit,i=e.index,a=l.Zb();l.yb(3),l.Hc(" Add ",t.controls.name.value," value "),l.yb(1),l.hc("ngForOf",a.inputParameterValues[i])}}function en(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form-input",45),l.Vb("ngModelChange",(function(t){l.vc(e);const i=l.Zb().index;return l.Zb().inputParameterValues[i]=t})),l.Nb()}if(2&e){const e=l.Zb(),t=e.$implicit,i=e.index,a=l.Zb();l.hc("label",t.controls.name.value)("ngModel",a.inputParameterValues[i])("name","inputParameterValues"+i)}}function tn(e,t){if(1&e&&(l.Ob(0,"div",26),l.Dc(1,Ja,5,2,"div",34),l.Dc(2,en,1,3,"ng-template",null,35,l.Ec),l.Nb()),2&e){const e=t.$implicit,i=t.index,a=l.sc(3);l.hc("ngStyle",l.mc(3,Ha,200-i)),l.yb(1),l.hc("ngIf",e.controls.rank.value>0)("ngIfElse",a)}}function an(e,t){1&e&&(l.Ob(0,"div",33),l.Fc(1," Outputs Parameters "),l.Nb())}function nn(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",26),l.Ob(1,"form-input",46),l.Vb("ngModelChange",(function(i){l.vc(e);const a=t.index;return l.Zb().outputParameterValues[a]=i})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit,i=t.index,a=l.Zb();l.hc("ngStyle",l.mc(5,Ha,200-i)),l.yb(1),l.hc("disabled",!0)("label",e.controls.name.value)("ngModel",a.outputParameterValues[i])("name","outputParameterValues"+i)}}let sn=(()=>{class e{constructor(e,t,i,a,n,s){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.location=s,this.typeCodes=D.a,this.eParameterDirection=c.Vb,this.outputParameters=[],this.inputParameters=[],this.outputParameterValues=[],this.inputParameterValues=[],this.functionTypes=D.d,this.eFunctionType=c.Cb,this.lookupColumnValue="",this.isLoaded=!1,this.cancelToken=new x.a}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.status===T.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"Column Validation")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._functionTypeSubscription&&this._functionTypeSubscription.unsubscribe(),this.cancelToken.cancel()}load(){if(this.isLoaded=!0,"edit"===this.action)if(this.customFunctionKey=+this.params.customFunctionKey,this.customFunctionKey)if(this.hubCache.hub&&this.hubCache.hub.dexihCustomFunctions){let e=this.hubCache.hub.dexihCustomFunctions.find(e=>e.key===this.customFunctionKey);this.formsService.customFunction(e),this.functionType=this.formsService.currentForm.controls.functionType.value}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no custom function specified to edit.");if("new"===this.action){let e=new c.g;e.key=this.hubCache.getNextSequence(),this.formsService.customFunction(e),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t>=0&&history.pushState){let e=window.location.pathname.replace("/customFunction-new","/customFunction-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}}),this.functionType=this.formsService.currentForm.controls.functionType.value}this._functionTypeSubscription=this.formsService.currentForm.controls.functionType.valueChanges.subscribe(e=>{this.functionType=e,this.functionType!==c.Cb.Condition&&this.functionType!==c.Cb.JoinCondition&&this.functionType!==c.Cb.Validate||(this.formsService.currentForm.controls.returnType.setValue(c.pc.Boolean),this.updateParameters())}),this.updateParameters()}canDeactivate(){return new Promise(e=>{this.formsService.currentForm&&!this.formsService.currentForm.pristine?this.authService.confirmDialog("Function has changed","The function has changed.  Would you like to discard the changes and return to the previous screen?").then(t=>{e(t)}).catch(t=>{e(!1)}):e(!0)})}parametersArray(){return this.formsService.currentForm.controls.dexihCustomFunctionParameters}updateParameters(){let e=this.parametersArray();this.inputParameters=e.controls.sort((e,t)=>e.value.position-t.value.position).filter(e=>e.value.direction===c.Vb.Input),this.outputParameters=e.controls.sort((e,t)=>e.value.position-t.value.position).filter(e=>e.value.direction===c.Vb.Output),this.inputParameterValues.length=this.inputParameters.length,this.outputParameterValues.length=this.outputParameters.length}addParameter(e,t){try{let i=new c.h;if(e){let t=e.value;i.dataType=t.dataType,i.name=t.name,i.position=t.position+1}i.key=this.hubCache.getNextSequence(),i.name="",i.direction=t,i.rank=0,i.isValid=!0;let a=this.parametersArray(),n=this.formsService.customFunctionParametersFormGroup(i);a.push(n),a.controls.sort((e,t)=>e.value.position-t.value.position).forEach((e,t)=>{e.controls.position.setValue(10*t)}),this.updateParameters()}catch(i){this.hubService.addHubClientErrorMessage(i,"Edit Custom Function, add parameter")}}addParameterValue(e,t){Array.isArray(this.inputParameterValues[e])?this.inputParameterValues[e].splice(t+1,0,""):this.inputParameterValues[e]=new Array(1)}removeParameterValue(e,t){this.inputParameterValues[e].splice(t,1)}removeParameter(e){try{let t=this.parametersArray(),i=t.controls.indexOf(e);i>-1&&t.removeAt(i),this.updateParameters()}catch(t){this.hubService.addHubClientErrorMessage(t,"Edit Custom Function, remove parameter")}}downloadCode(e=null){let t=this.createDataTransformItem();this.hubService.downloadCustomFunction(t,e)}test(e=null){let t=this.createDataTransformItem();this.hubService.testCustomFunction(t,e,this.cancelToken).then(e=>{this.syntaxMessage=new x.e(!0,"The function has successfully compiled.",null,null),e&&e.length>0?e.forEach((e,t)=>{0===t?this.returnParameterValue=e:this.outputParameterValues[t-1]=e}):(this.returnParameterValue=null,this.outputParameterValues.forEach(e=>null))}).catch(e=>{let t=e;e.stack&&(t=new x.e(!1,"Client Error: "+e.message,e.stack,"")),this.syntaxMessage=t,this.returnParameterValue=null,this.outputParameterValues.forEach(e=>null)})}createDataTransformItem(){let e=this.formsService.currentForm.value,t=new c.x;t.functionCode=e.methodCode,t.functionResultCode=e.resultCode,t.transformItemType=c.kc.CustomFunction;let i=[];e.dexihCustomFunctionParameters.sort((e,t)=>e.position-t.position).forEach((e,t)=>{if(e){let a=new c.A;a.key=0,a.datalinkTransformItemKey=0,a.name=e.name,a.rank=e.rank,a.direction=e.direction,a.dataType=e.dataType,a.position=t,a.isValid=!0,i.push(a)}});let a=new c.A;return a.key=0,a.datalinkTransformItemKey=0,a.name="Return",a.rank=0,a.direction=c.Vb.ReturnValue,a.dataType=e.returnType,a.position=0,a.isValid=!0,i.push(a),t.dexihFunctionParameters=i,t}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(N.a),l.Kb(s.a),l.Kb(s.e),l.Kb(p.n))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-customFunction-edit-form"]],features:[l.xb([N.a])],decls:19,vars:11,consts:[[1,"container"],["title","Edit Function","iconClass","fa fa-lg fa-fw fa-code",3,"showCloseButton","padding","close"],["header",""],[3,"formGroup",4,"ngIf"],["title","Test Function","iconClass","fa fa-lg fa-fw fa-code",3,"padding"],[3,"message"],["class","label",4,"ngIf"],[3,"ngStyle",4,"ngFor","ngForOf"],["label","Return Value","name","returnParameterValue","type","text",3,"disabled","ngModel","ngModelChange"],["title","Custom Functions","path","/assets/help/reference/function.md",1,"m-3"],[1,"mr-1",3,"control","click"],["class","mr-1",3,"formsService",4,"ngIf"],[3,"formsService"],[1,"mr-1",3,"formsService"],[3,"formGroup"],[4,"ngIf"],["label","Function Type","formControlName","functionType","itemKey","key","itemName","name","iconClass","fa fa-question",3,"items"],["label","Custom Function Name","formControlName","name","placeholder","Enter the name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[3,"ngIf"],[1,"alert"],[1,"label","mb-1"],["class","mb-1",4,"ngIf"],["rows","20","width","100%","spellcheck","false","formControlName","methodCode",1,"form-control"],[1,"mb-1"],["iconClass","fa fa-plus-square-o","title","Click to add a parameter",3,"click"],[3,"ngStyle"],[3,"customFunctionParameterForm","addParameter","removeParameter"],[1,"input-group","mb-1"],["readonly","","value","Return Data Type",1,"form-control"],["formControlName","returnType","itemKey","key","itemName","name",1,"form-control","p-0",3,"border","items"],["buttonClass","btn btn-success",1,"mr-1",3,"click"],["text","Sample Code",3,"click"],[1,"label"],[4,"ngIf","ngIfElse"],["showValue",""],[4,"ngFor","ngForOf"],[1,"input-group"],[1,"form-control"],["type","text","placeholder","Enter a test value for the parameter",1,"form-control","p-0",3,"border","ngModel","name","ngModelChange"],[1,"input-group-text","p-0"],["type","button","value","Add",1,"btn","btn-sm","border-0","bg-transparent",3,"click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-sm","border-0","bg-transparent",3,"click"],[1,"fa","fa-minus-square-o"],["type","text","placeholder","Enter a test value for the parameter",3,"label","ngModel","name","ngModelChange"],["type","text",3,"disabled","label","ngModel","name","ngModelChange"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget-vertical"),l.Ob(2,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(3,ja,3,3,"ng-template",null,2,l.Ec),l.Dc(5,Qa,10,7,"form",3),l.Nb(),l.Ob(6,"dexih-widget",4),l.Dc(7,$a,5,0,"ng-template",null,2,l.Ec),l.Lb(9,"dexih-message",5),l.Ob(10,"form"),l.Ob(11,"fieldset"),l.Ob(12,"div"),l.Dc(13,Xa,2,0,"div",6),l.Dc(14,tn,4,5,"div",7),l.Ob(15,"form-input",8),l.Vb("ngModelChange",(function(e){return t.returnParameterValue=e})),l.Nb(),l.Dc(16,an,2,0,"div",6),l.Dc(17,nn,2,7,"div",7),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Lb(18,"dexih-help",9),l.Nb(),l.Nb()),2&e&&(l.yb(2),l.hc("showCloseButton",!0)("padding",!0),l.yb(3),l.hc("ngIf",t.formsService.currentForm),l.yb(1),l.hc("padding",!0),l.yb(3),l.hc("message",t.syntaxMessage),l.yb(4),l.hc("ngIf",t.inputParameters.length>0),l.yb(1),l.hc("ngForOf",t.inputParameters),l.yb(1),l.hc("disabled",!0)("ngModel",t.returnParameterValue),l.yb(1),l.hc("ngIf",t.outputParameters.length>0),l.yb(1),l.hc("ngForOf",t.outputParameters))},directives:[b.S,b.P,p.t,Fi.a,a.I,a.t,a.u,p.s,b.D,a.s,a.v,W.a,V.a,F.a,I.a,a.l,b.E,a.j,b.H,a.c,b.f,p.w,Pa,b.u],encapsulation:2}),e})();var on=i("bK5D"),rn=i("crXl");function cn(e,t){if(1&e&&l.Lb(0,"dependent-items-button",11),2&e){const e=t.item,i=l.Zb();l.hc("key",e.key)("objectType",i.eSharedObjectType.DatalinkTest)}}function ln(e,t){if(1&e&&l.Lb(0,"tags-update-button",12),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.DatalinkTest)("objects",e)}}function un(e,t){1&e&&l.Lb(0,"actions-datalinkTest-button",13),2&e&&l.hc("datalinkTests",t.items)}function hn(e,t){if(1&e&&l.Lb(0,"datalink-status",14),2&e){const e=t.item;l.hc("datalinkTestKey",null==e?null:e.key)}}let bn=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.cancelToken=new x.a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",format:"",tags:"tags"},{name:"description",title:"Description",format:""},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this.watchChanges(),this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[0],this.update()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datalink Tests Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}delete(e){this.hubService.deleteDatalinkTests(e)}snapshot(e){this.hubService.runDatalinkTestSnapshot(e,this.cancelToken)}run(e){let t=e.map(e=>e.key);this.hubService.runDatalinkTests(t,this.cancelToken)}update(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihDatalinkTests.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,tags:this.hubCache.getObjectTags(c.dc.DatalinkTest,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}edit(e){this.router.navigate(["datalinkTest-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubService.createHub(this.hubCache.hub.hubKey,"");t.dexihDatalinkTests=e,this.hubService.exportHub(t,"datalink_tests.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.DatalinkTest&&e.changeClass!==c.dc.TagObjects||this.update()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["datalink-test"]],decls:12,vars:5,consts:[[1,"container-fluid"],["title","Datalink Tests","iconClass","fa fa-lg fa-fw fa-flag-checkered",3,"showCloseButton","close"],[3,"enableMultiSelect","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["select","rowStatus"],["rowStatus",""],["title","Datalink Test","path","/assets/help/reference/datalinkTest.md",1,"m-3"],[1,"ml-1",3,"key","objectType"],[1,"ml-1",3,"objectType","objects"],[3,"datalinkTests"],[3,"datalinkTestKey"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,cn,1,2,"ng-template",3,4,l.Ec),l.Dc(5,ln,1,2,"ng-template",5,6,l.Ec),l.Dc(7,un,1,1,"ng-template",null,7,l.Ec),l.Dc(9,hn,1,1,"ng-template",8,9,l.Ec),l.Nb(),l.Nb(),l.Lb(11,"dexih-help",10),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,f.a,g.a,rn.a,ht.a],encapsulation:2}),e})();function dn(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save",5),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return!t.saving&&t.save()})),l.Nb(),l.Ob(1,"dexih-button-cancel",6),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return!t.saving&&t.cancel()})),l.Nb()}if(2&e){const e=l.Zb();l.hc("busy",e.saving),l.yb(1),l.hc("busy",e.saving)}}function mn(e,t){if(1&e&&(l.Ob(0,"span",10),l.Fc(1),l.Nb()),2&e){const e=t.$implicit;l.yb(1),l.Hc(" ",e.name," ")}}function fn(e,t){if(1&e&&(l.Ob(0,"label",7),l.Fc(1,"Create automatic tests for the following datalink(s):"),l.Nb(),l.Ob(2,"div"),l.Ob(3,"div",8),l.Dc(4,mn,2,1,"span",9),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.yb(4),l.hc("ngForOf",e.sourceDatalinks)}}function pn(e,t){if(1&e&&l.Lb(0,"form-input",21),2&e){const e=l.Zb(2);l.hc("errors",e.formErrors.name)}}function gn(e,t){1&e&&l.Lb(0,"form-input",22)}function vn(e,t){if(1&e&&(l.Ob(0,"form",11),l.Ob(1,"fieldset"),l.Ob(2,"div",12),l.Ob(3,"section",13),l.Dc(4,pn,1,1,"form-input",14),l.Dc(5,gn,1,0,"form-input",15),l.Nb(),l.Ob(6,"section",13),l.Lb(7,"form-select",16),l.Nb(),l.Nb(),l.Ob(8,"div",12),l.Ob(9,"section",13),l.Lb(10,"form-select",17),l.Nb(),l.Ob(11,"section",13),l.Lb(12,"form-select",18),l.Nb(),l.Nb(),l.Nb(),l.Ob(13,"fieldset"),l.Ob(14,"section"),l.Ob(15,"div",12),l.Ob(16,"section",19),l.Lb(17,"form-checkbox",20),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.mainForm),l.yb(4),l.hc("ngIf",1==e.sourceDatalinks.length),l.yb(1),l.hc("ngIf",e.sourceDatalinks.length>1),l.yb(2),l.hc("items",e.hubCache.hub.dexihConnections)("errors",e.formErrors.auditConnectionKey),l.yb(3),l.hc("items",e.managedConnections)("errors",e.formErrors.sourceConnectionKey)("allowNullSelect",!0),l.yb(2),l.hc("items",e.managedConnections)("errors",e.formErrors.targetConnectionKey)("allowNullSelect",!0)}}let yn=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.route=t,this.router=i,this.location=a,this.fb=n,this.cancelToken=new x.a,this.hasChanged=!1,this.showAllErrors=!1,this.saving=!1,this.formErrors={name:"",auditConnectionKey:"",sourceConnectionKey:"",targetConnectionKey:"",snapshotData:""},this.validationMessages={name:{required:"Name is required.",minlength:"Name must be at least 4 characters long.",maxlength:"Name cannot be more than 50 characters long."},auditConnectionKey:{},targetConnectionKey:{},sourceConnectionKey:{},snapshotData:{}}}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[1];if(this.hubCache=e[2],this.managedConnections=this.hubCache.hub.dexihConnections.filter(e=>e.purpose===c.jb.Managed),this.hubCache.status===T.j.Loaded){let e=t.datalinkKeys;if(this.sourceDatalinkKeys=new Array,this.sourceDatalinks=new Array,e&&this.hubCache.hub.dexihConnections){let t=e.split("|");this.hubCache.hub.dexihDatalinks.forEach(e=>{t.findIndex(t=>t===e.key.toString())>=0&&(this.sourceDatalinkKeys.push(e.key),this.sourceDatalinks.push(e))})}let i=this.hubCache.hub.dexihConnections.find(e=>e.purpose===c.jb.Managed);i&&(this.targetConnectionKey=i.key),this.sourceConnectionKey=this.targetConnectionKey,this.auditConnectionKey=this.targetConnectionKey,this.buildForm()}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datalink New")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._valueChangesSubscription&&this._valueChangesSubscription.unsubscribe(),this.cancelToken.cancel()}buildForm(){this.mainForm=this.fb.group({name:[this.name,[]],auditConnectionKey:[this.auditConnectionKey>0?this.auditConnectionKey:null,[]],targetConnectionKey:[this.targetConnectionKey>0?this.targetConnectionKey:null,[]],sourceConnectionKey:[this.sourceConnectionKey>0?this.sourceConnectionKey:null,[]],snapshotData:[!0,[]]}),this._valueChangesSubscription&&this._valueChangesSubscription.unsubscribe(),this._valueChangesSubscription=this.mainForm.valueChanges.subscribe(e=>this.onValueChanged(e)),this.onValueChanged(),this.hasChanged=!1}onValueChanged(e){if(!this.mainForm)return;const t=this.mainForm;this.hasChanged=!0;for(const i of Object.keys(this.formErrors)){this.formErrors[i]="";const e=t.get(i);if(e&&(e.dirty||this.showAllErrors)&&!e.valid){const t=this.validationMessages[i];for(const a of Object.keys(e.errors))this.formErrors[i]+=t[a]+" "}}}save(){if(this.mainForm.valid){let e=this.mainForm.value;this.saving=!0,this.hubService.newDatalinkTest(this.name,this.sourceDatalinkKeys,e.auditConnectionKey,e.targetConnectionKey,e.sourceConnectionKey).then(t=>{return i=this,void 0,n=function*(){e.snapshotData&&(yield this.hubService.runDatalinkTestSnapshot([t],this.cancelToken)),this.router.navigate(["/hub",this.hubCache.hub.hubKey,"datalinkTests","datalinkTest-edit",t.key],{relativeTo:this.route.root})},new((a=void 0)||(a=Promise))((function(e,t){function s(e){try{r(n.next(e))}catch(i){t(i)}}function o(e){try{r(n.throw(e))}catch(i){t(i)}}function r(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(s,o)}r((n=n.apply(i,[])).next())}));var i,a,n}).catch(e=>{this.saving=!1})}else this.showAllErrors=!0,this.onValueChanged()}cancel(){this.location.back()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(s.a),l.Kb(s.e),l.Kb(p.n),l.Kb(a.g))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-datalinkTest-new-form"]],decls:7,vars:3,consts:[[1,"container"],["title","New Datalink Test(s)","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","padding","close"],["header",""],["subHeader",""],[3,"formGroup",4,"ngIf"],[1,"mr-1",3,"busy","click"],[3,"busy","click"],[1,"label"],[1,"list-group","d-inline-block"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Test Name","formControlName","name","placeholder","Test name (leave blank for auto naming)","iconClass","fa fa-comment",3,"errors",4,"ngIf"],["disabled","","label","Test Name","placeholder","Test name can not be specified when creating multiple tests.","iconClass","fa fa-comment",4,"ngIf"],["label","Audit Connection","formControlName","auditConnectionKey","itemKey","key","itemName","name","iconClass","fa fa-database","note","Connection where test results are stored.",3,"items","errors"],["formControlName","sourceConnectionKey","label","Input Connection","itemKey","key","itemName","name","note","Specify the connection to use for any datalink source data.","selectNullMessage","No source table",3,"items","errors","allowNullSelect"],["formControlName","targetConnectionKey","label","Target Connection","itemKey","key","itemName","name","note","Specify the connection for target data.","selectNullMessage","No target table",3,"items","errors","allowNullSelect"],[1,"col","col-11"],["label","Snapshot and copy current source/target data into the test connections.","formControlName","snapshotData","name","snapshotData"],["label","Test Name","formControlName","name","placeholder","Test name (leave blank for auto naming)","iconClass","fa fa-comment",3,"errors"],["disabled","","label","Test Name","placeholder","Test name can not be specified when creating multiple tests.","iconClass","fa fa-comment"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return!t.saving&&t.cancel()})),l.Dc(2,dn,2,2,"ng-template",null,2,l.Ec),l.Dc(4,fn,5,1,"ng-template",null,3,l.Ec),l.Dc(6,vn,18,11,"form",4),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(5),l.hc("ngIf",t.sourceDatalinkKeys))},directives:[b.P,p.t,b.t,b.b,p.s,a.I,a.t,a.l,b.E,a.s,a.j,b.A,b.D],encapsulation:2}),e})();var Cn=i("MbvK"),wn=i("ynzd"),Sn=i("XNiG"),kn=i("VRyK"),On=i("Z+eP"),Tn=i("RXlv"),Nn=i("79jk"),Dn=i("+F4M"),xn=i("hJJo"),Fn=i("YcGA");function Vn(e,t){if(1&e&&l.Lb(0,"save-button",16),2&e){const e=l.Zb(2);l.hc("formsService",e.formsService)}}function In(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-invalid-form-details",12),l.Vb("click",(function(){return l.vc(e),l.Zb().formsService.showErrors()})),l.Nb(),l.Ob(1,"download-button",13),l.Vb("download",(function(t){return l.vc(e),l.Zb().download(t)})),l.Nb(),l.Dc(2,Vn,1,1,"save-button",14),l.Lb(3,"cancel-button",15)}if(2&e){const e=l.Zb();l.hc("control",e.formsService.currentForm),l.yb(2),l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("formsService",e.formsService)}}function Kn(e,t){if(1&e&&(l.Ob(0,"section",21),l.Ob(1,"form-select",28),l.Lb(2,"table-edit-button",29),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",null==e.errors?null:e.errors.sourceTableKey)("items",e.connectionTables),l.yb(1),l.hc("key",e.formsService.currentForm.controls.sourceTableKey.value)}}function En(e,t){if(1&e&&(l.Ob(0,"section",21),l.Ob(1,"form-select",30),l.Lb(2,"datalink-edit-button",29),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",null==e.errors?null:e.errors.sourceDatalinkKey)("items",e.datalinks),l.yb(1),l.hc("key",e.formsService.currentForm.controls.sourceDatalinkKey.value)}}function Ln(e,t){if(1&e&&(l.Ob(0,"form",17),l.Ob(1,"fieldset"),l.Ob(2,"section"),l.Lb(3,"form-input",18),l.Nb(),l.Ob(4,"section"),l.Lb(5,"form-textarea",19),l.Nb(),l.Ob(6,"section"),l.Ob(7,"div",20),l.Ob(8,"section",21),l.Lb(9,"form-checkbox",22),l.Nb(),l.Ob(10,"section",21),l.Lb(11,"form-input",23),l.Nb(),l.Nb(),l.Nb(),l.Ob(12,"section"),l.Ob(13,"div",20),l.Ob(14,"section",21),l.Lb(15,"form-checkbox",24),l.Nb(),l.Ob(16,"section",21),l.Lb(17,"form-time",25),l.Nb(),l.Nb(),l.Nb(),l.Ob(18,"section"),l.Ob(19,"div",20),l.Ob(20,"section",21),l.Lb(21,"form-select",26),l.Nb(),l.Dc(22,Kn,3,3,"section",27),l.Dc(23,En,3,3,"section",27),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.formsService.currentForm),l.yb(3),l.hc("autocapitalize",!0)("errors",e.formsService.formErrors.name),l.yb(2),l.hc("showMarkdown",!0),l.yb(6),l.hc("errors",e.formsService.formErrors.logDirectory),l.yb(6),l.hc("errors",e.formsService.formErrors.resetCacheInterval),l.yb(4),l.hc("items",e.sourceTypes)("enableFilter",!1),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eSourceType.Table),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eSourceType.Datalink)}}function Pn(e,t){if(1&e&&(l.Ob(0,"dexih-widget-section",31),l.Lb(1,"input-parameters",32),l.Nb()),2&e){const e=l.Zb();l.hc("showExpandButton",!0)("padding",!0),l.yb(1),l.hc("showEdit",!0)("parameters",e.formsService.currentForm.controls.parameters)("formsService",e.formsService)}}function Mn(e,t){if(1&e){const e=l.Pb();l.Ob(0,"span",35),l.Ob(1,"div",36),l.Ob(2,"div",37),l.Fc(3),l.Nb(),l.Nb(),l.Ob(4,"form-input",38),l.Vb("ngModelChange",(function(i){return l.vc(e),t.$implicit.value=i})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit,i=t.index;l.yb(3),l.Hc(" ",e.logicalName," "),l.yb(1),l.jc("name","column",i,""),l.hc("placeholder","Enter "+e.logicalName)("ngModel",e.value)}}function jn(e,t){if(1&e&&(l.Ob(0,"div",33),l.Dc(1,Mn,5,4,"span",34),l.Nb()),2&e){const e=l.Zb();l.yb(1),l.hc("ngForOf",e.inputColumns)}}function An(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-refresh",39),l.Vb("click",(function(){return l.vc(e),l.Zb().refresh()})),l.Nb()}}let Rn=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.refreshDataSubject=new Sn.a,this.sourceTypes=[{key:c.gc.Datalink,name:"Datalink"},{key:c.gc.Table,name:"Table"}],this.eSourceType=c.gc,this.connectionTables=[],this.datalinks=[],this.selectQuery=new c.V,this.data=[],this.isLoaded=!1,this.cancelToken=new x.a}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];if(this.params=e[1],this.hubCache=e[2],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache&&this.hubCache.status===T.j.Loaded&&(this.hubCache&&this.hubCache.isLoaded()&&(this.connectionTables=this.hubCache.getConnectionTables(),this.datalinks=this.hubCache.hub.dexihDatalinks),(!this.isLoaded||"new"!==this.action)&&(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load(),this.hubCache.isLoaded()))){if(!this.hubCache||this.hubCache.status!==T.j.Loaded||this.isLoaded)return;this.isLoaded=!0}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Api Edit")}}load(){if("edit"===this.action)if(this.apiKey=+this.params.apiKey,this.apiKey)if(this.hubCache.hub&&this.hubCache.hub.dexihApis){let e=this.hubCache.hub.dexihApis.find(e=>e.key===this.apiKey);this.selectQuery=e.selectQuery,this.selectQuery||(this.selectQuery=new c.V),this.formsService.api(e),this.watchChanges(),this.getColumns()}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no api specified to edit.");if("new"===this.action){let e=new c.d;this.formsService.api(e),this.watchChanges(),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/api-new","/api-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}}watchChanges(){this._changesSubscription&&this._changesSubscription.unsubscribe(),this._changesSubscription=Object(kn.a)(this.formsService.currentForm.controls.sourceDatalinkKey.valueChanges,this.formsService.currentForm.controls.sourceTableKey.valueChanges).subscribe(()=>{this.reset(),this.selectQuery=new c.V,this.getColumns()})}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._changesSubscription&&this._changesSubscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}getColumns(){let e=this.formsService.currentForm;if(e.controls.sourceType.value===c.gc.Table&&e.controls.sourceTableKey.value>0){let t=this.hubCache.getTable(e.controls.sourceTableKey.value);if(t)return this.tableColumns=t.dexihTableColumns,void(this.inputColumns=this.getInputColumns(t.dexihTableColumns));this.reset()}else this.reset();if(e.controls.sourceType.value===c.gc.Datalink&&e.controls.sourceDatalinkKey.value>0){let t=this.datalinks.find(t=>t.key===e.controls.sourceDatalinkKey.value);if(t){const e=new On.b;e.buildInputOutput(this.hubCache,t),this.tableColumns=e.getDatalinkOutputColumns(t),this.inputColumns=this.getInputColumns(t.sourceDatalinkTable.dexihDatalinkColumns)}else this.reset()}else this.reset()}getInputColumns(e){return e.filter(e=>e.isInput).map(e=>({name:e.name,logicalName:e.logicalName,dataType:e.dataType,rank:e.rank,value:e.defaultValue}))}reset(){this.tableColumns=[],this.inputColumns=[],this.columns=null,this.data=null}refresh(){let e=this.formsService.currentForm;e.controls.sourceType.value===c.gc.Datalink&&this.hubService.previewDatalinkKeyData(e.controls.sourceDatalinkKey.value,!1,this.selectQuery,this.inputColumns,e.controls.parameters.value,this.cancelToken).then(e=>{this.refreshDataSubject.next(),this.columns=e.columns,this.data=e.data}).catch(()=>{}),e.controls.sourceType.value===c.gc.Table&&this.hubService.previewTableKeyData(e.controls.sourceTableKey.value,!1,this.selectQuery,this.inputColumns,e.controls.parameters.value,this.cancelToken).then(e=>{this.columns=e.columns,this.data=e.data}).catch(()=>{})}download(e){let t=this.formsService.currentForm.value,i=new c.M;t.sourceType===c.gc.Table&&(i.objectKey=t.sourceDatalinkKey,i.objectType=c.lb.Datalink),t.sourceType===c.gc.Table&&(i.objectKey=t.sourceTableKey,i.objectType=c.lb.Table),i.query=this.selectQuery,this.hubService.downloadData([i],!1,e,this.cancelToken)}canDeactivate(){return new Promise(e=>{this.formsService.hasChanged?this.authService.confirmDialog("The api has not been saved","The api changes have not been saved.  Do you want to discard the changes and exit?").then(t=>{e(t)}).catch(()=>{e(!1)}):e(!0)})}unloadNotification(e){this.formsService.hasChanged&&(e.returnValue="The api changes have not been saved.  Do you want to discard the changes and exit?")}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(N.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-api-edit-form"]],hostBindings:function(e,t){1&e&&l.Vb("beforeunload",(function(e){return t.unloadNotification(e)}),!1,l.uc)},features:[l.xb([N.a])],decls:17,vars:16,consts:[[1,"container"],["title","Edit API","iconClass","fa fa-lg fa-fw fa-feed",3,"showCloseButton","padding","close"],["header",""],["title","Properties",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],["title","Parameters",3,"showExpandButton","padding",4,"ngIf"],["title","Data",3,"showExpandButton"],["class","d-flex flex-wrap pt-1",4,"ngIf"],[3,"selectQuery","columns","inputColumns","parameters","refreshEvent","onRefreshData"],[3,"enableMultiSelect","enableSaveCsv","columns","data"],["actions",""],["title","Connections","path","/assets/help/reference/api.md",1,"m-3"],[1,"mr-1",3,"control","click"],[1,"mr-1",3,"download"],["class","mr-1",3,"formsService",4,"ngIf"],[3,"formsService"],[1,"mr-1",3,"formsService"],[3,"formGroup"],["label","Api Name","formControlName","name","placeholder","Enter the api name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Auto Start","formControlName","autoStart","note","Re-start the API when the remote agent is restarted."],["label","Log Directory","formControlName","logDirectory","placeholder","Enter a directory to log api updates.","iconClass","fa fa-list","note","Directory to create detailed logs of API calls.  Leave blank to exclude file logging.",3,"errors"],["label","Cache Queries","formControlName","cacheQueries","note","Cache API called to improve performance"],["label","Reset Cache Interval","formControlName","cacheResetInterval","note","The interval to reset the cache (forcing a reload of new data).",3,"errors"],["label","Data Source Type","formControlName","sourceType","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the source type for this view",3,"items","enableFilter"],["class","form-group col-md-6",4,"ngIf"],["label","Source Table","formControlName","sourceTableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the source table",3,"errors","items"],[3,"key"],["label","Source Datalink","formControlName","sourceDatalinkKey","itemKey","key","itemName","name","note","Select the source datalink",3,"errors","items"],["title","Parameters",3,"showExpandButton","padding"],[3,"showEdit","parameters","formsService"],[1,"d-flex","flex-wrap","pt-1"],["class","input-group",4,"ngFor","ngForOf"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0",3,"name","placeholder","ngModel","ngModelChange"],["text","Reload",1,"mr-1",3,"click"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,In,4,3,"ng-template",null,2,l.Ec),l.Ob(4,"dexih-widget-section",3),l.Dc(5,Ln,24,10,"form",4),l.Nb(),l.Dc(6,Pn,2,5,"dexih-widget-section",5),l.Ob(7,"dexih-widget-section",6),l.Dc(8,jn,2,1,"div",7),l.Ob(9,"section"),l.Ob(10,"h5"),l.Fc(11,"Data Configuration"),l.Nb(),l.Ob(12,"query-builder",8),l.Vb("onRefreshData",(function(){return t.refresh()})),l.Nb(),l.Nb(),l.Ob(13,"dexih-table",9),l.Dc(14,An,1,0,"ng-template",null,10,l.Ec),l.Nb(),l.Nb(),l.Nb(),l.Lb(16,"dexih-help",11),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!1),l.yb(3),l.hc("showExpandButton",!0),l.yb(1),l.hc("ngIf",t.formsService.currentForm),l.yb(1),l.hc("ngIf",t.formsService.currentForm),l.yb(1),l.hc("showExpandButton",!0),l.yb(1),l.hc("ngIf",t.inputColumns&&t.inputColumns.length>0),l.yb(4),l.hc("selectQuery",t.selectQuery)("columns",t.tableColumns)("inputColumns",t.inputColumns)("parameters",null==t.formsService||null==t.formsService.currentForm?null:t.formsService.currentForm.controls.parameters.value)("refreshEvent",t.refreshDataSubject.asObservable()),l.yb(1),l.hc("enableMultiSelect",!1)("enableSaveCsv",!0)("columns",t.columns)("data",t.data))},directives:[b.P,b.T,p.t,Tn.a,d.a,W.a,V.a,Nn.a,F.a,I.a,a.I,a.t,a.l,b.D,a.s,a.j,b.H,b.A,b.I,b.E,Dn.a,xn.a,Fn.a,p.s,a.v,b.s],encapsulation:2}),e})();var _n=i("7q3d"),Zn=i("Eg12");function Hn(e,t){if(1&e&&l.Lb(0,"tags-update-button",11),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.ColumnValidation)("objects",e)}}function Gn(e,t){if(1&e&&l.Lb(0,"dependent-items-button",12),2&e){const e=t.item,i=l.Zb();l.hc("key",e.key)("objectType",i.eSharedObjectType.Api)}}function qn(e,t){1&e&&l.Lb(0,"actions-api-button",13),2&e&&l.hc("apis",t.items)}function Bn(e,t){if(1&e&&l.Lb(0,"api-status",14),2&e){const e=t.item;l.hc("apiKey",null==e?null:e.key)}}let Un=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{iconClass:"sharedIcon",tooltip:"sharedToolTip",width:"1%",align:"center"},{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{name:"apiSource",title:"Api Source"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[2],this.updateApis()})}catch(e){this.hubService.addHubClientErrorMessage(e,"View Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}editApi(e){this.router.navigate(["api-edit",e.key],{relativeTo:this.route})}updateApis(){if(this.hubCache.isLoaded()){let e;e=this.hubCache.hub.dexihApis.filter(e=>e.isValid);let t=e.map(e=>({key:e.key,name:e.name,apiSource:this.getSourceDetails(e),updateDate:e.updateDate,sharedIcon:e.isShared?"fa fa-group":"fa fa-user-secret",sharedToolTip:e.isShared?"Table is shared":"Table is private",tags:this.hubCache.getObjectTags(c.dc.ColumnValidation,e.key)}));this._tableData.next(t)}else this._tableData.next(null)}getSourceDetails(e){if(e.sourceType===c.gc.Table){let t=this.hubCache.getTable(e.sourceTableKey);return t?"Table: "+t.name:"Error: Table not found"}{let t=this.hubCache.hub.dexihDatalinks.find(t=>t.key===e.sourceDatalinkKey);return t?"Datalink: "+t.name:"Error: Datalink not found"}}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Api&&e.changeClass!==c.dc.TagObjects||this.updateApis()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["apis"]],inputs:{hubKey:"hubKey"},decls:12,vars:7,consts:[[1,"container-fluid"],["title","Api's","iconClass","fa fa-lg fa-fw fa-feed",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["actions",""],["select","rowStatus"],["rowStatus",""],["title","Connections","path","/assets/help/reference/api.md",1,"m-3"],[1,"ml-1",3,"objectType","objects"],[1,"ml-1",3,"key","objectType"],[3,"apis"],[3,"apiKey"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.editApi(e)})),l.Dc(3,Hn,1,2,"ng-template",3,4,l.Ec),l.Dc(5,Gn,1,2,"ng-template",5,6,l.Ec),l.Dc(7,qn,1,1,"ng-template",null,7,l.Ec),l.Dc(9,Bn,1,1,"ng-template",8,9,l.Ec),l.Nb(),l.Nb(),l.Lb(11,"dexih-help",10),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,g.a,f.a,_n.a,Zn.a],encapsulation:2}),e})();var zn=i("v6kC");function Wn(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-refresh",11),l.Vb("click",(function(){return l.vc(e),l.Zb().runDatalinks()})),l.Nb(),l.Ob(1,"dexih-button-cancel",12),l.Vb("click",(function(){return l.vc(e),l.Zb().cancel()})),l.Nb()}}function Qn(e,t){if(1&e&&(l.Ob(0,"div",16),l.Fc(1),l.Nb()),2&e){const e=t.$implicit;l.yb(1),l.Hc(" ",e.name," ")}}function $n(e,t){if(1&e&&(l.Ob(0,"label",13),l.Fc(1,"Run the following datalink(s):"),l.Nb(),l.Ob(2,"div",14),l.Dc(3,Qn,2,1,"div",15),l.ac(4,"fieldSort"),l.Nb()),2&e){const e=l.Zb();l.yb(3),l.hc("ngForOf",l.cc(4,1,e.datalinks,"name"))}}function Xn(e,t){if(1&e){const e=l.Pb();l.Ob(0,"span",20),l.Ob(1,"div",21),l.Ob(2,"div",18),l.Fc(3),l.Nb(),l.Nb(),l.Ob(4,"form-input",22),l.Vb("ngModelChange",(function(i){return l.vc(e),t.$implicit.value=i})),l.Nb(),l.Nb()}if(2&e){const e=t.$implicit,i=t.index;l.yb(3),l.Hc(" ",e.logicalName," "),l.yb(1),l.jc("name","column",i,""),l.hc("placeholder",e.logicalName)("ngModel",e.value)}}function Yn(e,t){if(1&e&&(l.Ob(0,"div",17),l.Ob(1,"div",18),l.Fc(2," Input Values "),l.Nb(),l.Dc(3,Xn,5,4,"span",19),l.Nb()),2&e){const e=l.Zb();l.yb(3),l.hc("ngForOf",e.inputColumns)}}function Jn(e,t){if(1&e&&(l.Ob(0,"div"),l.Ob(1,"label",13),l.Fc(2,"Parameters:"),l.Nb(),l.Lb(3,"input-parameters-view",23),l.Nb()),2&e){const e=l.Zb();l.yb(3),l.hc("parameters",e.parameters)}}const es=function(){return{standalone:!0}};let ts=(()=>{class e{constructor(e,t,i){this.hubService=e,this.authService=t,this.route=i,this.cancelToken=new x.a,this.truncateTable=!1,this.resetIncremental=!1,this.resetValue="",this.isRefreshing=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{let t=e[0],i=e[1];if(this.hubCache=e[2],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache.isLoaded()){let e=i.datalinkKeys;this.datalinks=new Array,e&&(this.inputColumns=[],this.parameters=[],e.split("|").map(e=>+e).forEach(e=>{let t=this.hubCache.hub.dexihDatalinks.find(t=>t.key===e);this.datalinks.push(t),t.sourceDatalinkTable.dexihDatalinkColumns.filter(e=>e.isInput).forEach(i=>{this.inputColumns.push({datalinkKey:e,datalinkName:t.name,name:i.name,logicalName:i.logicalName,dataType:i.dataType,rank:i.rank,value:i.defaultValue,defaultValue:i.defaultValue})}),t.parameters.forEach(e=>{this.parameters.findIndex(t=>t.name===e.name)<0&&this.parameters.push(e)})}))}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datalink Preview")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}runDatalinks(){this.hubService.runDatalinks(this.datalinks.map(e=>e.key),this.truncateTable,this.resetIncremental,this.resetValue,this.inputColumns,this.parameters,this.cancelToken),this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["datalink-run"]],decls:20,vars:13,consts:[[1,"container"],["title","Datalink Options","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","padding","close"],["header",""],["subHeader",""],[1,"form-row"],[1,"col"],["label","Truncate all target tables before execution.",3,"ngModel","ngModelOptions","ngModelChange"],["label","Reset the source incremental value, and load all source rows.",3,"ngModel","ngModelOptions","ngModelChange"],["label","Incremental Value","placeholder","","iconClass","fa fa-list","note","Use a specific incremental value to start loading source rows from (leave empty for null value)",3,"ngModel","ngModelOptions","ngModelChange"],["class","d-flex flex-wrap pt-1",4,"ngIf"],[4,"ngIf"],["text","Run Now",1,"mr-1",3,"click"],[3,"click"],[1,"label"],[1,"d-flex","flex-wrap"],["class","alert alert-primary m-1",4,"ngFor","ngForOf"],[1,"alert","alert-primary","m-1"],[1,"d-flex","flex-wrap","pt-1"],[1,"input-group-text"],["class","input-group",4,"ngFor","ngForOf"],[1,"input-group"],[1,"input-group-prepend"],[1,"form-control","p-0",3,"name","placeholder","ngModel","ngModelChange"],[3,"parameters"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,Wn,2,0,"ng-template",null,2,l.Ec),l.Dc(4,$n,5,4,"ng-template",null,3,l.Ec),l.Ob(6,"form"),l.Ob(7,"fieldset"),l.Ob(8,"section"),l.Ob(9,"div",4),l.Ob(10,"section",5),l.Ob(11,"form-checkbox",6),l.Vb("ngModelChange",(function(e){return t.truncateTable=e})),l.Nb(),l.Nb(),l.Nb(),l.Ob(12,"div",4),l.Ob(13,"section",5),l.Ob(14,"form-checkbox",7),l.Vb("ngModelChange",(function(e){return t.resetIncremental=e})),l.Nb(),l.Nb(),l.Nb(),l.Ob(15,"div",4),l.Ob(16,"section",5),l.Ob(17,"form-input",8),l.Vb("ngModelChange",(function(e){return t.resetValue=e})),l.Nb(),l.Nb(),l.Nb(),l.Dc(18,Yn,4,1,"div",9),l.Dc(19,Jn,4,1,"div",10),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(10),l.hc("ngModel",t.truncateTable)("ngModelOptions",l.lc(10,es)),l.yb(3),l.hc("ngModel",t.resetIncremental)("ngModelOptions",l.lc(11,es)),l.yb(3),l.hc("ngModel",t.resetValue)("ngModelOptions",l.lc(12,es)),l.yb(1),l.hc("ngIf",t.inputColumns&&t.inputColumns.length>0),l.yb(1),l.hc("ngIf",t.parameters&&t.parameters.length>0))},directives:[b.P,a.I,a.t,a.u,b.A,a.s,a.v,b.D,p.t,b.s,b.b,p.s,zn.a],pipes:[xt.a],encapsulation:2}),e})();var is=i("Kj3r"),as=i("nlsZ"),ns=i("bRjT"),ss=i("eOAR"),os=i("OO45"),rs=i("mj3h"),cs=i("0oH3"),ls=i("qKhg"),us=i("OWar"),hs=i("5Av2"),bs=i("cSor"),ds=i("Hd2u"),ms=i("awqr");let fs=(()=>{class e{transform(e){return T.h.find(t=>t.key===e).name}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=l.Jb({name:"objectTypeName",type:e,pure:!0}),e})();function ps(e,t){if(1&e&&(l.Ob(0,"form",8),l.Ob(1,"fieldset"),l.Ob(2,"div",9),l.Ob(3,"section",10),l.Lb(4,"form-input",11),l.Nb(),l.Ob(5,"section",10),l.Lb(6,"form-select",12),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.hc("formGroup",e.searchForm),l.yb(6),l.hc("items",e.searchObjectTypes)}}function gs(e,t){1&e&&(l.Ob(0,"div",5),l.Ob(1,"h5"),l.Fc(2,"No search results available."),l.Nb(),l.Nb())}function vs(e,t){if(1&e&&l.Lb(0,"datajob-view",27),2&e){const e=l.Zb().$implicit;l.hc("datajob",e.object)}}function ys(e,t){if(1&e&&l.Lb(0,"datalink-view",28),2&e){const e=l.Zb().$implicit;l.hc("datalink",e.object)}}function Cs(e,t){if(1&e&&l.Lb(0,"connection-view",29),2&e){const e=l.Zb().$implicit;l.hc("connection",e.object)}}function ws(e,t){if(1&e&&l.Lb(0,"table-view",30),2&e){const e=l.Zb().$implicit;l.hc("connection",e.objectParent)("table",e.object)}}function Ss(e,t){if(1&e&&l.Lb(0,"table-column-view",31),2&e){const e=l.Zb().$implicit;l.hc("table",e.objectParent)("column",e.object)}}function ks(e,t){if(1&e&&l.Lb(0,"columnValidation-view",32),2&e){const e=l.Zb().$implicit;l.hc("columnValidation",e.object)}}function Os(e,t){if(1&e&&l.Lb(0,"fileFormat-view",33),2&e){const e=l.Zb().$implicit;l.hc("fileFormat",e.object)}}function Ts(e,t){if(1&e&&l.Lb(0,"view-view",34),2&e){const e=l.Zb().$implicit;l.hc("view",e.object)}}function Ns(e,t){if(1&e&&l.Lb(0,"api-view",35),2&e){const e=l.Zb().$implicit;l.hc("api",e.object)}}function Ds(e,t){if(1&e&&l.Lb(0,"dashboard-view",36),2&e){const e=l.Zb().$implicit;l.hc("dashboard",e.object)}}function xs(e,t){if(1&e&&l.Lb(0,"listOfValues-view",37),2&e){const e=l.Zb().$implicit;l.hc("listOfValues",e.object)}}function Fs(e,t){if(1&e&&l.Lb(0,"datalinkTest-view",38),2&e){const e=l.Zb().$implicit;l.hc("datalinkTest",e.object)}}function Vs(e,t){if(1&e&&(l.Ob(0,"li",13),l.Ob(1,"div"),l.Ob(2,"h5"),l.Fc(3),l.ac(4,"objectTypeName"),l.Nb(),l.Nb(),l.Ob(5,"div",14),l.Dc(6,vs,1,1,"datajob-view",15),l.Dc(7,ys,1,1,"datalink-view",16),l.Dc(8,Cs,1,1,"connection-view",17),l.Dc(9,ws,1,2,"table-view",18),l.Dc(10,Ss,1,2,"table-column-view",19),l.Dc(11,ks,1,1,"columnValidation-view",20),l.Dc(12,Os,1,1,"fileFormat-view",21),l.Dc(13,Ts,1,1,"view-view",22),l.Dc(14,Ns,1,1,"api-view",23),l.Dc(15,Ds,1,1,"dashboard-view",24),l.Dc(16,xs,1,1,"listOfValues-view",25),l.Dc(17,Fs,1,1,"datalinkTest-view",26),l.Nb(),l.Nb()),2&e){const e=t.$implicit,i=l.Zb();l.yb(3),l.Gc(l.bc(4,14,e.objectType)),l.yb(2),l.hc("ngSwitch",e.objectType),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.Datajob),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.Datalink),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.Connection),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.Table),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.TableColumn),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.ColumnValidation),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.FileFormat),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.View),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.Api),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.Dashboard),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.ListOfValues),l.yb(1),l.hc("ngSwitchCase",i.eSearchObjectType.DatalinkTest)}}let Is=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.route=i,this.router=a,this.fb=n,this.searchObjectTypes=T.h,this.eSearchObjectType=T.l,this.isFirst=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];if(this.hubCache=e[1],!this.isFirst){this.isFirst=!1;let e=+t.searchObject;e||(e=0),this.searchForm=this.fb.group({searchString:[t.search,[]],searchObject:[e,[]]}),this.updateSearch(),this._searchSubscription&&this._searchSubscription.unsubscribe(),this._searchSubscription=this.searchForm.valueChanges.pipe(Object(is.a)(500)).subscribe(e=>{this.updateSearch()})}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Search")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._searchSubscription&&this._searchSubscription.unsubscribe()}close(){this.authService.navigateUp()}updateSearch(){if(this.hubCache.isLoaded()&&(this.searchResults=this.hubCache.search(this.searchForm.value.searchString,this.searchForm.value.searchObject),history.pushState)){let e=this.hubCache.getHubUrl()+"/search",t=this.searchForm.value.searchString,i=this.searchForm.value.searchObject;t&&(e+="/"+i+"/"+t),this.router.navigateByUrl(e)}}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.a),l.Kb(s.e),l.Kb(a.g))},e.\u0275cmp=l.Eb({type:e,selectors:[["search"]],decls:8,vars:5,consts:[[1,"container-fluid"],["title","Search Results","iconClass","fa fa-lg fa-fw fa-search",3,"showCloseButton","padding","close"],[3,"formGroup",4,"ngIf"],["role","content"],["class","well",4,"ngIf"],[1,"well"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Search Term","formControlName","searchString","placeholder","Search...","iconClass","fa fa-search"],["label","Restrict to","formControlName","searchObject","itemKey","key","itemName","name",3,"items"],[1,"list-group-item"],[1,"col-xs-9",3,"ngSwitch"],[3,"datajob",4,"ngSwitchCase"],[3,"datalink",4,"ngSwitchCase"],[3,"connection",4,"ngSwitchCase"],[3,"connection","table",4,"ngSwitchCase"],[3,"table","column",4,"ngSwitchCase"],[3,"columnValidation",4,"ngSwitchCase"],[3,"fileFormat",4,"ngSwitchCase"],[3,"view",4,"ngSwitchCase"],[3,"api",4,"ngSwitchCase"],[3,"dashboard",4,"ngSwitchCase"],[3,"listOfValues",4,"ngSwitchCase"],[3,"datalinkTest",4,"ngSwitchCase"],[3,"datajob"],[3,"datalink"],[3,"connection"],[3,"connection","table"],[3,"table","column"],[3,"columnValidation"],[3,"fileFormat"],[3,"view"],[3,"api"],[3,"dashboard"],[3,"listOfValues"],[3,"datalinkTest"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,ps,7,2,"form",2),l.Ob(3,"div",3),l.Dc(4,gs,3,0,"div",4),l.Ob(5,"div",5),l.Ob(6,"ul",6),l.Dc(7,Vs,18,16,"li",7),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(1),l.hc("ngIf",t.searchForm),l.yb(2),l.hc("ngIf",!t.searchResults||0==(null==t.searchResults?null:t.searchResults.length)),l.yb(3),l.hc("ngForOf",t.searchResults))},directives:[b.P,p.t,p.s,a.I,a.t,a.l,b.D,a.s,a.j,b.E,p.x,p.y,as.a,ns.a,ss.a,os.a,rs.a,cs.a,ls.a,us.a,hs.a,bs.a,ds.a,ms.a],pipes:[fs],encapsulation:2}),e})();var Ks=i("RRRx");let Es=(()=>{class e{}return e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({factory:function(t){return new(t||e)},providers:[],imports:[[n.a,Ks.a,a.C]]}),e})();var Ls=i("SmOL");function Ps(e,t){if(1&e&&l.Lb(0,"dependent-items-button",9),2&e){const e=t.item,i=l.Zb();l.hc("key",e.key)("objectType",i.eSharedObjectType.Dashboard)}}function Ms(e,t){if(1&e&&l.Lb(0,"tags-update-button",10),2&e){const e=t.items,i=l.Zb();l.hc("objectType",i.eSharedObjectType.Dashboard)("objects",e)}}function js(e,t){1&e&&l.Lb(0,"actions-dashboard-button",11),2&e&&l.hc("dashboards",t.items)}let As=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{iconClass:"sharedIcon",tooltip:"sharedToolTip",width:"1%",align:"center"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[2],this.updateDashboards()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Dashboard Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}delete(e){this.hubService.deleteDashboards(e)}updateDashboards(){if(this.hubCache&&this.hubCache.isLoaded()){let e;e=this.hubCache.hub.dexihDashboards.filter(e=>e.isValid);let t=e.map(e=>({key:e.key,name:e.name,tags:this.hubCache.getObjectTags(c.dc.Dashboard,e.key),updateDate:e.updateDate,sharedIcon:e.isShared?"fa fa-group":"fa fa-user-secret",sharedToolTip:e.isShared?"Table is shared":"Table is private"}));this._tableData.next(t)}else this._tableData.next(null)}edit(e){this.router.navigate(["dashboard-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubCache,i=this.hubService.createHub(t.hub.hubKey,"");e.forEach(e=>{t.cacheAddDashboard(e.key,i)}),this.hubService.exportHub(i,1===e.length?"Dashboard - "+e[0].name+".json":"dashboards.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.Dashboard&&e.changeClass!==c.dc.TagObjects||this.updateDashboards()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["dashboards"]],inputs:{hubKey:"hubKey"},decls:10,vars:7,consts:[[1,"container-fluid"],["title","Dashboards","iconClass","fa fa-lg fa-fw fa-pie-chart",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["title","Dashboards","path","/assets/help/reference/dashboard.md",1,"m-3"],[1,"ml-1",3,"key","objectType"],[1,"ml-1",3,"objectType","objects"],[3,"dashboards"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,Ps,1,2,"ng-template",3,4,l.Ec),l.Dc(5,Ms,1,2,"ng-template",5,6,l.Ec),l.Dc(7,js,1,1,"ng-template",null,7,l.Ec),l.Nb(),l.Nb(),l.Lb(9,"dexih-help",8),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,W.a,f.a,g.a,Ls.a],encapsulation:2}),e})();function Rs(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-refresh",10),l.Vb("click",(function(){return l.vc(e),l.Zb().run()})),l.Nb(),l.Ob(1,"dexih-button-refresh",11),l.Vb("click",(function(){return l.vc(e),l.Zb().activate()})),l.Nb(),l.Ob(2,"dexih-button-cancel",12),l.Vb("click",(function(){return l.vc(e),l.Zb().cancel()})),l.Nb()}}function _s(e,t){if(1&e&&(l.Ob(0,"span",16),l.Fc(1),l.Nb()),2&e){const e=t.$implicit;l.yb(1),l.Hc(" ",e.name," ")}}function Zs(e,t){if(1&e&&(l.Ob(0,"label",13),l.Fc(1,"Run the following datajobs(s):"),l.Nb(),l.Ob(2,"div"),l.Ob(3,"div",14),l.Dc(4,_s,2,1,"span",15),l.ac(5,"fieldSort"),l.Nb(),l.Nb()),2&e){const e=l.Zb();l.yb(4),l.hc("ngForOf",l.cc(5,1,e.datajobs,"name"))}}function Hs(e,t){if(1&e&&(l.Ob(0,"div",17),l.Ob(1,"div",18),l.Fc(2," Input Parameters "),l.Nb(),l.Lb(3,"input-parameters-view",19),l.Nb()),2&e){const e=l.Zb();l.yb(3),l.hc("parameters",e.parameters)}}i("LyCD"),i("NbKI");const Gs=function(){return{standalone:!0}};let qs=(()=>{class e{constructor(e,t,i){this.hubService=e,this.authService=t,this.route=i,this.cancelToken=new x.a,this.truncateTable=!1,this.resetIncremental=!1,this.resetValue="",this.isRefreshing=!1}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{let t=e[0],i=e[1];if(this.hubCache=e[2],this.action=t.action,this.pageTitle=t.pageTitle,this.hubCache.isLoaded()){let e=i.datajobKeys;this.datajobs=new Array,e&&(this.parameters=[],e.split("|").map(e=>+e).forEach(e=>{let t=this.hubCache.hub.dexihDatajobs.find(t=>t.key===e);this.datajobs.push(t),t.parameters.forEach(e=>{this.parameters.findIndex(t=>e.name===t.name)<0&&this.parameters.push({name:e.name,value:e.value,rank:e.rank})})}))}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Datajob Run")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}run(){this.hubService.runDatajobs(this.datajobs,this.truncateTable,this.resetIncremental,this.resetValue,this.parameters,this.cancelToken),this.authService.navigateUp()}activate(){this.hubService.activateDatajobs(this.datajobs,this.parameters,this.cancelToken),this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["datajob-run"]],decls:19,vars:12,consts:[[1,"container"],["title","Datajob Options","iconClass","fa fa-lg fa-fw fa-exchange",3,"showCloseButton","padding","close"],["header",""],["subHeader",""],[1,"form-row"],[1,"col"],["label","Truncate all target tables before execution.",3,"ngModel","ngModelOptions","ngModelChange"],["label","Reset the source incremental value, and load all source rows.",3,"ngModel","ngModelOptions","ngModelChange"],["label","Incremental Value","placeholder","","iconClass","fa fa-list","note","Use a specific incremental value to start loading source rows from (leave empty for null value)",3,"ngModel","ngModelOptions","ngModelChange"],["class","d-flex flex-wrap pt-1",4,"ngIf"],["text","Run Now",1,"mr-1",3,"click"],["text","Activate Triggers",1,"mr-1",3,"click"],[3,"click"],[1,"label"],[1,"row"],["class","col alert alert-primary m-1",4,"ngFor","ngForOf"],[1,"col","alert","alert-primary","m-1"],[1,"d-flex","flex-wrap","pt-1"],[1,"input-group-text"],[3,"parameters"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Dc(2,Rs,3,0,"ng-template",null,2,l.Ec),l.Dc(4,Zs,6,4,"ng-template",null,3,l.Ec),l.Ob(6,"form"),l.Ob(7,"fieldset"),l.Ob(8,"section"),l.Ob(9,"div",4),l.Ob(10,"section",5),l.Ob(11,"form-checkbox",6),l.Vb("ngModelChange",(function(e){return t.truncateTable=e})),l.Nb(),l.Nb(),l.Nb(),l.Ob(12,"div",4),l.Ob(13,"section",5),l.Ob(14,"form-checkbox",7),l.Vb("ngModelChange",(function(e){return t.resetIncremental=e})),l.Nb(),l.Nb(),l.Nb(),l.Ob(15,"div",4),l.Ob(16,"section",5),l.Ob(17,"form-input",8),l.Vb("ngModelChange",(function(e){return t.resetValue=e})),l.Nb(),l.Nb(),l.Nb(),l.Dc(18,Hs,4,1,"div",9),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0)("padding",!0),l.yb(10),l.hc("ngModel",t.truncateTable)("ngModelOptions",l.lc(9,Gs)),l.yb(3),l.hc("ngModel",t.resetIncremental)("ngModelOptions",l.lc(10,Gs)),l.yb(3),l.hc("ngModel",t.resetValue)("ngModelOptions",l.lc(11,Gs)),l.yb(1),l.hc("ngIf",t.parameters&&t.parameters.length>0))},directives:[b.P,a.I,a.t,a.u,b.A,a.s,a.v,b.D,p.t,b.s,b.b,p.s,zn.a],pipes:[xt.a],encapsulation:2}),e})();function Bs(e,t){if(1&e&&l.Lb(0,"save-button",17),2&e){const e=l.Zb(3);l.hc("formsService",e.formsService)}}function Us(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-invalid-form-details",14),l.Vb("click",(function(){return l.vc(e),l.Zb(2).formsService.showErrors()})),l.Nb(),l.Dc(1,Bs,1,1,"save-button",15),l.Lb(2,"cancel-button",16)}if(2&e){const e=l.Zb(2);l.hc("control",e.formsService.currentForm),l.yb(1),l.hc("ngIf",e.hubCache.canWrite),l.yb(1),l.hc("formsService",e.formsService)}}function zs(e,t){if(1&e&&(l.Ob(0,"section",8),l.Ob(1,"form-select",18),l.Lb(2,"table-edit-button",19),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",null==e.errors?null:e.errors.sourceTableKey)("items",e.connectionTables),l.yb(1),l.hc("key",e.formsService.currentForm.controls.sourceTableKey.value)}}function Ws(e,t){if(1&e&&(l.Ob(0,"section",8),l.Ob(1,"form-select",20),l.Lb(2,"datalink-edit-button",19),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(1),l.hc("errors",null==e.errors?null:e.errors.sourceDatalinkKey)("items",e.datalinks),l.yb(1),l.hc("key",e.formsService.currentForm.controls.sourceDatalinkKey.value)}}function Qs(e,t){if(1&e&&(l.Ob(0,"div",7),l.Ob(1,"section",21),l.Lb(2,"form-select",22),l.Nb(),l.Ob(3,"section",21),l.Lb(4,"form-select",23),l.Nb(),l.Ob(5,"section",21),l.Lb(6,"form-select",24),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(2),l.hc("items",e.tableColumns)("allowNullSelect",!0)("enableFilter",!1),l.yb(2),l.hc("items",e.tableColumns)("allowNullSelect",!0)("enableFilter",!1),l.yb(2),l.hc("items",e.tableColumns)("allowNullSelect",!0)("enableFilter",!1)}}function $s(e,t){1&e&&l.Lb(0,"form-input",29)}function Xs(e,t){if(1&e&&(l.Ob(0,"div",7),l.Ob(1,"section",25),l.Ob(2,"div",26),l.Lb(3,"form-checkbox",27),l.Dc(4,$s,1,0,"form-input",28),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.yb(3),l.hc("border",!0),l.yb(1),l.hc("ngIf",e.formsService.currentForm.controls.cache.value)}}function Ys(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button",32),l.Vb("click",(function(){return l.vc(e),l.Zb(3).add(-1)})),l.Fc(1,"Insert Item"),l.Nb(),l.Ob(2,"dexih-button-delete",33),l.Vb("click",(function(){return l.vc(e),l.Zb(3).clear()})),l.Nb()}}function Js(e,t){if(1&e){const e=l.Pb();l.Ob(0,"form",34),l.Ob(1,"div",35),l.Ob(2,"div",36),l.Lb(3,"form-input",37),l.Nb(),l.Ob(4,"div",36),l.Lb(5,"form-input",38),l.Nb(),l.Ob(6,"div",36),l.Lb(7,"form-input",39),l.Nb(),l.Ob(8,"div",40),l.Ob(9,"button",41),l.Vb("click",(function(){l.vc(e);const i=t.index;return l.Zb(3).add(i)})),l.Lb(10,"i",42),l.Nb(),l.Ob(11,"button",43),l.Vb("click",(function(){l.vc(e);const i=t.index;return l.Zb(3).remove(i)})),l.Lb(12,"i",44),l.Nb(),l.Nb(),l.Nb(),l.Nb()}2&e&&(l.hc("formGroup",t.$implicit),l.yb(3),l.hc("border",!1),l.yb(2),l.hc("border",!1),l.yb(2),l.hc("border",!1))}function eo(e,t){if(1&e&&(l.Ob(0,"dexih-widget-section",30),l.Dc(1,Ys,3,0,"ng-template",null,3,l.Ec),l.Dc(3,Js,13,4,"form",31),l.Nb()),2&e){const e=l.Zb(2);l.hc("showExpandButton",!0),l.yb(3),l.hc("ngForOf",e.formsService.currentForm.controls.staticData.controls)}}function to(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",49),l.Ob(1,"dexih-button-refresh",50),l.Vb("click",(function(){return l.vc(e),l.Zb(3).refreshData()})),l.Nb(),l.Nb()}2&e&&(l.yb(1),l.hc("autoCompact",!1))}function io(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-refresh",53),l.Vb("click",(function(){return l.vc(e),l.Zb(4).refreshData()})),l.Nb()}}function ao(e,t){if(1&e&&(l.Ob(0,"dexih-table",51),l.Dc(1,io,1,0,"ng-template",null,52,l.Ec),l.Nb()),2&e){const e=l.Zb(3);l.hc("enableMultiSelect",!1)("enableSaveCsv",!0)("columns",e.columns)("data",e.data)}}function no(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-widget-section",45),l.Ob(1,"query-builder",46),l.Vb("hasChanged",(function(){return l.vc(e),l.Zb(2).hasChanged()}))("onRefreshData",(function(){return l.vc(e),l.Zb(2).refreshData()})),l.Nb(),l.Nb(),l.Dc(2,to,2,1,"div",47),l.Dc(3,ao,3,4,"dexih-table",48)}if(2&e){const e=l.Zb(2);l.hc("showExpandButton",!0),l.yb(1),l.hc("selectQuery",e.formsService.currentForm.controls.selectQuery.value)("columns",e.tableColumns)("inputColumns",e.inputColumns)("parameters",null)("refreshEvent",e.refreshDataSubject.asObservable()),l.yb(1),l.hc("ngIf",!e.data),l.yb(1),l.hc("ngIf",e.data)}}function so(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",1),l.Ob(1,"dexih-widget",2),l.Vb("close",(function(){return l.vc(e),l.Zb().close()})),l.Dc(2,Us,3,3,"ng-template",null,3,l.Ec),l.Ob(4,"form",4),l.Ob(5,"fieldset"),l.Ob(6,"section"),l.Lb(7,"form-input",5),l.Nb(),l.Ob(8,"section"),l.Lb(9,"form-textarea",6),l.Nb(),l.Ob(10,"section"),l.Ob(11,"div",7),l.Ob(12,"section",8),l.Lb(13,"form-select",9),l.Nb(),l.Dc(14,zs,3,3,"section",10),l.Dc(15,Ws,3,3,"section",10),l.Nb(),l.Dc(16,Qs,7,9,"div",11),l.Dc(17,Xs,5,2,"div",11),l.Nb(),l.Nb(),l.Nb(),l.Dc(18,eo,4,2,"dexih-widget-section",12),l.Dc(19,no,4,8,"ng-template",13),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.yb(1),l.hc("showCloseButton",!0)("padding",!1),l.yb(3),l.hc("formGroup",e.formsService.currentForm),l.yb(3),l.hc("autocapitalize",e.on)("errors",e.formsService.formErrors.name),l.yb(2),l.hc("showMarkdown",!0),l.yb(4),l.hc("items",e.sourceTypes)("enableFilter",!1),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eLOVObjectType.Table),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eLOVObjectType.Datalink),l.yb(1),l.hc("ngIf",e.tableColumns),l.yb(1),l.hc("ngIf",e.tableColumns),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.sourceType==e.eLOVObjectType.Static),l.yb(1),l.hc("ngIf",e.formsService.currentForm.value.sourceType!==e.eLOVObjectType.Static)}}let oo=(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.formsService=i,this.route=a,this.router=n,this.isLoaded=!1,this.refreshDataSubject=new Sn.a,this.cancelToken=new x.a,this.eLOVObjectType=c.Qb,this.connectionTables=[],this.datalinks=[],this.sourceTypes=c.Rb.filter(e=>e.key>0),this.columns=[{name:"key",title:"Key"},{name:"name",title:"Name"},{name:"description",title:"Description"}]}ngOnInit(){try{this._subscription=Object(r.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];this.params=e[1],this.hubCache=e[2],this.pageTitle=t.pageTitle,this.action=t.action,this.hubCache&&this.hubCache.status===T.j.Loaded&&(this.isLoaded&&"new"===this.action||(this.isLoaded&&this.formsService.hasChanged?this.authService.confirmDialog("Synchronization warning","The hub was disconnected, meaning this edit could have been changed by another session.  Would you like to discard the current changes, and reload the latest version?").then(e=>{e&&this.load()}).catch(e=>{}):this.load()))})}catch(e){this.hubService.addHubClientErrorMessage(e,"Edit List Of Values")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._sourceChangeSubscription&&this._sourceChangeSubscription.unsubscribe(),this.cancelToken.cancel()}load(){if(this.isLoaded=!0,this.connectionTables=this.hubCache.getConnectionTables(),this.datalinks=this.hubCache.hub.dexihDatalinks,"edit"===this.action)if(this.listOfValuesKey=+this.params.listOfValuesKey,this.listOfValuesKey)if(this.hubCache.hub&&this.hubCache.hub.dexihListOfValues){let e=this.hubCache.hub.dexihListOfValues.find(e=>e.key===this.listOfValuesKey);e.selectQuery||(e.selectQuery=new c.V),this.formsService.listOfValues(e)}else this.hubService.addHubErrorMessage("The hub cache is not loaded.");else this.hubService.addHubErrorMessage("There was no list of values specified to edit.");if("new"===this.action){let e=new c.E;e.selectQuery=new c.V,this.formsService.listOfValues(e),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe(e=>{let t=e.controls.key.value;if(t&&history.pushState){let e=window.location.pathname.replace("/listOfValues-new","/listOfValues-edit/"+t);this.router.navigateByUrl(e),this._formChangeSubscription.unsubscribe()}})}this.refreshColumns();let e=this.formsService.currentForm;this._sourceChangeSubscription=Object(kn.a)(e.controls.sourceType.valueChanges,e.controls.sourceTableKey.valueChanges,e.controls.sourceDatalinkKey.valueChanges).subscribe(()=>{this.refreshColumns()})}refreshColumns(){let e=this.formsService.currentForm;switch(e.controls.sourceType.value){case c.Qb.Datalink:let t=e.controls.sourceDatalinkKey.value,i=this.hubCache.hub.dexihDatalinks.find(e=>e.key===t);if(i){const e=new On.b;e.buildInputOutput(this.hubCache,i),this.tableColumns=e.getDatalinkOutputColumns(i)}else t>0&&this.hubService.addHubErrorMessage(`The datalink with the key ${t} could not be found.`),this.tableColumns=null;break;case c.Qb.Table:let a=e.controls.sourceTableKey.value,n=this.hubCache.hub.dexihTables.find(e=>e.key===a);n?this.tableColumns=n.dexihTableColumns:(a>0&&this.hubService.addHubErrorMessage(`The table with the key ${a} could not be found.`),this.tableColumns=null)}}refreshData(){this.hubService.previewListOfValues(this.formsService.currentForm.value,!0,this.cancelToken).then(e=>{this.data=e,this.refreshDataSubject.next()}).catch(e=>{this.hubService.addHubMessage(e)})}hasChanged(){}add(e){let t=this.formsService.currentForm,i=this.formsService.listOfValuesItem(new c.R);t.controls.staticData.insert(e+1,i)}remove(e){this.formsService.currentForm.controls.staticData.removeAt(e)}clear(){let e=this.formsService.currentForm.controls.staticData;for(;e.controls.length>0;)e.removeAt(0)}close(){this.authService.navigateUp()}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(N.a),l.Kb(s.a),l.Kb(s.e))},e.\u0275cmp=l.Eb({type:e,selectors:[["dexih-listOfValues-edit-form"]],features:[l.xb([N.a])],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["title","Edit List of Values","iconClass","fa fa-lg fa-list-alt",3,"showCloseButton","padding","close"],["header",""],[1,"m-3",3,"formGroup"],["label","List of Values","formControlName","name","placeholder","Enter the list of values name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[1,"form-row"],[1,"form-group","col-md-6"],["label","Data Source Type","formControlName","sourceType","itemKey","key","itemName","name","iconClass","fa fa-database","note","Specify the source type for this view",3,"items","enableFilter"],["class","form-group col-md-6",4,"ngIf"],["class","form-row",4,"ngIf"],["title","Static Values",3,"showExpandButton",4,"ngIf"],[3,"ngIf"],[1,"mr-1",3,"control","click"],["class","mr-1",3,"formsService",4,"ngIf"],[3,"formsService"],[1,"mr-1",3,"formsService"],["label","Source Table","formControlName","sourceTableKey","parentName","name","childItems","dexihTables","itemKey","key","itemName","logicalName","note","Select the source table",3,"errors","items"],[3,"key"],["label","Source Datalink","formControlName","sourceDatalinkKey","itemKey","key","itemName","name","note","Select the source datalink",3,"errors","items"],[1,"form-group","col-md-4"],["label","Key Column","formControlName","keyColumn","itemKey","name","itemName","name","iconClass","fa fa-key",3,"items","allowNullSelect","enableFilter"],["label","Name Column","formControlName","nameColumn","itemKey","name","itemName","name","iconClass","fa fa-circle-o",3,"items","allowNullSelect","enableFilter"],["label","Description Column","formControlName","descriptionColumn","itemKey","name","itemName","name","iconClass","fa fa-comment-o",3,"items","allowNullSelect","enableFilter"],[1,"form-group","col-md-12"],[1,"d-flex","flex-wrap","pt-1"],["label","Cache Lookup","formControlName","cache",1,"input-group-prepend",3,"border"],["type","number","class","pl-1","labelLeft","Cache Seconds","placeholder","seconds","title","Specify the number of seconds to cache the lookup","formControlName","cacheSeconds",4,"ngIf"],["type","number","labelLeft","Cache Seconds","placeholder","seconds","title","Specify the number of seconds to cache the lookup","formControlName","cacheSeconds",1,"pl-1"],["title","Static Values",3,"showExpandButton"],["class","flex-fill",3,"formGroup",4,"ngFor","ngForOf"],["iconClass","fa fa-plus",1,"mr-1",3,"click"],["text","Clear All",3,"click"],[1,"flex-fill",3,"formGroup"],[1,"input-group"],[1,"form-control","p-0"],["formControlName","key","type","text","placeholder","Key Value",3,"border"],["formControlName","name","type","text","placeholder","Item name",3,"border"],["formControlName","key","type","text","placeholder","Description",3,"border"],[1,"input-group-append","flex-shrink-1","ml-1"],["type","button","value","Add",1,"btn","btn-light",3,"click"],[1,"fa","fa-plus-square-o"],["type","button","value","Remove",1,"btn","btn-light",3,"click"],[1,"fa","fa-minus-square-o"],["title","Query Configuration",3,"showExpandButton"],[3,"selectQuery","columns","inputColumns","parameters","refreshEvent","hasChanged","onRefreshData"],["class","m-3",4,"ngIf"],[3,"enableMultiSelect","enableSaveCsv","columns","data",4,"ngIf"],[1,"m-3"],["text","Reload",3,"autoCompact","click"],[3,"enableMultiSelect","enableSaveCsv","columns","data"],["actions",""],["text","Reload",1,"mr-1",3,"click"]],template:function(e,t){1&e&&l.Dc(0,so,20,14,"div",0),2&e&&l.hc("ngIf",t.formsService.currentForm)},directives:[p.t,b.P,a.I,a.t,a.l,b.D,a.s,a.j,b.H,b.E,V.a,F.a,I.a,Dn.a,xn.a,b.A,b.T,p.s,b.f,b.g,Tn.a,b.s,d.a],encapsulation:2}),e})();const ro=function(e){return["listOfValues-edit",e]};function co(e,t){if(1&e&&(l.Lb(0,"dexih-button-edit",8),l.Lb(1,"dependent-items-button",9)),2&e){const e=t.item,i=l.Zb();l.hc("routerLink",l.mc(3,ro,e.key)),l.yb(1),l.hc("key",e.key)("objectType",i.eSharedObjectType.ListOfValues)}}function lo(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",10),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().delete(t)})),l.Nb()}}function uo(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",10),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().export(i)})),l.Nb(),l.Dc(1,lo,1,0,"dexih-button-delete",11),l.Lb(2,"tags-update-button",12)}if(2&e){const e=t.items,i=l.Zb();l.yb(1),l.hc("ngIf",i.hubCache.canWrite),l.yb(1),l.hc("objectType",i.eSharedObjectType.ListOfValues)("objects",e)}}const ho=function(){return["listOfValues-new"]};function bo(e,t){1&e&&l.Lb(0,"dexih-button-new",14),2&e&&l.hc("routerLink",l.lc(1,ho))}function mo(e,t){if(1&e&&l.Dc(0,bo,1,2,"dexih-button-new",13),2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite)}}let fo=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.eSharedObjectType=c.dc,this.columns=[{name:"name",title:"Name",format:"",tags:"tags"},{name:"sourceType",title:"Source Type",format:"Enum",enum:c.Qb},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){try{this.watchChanges(),this._subscription=Object(r.a)(this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[0],this.update()})}catch(e){this.hubService.addHubClientErrorMessage(e,"Hub List of Values Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}delete(e){this.hubService.deleteListOfValues(e)}update(){if(this.hubCache&&this.hubCache.isLoaded()){let e=this.hubCache.hub.dexihListOfValues.filter(e=>e.isValid).map(e=>({key:e.key,name:e.name,description:e.description,updateDate:e.updateDate,tags:this.hubCache.getObjectTags(c.dc.ListOfValues,e.key)}));this._tableData.next(e)}else this._tableData.next(null)}edit(e){this.router.navigate(["listOfValues-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubCache,i=this.hubService.createHub(t.hub.hubKey,"");i.dexihListOfValues=e,e.forEach(e=>{t.getListOfValuesCache(e,i)}),this.hubService.exportHub(i,"list_of_values.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==c.dc.ListOfValues&&e.changeClass!==c.dc.TagObjects||this.update()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(u.a),l.Kb(h.a),l.Kb(s.e),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["listOfValues"]],decls:9,vars:7,consts:[[1,"container-fluid"],["title","List Of Values","iconClass","fa fa-lg fa-fw fa-list-alt",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["queryParamsHandling","","preserveFragment","",1,"mr-1",3,"routerLink"],[1,"ml-1",3,"key","objectType"],[1,"mr-1",3,"click"],["class","mr-1",3,"click",4,"ngIf"],[1,"mr-1",3,"objectType","objects"],["class","mr-1",3,"routerLink",4,"ngIf"],[1,"mr-1",3,"routerLink"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,co,2,5,"ng-template",3,4,l.Ec),l.Dc(5,uo,3,3,"ng-template",5,6,l.Ec),l.Dc(7,mo,1,1,"ng-template",null,7,l.Ec),l.Nb(),l.Nb(),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[b.P,d.a,b.j,s.f,f.a,b.u,p.t,g.a,b.g,b.o],encapsulation:2}),e})();var po=i("R0Ic"),go=i("Xjf6");function vo(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-edit",12),l.Vb("click",(function(){l.vc(e);const t=l.Zb();return t.edit(t.item)})),l.Nb()}}function yo(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-delete",12),l.Vb("click",(function(){l.vc(e);const t=l.Zb().items;return l.Zb().delete(t)})),l.Nb()}}function Co(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-save-local",12),l.Vb("click",(function(){l.vc(e);const i=t.items;return l.Zb().export(i)})),l.Nb(),l.Dc(1,yo,1,0,"dexih-button-delete",13)}if(2&e){const e=l.Zb();l.yb(1),l.hc("ngIf",e.hubCache.canWrite)}}function wo(e,t){if(1&e){const e=l.Pb();l.Ob(0,"dexih-button-new",12),l.Vb("click",(function(){return l.vc(e),l.Zb(2).new()})),l.Nb()}}function So(e,t){if(1&e&&l.Dc(0,wo,1,0,"dexih-button-new",13),2&e){const e=l.Zb();l.hc("ngIf",e.hubCache.canWrite)}}const ko=function(e){return{"background-color":e,"margin-bottom":"0"}};function Oo(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",14),l.Vb("click",(function(){l.vc(e);const i=t.item;return l.Zb().edit(i)})),l.Ob(1,"span",15),l.Fc(2),l.Nb(),l.Nb()}if(2&e){const e=t.item;l.hc("ngStyle",l.mc(2,ko,e.color)),l.yb(2),l.Gc(e.name)}}function To(e,t){if(1&e){const e=l.Pb();l.Ob(0,"button",35),l.Vb("click",(function(){l.vc(e);const i=t.$implicit;return l.Zb(3).selectColor(i)})),l.Nb()}2&e&&l.Cc("background-color",t.$implicit.color)}function No(e,t){if(1&e&&(l.Ob(0,"form",21),l.Ob(1,"div",22),l.Ob(2,"section",23),l.Lb(3,"form-input",24),l.Nb(),l.Ob(4,"section",25),l.Ob(5,"div"),l.Ob(6,"label",26),l.Fc(7,"Color"),l.Nb(),l.Ob(8,"div",27),l.Ob(9,"label",28),l.Lb(10,"input",29),l.Nb(),l.Lb(11,"form-input",30),l.Ob(12,"div",31),l.Dc(13,To,1,2,"button",32),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Ob(14,"div",22),l.Ob(15,"section",33),l.Lb(16,"form-textarea",34),l.Nb(),l.Nb(),l.Nb()),2&e){const e=l.Zb(2);l.hc("formGroup",e.formsService.currentForm),l.yb(3),l.hc("autocapitalize",!0)("errors",e.formsService.formErrors.name),l.yb(6),l.Cc("background-color",e.formsService.currentForm.controls.color.value),l.yb(4),l.hc("ngForOf",e.colors),l.yb(3),l.hc("showMarkdown",!0)}}function Do(e,t){if(1&e){const e=l.Pb();l.Ob(0,"div",16),l.Ob(1,"div",17),l.Ob(2,"b"),l.Fc(3,"Add/Edit Tag"),l.Nb(),l.Nb(),l.Ob(4,"div",18),l.Dc(5,No,17,7,"form",19),l.Nb(),l.Ob(6,"div",20),l.Ob(7,"dexih-button-save",12),l.Vb("click",(function(){return l.vc(e),l.Zb().save()})),l.Nb(),l.Ob(8,"dexih-button-cancel",12),l.Vb("click",(function(){return l.vc(e),l.Zb().cancel()})),l.Nb(),l.Nb(),l.Nb()}if(2&e){const e=l.Zb();l.hc("@slideDown",e.state),l.yb(5),l.hc("ngIf",e.formsService.currentForm)}}const xo={path:"result-view/:auditConnectionKey/:auditKey",children:[{path:"",pathMatch:"full",component:Ji.b,data:{pageTitle:"Detailed Result"}},{path:"result-view/:auditConnectionKey/:auditKey",children:[{path:"",pathMatch:"full",component:Ji.b,data:{pageTitle:"Child Result"}},{path:"result-view/:auditConnectionKey/:auditKey",children:[{path:"",pathMatch:"full",component:Ji.b,data:{pageTitle:"GrandChild Result"}}]}]}]},Fo=[{path:"table-edit/:tableKey",data:{pageTitle:"Edit Table",action:"edit"},loadChildren:()=>Promise.all([i.e(1),i.e(0)]).then(i.bind(null,"gQFH")).then(e=>e.TableEditModule)},{path:"table-new",data:{pageTitle:"New Table",action:"new"},loadChildren:()=>Promise.all([i.e(1),i.e(0)]).then(i.bind(null,"gQFH")).then(e=>e.TableEditModule)},{path:"table-new/:connectionKey",data:{pageTitle:"New Table",action:"new"},loadChildren:()=>Promise.all([i.e(1),i.e(0)]).then(i.bind(null,"gQFH")).then(e=>e.TableEditModule)},{path:"datalink-new/:sourceTableKeys/:targetConnectionKey",component:At,data:{action:"new",pageTitle:"New Datalink"}},{path:"table-preview/:tableKey",component:xa,data:{pageTitle:"Preview Table"}}],Vo=[{path:"datalink-edit",loadChildren:()=>Promise.all([i.e(1),i.e(14)]).then(i.bind(null,"8Hfl")).then(e=>e.DatalinkEditModule)},{path:"datalink-preview/:datalinkKey/:previewUpdates",component:_t,data:{pageTitle:"Preview Datalink"}},{path:"table-preview/:tableKey",component:xa,data:{pageTitle:"Preview Table"}},{path:"datalink-run/:datalinkKeys",component:ts,data:{pageTitle:"Run Datalink"}},xo],Io={path:"tables",data:{pageTitle:"Tables"},children:[{path:"",pathMatch:"full",component:Da,data:{pageTitle:"Tables"}},{path:"",children:Fo},{path:"",children:Vo}]},Ko=[{path:"connection-edit/:connectionKey",component:Ee,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit Connection"}},{path:"connection-import/:connectionKey",data:{pageTitle:"Import Tables"},children:[{path:"",pathMatch:"full",component:Ze,data:{pageTitle:"Import Tables"}},{path:"table-edit/:tableKey",data:{pageTitle:"Edit Table",action:"edit"},loadChildren:()=>Promise.all([i.e(1),i.e(0)]).then(i.bind(null,"gQFH")).then(e=>e.TableEditModule)},{path:"datalink-new/:sourceTableKeys/:targetConnectionKey",component:At,data:{action:"new",pageTitle:"New Datalink"}}]},{path:"connection-new/:purpose",component:Ee,data:{action:"new",pageTitle:"New Connection"}},{path:"connection-copy/:connectionKey",component:Ee,data:{action:"copy",pageTitle:"New Connection"}}],Eo=[{path:"",pathMatch:"full",component:Bi,data:{pageTitle:"Remote Agents"}},{path:"agent-edit/:remoteAgentKey/:remoteAgentHubKey",component:Yi,data:{pageTitle:"Edit Agent"}}],Lo=[{path:"results",data:{pageTitle:"Execution Results"},children:[{path:"",pathMatch:"full",component:Ji.a,data:{pageTitle:"Execution Results"}},xo]},xo],Po=[{path:"customFunction-edit/:customFunctionKey",component:sn,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit Custom Function"}},{path:"customFunction-new",component:sn,data:{action:"new",pageTitle:"New Custom Function"}}],Mo=[{path:"columnValidation-edit/:validationKey",component:U,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit Validation"}},{path:"columnValidation-new",component:U,data:{action:"new",pageTitle:"New Validation"}}],jo=[{path:"fileFormat-edit/:fileFormatKey",component:Zt.a,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit FileFormat"}},{path:"fileFormat-new",component:Zt.a,data:{action:"new",pageTitle:"New FileFormat"}}],Ao=[{path:"view-edit/:viewKey",component:Cn.a,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit View"}},{path:"view-new",component:Cn.a,data:{action:"new",pageTitle:"New View"}}],Ro=[{path:"dashboard-edit/:dashboardKey",data:{pageTitle:"Edit Dashboard",action:"edit"},loadChildren:()=>Promise.all([i.e(0),i.e(3)]).then(i.bind(null,"DN8j")).then(e=>e.DashboardEditModule)},{path:"dashboard-new",data:{pageTitle:"New Dashboard",action:"new"},loadChildren:()=>Promise.all([i.e(0),i.e(3)]).then(i.bind(null,"DN8j")).then(e=>e.DashboardEditModule)}],_o=[{path:"listOfValues-edit/:listOfValuesKey",component:oo,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit List Of Values"}},{path:"listOfValues-new",component:oo,data:{action:"new",pageTitle:"New List of Values"}}],Zo=[{path:"api-edit/:apiKey",component:Rn,canDeactivate:[on.a],data:{action:"edit",pageTitle:"Edit Api"}},{path:"api-new",component:Rn,data:{action:"new",pageTitle:"New Api"}}],Ho=[{path:"hubVariable-edit/:hubVariableKey",component:xi,data:{action:"edit",pageTitle:"Edit Hub Variable"}},{path:"hubVariable-new",component:xi,data:{action:"new",pageTitle:"New Hub Variable"}}],Go=[{path:"datalinkTest-edit/:datalinkTestKey",data:{pageTitle:"Edit Datalink Test",action:"edit"},loadChildren:()=>i.e(6).then(i.bind(null,"3ZyD")).then(e=>e.DatalinkTestEditModule)},{path:"datalinkTest-new",data:{pageTitle:"New Datalink Test",action:"new"},loadChildren:()=>i.e(6).then(i.bind(null,"3ZyD")).then(e=>e.DatalinkTestEditModule)},{path:"datalinkTest-new/:datalinkKeys",component:yn,data:{pageTitle:"New Datalink Test",action:"new"}},xo],qo=[{path:"manage",children:[{path:"",component:pi,data:{action:"edit",pageTitle:"Manage Files"}},{path:":tableKey",data:{action:"edit",pageTitle:"Manage Files"},children:[{path:"",component:pi,data:{action:"edit",pageTitle:"Manage Files"}},{path:"file-preview/:path/:fileName",component:xa,data:{pageTitle:"Preview File"}}]}]},{path:"bulk-load",children:[{path:"",data:{action:"new",pageTitle:"Bulk Load Files"},loadChildren:()=>Promise.all([i.e(1),i.e(0),i.e(5)]).then(i.bind(null,"xgYh")).then(e=>e.FilesBulkLoadModule)},{path:":connectionKey",data:{action:"new",pageTitle:"Bulk Load Files"},loadChildren:()=>Promise.all([i.e(1),i.e(0),i.e(5)]).then(i.bind(null,"xgYh")).then(e=>e.FilesBulkLoadModule)}]}],Bo=[{path:"datajob-edit/:datajobKey",data:{pageTitle:"Edit Data Job",action:"edit"},loadChildren:()=>i.e(4).then(i.bind(null,"geWG")).then(e=>e.DatajobEditModule)},{path:"datajob-new",data:{pageTitle:"New Data Job",action:"new"},loadChildren:()=>i.e(4).then(i.bind(null,"geWG")).then(e=>e.DatajobEditModule)},{path:"datajob-run/:datajobKeys",component:qs,data:{pageTitle:"Run datajobs"}}],Uo=s.i.forChild([{path:"agents",data:{pageTitle:"Remote Agents"},children:Eo},{path:"connections",data:{pageTitle:"Connections"},children:[{path:"",pathMatch:"full",component:$e,data:{pageTitle:"Connections"}},{path:"",children:Ko},Io]},{path:"datalinks",data:{pageTitle:"Data Links"},children:[{path:"",pathMatch:"full",data:{pageTitle:"Data Links"},component:Dt},{path:"",children:Vo},{path:"",children:Lo}]},Io,{path:"datajobs",data:{pageTitle:"Data Jobs"},children:[{path:"",pathMatch:"full",component:gt},{path:"",children:Bo},{path:"",children:Lo}]},{path:"columnValidations",data:{pageTitle:"Column Validations"},children:[{path:"",pathMatch:"full",component:O},{path:"",children:Mo}]},{path:"customFunctions",data:{pageTitle:"Custom Functions"},children:[{path:"",pathMatch:"full",component:La},{path:"",children:Po}]},{path:"fileFormats",data:{pageTitle:"File Formats"},children:[{path:"",pathMatch:"full",component:Zt.b},{path:"",children:jo}]},{path:"views",data:{pageTitle:"Views"},children:[{path:"",pathMatch:"full",component:wn.a},{path:"",children:Ao}]},{path:"dashboards",data:{pageTitle:"Dashboards"},children:[{path:"",pathMatch:"full",component:As},{path:"",children:Ro}]},{path:"listOfValues",data:{pageTitle:"List of Values"},children:[{path:"",pathMatch:"full",component:fo},{path:"",children:_o}]},{path:"apis",data:{pageTitle:"Apis"},children:[{path:"",pathMatch:"full",component:Un},{path:"",children:Zo}]},{path:"hubVariables",data:{pageTitle:"Hub Variables"},children:[{path:"",pathMatch:"full",component:Oi},{path:"",children:Ho}]},{path:"manage",children:[{path:"manage-users",component:Li,data:{pageTitle:"Manage Users"}}]},{path:"import",children:[{path:"",pathMatch:"full",component:ot,data:{pageTitle:"Import Objects"}}]},{path:"export",children:[{path:"",pathMatch:"full",component:ut,data:{pageTitle:"Export Objects"}}]},{path:"sharedData",data:{pageTitle:"Shared Data"},children:[{path:"",pathMatch:"full",component:ha},{path:"",children:[{path:"table-preview/:tableKey",component:xa,data:{pageTitle:"Preview Table"}},{path:"datalink-preview/:datalinkKey",component:_t,data:{pageTitle:"Preview Datalink"}},{path:"dashboard-preview/:dashboardKey",data:{pageTitle:"Preview Dashboard",action:"edit"},loadChildren:()=>Promise.all([i.e(0),i.e(3)]).then(i.bind(null,"DN8j")).then(e=>e.DashboardEditModule)},{path:"view-preview/:viewKey",component:Cn.a,data:{pageTitle:"Preview View",action:"edit"}},{path:"api-preview/:apiKey",component:Rn,data:{pageTitle:"Preview Api",action:"edit"}}]}]},{path:"files",data:{pageTitle:"Files"},children:[{path:"",children:qo}]},{path:"datalinkTests",data:{pageTitle:"Datalink Tests"},children:[{path:"",pathMatch:"full",component:bn},{path:"",children:Go},{path:"",children:Lo}]},{path:"tags",component:(()=>{class e{constructor(e,t,i,a,n){this.hubService=e,this.authService=t,this.router=i,this.formsService=a,this.route=n,this.state="hide",this.colors=[{name:"primary",color:"#3a5f8d"},{name:"secondary",color:"#89B3BF"},{name:"success",color:"#479762"},{name:"warning",color:"#c4872a"},{name:"danger",color:"#f44336"},{name:"yellow",color:"yellow"},{name:"pink",color:"pink"},{name:"purple",color:"purple"},{name:"dark",color:"#1F2624"}],this.columns=[{name:"name",title:"Name",footer:"description",format:"Md"}],this._tableData=new o.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(r.a)(this.route.queryParams,this.hubService.getHubCacheObservable()).subscribe(e=>{let t=e[0];if(this.hubCache=e[1],t.key){let e=this.hubCache.hub.dexihTags.find(e=>e.key===+t.key);if(e){let t=this.hubCache.hub.dexihTags.find(t=>t.key===e.key);this.formsService.tag(t),this.state="show"}}this.update()})}catch(e){this.hubService.addHubClientErrorMessage(e,"View Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}update(){if(this.hubCache&&this.hubCache.isLoaded()){let e;e=this.hubCache.hub.dexihTags.filter(e=>e.isValid);let t=e.map(e=>({key:e.key,name:e.name,description:e.description,color:e.color,updateDate:e.updateDate}));this._tableData.next(t)}else this._tableData.next(null)}new(){let e=new c.J;this.formsService.tag(e),this.state="show"}edit(e){let t=this.hubCache.hub.dexihTags.find(t=>t.key===e.key);this.formsService.tag(t),this.state="show",history.pushState&&this.router.navigateByUrl(window.location.pathname+"?key="+e.key),document.body.scrollTop=0,document.documentElement.scrollTop=0}delete(e){this.hubService.deleteTags(e)}save(){this.formsService.save(!1).then(()=>{this.hide()}).catch()}cancel(){this.hide()}hide(){this.state="hide",history.pushState&&window.location.search&&this.router.navigateByUrl(window.location.pathname)}selectColor(e){this.formsService.currentForm.controls.color.setValue(e.color)}export(e){const t=this.hubCache,i=this.hubService.createHub(t.hub.hubKey,"");e.forEach(e=>{t.cacheAddTag(e.key,i)}),this.hubService.exportHub(i,1===e.length?"Tag - "+e[0].name+".json":"tags.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass===c.dc.Tags&&this.update()})}}return e.\u0275fac=function(t){return new(t||e)(l.Kb(go.a),l.Kb(h.a),l.Kb(s.e),l.Kb(N.a),l.Kb(s.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["tags"]],features:[l.xb([N.a])],decls:14,vars:6,consts:[[1,"container-fluid"],["title","Tags","iconClass","fa fa-lg fa-fw fa-tags",3,"showCloseButton","close"],["rowStatusHeading","Color",3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","rowClick"],["select","selectedItemAction"],["selectedItemAction",""],["select","selectedItemsAction"],["selectedItemsAction",""],["actions",""],["select","rowStatus"],["rowStatus",""],["tableHeader",""],["title","Views","path","/assets/help/reference/tag.md",1,"m-3"],[1,"mr-1",3,"click"],["class","mr-1",3,"click",4,"ngIf"],[1,"alert","p-1","text-center",3,"ngStyle","click"],[1,"blend-text","font-weight-bold"],[1,"card","mt-2",2,"width","100%"],[1,"card-header","text-white","bg-primary"],[1,"card-body"],[3,"formGroup",4,"ngIf"],[1,"card-footer"],[3,"formGroup"],[1,"form-row"],[1,"form-group","col-md-3"],["label","Tag Name","formControlName","name","placeholder","Enter the name.","iconClass","fa fa-list",3,"autocapitalize","errors"],[1,"form-group","col-md-9"],[1,"mt-1"],[1,"input-group","m-0"],[1,"btn","mr-1",2,"height","38px","width","76px"],["formControlName","color","hidden","","type","color"],["formControlName","color","placeholder","color",1,"mr-3",2,"height","38px","width","90px"],["data-toggle","buttons",1,"btn-group-toggle"],["class","btn mr-1","style","height: '38px'; width: '38px'",3,"background-color","click",4,"ngFor","ngForOf"],[1,"col-md-12"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[1,"btn","mr-1",2,"height","38px","width","38px",3,"click"]],template:function(e,t){1&e&&(l.Ob(0,"div",0),l.Ob(1,"dexih-widget",1),l.Vb("close",(function(){return t.close()})),l.Ob(2,"dexih-table",2),l.Vb("rowClick",(function(e){return t.edit(e)})),l.Dc(3,vo,1,0,"ng-template",3,4,l.Ec),l.Dc(5,Co,2,1,"ng-template",5,6,l.Ec),l.Dc(7,So,1,1,"ng-template",null,7,l.Ec),l.Dc(9,Oo,3,4,"ng-template",8,9,l.Ec),l.Dc(11,Do,9,2,"ng-template",null,10,l.Ec),l.Nb(),l.Nb(),l.Lb(13,"dexih-help",11),l.Nb()),2&e&&(l.yb(1),l.hc("showCloseButton",!0),l.yb(1),l.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData))},directives:[b.P,d.a,W.a,b.j,b.u,p.t,b.g,b.o,p.w,b.t,b.b,a.I,a.t,a.l,b.D,a.s,a.j,a.c,p.s,b.H],encapsulation:2,data:{animation:[Object(po.j)("slideDown",[Object(po.g)("hide",Object(po.h)({height:0,overflow:"hidden"})),Object(po.g)("show",Object(po.h)({height:"*",overflow:"unset"})),Object(po.i)("hide <=> show",Object(po.e)("200ms ease-in"))])]}}),e})()},{path:"search",data:{pageTitle:"Search"},children:[{path:"",pathMatch:"full",redirectTo:"0/"},{path:":searchObject/:search",pathMatch:"full",component:Is},{path:":searchObject/:search",loadChildren:()=>Promise.resolve().then(i.bind(null,"e1St")).then(e=>e.HubBaseModule)}]},{path:"",children:Ko},{path:"",children:Vo},{path:"",children:Fo},{path:"",children:Bo},{path:"",children:Lo},{path:"",children:Po},{path:"",children:Mo},{path:"",children:jo},{path:"",children:Ao},{path:"",children:Ro},{path:"",children:_o},{path:"",children:Zo},{path:"",children:Ho},{path:"",children:qo},{path:"",children:Eo},{path:"",children:Go}]);var zo=i("mCXf");let Wo=(()=>{class e{static forRoot(){return{ngModule:e,providers:[u.a,on.a]}}}return e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({factory:function(t){return new(t||e)},providers:[on.a],imports:[[n.a,Uo,a.C,Ks.a,zo.a,Es]]}),e})()},mCXf:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("PCNd"),n=i("RRRx"),s=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=s.Ib({type:e}),e.\u0275inj=s.Hb({factory:function(t){return new(t||e)},providers:[],imports:[[a.a,n.a]]}),e})()},wTS4:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return pe}));var a=i("2Vo4"),n=i("itXk"),s=i("3WyZ"),o=i("soiQ"),r=i("fXoL"),c=i("4Y1E"),l=i("tyNb"),u=i("Wumg"),h=i("H3K+"),b=i("3Pt+"),d=i("ofXK"),m=i("Npcx");function f(e,t){if(1&e){const e=r.Pb();r.Ob(0,"div",9),r.Ob(1,"div",10),r.Ob(2,"dexih-button-refresh",11),r.Vb("click",(function(){return r.vc(e),r.Zb().refresh()})),r.Nb(),r.Ob(3,"input",12),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb().rows=t})),r.Nb(),r.Nb(),r.Ob(4,"div",13),r.Ob(5,"form-select",14),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb().auditType=t})),r.Nb(),r.Nb(),r.Nb()}if(2&e){const e=r.Zb();r.yb(3),r.hc("ngModel",e.rows),r.yb(2),r.hc("ngModel",e.auditType)("border",!1)("items",e.auditTypes)("enableTextEntry",!1)("allowNullSelect",!0)}}function p(e,t){if(1&e){const e=r.Pb();r.Ob(0,"div",16),r.Ob(1,"form-tags-dropdown",17),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb(2).datalinks=t})),r.Nb(),r.Nb()}if(2&e){const e=r.Zb(2);r.yb(1),r.hc("ngModel",e.datalinks)("items",e.hubCache.hub.dexihDatalinks)("enableAddAll",!0)}}function g(e,t){if(1&e){const e=r.Pb();r.Ob(0,"div",16),r.Ob(1,"form-tags-dropdown",18),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb(2).datajobs=t})),r.Nb(),r.Nb()}if(2&e){const e=r.Zb(2);r.yb(1),r.hc("ngModel",e.datajobs)("items",e.hubCache.hub.dexihDatajobs)("enableAddAll",!0)}}function v(e,t){if(1&e){const e=r.Pb();r.Ob(0,"div",16),r.Ob(1,"form-tags-dropdown",19),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb(2).datalinkTests=t})),r.Nb(),r.Nb()}if(2&e){const e=r.Zb(2);r.yb(1),r.hc("ngModel",e.datalinkTests)("items",e.hubCache.hub.dexihDatalinkTests)("enableAddAll",!0)}}function y(e,t){if(1&e&&(r.Dc(0,p,2,3,"div",15),r.Dc(1,g,2,3,"div",15),r.Dc(2,v,2,3,"div",15)),2&e){const e=r.Zb();r.hc("ngIf","Datalink"===e.auditType),r.yb(1),r.hc("ngIf","Datajob"===e.auditType),r.yb(1),r.hc("ngIf","DatalinkTest"===e.auditType)}}const C=function(e,t){return[e,"datalink-edit","edit",t]},w=function(e,t){return["result-view",e,t]};function S(e,t){if(1&e&&(r.Lb(0,"dexih-button-edit",20),r.Lb(1,"dexih-button-view",21)),2&e){const e=t.item,i=r.Zb();r.hc("routerLink",r.nc(2,C,i.hubPath,e.referenceKey)),r.yb(1),r.hc("routerLink",r.nc(5,w,e.auditConnectionKey,e.auditKey))}}function k(e,t){1&e&&r.Lb(0,"datalink-status",22),2&e&&r.hc("writerResult",t.item)}let O=(()=>{class e{constructor(e,t,i){this.hubService=e,this.router=t,this.route=i,this.rows=20,this.cancelToken=new s.a,this.showPage=!1,this.showPageMessage="Loading...",this.columns=[{name:"auditKey",title:"#",format:""},{name:"auditType",title:"Type",format:""},{name:"referenceName",title:"Name",format:""},{name:"rowsTotal",title:"Rows Total",format:""},{name:"startTime",title:"Start Date",format:"Calendar"},{name:"startTime",title:"Time",format:"Time"},{name:"endTime",title:"Finished At",format:"Time"},{name:"message",title:"Message",format:""}],this.auditTypes=["Datalink","Datajob","DatalinkTest"],this._tableData=new a.a(null),this.tableData=this._tableData.asObservable(),this.datalinks=[],this.datajobs=[],this.datalinkTests=[],this.auditType=null}ngOnInit(){try{this._subscription=Object(n.a)(this.route.data,this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable(),this.hubService.getRemoteAgentObservable()).subscribe(e=>{let t=e[2];this.hubCache=e[3];let i=e[4];if(this.showPage=!1,this.showPageMessage="Waiting for an active remote agent...",this.hubCache.isLoaded()&&i){this.hubPath=this.hubCache.getHubUrl();let e=t.datalinkKeys,i=t.datajobKeys,a=t.datalinkTestKeys;e&&(this.datalinks=(e+"").split(",").map(e=>+e),this.auditType="Datalink"),i&&(this.datajobs=(i+"").split(",").map(e=>+e),this.auditType="Datajob"),a&&(this.datalinkTests=(a+"").split(",").map(e=>+e),this.auditType="DatalinkTest"),this.refresh(),this.showPage=!0,this.showPageMessage=""}})}catch(e){this.hubService.addHubClientErrorMessage(e,"Results Index")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._transformWriterResultChangeSubscription&&this._transformWriterResultChangeSubscription.unsubscribe(),this.cancelToken.cancel()}showResult(e){this.router.navigate(["result-view",e.auditConnectionKey,e.auditKey],{relativeTo:this.route})}refresh(){let e,t=[];switch(this.auditType){case"Datalink":e=this.datalinks,t=this.datalinks.map(e=>this.hubCache.hub.dexihDatalinks.find(t=>t.key===e).auditConnectionKey);break;case"Datajob":e=this.datajobs,t=this.datajobs.map(e=>this.hubCache.hub.dexihDatajobs.find(t=>t.key===e).auditConnectionKey);break;case"DatalinkTest":e=this.datalinkTests,t=this.datalinkTests.map(e=>this.hubCache.hub.dexihDatalinkTests.find(t=>t.key===e).auditConnectionKey);break;default:e=null}let i=t.filter((function(e,t,i){return i.indexOf(e)===t}));0===i.length&&(i=this.hubCache.hub.dexihConnections.filter(e=>e.purpose===o.jb.Managed).map(e=>e.key)),this.hubService.getAuditResults(this.auditType,i,e,!0,this.rows,this.cancelToken).then(e=>{this._tableData.next(e),this.watchChanges()})}watchChanges(){this._transformWriterResultChangeSubscription&&this._transformWriterResultChangeSubscription.unsubscribe(),this._transformWriterResultChangeSubscription=this.hubService.getTransformWriterResultChangeObservable().subscribe(e=>{let t=this._tableData.value;if(this.datalinks&&this.datalinks.findIndex(t=>t===e.referenceKey)>=0){let i=t.find(t=>t.auditKey===e.auditKey);i?(Object.assign(i,e),this._tableData.next(t)):this._tableData.next([e].concat(t))}if(this.datajobs&&this.datajobs.findIndex(t=>t===e.referenceKey)>=0){let i=t.find(t=>t.auditKey===e.auditKey);i?(Object.assign(i,e),this._tableData.next(t)):this._tableData.next([e].concat(t))}if(this.datalinkTests&&this.datalinkTests.findIndex(t=>t===e.referenceKey)>=0){let i=t.find(t=>t.auditKey===e.auditKey);i?(Object.assign(i,e),this._tableData.next(t)):this._tableData.next([e].concat(t))}})}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(c.a),r.Kb(l.e),r.Kb(l.a))},e.\u0275cmp=r.Eb({type:e,selectors:[["results-index"]],decls:11,vars:6,consts:[[1,"container-fluid"],["title","Execution Results","iconClass","fa fa-lg fa-fw fa-exchange"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","enableSaveCsv","rowClick"],["actions",""],["tableHeader",""],["select","selectedItemAction"],["selectedItemAction",""],["select","rowStatus"],["rowStatus",""],[1,"d-flex","flex-wrap"],[1,"input-group"],["text","Reload",1,"input-group-prepend",3,"click"],["type","number","placeholder","Maximum rows...","title","Specify the maximum rows to return",1,"form-control",2,"width","100%","max-width","100px",3,"ngModel","ngModelChange"],[1,"flex-fill","ml-1"],["labelLeft","Type","selectNullMessage","All types",1,"form-control","p-0",3,"ngModel","border","items","enableTextEntry","allowNullSelect","ngModelChange"],["class","d-flex flex-wrap pt-1",4,"ngIf"],[1,"d-flex","flex-wrap","pt-1"],["labelLeft","Datalinks","itemKey","key","itemName","name",3,"ngModel","items","enableAddAll","ngModelChange"],["labelLeft","Datajobs","itemKey","key","itemName","name",3,"ngModel","items","enableAddAll","ngModelChange"],["labelLeft","DatalinkTests","itemKey","key","itemName","name",3,"ngModel","items","enableAddAll","ngModelChange"],["text","Edit Datalink",1,"mr-1",3,"routerLink"],["queryParamsHandling","merge",3,"routerLink"],[3,"writerResult"]],template:function(e,t){1&e&&(r.Ob(0,"div",0),r.Ob(1,"dexih-widget",1),r.Ob(2,"dexih-table",2),r.Vb("rowClick",(function(e){return t.showResult(e)})),r.Dc(3,f,6,6,"ng-template",null,3,r.Ec),r.Dc(5,y,3,3,"ng-template",null,4,r.Ec),r.Dc(7,S,2,8,"ng-template",5,6,r.Ec),r.Dc(9,k,1,1,"ng-template",7,8,r.Ec),r.Nb(),r.Nb(),r.Nb()),2&e&&(r.yb(2),r.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("enableSaveCsv",!0))},directives:[u.P,h.a,u.s,b.y,b.c,b.s,b.v,u.E,d.t,u.G,u.j,l.f,u.y,m.a],encapsulation:2}),e})();var T=i("ElCs"),N=i("zQsl");const D=function(e){return["progress-bar",e]},x=function(e){return{width:e}};let F=(()=>{class e{constructor(){this.percent="0%"}ngOnInit(){if(0===this.value)this.percent="0%";else if(0===this.total)this.percent="100%";else{let e=100*this.value/this.total;e<0&&(e=0),e>100&&(e=100),this.percent=e.toString()+"%"}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Eb({type:e,selectors:[["result-progress"]],inputs:{value:"value",total:"total",caption:"caption",color:"color"},decls:8,vars:9,consts:[[1,""],[1,"text"],[1,"float-right"],[1,"progress",2,"width","100%"],[3,"ngClass","ngStyle"]],template:function(e,t){1&e&&(r.Ob(0,"div",0),r.Ob(1,"span",1),r.Fc(2),r.Ob(3,"span",2),r.Fc(4),r.Nb(),r.Nb(),r.Ob(5,"div",3),r.Ob(6,"div",4),r.Fc(7,"\xa0"),r.Nb(),r.Nb(),r.Nb()),2&e&&(r.yb(2),r.Hc(" ",t.caption," "),r.yb(2),r.Ic("",t.value,"/",t.total,""),r.yb(2),r.hc("ngClass",r.mc(5,D,t.color))("ngStyle",r.mc(7,x,t.percent)))},directives:[d.q,d.w],encapsulation:2}),e})();var V=i("WrAK");function I(e,t){1&e&&(r.Ob(0,"li",27),r.Ob(1,"h5"),r.Fc(2,"Error encountered!"),r.Nb(),r.Nb())}function K(e,t){1&e&&(r.Ob(0,"li",28),r.Ob(1,"h5"),r.Fc(2,"Finished Successfully"),r.Nb(),r.Nb())}function E(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-button",33),r.Vb("click",(function(){r.vc(e);const t=r.Zb(2);return t.exceptionHidden=!t.exceptionHidden})),r.Fc(1,"Details"),r.Nb()}}function L(e,t){if(1&e&&(r.Ob(0,"pre"),r.Fc(1),r.Nb()),2&e){const e=r.Zb(2);r.yb(1),r.Gc(e.auditResult.exceptionDetails)}}function P(e,t){if(1&e&&(r.Ob(0,"li",5),r.Ob(1,"div",29),r.Fc(2),r.Ob(3,"div",30),r.Dc(4,E,2,0,"dexih-button",31),r.Nb(),r.Nb(),r.Ob(5,"div"),r.Dc(6,L,2,1,"pre",32),r.Nb(),r.Nb()),2&e){const e=r.Zb();r.yb(2),r.Hc(" ",e.auditResult.message," "),r.yb(2),r.hc("ngIf",e.auditResult.exceptionDetails),r.yb(2),r.hc("ngIf",!e.exceptionHidden&&e.auditResult.exceptionDetails)}}function M(e,t){if(1&e&&(r.Ob(0,"div",9),r.Fc(1,"Target Table"),r.Nb(),r.Ob(2,"div",9),r.Fc(3),r.Nb(),r.Lb(4,"div",10)),2&e){const e=r.Zb();r.yb(3),r.Gc(e.auditResult.targetTableName)}}function j(e,t){if(1&e&&(r.Ob(0,"div",9),r.Fc(1,"Scheduled Time"),r.Nb(),r.Ob(2,"div",9),r.Fc(3),r.ac(4,"calendar"),r.Nb(),r.Lb(5,"div",10)),2&e){const e=r.Zb();r.yb(3),r.Gc(r.bc(4,1,e.auditResult.scheduledTime))}}function A(e,t){1&e&&(r.Ob(0,"li",13),r.Ob(1,"h5"),r.Fc(2,"Child Results"),r.Nb(),r.Nb())}function R(e,t){if(1&e&&(r.Ob(0,"div"),r.Ob(1,"div",35),r.Ob(2,"span",36),r.Fc(3),r.Nb(),r.Lb(4,"datalink-status",37),r.Nb(),r.Nb()),2&e){const e=t.$implicit;r.yb(3),r.Hc(" ","Table"===e.auditType?e.targetTableName:e.referenceName," "),r.yb(1),r.hc("writerResult",e)}}function _(e,t){if(1&e&&(r.Ob(0,"li",5),r.Dc(1,R,5,2,"div",34),r.Nb()),2&e){const e=r.Zb();r.yb(1),r.hc("ngForOf",e.auditResult.childResults)}}function Z(e,t){if(1&e&&r.Lb(0,"result-progress",38),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsReadPrimary)("total",e.auditResult.rowsReadPrimary+e.auditResult.rowsReadReference)}}function H(e,t){if(1&e&&r.Lb(0,"result-progress",39),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsReadReference)("total",e.auditResult.rowsReadPrimary+e.auditResult.rowsReadReference)}}function G(e,t){if(1&e&&r.Lb(0,"result-progress",40),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsCreated)("total",e.auditResult.rowsTotal)}}function q(e,t){if(1&e&&r.Lb(0,"result-progress",41),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsUpdated)("total",e.auditResult.rowsTotal)}}function B(e,t){if(1&e&&r.Lb(0,"result-progress",42),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsDeleted)("total",e.auditResult.rowsTotal)}}function U(e,t){if(1&e&&r.Lb(0,"result-progress",43),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsRejected)("total",e.auditResult.rowsTotal)}}function z(e,t){if(1&e&&r.Lb(0,"result-progress",44),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsPreserved)("total",e.auditResult.rowsTotal)}}function W(e,t){if(1&e&&r.Lb(0,"result-progress",45),2&e){const e=r.Zb();r.hc("value",e.auditResult.rowsIgnored)("total",e.auditResult.rowsTotal)}}function Q(e,t){if(1&e&&r.Lb(0,"result-progress",46),2&e){const e=r.Zb();r.hc("value",e.auditResult.passed)("total",e.auditResult.rowsTotal)}}function $(e,t){if(1&e&&r.Lb(0,"result-progress",47),2&e){const e=r.Zb();r.hc("value",e.auditResult.failed)("total",e.auditResult.rowsTotal)}}function X(e,t){if(1&e&&(r.Ob(0,"div",9),r.Fc(1),r.Nb(),r.Ob(2,"div",9),r.Fc(3),r.ac(4,"number"),r.Nb(),r.Lb(5,"div",10)),2&e){const e=t.$implicit;r.yb(1),r.Gc(e.transformName),r.yb(2),r.Hc("",0==e.seconds?"N/A":r.cc(4,2,e.rows/e.seconds,"1.2-2")," rows/second")}}let Y=(()=>{class e{constructor(e,t){this.route=e,this.router=t,this.exceptionHidden=!0,this.fail=!1,this.success=!1,this.eRunStatus=o.Yb,this.eTriggerMethod=o.oc}ngOnInit(){switch(this.runTime=this.auditResult.endTime?(new Date(this.auditResult.endTime).valueOf()-new Date(this.auditResult.startTime).valueOf())/1e3:this.auditResult.runStatus===o.Yb.Running||this.auditResult.runStatus===o.Yb.RunningErrors||this.auditResult.runStatus===o.Yb.Started?((new Date).valueOf()-new Date(this.auditResult.startTime).valueOf())/1e3:null,this.auditResult.runStatus){case o.Yb.Abended:case o.Yb.Cancelled:case o.Yb.Failed:case o.Yb.FinishedErrors:this.fail=!0;break;case o.Yb.Finished:case o.Yb.Passed:this.success=!0}this.barChartData=[{name:"Reading",value:this.rowsPerSecond(this.auditResult.rowsReadPrimary+this.auditResult.rowsReadReference,this.auditResult.readTicks)},{name:"Processing",value:this.rowsPerSecond(this.auditResult.rowsTotal,this.auditResult.processingTicks)},{name:"Writing",value:this.rowsPerSecond(this.auditResult.rowsTotal,this.auditResult.writeTicks)}]}numberWithCommas(e){const t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}rowsPerSecond(e,t){return 0===t?0:e/(t/1e7)}openResult(e){this.router.navigate(["..",e],{relativeTo:this.route})}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(l.a),r.Kb(l.e))},e.\u0275cmp=r.Eb({type:e,selectors:[["stats"]],inputs:{auditResult:"auditResult"},decls:75,vars:44,consts:[[1,"list-group"],["class","list-group-item list-group-item-danger",4,"ngIf"],["class","list-group-item list-group-item-success",4,"ngIf"],["class","list-group-item",4,"ngIf"],[1,"list-group-item","list-group-item-info","rounded-0"],[1,"list-group-item"],[1,"container"],[1,"row","rounded","text-white","bg-secondary"],[3,"ngIf"],[1,"col","border","border-white"],[1,"w-100"],["class","list-group-item list-group-item-info",4,"ngIf"],["class","list-group-item ",4,"ngIf"],[1,"list-group-item","list-group-item-info"],["caption","Source Rows","color","bg-color-blueDark",3,"value","total",4,"ngIf"],["caption","Joined Rows","color","bg-color-blueLight",3,"value","total",4,"ngIf"],["caption","Created","color","bg-color-greenDark",3,"value","total",4,"ngIf"],["caption","Updated","color","bg-color-blueDark",3,"value","total",4,"ngIf"],["caption","Deleted","color","bg-color-magenta",3,"value","total",4,"ngIf"],["caption","Rejected","color","bg-color-red",3,"value","total",4,"ngIf"],["caption","Preserved","color","bg-color-pinkDark",3,"value","total",4,"ngIf"],["caption","Ignored","color","bg-color-grayDark",3,"value","total",4,"ngIf"],["caption","Passed","color","bg-color-greenDark",3,"value","total",4,"ngIf"],["caption","Failed","color","bg-color-magenta",3,"value","total",4,"ngIf"],["ngFor","",3,"ngForOf"],[2,"display","grid"],["scheme","natural","yAxisLabel","rows/second","xAxisLabel","operation",3,"results","gradient","xAxis","yAxis","legend","showGridLines","showXAxisLabel","showYAxisLabel"],[1,"list-group-item","list-group-item-danger"],[1,"list-group-item","list-group-item-success"],[1,"d-flex","mb-2"],[1,"ml-auto"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf"],[1,""],[1,"text"],[3,"writerResult"],["caption","Source Rows","color","bg-color-blueDark",3,"value","total"],["caption","Joined Rows","color","bg-color-blueLight",3,"value","total"],["caption","Created","color","bg-color-greenDark",3,"value","total"],["caption","Updated","color","bg-color-blueDark",3,"value","total"],["caption","Deleted","color","bg-color-magenta",3,"value","total"],["caption","Rejected","color","bg-color-red",3,"value","total"],["caption","Preserved","color","bg-color-pinkDark",3,"value","total"],["caption","Ignored","color","bg-color-grayDark",3,"value","total"],["caption","Passed","color","bg-color-greenDark",3,"value","total"],["caption","Failed","color","bg-color-magenta",3,"value","total"]],template:function(e,t){1&e&&(r.Ob(0,"ul",0),r.Dc(1,I,3,0,"li",1),r.Dc(2,K,3,0,"li",2),r.Dc(3,P,7,3,"li",3),r.Ob(4,"li",4),r.Ob(5,"h5"),r.Fc(6,"Running Time"),r.Nb(),r.Nb(),r.Ob(7,"li",5),r.Ob(8,"div",6),r.Ob(9,"div",7),r.Dc(10,M,5,1,"ng-template",8),r.Ob(11,"div",9),r.Fc(12,"Run Status"),r.Nb(),r.Ob(13,"div",9),r.Fc(14),r.Nb(),r.Lb(15,"div",10),r.Ob(16,"div",9),r.Fc(17,"Start Date"),r.Nb(),r.Ob(18,"div",9),r.Fc(19),r.ac(20,"calendar"),r.Nb(),r.Lb(21,"div",10),r.Dc(22,j,6,3,"ng-template",8),r.Ob(23,"div",9),r.Fc(24,"Initialized"),r.Nb(),r.Ob(25,"div",9),r.Fc(26),r.ac(27,"calendar"),r.Nb(),r.Lb(28,"div",10),r.Ob(29,"div",9),r.Fc(30,"Started"),r.Nb(),r.Ob(31,"div",9),r.Fc(32),r.ac(33,"calendar"),r.Nb(),r.Lb(34,"div",10),r.Ob(35,"div",9),r.Fc(36,"Finished"),r.Nb(),r.Ob(37,"div",9),r.Fc(38),r.ac(39,"calendar"),r.Nb(),r.Lb(40,"div",10),r.Ob(41,"div",9),r.Fc(42,"Run Time"),r.Nb(),r.Ob(43,"div",9),r.Fc(44),r.ac(45,"number"),r.Nb(),r.Lb(46,"div",10),r.Ob(47,"div",9),r.Fc(48,"Triggered By"),r.Nb(),r.Ob(49,"div",9),r.Fc(50),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Dc(51,A,3,0,"li",11),r.Dc(52,_,2,1,"li",12),r.Ob(53,"li",13),r.Ob(54,"h5"),r.Fc(55,"Row Distribution"),r.Nb(),r.Nb(),r.Ob(56,"li",5),r.Dc(57,Z,1,2,"result-progress",14),r.Dc(58,H,1,2,"result-progress",15),r.Dc(59,G,1,2,"result-progress",16),r.Dc(60,q,1,2,"result-progress",17),r.Dc(61,B,1,2,"result-progress",18),r.Dc(62,U,1,2,"result-progress",19),r.Dc(63,z,1,2,"result-progress",20),r.Dc(64,W,1,2,"result-progress",21),r.Dc(65,Q,1,2,"result-progress",22),r.Dc(66,$,1,2,"result-progress",23),r.Nb(),r.Ob(67,"li",13),r.Ob(68,"h5"),r.Fc(69,"Performance Estimates (rows/second)"),r.Nb(),r.Nb(),r.Ob(70,"li",5),r.Ob(71,"div",7),r.Dc(72,X,6,5,"ng-template",24),r.Nb(),r.Ob(73,"div",25),r.Lb(74,"ngx-charts-bar-vertical",26),r.Nb(),r.Nb(),r.Nb()),2&e&&(r.yb(1),r.hc("ngIf",t.fail),r.yb(1),r.hc("ngIf",t.success),r.yb(1),r.hc("ngIf",null==t.auditResult?null:t.auditResult.message),r.yb(7),r.hc("ngIf",t.auditResult.targetTableName),r.yb(4),r.Gc(t.eRunStatus[t.auditResult.runStatus]),r.yb(5),r.Gc(r.bc(20,33,t.auditResult.initializeTime)),r.yb(3),r.hc("ngIf",t.auditResult.scheduledTime),r.yb(4),r.Gc(r.bc(27,35,t.auditResult.initializeTime)),r.yb(6),r.Gc(r.bc(33,37,t.auditResult.startTime)),r.yb(6),r.Gc(r.bc(39,39,t.auditResult.endTime)),r.yb(6),r.Hc("",r.cc(45,41,t.runTime,"1.2-2")," seconds"),r.yb(6),r.Gc(t.eTriggerMethod[t.auditResult.triggerMethod]),r.yb(1),r.hc("ngIf",(null==t.auditResult.childResults?null:t.auditResult.childResults.length)>0),r.yb(1),r.hc("ngIf",(null==t.auditResult.childResults?null:t.auditResult.childResults.length)>0),r.yb(5),r.hc("ngIf",t.auditResult.rowsReadPrimary>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsReadReference>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsCreated>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsUpdated>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsDeleted>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsRejected>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsPreserved>0),r.yb(1),r.hc("ngIf",t.auditResult.rowsIgnored>0),r.yb(1),r.hc("ngIf",t.auditResult.passed>0),r.yb(1),r.hc("ngIf",t.auditResult.failed>0),r.yb(6),r.hc("ngForOf",t.auditResult.performanceSummary),r.yb(2),r.hc("results",t.barChartData)("gradient",!0)("xAxis",!0)("yAxis",!0)("legend",!1)("showGridLines",!0)("showXAxisLabel",!0)("showYAxisLabel",!0))},directives:[d.t,d.s,N.p,u.f,m.a,F],pipes:[V.a,d.g],encapsulation:2}),e})();function J(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-button-refresh",2),r.Vb("click",(function(){return r.vc(e),r.Zb().refresh()})),r.Nb(),r.Ob(1,"dexih-button-download",3),r.Vb("click",(function(){return r.vc(e),r.Zb().download()})),r.Nb(),r.Ob(2,"div",4),r.Ob(3,"div",5),r.Ob(4,"form-checkbox",6),r.Vb("ngModelChange",(function(t){return r.vc(e),r.Zb().showDetailed=t}))("change",(function(){return r.vc(e),r.Zb().refresh()})),r.Nb(),r.Nb(),r.Nb()}if(2&e){const e=r.Zb();r.yb(4),r.hc("ngModel",e.showDetailed)("border",!0)}}let ee=(()=>{class e{constructor(e,t){this.authService=e,this.hubService=t,this.showDetailed=!1,this.cancelToken=new s.a}ngOnInit(){this.refresh()}ngOnDestroy(){this.cancelToken.cancel()}refresh(){this.hubService.previewProfileData(this.auditResult,!this.showDetailed,this.cancelToken).then(e=>{this.columns=e.columns,this.data=e.data}).catch(e=>{})}download(){this.hubService.downloadProfileData(this.auditResult,this.cancelToken)}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(T.a),r.Kb(c.a))},e.\u0275cmp=r.Eb({type:e,selectors:[["profile-results"]],inputs:{auditResult:"auditResult"},decls:3,vars:3,consts:[[3,"enableMultiSelect","columns","data"],["actions",""],["text","Reload",3,"click"],[1,"ml-1",3,"click"],[1,"d-flex","flex-wrap"],[1,"flex-fill","pl-1"],["label","Show Detailed Results",3,"ngModel","border","ngModelChange","change"]],template:function(e,t){1&e&&(r.Ob(0,"dexih-table",0),r.Dc(1,J,5,2,"ng-template",null,1,r.Ec),r.Nb()),2&e&&r.hc("enableMultiSelect",!1)("columns",t.columns)("data",t.data)},directives:[h.a,u.s,u.h,u.A,b.s,b.v],encapsulation:2}),e})();var te=i("XNiG"),ie=i("RXlv");function ae(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-button-refresh",3),r.Vb("click",(function(){return r.vc(e),r.Zb().refresh()})),r.Nb(),r.Ob(1,"dexih-button-download",4),r.Vb("click",(function(){return r.vc(e),r.Zb().download()})),r.Nb()}}function ne(e,t){if(1&e){const e=r.Pb();r.Ob(0,"query-builder",5),r.Vb("onRefreshData",(function(){return r.vc(e),r.Zb().refresh()})),r.Nb()}if(2&e){const e=r.Zb();r.hc("selectQuery",e.selectQuery)("columns",e.targetTable.dexihTableColumns)("inputColumns",e.inputColumns)("refreshEvent",e.refreshDataSubject.asObservable())}}let se=(()=>{class e{constructor(e){this.hubService=e,this.selectQuery=new o.V,this.refreshDataSubject=new te.a,this.cancelToken=new s.a}ngOnInit(){this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe(e=>{switch(this.cache=e,this.auditResult.auditType){case"Table":this.targetTable=this.cache.getTable(this.auditResult.referenceKey),this.refresh();break;case"Datalink":case"DatalinkStep":let e=this.cache.hub.dexihDatalinks.find(e=>e.key===this.auditResult.referenceKey);if(!e)return void this.hubService.addHubErrorMessage(`The datalink with the key ${this.auditResult.referenceKey} cannot be found.`);if(!(e.dexihDatalinkTargets.length>=1))return void this.hubService.addHubErrorMessage("There is no target table for this datalink.");this.targetTable=this.cache.getTable(e.dexihDatalinkTargets[0].tableKey),this.refresh();break;case"DatalinkTestStep":let t=this.cache.getDatalinkTestStep(this.auditResult.referenceKey);if(!t)return void this.hubService.addHubErrorMessage(`The test step with the key ${this.auditResult.referenceKey} cannot be found.`);let i=this.cache.hub.dexihDatalinks.find(e=>e.key===t.datalinkKey);if(!(i.dexihDatalinkTargets.length>=1))return void this.hubService.addHubErrorMessage("There is no target table for this datalink.");{let e=this.cache.getTable(i.dexihDatalinkTargets[0].tableKey),a=JSON.parse(JSON.stringify(e));a.name=t.errorTableName,a.schema=t.errorSchema,a.connectionKey=t.errorConnectionKey;for(let t of a.dexihTableColumns)t.deltaType=o.qb.NonTrackingField;let n=new o.I;n.name="error_audit_key",n.dataType=o.pc.Int64,n.deltaType=o.qb.CreateAuditKey;let s=new o.I;s.name="error_operation",s.dataType=o.pc.CharArray,s.maxLength=1,s.deltaType=o.qb.DatabaseOperation;let r=new o.I;r.name="mismatch_reason",r.dataType=o.pc.String,r.deltaType=o.qb.UpdateReason,a.dexihTableColumns.push(n),a.dexihTableColumns.push(s),a.dexihTableColumns.push(r),this.targetTable=a}this.refresh()}})}ngOnDestroy(){this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this.runningQuery&&this.runningQuery.cancel(),this.cancelToken.cancel()}createSelectQuery(){const e=this.targetTable.dexihTableColumns.find(e=>e.deltaType===o.qb.CreateAuditKey),t=this.targetTable.dexihTableColumns.find(e=>e.deltaType===o.qb.UpdateAuditKey);if(!e&&!t)return void this.hubService.addHubErrorMessage(`The table ${this.targetTable.name} does not contain a create or update audit column which is required to connect to an audit.`);let i=JSON.parse(JSON.stringify(this.selectQuery));if(e){let t=new o.N;t.column1=new o.X,Object.assign(t.column1,e),t.operator=o.hb.IsEqual,t.value2=this.auditResult.auditKey,t.andOr=o.cb.Or,t.compareDataType=o.pc.Int64,i.filters.push(t)}if(t){let e=new o.N;e.column1=new o.X,Object.assign(e.column1,t),e.operator=o.hb.IsEqual,e.value2=this.auditResult.auditKey,e.andOr=o.cb.Or,e.compareDataType=o.pc.Int64,i.filters.push(e)}return i.rows=100,i}refresh(){let e=this.createSelectQuery(),t=this.hubService.previewTableDataQuery(this.targetTable,!1,e,null,null,this.cancelToken);t.then(e=>{this.refreshDataSubject.next(),this.columns=e.columns,this.data=e.data}).catch(()=>{}),this.runningQuery=t}download(){let e=this.createSelectQuery(),t=new o.M;t.objectKey=this.targetTable.key,t.objectType=o.lb.Table,t.query=e,this.hubService.downloadData([t],!1,o.rb.Csv,this.cancelToken)}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(c.a))},e.\u0275cmp=r.Eb({type:e,selectors:[["preview-results"]],inputs:{auditResult:"auditResult"},decls:5,vars:3,consts:[[3,"enableMultiSelect","columns","data"],["actions",""],["tableHeader",""],["text","Reload",3,"click"],[1,"ml-1",3,"click"],[3,"selectQuery","columns","inputColumns","refreshEvent","onRefreshData"]],template:function(e,t){1&e&&(r.Ob(0,"dexih-table",0),r.Dc(1,ae,2,0,"ng-template",null,1,r.Ec),r.Dc(3,ne,1,4,"ng-template",null,2,r.Ec),r.Nb()),2&e&&r.hc("enableMultiSelect",!1)("columns",t.columns)("data",t.data)},directives:[h.a,u.s,u.h,ie.a],encapsulation:2}),e})();const oe=function(){return{view:"Profile"}};function re(e,t){if(1&e&&(r.Ob(0,"li",7),r.Ob(1,"a",8),r.Lb(2,"i",12),r.Ob(3,"span",10),r.Fc(4,"Profile Data"),r.Nb(),r.Nb(),r.Nb()),2&e){const e=r.Zb(3);r.yb(1),r.Cb("active","Profile"==e.view),r.hc("queryParams",r.lc(3,oe))}}const ce=function(){return{view:"Preview"}};function le(e,t){if(1&e&&(r.Ob(0,"li",7),r.Ob(1,"a",8),r.Lb(2,"i",13),r.Ob(3,"span",10),r.Fc(4,"Preview"),r.Nb(),r.Nb(),r.Nb()),2&e){const e=r.Zb(3);r.yb(1),r.Cb("active","Preview"==e.view),r.hc("queryParams",r.lc(3,ce))}}const ue=function(){return{view:"Stats"}};function he(e,t){if(1&e&&(r.Ob(0,"ul",6),r.Ob(1,"li",7),r.Ob(2,"a",8),r.Lb(3,"i",9),r.Ob(4,"span",10),r.Fc(5,"Execution Stats"),r.Nb(),r.Nb(),r.Nb(),r.Dc(6,re,5,4,"li",11),r.Dc(7,le,5,4,"li",11),r.Nb()),2&e){const e=r.Zb(2);r.yb(2),r.Cb("active","Stats"==e.view),r.hc("queryParams",r.lc(5,ue)),r.yb(4),r.hc("ngIf",e.auditResult.profileTableName&&("DatalinkStep"==(null==e.auditResult?null:e.auditResult.auditType)||"Datalink"==(null==e.auditResult?null:e.auditResult.auditType))),r.yb(1),r.hc("ngIf","DatalinkStep"==(null==e.auditResult?null:e.auditResult.auditType)||"Datalink"==(null==e.auditResult?null:e.auditResult.auditType)||"Table"==(null==e.auditResult?null:e.auditResult.auditType)||"DatalinkTestStep"==(null==e.auditResult?null:e.auditResult.auditType))}}function be(e,t){if(1&e&&(r.Ob(0,"div"),r.Lb(1,"stats",14),r.Nb()),2&e){const e=r.Zb(2);r.yb(1),r.hc("auditResult",e.auditResult)}}function de(e,t){if(1&e&&(r.Ob(0,"div"),r.Lb(1,"profile-results",14),r.Nb()),2&e){const e=r.Zb(2);r.yb(1),r.hc("auditResult",e.auditResult)}}function me(e,t){if(1&e&&(r.Ob(0,"div"),r.Lb(1,"preview-results",14),r.Nb()),2&e){const e=r.Zb(2);r.yb(1),r.hc("auditResult",e.auditResult)}}function fe(e,t){if(1&e){const e=r.Pb();r.Ob(0,"dexih-widget",2),r.Vb("close",(function(){return r.vc(e),r.Zb().close()})),r.Dc(1,he,8,6,"ng-template",null,3,r.Ec),r.Ob(3,"div",4),r.Dc(4,be,2,1,"div",5),r.Dc(5,de,2,1,"div",5),r.Dc(6,me,2,1,"div",5),r.Nb(),r.Nb()}if(2&e){const e=r.Zb();r.hc("title",null==e.auditResult?null:e.auditResult.referenceName)("showCloseButton",!0),r.yb(3),r.hc("ngSwitch",e.view),r.yb(1),r.hc("ngSwitchCase","Stats"),r.yb(1),r.hc("ngSwitchCase","Profile"),r.yb(1),r.hc("ngSwitchCase","Preview")}}let pe=(()=>{class e{constructor(e,t,i,a){this.hubService=e,this.authService=t,this.router=i,this.route=a,this.showPage=!1,this.showPageMessage="Loading...",this.cancelToken=new s.a}ngOnInit(){this.watchChanges();try{this._subscription=Object(n.a)(this.route.data,this.route.params,this.route.queryParams,this.hubService.getHubCacheObservable(!0),this.hubService.getRemoteAgentObservable(!0)).subscribe(e=>{let t=e[1],i=e[2];this.hubCache=e[3];let a=e[4],n=+t.auditConnectionKey,s=+t.auditKey;this.showPage=!1,this.showPageMessage="Waiting for an active remote agent...",this.view=i.view,this.view||(this.view="Stats"),a&&(this.showPage=!0,this.showPageMessage="",this.hubService.getResultDetail(n,s,this.cancelToken).then(e=>{this.auditResult=e[0]}))})}catch(e){this.hubService.addHubClientErrorMessage(e,"Results View")}}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe(),this._transformWriterResultChangeSubscription&&this._transformWriterResultChangeSubscription.unsubscribe(),this.cancelToken.cancel()}close(){this.authService.navigateUp()}watchChanges(){this._transformWriterResultChangeSubscription&&this._transformWriterResultChangeSubscription.unsubscribe(),this._transformWriterResultChangeSubscription=this.hubService.getTransformWriterResultChangeObservable().subscribe(e=>{this.auditResult&&e.auditConnectionKey===this.auditResult.auditConnectionKey&&e.auditKey===this.auditResult.auditKey&&(this.auditResult=e)})}}return e.\u0275fac=function(t){return new(t||e)(r.Kb(c.a),r.Kb(T.a),r.Kb(l.e),r.Kb(l.a))},e.\u0275cmp=r.Eb({type:e,selectors:[["results-view"]],decls:2,vars:1,consts:[[1,"container-fluid"],["iconClass","fa fa-lg fa-fw fa-trophy",3,"title","showCloseButton","close",4,"ngIf"],["iconClass","fa fa-lg fa-fw fa-trophy",3,"title","showCloseButton","close"],["header",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"nav","nav-tabs","card-header-tabs"],[1,"nav-item"],["routerLink",".",1,"nav-link",3,"queryParams"],[1,"fa","fa-clock-o"],[1,"ml-1","d-none","d-md-inline"],["class","nav-item",4,"ngIf"],[1,"fa","fa-tachometer"],[1,"fa","fa-table"],[3,"auditResult"]],template:function(e,t){1&e&&(r.Ob(0,"div",0),r.Dc(1,fe,7,6,"dexih-widget",1),r.Nb()),2&e&&(r.yb(1),r.hc("ngIf",t.auditResult))},directives:[d.t,u.P,d.x,d.y,l.h,Y,ee,se],encapsulation:2}),e})()},ynzd:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var a=i("2Vo4"),n=i("itXk"),s=i("soiQ"),o=i("fXoL"),r=i("4Y1E"),c=i("ElCs"),l=i("tyNb"),u=i("Wumg"),h=i("H3K+"),b=i("/pur"),d=i("mWX8"),m=i("VdXI"),f=i("axB7");function p(e,t){if(1&e&&o.Lb(0,"tags-update-button",9),2&e){const e=t.items,i=o.Zb();o.hc("objectType",i.eSharedObjectType.View)("objects",e)}}function g(e,t){if(1&e&&o.Lb(0,"dependent-items-button",10),2&e){const e=t.item,i=o.Zb();o.hc("key",e.key)("objectType",i.eSharedObjectType.View)}}function v(e,t){1&e&&o.Lb(0,"actions-view-button",11),2&e&&o.hc("views",t.items)}let y=(()=>{class e{constructor(e,t,i,n){this.hubService=e,this.authService=t,this.router=i,this.route=n,this.eSharedObjectType=s.dc,this.columns=[{name:"name",title:"Name",footer:"description",format:"Md",tags:"tags"},{iconClass:"sharedIcon",tooltip:"sharedToolTip",width:"1%",align:"center"},{name:"viewType",title:"Chart/Table"},{name:"sourceName",title:"Source"},{name:"updateDate",title:"Last Modified",format:"Calendar"}],this._tableData=new a.a(null),this.tableData=this._tableData.asObservable()}ngOnInit(){this.watchChanges();try{this._subscription=Object(n.a)(this.route.data,this.route.params,this.hubService.getHubCacheObservable()).subscribe(e=>{this.hubCache=e[2],this.updateViews()})}catch(e){this.hubService.addHubClientErrorMessage(e,"View Index")}}ngOnDestroy(){this._hubCacheChangeSubscription&&this._hubCacheChangeSubscription.unsubscribe(),this._subscription&&this._subscription.unsubscribe()}close(){this.authService.navigateUp()}deleteViews(e){this.hubService.deleteViews(e)}updateViews(){if(this.hubCache&&this.hubCache.isLoaded()){let e;e=this.hubCache.hub.dexihViews.filter(e=>e.isValid);let t=e.map(e=>{let t="";switch(e.sourceType){case s.lb.Table:let i=this.hubCache.getTable(e.sourceTableKey);t=i?i.logicalName:"Error, not found";break;case s.lb.Datalink:let a=this.hubCache.hub.dexihDatalinks.find(t=>t.key===e.sourceDatalinkKey);t=a?"Datalink: "+a.name:"Error, not found"}return{key:e.key,name:e.name,tags:this.hubCache.getObjectTags(s.dc.View,e.key),viewType:s.rc[e.viewType],sourceName:t,updateDate:e.updateDate,sharedIcon:e.isShared?"fa fa-group":"fa fa-user-secret",sharedToolTip:e.isShared?"Table is shared":"Table is private"}});this._tableData.next(t)}else this._tableData.next(null)}editView(e){this.router.navigate(["view-edit",e.key],{relativeTo:this.route})}export(e){const t=this.hubCache,i=this.hubService.createHub(t.hub.hubKey,"");e.forEach(e=>{t.cacheAddView(e.key,i)}),this.hubService.exportHub(i,1===e.length?"View - "+e[0].name+".json":"views.json")}watchChanges(){this._hubCacheChangeSubscription=this.hubService.getHubCacheChangeObservable().subscribe(e=>{e.changeClass!==s.dc.View&&e.changeClass!==s.dc.TagObjects||this.updateViews()})}}return e.\u0275fac=function(t){return new(t||e)(o.Kb(r.a),o.Kb(c.a),o.Kb(l.e),o.Kb(l.a))},e.\u0275cmp=o.Eb({type:e,selectors:[["views"]],inputs:{hubKey:"hubKey"},decls:10,vars:7,consts:[[1,"container-fluid"],["title","Views","iconClass","fa fa-lg fa-fw fa-bar-chart",3,"showCloseButton","close"],[3,"enableMultiSelect","enableStickyToolbar","toolbarZIndex","columns","dataObservable","tags","rowClick"],["select","selectedItemsAction"],["selectedItemsAction",""],["select","selectedItemAction"],["selectedItemAction",""],["actions",""],["title","Views","path","/assets/help/reference/view.md",1,"m-3"],[1,"ml-1",3,"objectType","objects"],[1,"ml-1",3,"key","objectType"],[3,"views"]],template:function(e,t){1&e&&(o.Ob(0,"div",0),o.Ob(1,"dexih-widget",1),o.Vb("close",(function(){return t.close()})),o.Ob(2,"dexih-table",2),o.Vb("rowClick",(function(e){return t.editView(e)})),o.Dc(3,p,1,2,"ng-template",3,4,o.Ec),o.Dc(5,g,1,2,"ng-template",5,6,o.Ec),o.Dc(7,v,1,1,"ng-template",null,7,o.Ec),o.Nb(),o.Nb(),o.Lb(9,"dexih-help",8),o.Nb()),2&e&&(o.yb(1),o.hc("showCloseButton",!0),o.yb(1),o.hc("enableMultiSelect",!0)("enableStickyToolbar",!0)("toolbarZIndex",100)("columns",t.columns)("dataObservable",t.tableData)("tags",t.hubCache.hub.dexihTags))},directives:[u.P,h.a,b.a,d.a,m.a,f.a],encapsulation:2}),e})()}}]);
//# sourceMappingURL=11-es2015.33015a32e2d353a57c9f.js.map