function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{DN8j:function(e,t,o){"use strict";o.r(t),o.d(t,"DashboardEditModule",(function(){return _}));var i=o("cvPx"),n=o("bK5D"),r=o("M0ag"),s=o("ofXK"),a=o("3Pt+"),c=o("LyCD"),l=(o("ynzd"),o("MbvK")),u=o("tyNb"),m=o("Xjf6"),h=o("XNiG"),b=o("Ljk9"),d=o("soiQ"),p=o("ElCs"),f=o("3WyZ"),v=o("fXoL"),g=o("Wumg"),w=o("YcGA"),C=o("NbKI"),x=["gridster"];function y(e,t){if(1&e){var o=v.Pb();v.Ob(0,"form",11),v.Ob(1,"fieldset"),v.Ob(2,"section"),v.Lb(3,"form-input",12),v.Nb(),v.Ob(4,"section"),v.Lb(5,"form-textarea",13),v.Nb(),v.Ob(6,"section"),v.Ob(7,"div",14),v.Ob(8,"section",15),v.Lb(9,"form-input",16),v.Nb(),v.Ob(10,"section",15),v.Lb(11,"form-input",17),v.Nb(),v.Ob(12,"section",15),v.Lb(13,"form-input",18),v.Nb(),v.Ob(14,"section",15),v.Lb(15,"form-input",19),v.Nb(),v.Ob(16,"dexih-button-refresh",20),v.Vb("click",(function(){return v.vc(o),v.Zb(2).updateGrid()})),v.Nb(),v.Nb(),v.Nb(),v.Ob(17,"section"),v.Lb(18,"form-checkbox",21),v.Lb(19,"form-checkbox",22),v.Nb(),v.Nb(),v.Nb()}if(2&e){var i=v.Zb(2);v.hc("formGroup",i.formsService.currentForm),v.yb(3),v.hc("autocapitalize",i.on)("errors",i.formsService.formErrors.name),v.yb(2),v.hc("showMarkdown",!0)}}function I(e,t){if(1&e&&(v.Ob(0,"dexih-widget-section",9),v.Dc(1,y,20,4,"form",10),v.Nb()),2&e){var o=v.Zb();v.hc("showExpandButton",!0),v.yb(1),v.hc("ngIf",o.formsService.currentForm)}}function E(e,t){if(1&e){var o=v.Pb();v.Ob(0,"dexih-widget-section",23),v.Vb("onChange",(function(){return v.vc(o),v.Zb().parameterChange()})),v.Ob(1,"input-parameters",24),v.Vb("onChange",(function(){return v.vc(o),v.Zb().parameterChange()}))("onRefreshData",(function(){return v.vc(o),v.Zb().refresh()})),v.Nb(),v.Nb()}if(2&e){var i=v.Zb();v.hc("showExpandButton",!0),v.yb(1),v.hc("showEdit",i.showEdit)("parameters",i.parameters)("formsService",i.formsService)("refreshEvent",i.refreshDataSubject.asObservable())}}function N(e,t){if(1&e){var o=v.Pb();v.Ob(0,"span",27),v.Ob(1,"div",28),v.Ob(2,"div",29),v.Fc(3),v.Nb(),v.Nb(),v.Ob(4,"form-input",30),v.Vb("ngModelChange",(function(e){return v.vc(o),t.$implicit.value=e})),v.Nb(),v.Nb()}if(2&e){var i=t.$implicit,n=t.index;v.yb(3),v.Hc(" ",i.logicalName," "),v.yb(1),v.jc("name","column",n,""),v.hc("placeholder","Enter "+i.logicalName)("ngModel",i.value)}}function S(e,t){if(1&e&&(v.Ob(0,"dexih-widget-section",25),v.Dc(1,N,5,4,"span",26),v.Nb()),2&e){var o=v.Zb();v.hc("showExpandButton",!0),v.yb(1),v.hc("ngForOf",o.inputColumns)}}var k=function(e,t,o,i,n){return{x:e,y:t,cols:o,rows:i,control:n}};function R(e,t){if(1&e){var o=v.Pb();v.Ob(0,"gridster-item",32),v.Ob(1,"dashboard-item",33),v.Vb("onRemove",(function(){v.vc(o);var e=t.index;return v.Zb(2).removeItem(e)}))("onMaximize",(function(e){return v.vc(o),v.Zb(2).maximize(e)})),v.Nb(),v.Nb()}if(2&e){var i=t.$implicit,n=v.Zb(2);v.hc("item",v.qc(4,k,i.controls.x.value,i.controls.y.value,i.controls.cols.value,i.controls.rows.value,i)),v.yb(1),v.hc("item",i)("showEdit",n.showEdit)("refreshData",i.controls.runTime.value.refreshData)}}function O(e,t){if(1&e&&v.Dc(0,R,2,10,"gridster-item",31),2&e){var o=v.Zb();v.hc("ngForOf",o.dashboardItemControls.controls)}}function D(e,t){if(1&e){var o=v.Pb();v.Ob(0,"div",34),v.Ob(1,"dashboard-item",35),v.Vb("onRemove",(function(){v.vc(o);var e=v.Zb();return e.removeItem(e.i)}))("onMaximize",(function(e){return v.vc(o),v.Zb().maximize(e)})),v.Nb(),v.Nb()}if(2&e){var i=v.Zb();v.yb(1),v.hc("item",i.maximizedItem)("showEdit",i.showEdit)("refreshData",i.maximizedItem.controls.runTime.value.refreshData)("isMaximized",!0)}}var M,z,T=function(e){return{"d-none":e}},P=u.i.forChild([{path:"",component:c.a,canDeactivate:[n.a],children:[{path:"",redirectTo:"properties"},{path:"properties",component:(M=function(){function e(t,o,i){_classCallCheck(this,e),this.authService=t,this.hubService=o,this.formsService=i,this.showEdit=!1,this.lock=!0,this.refreshDataSubject=new h.a,this.eViewType=d.rc,this.eSourceType=d.gc,this.cancelToken=new f.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.options={gridType:b.c.ScrollVertical,compactType:b.a.None,margin:5,outerMargin:!0,outerMarginTop:null,outerMarginRight:null,outerMarginBottom:null,outerMarginLeft:null,useTransformPositioning:!0,mobileBreakpoint:640,minCols:12,maxCols:100,minRows:6,maxRows:100,maxItemCols:100,minItemCols:1,maxItemRows:100,minItemRows:1,maxItemArea:2500,minItemArea:1,defaultItemCols:2,defaultItemRows:2,fixedColWidth:105,fixedRowHeight:105,keepFixedHeightInMobile:!1,keepFixedWidthInMobile:!1,scrollSensitivity:10,scrollSpeed:20,enableEmptyCellClick:!1,enableEmptyCellContextMenu:!1,enableEmptyCellDrop:!1,enableEmptyCellDrag:!1,emptyCellDragMaxCols:50,emptyCellDragMaxRows:50,ignoreMarginInRow:!1,draggable:{enabled:!1},resizable:{enabled:!1},swap:!1,pushItems:!0,disablePushOnDrag:!1,disablePushOnResize:!1,pushDirections:{north:!0,east:!0,south:!0,west:!0},pushResizeItems:!1,displayGrid:b.b.None,disableWindowResize:!1,disableWarnings:!1,scrollToNewItems:!1,itemChangeCallback:function(t,o){e.itemResize(t,o)},itemResizeCallback:function(t,o){e.itemResize(t,o)},itemInitCallback:function(t,o){e.itemResize(t,o)}},this._hubCacheSubscription=this.hubService.getHubCacheObservable().subscribe((function(t){t.isLoaded()&&(e.hubCache=t)})),this._formChangeSubscription=this.formsService.getCurrentFormObservable().subscribe((function(t){e.currentForm=t,t&&(e.dashboardItemControls=t.controls.dexihDashboardItems,e.parameters=t.controls.parameters,e.options.minCols=t.controls.minCols.value,e.options.maxCols=t.controls.maxCols.value,e.options.minRows=t.controls.minRows.value,e.options.maxRows=t.controls.maxRows.value,e.showEdit=t.controls.runTime.value.showEdit,e._runTimeSubscription&&e._runTimeSubscription.unsubscribe(),e._runTimeSubscription=t.controls.runTime.valueChanges.subscribe((function(t){e.showEdit=t.showEdit,e.lock=t.lock,e.updateShowEdit()})),e.updateShowEdit())}))}},{key:"ngOnDestroy",value:function(){this._formChangeSubscription&&this._formChangeSubscription.unsubscribe(),this._runTimeSubscription&&this._runTimeSubscription.unsubscribe(),this._hubCacheSubscription&&this._hubCacheSubscription.unsubscribe(),this.cancelToken.cancel()}},{key:"getNextPossiblePosition",value:function(){return this.gridster.getFirstPossiblePosition({x:0,y:0,cols:1,rows:1,control:null})}},{key:"updateShowEdit",value:function(){this.showEdit||!this.lock?(this.options.displayGrid=b.b.Always,this.options.draggable.enabled=!0,this.options.resizable.enabled=!0):(this.options.displayGrid=b.b.None,this.options.draggable.enabled=!1,this.options.resizable.enabled=!1),this.options=Object.assign({},this.options)}},{key:"itemResize",value:function(e,t){function o(e,t){e.value!==t&&e.setValue(t)}var i=e.control;o(i.controls.x,e.x),o(i.controls.y,e.y),o(i.controls.cols,e.cols),o(i.controls.rows,e.rows),t.width&&e.control.controls.runTime.value.resizeEvent.emit([t.width,t.height])}},{key:"removeItem",value:function(e){this.formsService.currentForm.controls.dexihDashboardItems.removeAt(e)}},{key:"updateGrid",value:function(){var e=this.formsService.currentForm;this.options.minCols=e.controls.minCols.value,this.options.maxCols=e.controls.maxCols.value,this.options.minRows=e.controls.minRows.value,this.options.maxRows=e.controls.maxRows.value,this.options=Object.assign({},this.options)}},{key:"maximize",value:function(e){this.maximizedItem=this.maximizedItem?null:e}},{key:"parameterChange",value:function(){this.formsService.currentForm.controls.autoRefresh.value&&this.refresh()}},{key:"refresh",value:function(){var e=this;this.hubService.previewDashboard(this.formsService.currentForm.value,this.formsService.currentForm.value.parameters,this.cancelToken).then((function(t){e.refreshDataSubject.next();var o=e.formsService.currentForm.controls.dexihDashboardItems;t.forEach((function(t){var i=o.controls.find((function(e){return e.controls.key.value===t.dashboardItemKey}));if(i){var n=i.controls.runTime.value.data;e.hubService.getRemoteResponse(t.dataKey,e.cancelToken).then((function(t){t.columns=e.authService.constructDataTableColumns(t.columns),t.status&&e.hubService.addHubMessage(t.status,!1,t.name),n.data.next(t)})).catch()}}))}))}}]),e}(),M.\u0275fac=function(e){return new(e||M)(v.Kb(p.a),v.Kb(m.a),v.Kb(i.a))},M.\u0275cmp=v.Eb({type:M,selectors:[["dashboard-properties"]],viewQuery:function(e,t){var o;1&e&&v.Bc(x,!0),2&e&&v.rc(o=v.Wb())&&(t.gridster=o.first)},inputs:{showEdit:"showEdit",lock:"lock"},decls:9,vars:9,consts:[[3,"ngClass"],["title","Properties",3,"showExpandButton",4,"ngIf"],["title","Parameters",3,"showExpandButton","onChange",4,"ngIf"],["title","InputColumns",3,"showExpandButton",4,"ngIf"],[2,"height","800px"],[3,"options"],["gridster",""],[3,"ngIf"],["class","position-relative","style","height:800px; overflow: hidden;",4,"ngIf"],["title","Properties",3,"showExpandButton"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["label","Dashboard Name","formControlName","name","placeholder","Enter the dashboard name.","iconClass","fa fa-list",3,"autocapitalize","errors"],["label","Description","formControlName","description","placeholder","Enter the description.",3,"showMarkdown"],[1,"form-row"],[1,"form-group","col-md-3"],["type","number","label","Minimum Columns","formControlName","minCols"],["type","number","label","Maximum Columns","formControlName","maxCols"],["type","number","label","Minimum Rows","formControlName","minRows"],["type","number","label","Maximum Rows","formControlName","maxRows"],["text","Update Grid",3,"click"],["formControlName","autoRefresh","label","Automatically refresh data when view is opened"],["label","Table is shared in the catalog to users with read access.","formControlName","isShared"],["title","Parameters",3,"showExpandButton","onChange"],[3,"showEdit","parameters","formsService","refreshEvent","onChange","onRefreshData"],["title","InputColumns",3,"showExpandButton"],["class","input-group",4,"ngFor","ngForOf"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control","p-0",3,"name","placeholder","ngModel","ngModelChange"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"item","showEdit","refreshData","onRemove","onMaximize"],[1,"position-relative",2,"height","800px","overflow","hidden"],[3,"item","showEdit","refreshData","isMaximized","onRemove","onMaximize"]],template:function(e,t){1&e&&(v.Ob(0,"div",0),v.Dc(1,I,2,2,"dexih-widget-section",1),v.Dc(2,E,2,5,"dexih-widget-section",2),v.Dc(3,S,2,2,"dexih-widget-section",3),v.Ob(4,"div",4),v.Ob(5,"gridster",5,6),v.Dc(7,O,1,1,"ng-template",7),v.Nb(),v.Nb(),v.Nb(),v.Dc(8,D,2,4,"div",8)),2&e&&(v.hc("ngClass",v.mc(7,T,t.maximizedItem)),v.yb(1),v.hc("ngIf",t.showEdit),v.yb(1),v.hc("ngIf",t.showEdit||(null==t.parameters?null:t.parameters.length)>0),v.yb(1),v.hc("ngIf",t.inputColumns&&t.inputColumns.length>0),v.yb(2),v.hc("options",t.options),v.yb(2),v.hc("ngIf",t.dashboardItemControls),v.yb(1),v.hc("ngIf",t.maximizedItem))},directives:[s.q,s.t,b.d,g.T,a.I,a.t,a.l,g.D,a.s,a.j,g.H,g.s,g.A,w.a,s.s,a.v,b.e,C.a],encapsulation:2}),M),data:{navigateSkip:!0}},{path:"view-edit/:viewKey",component:l.a,data:{action:"edit",pageTitle:"Edit View"}},{path:"view-new",component:l.a,data:{action:"new",pageTitle:"New View"}}]}]),F=o("RRRx"),_=((z=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(){return{ngModule:e,providers:[i.a]}}}]),e}()).\u0275mod=v.Ib({type:z}),z.\u0275inj=v.Hb({factory:function(e){return new(e||z)},providers:[i.a,n.a],imports:[[r.a,s.c,a.n,a.C,P,F.a]]}),z)}}]);